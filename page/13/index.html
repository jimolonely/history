<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-111673440-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>在我的世界</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="who,where,what">
<meta property="og:type" content="website">
<meta property="og:title" content="在我的世界">
<meta property="og:url" content="http://jimolonely.github.io/history/page/13/index.html">
<meta property="og:site_name" content="在我的世界">
<meta property="og:description" content="who,where,what">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Jackpler">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="在我的世界" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.1.0"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">在我的世界</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">home</a>
        
          <a class="main-nav-link" href="/archives">archives</a>
        
          <a class="main-nav-link" href="/about">about</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://jimolonely.github.io/history"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-maven/001-maven-tutorial" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/06/maven/001-maven-tutorial/" class="article-date">
  <time datetime="2018-09-06T07:54:57.000Z" itemprop="datePublished">2018-09-06</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/06/maven/001-maven-tutorial/">maven回眸</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>使用了这么多年的maven，maven的单词什么意思？</p>
<p>原来是 <strong>行家</strong>.</p>
<h1 id="maven方法"><a href="#maven方法" class="headerlink" title="maven方法"></a>maven方法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Builds</span><br><span class="line">Documentation</span><br><span class="line">Reporting</span><br><span class="line">Dependencies</span><br><span class="line">SCMs</span><br><span class="line">Releases</span><br><span class="line">Distribution</span><br><span class="line">Mailing list</span><br></pre></td></tr></table></figure>

<h1 id="POM-xml"><a href="#POM-xml" class="headerlink" title="POM.xml"></a>POM.xml</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">project dependencies</span><br><span class="line">plugins</span><br><span class="line">goals</span><br><span class="line">build profiles</span><br><span class="line">project version</span><br><span class="line">developers</span><br><span class="line">mailing list</span><br></pre></td></tr></table></figure>
<h2 id="Super-POM"><a href="#Super-POM" class="headerlink" title="Super POM"></a>Super POM</h2><p>Super POM是Maven的默认POM。 所有POM都继承自父级或默认（尽管明确定义与否）。 此基本POM称为Super POM，包含默认继承的值。</p>
<p>查看超级POM的默认配置的简单方法是运行以下命令：<code>mvn help:effective-pom</code></p>
<p>在任何目录中创建一个pom.xml：</p>
<figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns <span class="built_in">=</span> <span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">   xmlns:xsi <span class="built_in">=</span> <span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">   xsi:schemaLocation <span class="built_in">=</span> <span class="string">&quot;http://maven.apache.org/POM/4.0.0</span></span><br><span class="line"><span class="string">   http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">   &lt;modelVersion&gt;<span class="number">4.0</span>.<span class="number">0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">   &lt;groupId&gt;com.companyname.project-group&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;project&lt;/artifactId&gt;</span><br><span class="line">   &lt;version&gt;<span class="number">1.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p>然后在命令行执行命令即可：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line">PS E:\ws\test&gt; mvn help:effective-pom</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[INFO]</span><br><span class="line">Effective POMs, after inheritance, interpolation, and profiles are applied:</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;GBK&quot;?&gt;</span><br><span class="line">&lt;!-- ====================================================================== --&gt;</span><br><span class="line">&lt;!--                                                                        --&gt;</span><br><span class="line">&lt;!-- Generated by Maven Help Plugin on 2018-09-06T16:15:38+08:00            --&gt;</span><br><span class="line">&lt;!-- See: http://maven.apache.org/plugins/maven-help-plugin/                --&gt;</span><br><span class="line">&lt;!--                                                                        --&gt;</span><br><span class="line">&lt;!-- ====================================================================== --&gt;</span><br><span class="line">&lt;!-- ====================================================================== --&gt;</span><br><span class="line">&lt;!--                                                                        --&gt;</span><br><span class="line">&lt;!-- Effective POM for project                                              --&gt;</span><br><span class="line">&lt;!-- &#x27;com.companyname.project-group:project:jar:1.0&#x27;                        --&gt;</span><br><span class="line">&lt;!--                                                                        --&gt;</span><br><span class="line">&lt;!-- ====================================================================== --&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">  &lt;groupId&gt;com.companyname.project-group&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;project&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0&lt;/version&gt;</span><br><span class="line">  &lt;repositories&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">      &lt;snapshots&gt;</span><br><span class="line">        &lt;enabled&gt;false&lt;/enabled&gt;</span><br><span class="line">      &lt;/snapshots&gt;</span><br><span class="line">      &lt;id&gt;central&lt;/id&gt;</span><br><span class="line">      &lt;name&gt;Central Repository&lt;/name&gt;</span><br><span class="line">      &lt;url&gt;https://repo.maven.apache.org/maven2&lt;/url&gt;</span><br><span class="line">    &lt;/repository&gt;</span><br><span class="line">  &lt;/repositories&gt;</span><br><span class="line">  &lt;pluginRepositories&gt;</span><br><span class="line">    &lt;pluginRepository&gt;</span><br><span class="line">      &lt;releases&gt;</span><br><span class="line">        &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;</span><br><span class="line">      &lt;/releases&gt;</span><br><span class="line">      &lt;snapshots&gt;</span><br><span class="line">        &lt;enabled&gt;false&lt;/enabled&gt;</span><br><span class="line">      &lt;/snapshots&gt;</span><br><span class="line">      &lt;id&gt;central&lt;/id&gt;</span><br><span class="line">      &lt;name&gt;Central Repository&lt;/name&gt;</span><br><span class="line">      &lt;url&gt;https://repo.maven.apache.org/maven2&lt;/url&gt;</span><br><span class="line">    &lt;/pluginRepository&gt;</span><br><span class="line">  &lt;/pluginRepositories&gt;</span><br><span class="line">  &lt;build&gt;</span><br><span class="line">    &lt;sourceDirectory&gt;E:\ws\test\src\main\java&lt;/sourceDirectory&gt;</span><br><span class="line">    &lt;scriptSourceDirectory&gt;E:\ws\test\src\main\scripts&lt;/scriptSourceDirectory&gt;</span><br><span class="line">    &lt;testSourceDirectory&gt;E:\ws\test\src\test\java&lt;/testSourceDirectory&gt;</span><br><span class="line">    &lt;outputDirectory&gt;E:\ws\test\target\classes&lt;/outputDirectory&gt;</span><br><span class="line">    &lt;testOutputDirectory&gt;E:\ws\test\target\test-classes&lt;/testOutputDirectory&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">      &lt;resource&gt;</span><br><span class="line">        &lt;directory&gt;E:\ws\test\src\main\resources&lt;/directory&gt;</span><br><span class="line">      &lt;/resource&gt;</span><br><span class="line">    &lt;/resources&gt;</span><br><span class="line">    &lt;testResources&gt;</span><br><span class="line">      &lt;testResource&gt;</span><br><span class="line">        &lt;directory&gt;E:\ws\test\src\test\resources&lt;/directory&gt;</span><br><span class="line">      &lt;/testResource&gt;</span><br><span class="line">    &lt;/testResources&gt;</span><br><span class="line">    &lt;directory&gt;E:\ws\test\target&lt;/directory&gt;</span><br><span class="line">    &lt;finalName&gt;project-1.0&lt;/finalName&gt;</span><br><span class="line">    &lt;pluginManagement&gt;</span><br><span class="line">      &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.3&lt;/version&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.2-beta-5&lt;/version&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.8&lt;/version&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">          &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.3.2&lt;/version&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">      &lt;/plugins&gt;</span><br><span class="line">    &lt;/pluginManagement&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.5&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-clean&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;clean&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;clean&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.6&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-testResources&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;process-test-resources&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;testResources&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-resources&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;process-resources&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;resources&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.4&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-jar&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;jar&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.1&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-compile&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;compile&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;compile&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-testCompile&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;test-compile&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;testCompile&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.12.4&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-test&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;test&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;test&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.4&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-install&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;install&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;install&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.7&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-deploy&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;deploy&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;deploy&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">      &lt;plugin&gt;</span><br><span class="line">        &lt;artifactId&gt;maven-site-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.3&lt;/version&gt;</span><br><span class="line">        &lt;executions&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-site&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;site&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;site&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">              &lt;outputDirectory&gt;E:\ws\test\target\site&lt;/outputDirectory&gt;</span><br><span class="line">              &lt;reportPlugins&gt;</span><br><span class="line">                &lt;reportPlugin&gt;</span><br><span class="line">                  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                  &lt;artifactId&gt;maven-project-info-reports-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;/reportPlugin&gt;</span><br><span class="line">              &lt;/reportPlugins&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">          &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;default-deploy&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;site-deploy&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">              &lt;goal&gt;deploy&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">              &lt;outputDirectory&gt;E:\ws\test\target\site&lt;/outputDirectory&gt;</span><br><span class="line">              &lt;reportPlugins&gt;</span><br><span class="line">                &lt;reportPlugin&gt;</span><br><span class="line">                  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                  &lt;artifactId&gt;maven-project-info-reports-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;/reportPlugin&gt;</span><br><span class="line">              &lt;/reportPlugins&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">          &lt;/execution&gt;</span><br><span class="line">        &lt;/executions&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">          &lt;outputDirectory&gt;E:\ws\test\target\site&lt;/outputDirectory&gt;</span><br><span class="line">          &lt;reportPlugins&gt;</span><br><span class="line">            &lt;reportPlugin&gt;</span><br><span class="line">              &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">              &lt;artifactId&gt;maven-project-info-reports-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;/reportPlugin&gt;</span><br><span class="line">          &lt;/reportPlugins&gt;</span><br><span class="line">        &lt;/configuration&gt;</span><br><span class="line">      &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">  &lt;/build&gt;</span><br><span class="line">  &lt;reporting&gt;</span><br><span class="line">    &lt;outputDirectory&gt;E:\ws\test\target\site&lt;/outputDirectory&gt;</span><br><span class="line">  &lt;/reporting&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p>在上面的pom.xml中，您可以看到默认的项目源文件夹结构，输出目录，所需的插件，存储库，报告目录，Maven将在执行所需目标时使用。</p>
<p>Maven pom.xml也不需要手动编写。 Maven提供了许多原型插件来创建项目，按顺序创建项目结构和pom.xml.</p>
<h1 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h1><h1 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h1><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html">官网-5分钟入门</a></p>
<p><a target="_blank" rel="noopener" href="https://maven.apache.org/guides/getting-started/index.html">官网-入门指导</a></p>
<p><a target="_blank" rel="noopener" href="https://maven.apache.org/pom.html">官网-POM文件</a></p>
<p><a target="_blank" rel="noopener" href="https://maven.apache.org/settings.html">官网-setting</a></p>
<p><a target="_blank" rel="noopener" href="http://tutorials.jenkov.com/maven/maven-tutorial.html">maven入门博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tutorialspoint.com/maven/maven_overview.htm">maven入门教程</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>使用了这么多年的maven，maven的单词什么意思？</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/06/maven/001-maven-tutorial/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/06/maven/001-maven-tutorial/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/06/maven/001-maven-tutorial/" data-id="cl1fw7fmz00h0vkd34zau5hl2" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maven/" rel="tag">maven</a><span class="article-tag-list-count">11</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-hadoop/002-hbase-java" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/05/hadoop/002-hbase-java/" class="article-date">
  <time datetime="2018-09-05T09:02:47.000Z" itemprop="datePublished">2018-09-05</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/05/hadoop/002-hbase-java/">hbase-java操作</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本篇包括java客户端堆hbase的常用CRUD和过滤器使用。</p>
<h1 id="Maven配置"><a href="#Maven配置" class="headerlink" title="Maven配置"></a>Maven配置</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.apache.hbase/hbase-client --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.apache.hbase&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;hbase-client&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.6&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<h1 id="创建连接"><a href="#创建连接" class="headerlink" title="创建连接"></a>创建连接</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HBaseTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Admin admin;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">tableName</span> <span class="operator">=</span> <span class="string">&quot;t_blog&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">cf1</span> <span class="operator">=</span> <span class="string">&quot;cf1&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">cf2</span> <span class="operator">=</span> <span class="string">&quot;cf2&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * title为列名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> <span class="string">&quot;title&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Table table;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> HBaseConfiguration.create();</span><br><span class="line">        configuration.set(<span class="string">&quot;hbase.zookeeper.property.clientPort&quot;</span>, <span class="string">&quot;2181&quot;</span>);</span><br><span class="line">        configuration.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>, <span class="string">&quot;hadoop6,hadoop5,hadoop4&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionFactory.createConnection(configuration);</span><br><span class="line">        admin = connection.getAdmin();</span><br><span class="line">        table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        admin.close();</span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="list"><a href="#list" class="headerlink" title="list"></a>list</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 列出所有表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 14:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listTables</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    HTableDescriptor[] hTableDescriptors = admin.listTables();</span><br><span class="line">    <span class="keyword">for</span> (HTableDescriptor descriptor : hTableDescriptors) &#123;</span><br><span class="line">        System.out.println(descriptor.getNameAsString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     homedata</span></span><br><span class="line"><span class="comment">     testKfkBulkload</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="create-table"><a href="#create-table" class="headerlink" title="create table"></a>create table</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 判断表是否存在</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 14:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isTableExists</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">return</span> admin.tableExists(TableName.valueOf(tableName));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 创建表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 14:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">TableName</span> <span class="variable">tableName</span> <span class="operator">=</span> TableName.valueOf(<span class="built_in">this</span>.tableName);</span><br><span class="line">    <span class="type">HTableDescriptor</span> <span class="variable">hTableDescriptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HTableDescriptor</span>(tableName);</span><br><span class="line">    hTableDescriptor.addFamily(<span class="keyword">new</span> <span class="title class_">HColumnDescriptor</span>(cf1));</span><br><span class="line">    hTableDescriptor.addFamily(<span class="keyword">new</span> <span class="title class_">HColumnDescriptor</span>(cf2));</span><br><span class="line">    admin.createTable(hTableDescriptor);</span><br><span class="line">    System.out.println(isTableExists());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="disable-amp-enable"><a href="#disable-amp-enable" class="headerlink" title="disable &amp; enable"></a>disable &amp; enable</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 禁用一张表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 14:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">disableTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (!admin.isTableDisabled(TableName.valueOf(tableName))) &#123;</span><br><span class="line">        admin.disableTable(TableName.valueOf(tableName));</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;已经disabled&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> enable一张表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 15:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">enableTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (!admin.isTableEnabled(TableName.valueOf(tableName))) &#123;</span><br><span class="line">        admin.enableTable(TableName.valueOf(tableName));</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;已经enabled&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="delete-amp-add-列族"><a href="#delete-amp-add-列族" class="headerlink" title="delete &amp; add 列族"></a>delete &amp; add 列族</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 加入列族</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 15:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addColumnFamilty</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">HColumnDescriptor</span> <span class="variable">title</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HColumnDescriptor</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">    admin.addColumn(TableName.valueOf(tableName), title);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 删除列族</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 15:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteColumnFamily</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    admin.deleteColumn(TableName.valueOf(tableName), Bytes.toBytes(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="put-data"><a href="#put-data" class="headerlink" title="put data"></a>put data</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 插入数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 15:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putData</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Put</span> <span class="variable">r1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>(Bytes.toBytes(<span class="string">&quot;row-key-0&quot;</span>));</span><br><span class="line">    r1.addColumn(Bytes.toBytes(cf1), Bytes.toBytes(title), Bytes.toBytes(<span class="string">&quot;java入门&quot;</span>));</span><br><span class="line">    table.put(r1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*批量插入*/</span></span><br><span class="line">    List&lt;Put&gt; puts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="type">Put</span> <span class="variable">put</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>(Bytes.toBytes(<span class="string">&quot;row-key-&quot;</span> + (i + <span class="number">1</span>)));</span><br><span class="line">        put.addColumn(Bytes.toBytes(cf1), Bytes.toBytes(title), Bytes.toBytes(<span class="string">&quot;python教程-&quot;</span> + i));</span><br><span class="line">        puts.add(put);</span><br><span class="line">    &#125;</span><br><span class="line">    table.put(puts);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="get-data"><a href="#get-data" class="headerlink" title="get data"></a>get data</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 根据row key获取数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 15:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getData</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Get</span> <span class="variable">get</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Get</span>(Bytes.toBytes(<span class="string">&quot;row-key-0&quot;</span>));</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> table.get(get);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*简单方式：已知列族和列名*/</span></span><br><span class="line">    <span class="type">byte</span>[] resultValue = result.getValue(Bytes.toBytes(cf1), Bytes.toBytes(<span class="string">&quot;title&quot;</span>));</span><br><span class="line">    System.out.println(Bytes.toString(resultValue));</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*复杂方式：全部查出来*/</span></span><br><span class="line">    printResult(result);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     java入门</span></span><br><span class="line"><span class="comment">     ColumnFamily: cf1</span></span><br><span class="line"><span class="comment">     columnName: title:</span></span><br><span class="line"><span class="comment">     column-key: 1534491212818,value: java入门</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 解析并打印Result结果</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 16:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">printResult</span><span class="params">(Result result)</span> &#123;</span><br><span class="line">    NavigableMap&lt;<span class="type">byte</span>[], NavigableMap&lt;<span class="type">byte</span>[], NavigableMap&lt;Long, <span class="type">byte</span>[]&gt;&gt;&gt; navigableMap = result.getMap();</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;<span class="type">byte</span>[], NavigableMap&lt;<span class="type">byte</span>[], NavigableMap&lt;Long, <span class="type">byte</span>[]&gt;&gt;&gt; entry : navigableMap.entrySet()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ColumnFamily: &quot;</span> + Bytes.toString(entry.getKey()));</span><br><span class="line">        NavigableMap&lt;<span class="type">byte</span>[], NavigableMap&lt;Long, <span class="type">byte</span>[]&gt;&gt; value = entry.getValue();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;<span class="type">byte</span>[], NavigableMap&lt;Long, <span class="type">byte</span>[]&gt;&gt; m : value.entrySet()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;columnName: &quot;</span> + Bytes.toString(m.getKey()) + <span class="string">&quot;:&quot;</span>);</span><br><span class="line">            NavigableMap&lt;Long, <span class="type">byte</span>[]&gt; mValue = m.getValue();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;Long, <span class="type">byte</span>[]&gt; mm : mValue.entrySet()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;column-key: &quot;</span> + mm.getKey() + <span class="string">&quot;,value: &quot;</span> + Bytes.toString(mm.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> scan表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 15:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">scanTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> table.getScanner(<span class="keyword">new</span> <span class="title class_">Scan</span>());</span><br><span class="line">    <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">        printResult(result);</span><br><span class="line">    &#125;</span><br><span class="line">    scanner.close();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ColumnFamily: cf1</span></span><br><span class="line"><span class="comment">    columnName: title:</span></span><br><span class="line"><span class="comment">    column-key: 1534491212818,value: java入门</span></span><br><span class="line"><span class="comment">    ColumnFamily: cf1</span></span><br><span class="line"><span class="comment">    columnName: title:</span></span><br><span class="line"><span class="comment">    column-key: 1534491212955,value: python教程-0</span></span><br><span class="line"><span class="comment">    ColumnFamily: cf1</span></span><br><span class="line"><span class="comment">    columnName: title:</span></span><br><span class="line"><span class="comment">    column-key: 1534491212955,value: python教程-1</span></span><br><span class="line"><span class="comment">    ColumnFamily: cf1</span></span><br><span class="line"><span class="comment">    columnName: title:</span></span><br><span class="line"><span class="comment">    column-key: 1534491212955,value: python教程-2</span></span><br><span class="line"><span class="comment">    ColumnFamily: cf1</span></span><br><span class="line"><span class="comment">    columnName: title:</span></span><br><span class="line"><span class="comment">    column-key: 1534491212955,value: python教程-3</span></span><br><span class="line"><span class="comment">    ColumnFamily: cf1</span></span><br><span class="line"><span class="comment">    columnName: title:</span></span><br><span class="line"><span class="comment">    column-key: 1534491212955,value: python教程-4</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="update"><a href="#update" class="headerlink" title="update"></a>update</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 更新：类似于覆盖数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 16:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateData</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Put</span> <span class="variable">put</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>(Bytes.toBytes(<span class="string">&quot;row-key-0&quot;</span>));</span><br><span class="line">    put.addColumn(Bytes.toBytes(cf1), Bytes.toBytes(title), Bytes.toBytes(<span class="string">&quot;java进阶&quot;</span>));</span><br><span class="line">    table.put(put);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="delete-amp-truncate"><a href="#delete-amp-truncate" class="headerlink" title="delete &amp; truncate"></a>delete &amp; truncate</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 删除数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 16:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteData</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Delete</span> <span class="variable">delete</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Delete</span>(Bytes.toBytes(<span class="string">&quot;row-key-1&quot;</span>));</span><br><span class="line"><span class="comment">//        delete.addColumn(Bytes.toBytes(cf1), Bytes.toBytes(title));</span></span><br><span class="line"><span class="comment">//        delete.addFamily(Bytes.toBytes(cf1));</span></span><br><span class="line">    table.delete(delete);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 删除所有数据且不保留分割</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 16:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">truncate</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    admin.truncateTable(TableName.valueOf(tableName), <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="drop-amp-shutdown"><a href="#drop-amp-shutdown" class="headerlink" title="drop &amp; shutdown"></a>drop &amp; shutdown</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> drop表, 记得先disable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 15:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dropTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    admin.disableTable(TableName.valueOf(tableName));</span><br><span class="line">    admin.deleteTable(TableName.valueOf(tableName));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> stop hbase</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 15:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    admin.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="scan-filters"><a href="#scan-filters" class="headerlink" title="scan filters"></a>scan filters</h1><h2 id="SingleColumnValueFilter"><a href="#SingleColumnValueFilter" class="headerlink" title="SingleColumnValueFilter"></a>SingleColumnValueFilter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 单一列值过滤器，有多种比较符,会获取整行数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 22:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">singleColumnFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">SingleColumnValueFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleColumnValueFilter</span>(</span><br><span class="line">            Bytes.toBytes(cf1),</span><br><span class="line">            Bytes.toBytes(title),</span><br><span class="line">            CompareFilter.CompareOp.EQUAL,</span><br><span class="line">            Bytes.toBytes(<span class="string">&quot;python教程-3&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.setFilter(filter);</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">results</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    MyUtil.printResults(results);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ColumnValueFilter"><a href="#ColumnValueFilter" class="headerlink" title="ColumnValueFilter"></a>ColumnValueFilter</h2><p>作为SingleColumnValueFilter的补充，在HBase-2.0.0版本中引入，ColumnValueFilter仅获取匹配的单元格，而SingleColumnValueFilter获取匹配的单元格所属的整个行（具有其他列和值）。<br>##ValueFilter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 准确搜索指定的列，避免无效的搜索其他列族，简单搜索推荐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 23:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">valueFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">ValueFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ValueFilter</span>(</span><br><span class="line">            CompareFilter.CompareOp.EQUAL,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BinaryComparator</span>(Bytes.toBytes(<span class="string">&quot;python教程-4&quot;</span>))</span><br><span class="line">    );</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.addColumn(Bytes.toBytes(cf1), Bytes.toBytes(title));</span><br><span class="line">    scan.setFilter(filter);</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">results</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    MyUtil.printResults(results);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="RegexStringComparator"><a href="#RegexStringComparator" class="headerlink" title="RegexStringComparator"></a>RegexStringComparator</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 正则过滤, 凡是以python开头的都可以，参考：</span></span><br><span class="line"><span class="comment"> * https://docs.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/20 8:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">regexFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">RegexStringComparator</span> <span class="variable">comparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegexStringComparator</span>(<span class="string">&quot;python.&quot;</span>);</span><br><span class="line">    <span class="type">SingleColumnValueFilter</span> <span class="variable">singleColumnValueFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleColumnValueFilter</span>(</span><br><span class="line">            Bytes.toBytes(cf1),</span><br><span class="line">            Bytes.toBytes(title),</span><br><span class="line">            CompareFilter.CompareOp.EQUAL,</span><br><span class="line">            comparator</span><br><span class="line">    );</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.setFilter(singleColumnValueFilter);</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">results</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    MyUtil.printResults(results);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SubStringFilter"><a href="#SubStringFilter" class="headerlink" title="SubStringFilter"></a>SubStringFilter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 子串匹配</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/20 8:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subStringFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">/*匹配 xxx教程-2xxx*/</span></span><br><span class="line">    <span class="type">SubstringComparator</span> <span class="variable">comparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubstringComparator</span>(<span class="string">&quot;教程-2&quot;</span>);</span><br><span class="line">    <span class="type">SingleColumnValueFilter</span> <span class="variable">singleColumnValueFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleColumnValueFilter</span>(</span><br><span class="line">            Bytes.toBytes(cf1),</span><br><span class="line">            Bytes.toBytes(title),</span><br><span class="line">            CompareFilter.CompareOp.EQUAL,</span><br><span class="line">            comparator</span><br><span class="line">    );</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.setFilter(singleColumnValueFilter);</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">results</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    MyUtil.printResults(results);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ColumnFamily: cf1</span></span><br><span class="line"><span class="comment">    columnName: title:</span></span><br><span class="line"><span class="comment">    column-key: 1534491212955,value: python教程-2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="BinaryPrefixFilter"><a href="#BinaryPrefixFilter" class="headerlink" title="BinaryPrefixFilter"></a>BinaryPrefixFilter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 前缀匹配</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/20 8:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">binaryPrefixFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BinaryPrefixComparator</span> <span class="variable">comparator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinaryPrefixComparator</span>(Bytes.toBytes(<span class="string">&quot;python&quot;</span>));</span><br><span class="line">    <span class="type">SingleColumnValueFilter</span> <span class="variable">singleColumnValueFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleColumnValueFilter</span>(</span><br><span class="line">            Bytes.toBytes(cf1),</span><br><span class="line">            Bytes.toBytes(title),</span><br><span class="line">            CompareFilter.CompareOp.EQUAL,</span><br><span class="line">            comparator</span><br><span class="line">    );</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.setFilter(singleColumnValueFilter);</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">results</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    MyUtil.printResults(results);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ColumnPrefixFilter"><a href="#ColumnPrefixFilter" class="headerlink" title="ColumnPrefixFilter"></a>ColumnPrefixFilter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 匹配列名的前缀</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/20 8:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">columnPrefixFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">ColumnPrefixFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ColumnPrefixFilter</span>(Bytes.toBytes(<span class="string">&quot;titl&quot;</span>));</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.addFamily(Bytes.toBytes(cf1));</span><br><span class="line">    scan.setFilter(filter);</span><br><span class="line">    scan.setBatch(<span class="number">10</span>);</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">rs</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    MyUtil.printResults(rs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MultipleColumnPrefixFilter"><a href="#MultipleColumnPrefixFilter" class="headerlink" title="MultipleColumnPrefixFilter"></a>MultipleColumnPrefixFilter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 匹配多个列名的前缀</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/20 9:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">multiColumnPrefixFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">byte</span>[][] prefix = &#123;Bytes.toBytes(<span class="string">&quot;my-column&quot;</span>), Bytes.toBytes(<span class="string">&quot;title&quot;</span>)&#125;;</span><br><span class="line">    <span class="type">MultipleColumnPrefixFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultipleColumnPrefixFilter</span>(prefix);</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.addFamily(Bytes.toBytes(cf1));</span><br><span class="line">    scan.setFilter(filter);</span><br><span class="line">    scan.setBatch(<span class="number">10</span>);</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">rs</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    MyUtil.printResults(rs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="RowFilter"><a href="#RowFilter" class="headerlink" title="RowFilter"></a>RowFilter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 行过滤器，可以加各种Comparator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/20 9:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rowFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">/*&gt;=3的行,可以使用FilterList组合多个界限*/</span></span><br><span class="line">    <span class="type">RowFilter</span> <span class="variable">beginRowFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RowFilter</span>(</span><br><span class="line">            CompareFilter.CompareOp.GREATER_OR_EQUAL,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BinaryComparator</span>(Bytes.toBytes(<span class="number">3</span>))</span><br><span class="line">    );</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    <span class="comment">/*等价于：Scan scan = new Scan(Bytes.toBytes(1), Bytes.toBytes(10));*/</span></span><br><span class="line">    scan.setFilter(beginRowFilter);</span><br><span class="line">    scan.addFamily(Bytes.toBytes(cf1));</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    MyUtil.printResults(scanner);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="FilterList"><a href="#FilterList" class="headerlink" title="FilterList"></a>FilterList</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 过滤器列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/17 21:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">filterList</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">FilterList</span> <span class="variable">filterList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterList</span>(FilterList.Operator.MUST_PASS_ALL);</span><br><span class="line"><span class="comment">//        new FilterList(FilterList.Operator.MUST_PASS_ALL);</span></span><br><span class="line"></span><br><span class="line">    <span class="type">SingleColumnValueFilter</span> <span class="variable">filter1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleColumnValueFilter</span>(</span><br><span class="line">            Bytes.toBytes(cf1),</span><br><span class="line">            Bytes.toBytes(title),</span><br><span class="line">            CompareFilter.CompareOp.EQUAL,</span><br><span class="line">            Bytes.toBytes(<span class="string">&quot;python教程2&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="type">SingleColumnValueFilter</span> <span class="variable">filter2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleColumnValueFilter</span>(</span><br><span class="line">            Bytes.toBytes(cf1),</span><br><span class="line">            Bytes.toBytes(title),</span><br><span class="line">            CompareFilter.CompareOp.EQUAL,</span><br><span class="line">            Bytes.toBytes(<span class="string">&quot;python教程3&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">    filterList.addFilter(filter1);</span><br><span class="line">    filterList.addFilter(filter2);</span><br><span class="line"></span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.setFilter(filterList);</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">results</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    MyUtil.printResults(results);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="FirstKeyOnlyFilter"><a href="#FirstKeyOnlyFilter" class="headerlink" title="FirstKeyOnlyFilter"></a>FirstKeyOnlyFilter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 只取每一行的第一个KV，一般用于row count，如下(但这并不适合大表)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/8/20 9:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">firstKeyOnlyFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.setFilter(<span class="keyword">new</span> <span class="title class_">FirstKeyOnlyFilter</span>());</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">resultScanner</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    <span class="type">int</span> <span class="variable">totalRow</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Result result : resultScanner) &#123;</span><br><span class="line">        totalRow += result.size();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;total rows: &quot;</span> + totalRow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="PageFilter"><a href="#PageFilter" class="headerlink" title="PageFilter"></a>PageFilter</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@func</span> 限制页数或用于分页</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 18/8/20 10:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pageFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">PageFilter</span> <span class="variable">pageFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageFilter</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">    scan.setStartRow(Bytes.toBytes(<span class="string">&quot;row-key-2&quot;</span>));</span><br><span class="line">    scan.setStopRow(Bytes.toBytes(<span class="string">&quot;row-key-5&quot;</span>));</span><br><span class="line">    scan.setFilter(pageFilter);</span><br><span class="line">    <span class="type">ResultScanner</span> <span class="variable">results</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line">    <span class="keyword">for</span> (Result result : results) &#123;</span><br><span class="line">        System.out.println(Bytes.toString(result.getRow()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="最后-HbaseTemplate"><a href="#最后-HbaseTemplate" class="headerlink" title="最后-HbaseTemplate"></a>最后-HbaseTemplate</h1><p>HbaseTemplate是spring-data模块里对hbase操作的封装， 具体使用可以参考：<br><a target="_blank" rel="noopener" href="https://www.programcreek.com/java-api-examples/index.php?api=org.springframework.data.hadoop.hbase.TableCallback">hbaseTemplate use</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/tguduru/Spring-HBase/blob/master/src/main/java/org/bigdata/hbase/spring/HBaseConnection.java">HBaseConnection</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="http://hbase.apache.org/book.html#client_dependencies">http://hbase.apache.org/book.html#client_dependencies</a></p>
<p><a target="_blank" rel="noopener" href="http://www.corejavaguru.com/bigdata/hbase-tutorial/hbase-java-client-api-examples">http://www.corejavaguru.com/bigdata/hbase-tutorial/hbase-java-client-api-examples</a></p>
<p><a target="_blank" rel="noopener" href="http://hbase.apache.org/book.html#client.filter">http://hbase.apache.org/book.html#client.filter</a></p>
<p><a target="_blank" rel="noopener" href="https://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Scan.html">https://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Scan.html</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本篇包括java客户端堆hbase的常用CRUD和过滤器使用。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/05/hadoop/002-hbase-java/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/05/hadoop/002-hbase-java/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/05/hadoop/002-hbase-java/" data-id="cl1fw7fjn0054vkd3g69a4d7m" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hbase/" rel="tag">hbase</a><span class="article-tag-list-count">4</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-hadoop/001-hbase-shell-command" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/05/hadoop/001-hbase-shell-command/" class="article-date">
  <time datetime="2018-09-05T00:01:35.000Z" itemprop="datePublished">2018-09-05</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/05/hadoop/001-hbase-shell-command/">hbase shell命令</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本篇关于hbase常用命令。</p>
<img src="/2018/09/05/hadoop/001-hbase-shell-command/000.png" class="">

<h1 id="进入shell"><a href="#进入shell" class="headerlink" title="进入shell"></a>进入shell</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># hbase shell</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: Using incremental CMS is deprecated and will likely be removed in a future release</span><br><span class="line">18/09/05 08:05:08 INFO Configuration.deprecation: hadoop.native.lib is deprecated. Instead, use io.native.lib.available</span><br><span class="line">HBase Shell; enter &#x27;help&lt;RETURN&gt;&#x27; for list of supported commands.</span><br><span class="line">Type &quot;exit&lt;RETURN&gt;&quot; to leave the HBase Shell</span><br><span class="line">Version 1.2.0-cdh5.11.1, rUnknown, Thu Jun  1 10:19:43 PDT 2017</span><br><span class="line"></span><br><span class="line">hbase(main):001:0&gt;</span><br></pre></td></tr></table></figure>
<h2 id="查看有哪些命令"><a href="#查看有哪些命令" class="headerlink" title="查看有哪些命令"></a>查看有哪些命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):006:0&gt; table help</span><br><span class="line">HBase Shell, version 1.2.0-cdh5.11.1, rUnknown, Thu Jun  1 10:19:43 PDT 2017</span><br><span class="line">Type &#x27;help &quot;COMMAND&quot;&#x27;, (e.g. &#x27;help &quot;get&quot;&#x27; -- the quotes are necessary) for help on a specific command.</span><br><span class="line">Commands are grouped. Type &#x27;help &quot;COMMAND_GROUP&quot;&#x27;, (e.g. &#x27;help &quot;general&quot;&#x27;) for help on a command group.</span><br><span class="line"></span><br><span class="line">COMMAND GROUPS:</span><br><span class="line">  Group name: general</span><br><span class="line">  Commands: status, table_help, version, whoami</span><br><span class="line"></span><br><span class="line">  Group name: ddl</span><br><span class="line">  Commands: alter, alter_async, alter_status, create, describe, disable, disable_all, drop, drop_all, enable, enable_all, exists, get_table, is_disabled, is_enabled, list, locate_region, show_filters</span><br><span class="line"></span><br><span class="line">  Group name: namespace</span><br><span class="line">  Commands: alter_namespace, create_namespace, describe_namespace, drop_namespace, list_namespace, list_namespace_tables</span><br><span class="line"></span><br><span class="line">  Group name: dml</span><br><span class="line">  Commands: append, count, delete, deleteall, get, get_counter, get_splits, incr, put, scan, truncate, truncate_preserve</span><br><span class="line"></span><br><span class="line">  Group name: tools</span><br><span class="line">  Commands: assign, balance_switch, balancer, balancer_enabled, catalogjanitor_enabled, catalogjanitor_run, catalogjanitor_switch, close_region, compact, compact_mob, compact_rs, flush, major_compact, major_compact_mob, merge_region, move, normalize, normalizer_enabled, normalizer_switch, split, trace, unassign, wal_roll, zk_dump</span><br><span class="line"></span><br><span class="line">  Group name: replication</span><br><span class="line">  Commands: add_peer, append_peer_tableCFs, disable_peer, disable_table_replication, enable_peer, enable_table_replication, get_peer_config, list_peer_configs, list_peers, list_replicated_tables, remove_peer, remove_peer_tableCFs, set_peer_tableCFs, show_peer_tableCFs, update_peer_config</span><br><span class="line"></span><br><span class="line">  Group name: snapshots</span><br><span class="line">  Commands: clone_snapshot, delete_all_snapshot, delete_snapshot, list_snapshots, restore_snapshot, snapshot</span><br><span class="line"></span><br><span class="line">  Group name: configuration</span><br><span class="line">  Commands: update_all_config, update_config</span><br><span class="line"></span><br><span class="line">  Group name: quotas</span><br><span class="line">  Commands: list_quotas, set_quota</span><br><span class="line"></span><br><span class="line">  Group name: security</span><br><span class="line">  Commands: grant, list_security_capabilities, revoke, user_permission</span><br><span class="line"></span><br><span class="line">  Group name: procedures</span><br><span class="line">  Commands: abort_procedure, list_procedures</span><br><span class="line"></span><br><span class="line">  Group name: visibility labels</span><br><span class="line">  Commands: add_labels, clear_auths, get_auths, list_labels, set_auths, set_visibility</span><br><span class="line"></span><br><span class="line">  Group name: rsgroup</span><br><span class="line">  Commands: add_rsgroup, balance_rsgroup, get_rsgroup, get_server_rsgroup, get_table_rsgroup, list_rsgroups, move_servers_rsgroup, move_tables_rsgroup, remove_rsgroup</span><br></pre></td></tr></table></figure>

<p>可以看到，hbase已经给我们分好类了。</p>
<h1 id="通用命令"><a href="#通用命令" class="headerlink" title="通用命令"></a>通用命令</h1><h2 id="status"><a href="#status" class="headerlink" title="status"></a>status</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):001:0&gt; status</span><br><span class="line">1 active master, 1 backup masters, 6 servers, 0 dead, 11.0000 average load</span><br><span class="line"></span><br><span class="line">hbase(main):003:0&gt; status &#x27;summary&#x27;</span><br><span class="line">1 active master, 1 backup masters, 6 servers, 0 dead, 11.0000 average load</span><br><span class="line"></span><br><span class="line">hbase(main):002:0&gt; status &#x27;simple&#x27;</span><br><span class="line">active master:  hadoop5:60000 1534920686752</span><br><span class="line">1 backup masters</span><br><span class="line">    hadoop4:60000 1535506688049</span><br><span class="line">6 live servers</span><br><span class="line">    hadoop5:60020 1534920686459</span><br><span class="line">        requestsPerSecond=0.0, numberOfOnlineRegions=12, usedHeapMB=4468, maxHeapMB=16275, numberOfStores=12, numberOfStorefiles=29, storefileUncompressedSizeMB=10506, storefileSizeMB=10509, compressionRatio=1.0003, memstoreSizeMB=0, storefileIndexSizeMB=0, readRequestsCount=2572948, writeRequestsCount=11596818, rootIndexSizeKB=586, totalStaticIndexSizeKB=24278, totalStaticBloomSizeKB=16265, totalCompactingKVs=23177559, currentCompactedKVs=23177559, compactionProgressPct=1.0, coprocessors=[SecureBulkLoadEndpoint]</span><br><span class="line">    hadoop4:60020 1535506702569</span><br><span class="line">        requestsPerSecond=43.0, numberOfOnlineRegions=13, usedHeapMB=3410, maxHeapMB=16275, numberOfStores=14, numberOfStorefiles=30, storefileUncompressedSizeMB=5037, storefileSizeMB=5039, compressionRatio=1.0004, memstoreSizeMB=0, storefileIndexSizeMB=0, readRequestsCount=27841408, writeRequestsCount=6925128, rootIndexSizeKB=513, totalStaticIndexSizeKB=10852, totalStaticBloomSizeKB=15973, totalCompactingKVs=12727622, currentCompactedKVs=12727622, compactionProgressPct=1.0, coprocessors=[MultiRowMutationEndpoint, SecureBulkLoadEndpoint]</span><br><span class="line">    hadoop7:60020 1534920685705</span><br><span class="line">        requestsPerSecond=0.0, numberOfOnlineRegions=10, usedHeapMB=6894, maxHeapMB=16275, numberOfStores=10, numberOfStorefiles=28, storefileUncompressedSizeMB=6536, storefileSizeMB=6538, compressionRatio=1.0003, memstoreSizeMB=0, storefileIndexSizeMB=0, readRequestsCount=5364554, writeRequestsCount=9582529, rootIndexSizeKB=582, totalStaticIndexSizeKB=14239, totalStaticBloomSizeKB=17340, totalCompactingKVs=9000095, currentCompactedKVs=9000095, compactionProgressPct=1.0, coprocessors=[SecureBulkLoadEndpoint]</span><br><span class="line">    hadoop6:60020 1534920685863</span><br><span class="line">        requestsPerSecond=0.0, numberOfOnlineRegions=9, usedHeapMB=8409, maxHeapMB=16275, numberOfStores=9, numberOfStorefiles=17, storefileUncompressedSizeMB=7896, storefileSizeMB=7899, compressionRatio=1.0004, memstoreSizeMB=0, storefileIndexSizeMB=0, readRequestsCount=11236762, writeRequestsCount=4793387, rootIndexSizeKB=277, totalStaticIndexSizeKB=18459, totalStaticBloomSizeKB=13756, totalCompactingKVs=35614802, currentCompactedKVs=35614802, compactionProgressPct=1.0, coprocessors=[SecureBulkLoadEndpoint]</span><br><span class="line">    hadoop8:60020 1534920687951</span><br><span class="line">        requestsPerSecond=0.0, numberOfOnlineRegions=10, usedHeapMB=3580, maxHeapMB=16275, numberOfStores=10, numberOfStorefiles=19, storefileUncompressedSizeMB=3529, storefileSizeMB=3532, compressionRatio=1.0009, memstoreSizeMB=0, storefileIndexSizeMB=0, readRequestsCount=3473967, writeRequestsCount=4396196, rootIndexSizeKB=150, totalStaticIndexSizeKB=7659, totalStaticBloomSizeKB=9324, totalCompactingKVs=9331946, currentCompactedKVs=9331946, compactionProgressPct=1.0, coprocessors=[SecureBulkLoadEndpoint]</span><br><span class="line">    hadoop9:60020 1534920685661</span><br><span class="line">        requestsPerSecond=0.0, numberOfOnlineRegions=12, usedHeapMB=4199, maxHeapMB=16275, numberOfStores=14, numberOfStorefiles=22, storefileUncompressedSizeMB=5489, storefileSizeMB=5491, compressionRatio=1.0004, memstoreSizeMB=0, storefileIndexSizeMB=0, readRequestsCount=4352374, writeRequestsCount=5654792, rootIndexSizeKB=193, totalStaticIndexSizeKB=11357, totalStaticBloomSizeKB=14968, totalCompactingKVs=16062162, currentCompactedKVs=16062162, compactionProgressPct=1.0, coprocessors=[SecureBulkLoadEndpoint]</span><br><span class="line">0 dead servers</span><br><span class="line">Aggregate load: 43, regions: 66</span><br><span class="line"></span><br><span class="line">hbase(main):004:0&gt; status &#x27;detailed&#x27;</span><br><span class="line">version 1.2.0-cdh5.11.1</span><br><span class="line">0 regionsInTransition</span><br><span class="line">active master:  hadoop5:60000 1534920686752</span><br><span class="line">1 backup masters</span><br><span class="line">    hadoop4:60000 1535506688049</span><br><span class="line">master coprocessors: []</span><br><span class="line">6 live servers</span><br><span class="line">    hadoop5:60020 1534920686459</span><br><span class="line">        requestsPerSecond=0.0, numberOfOnlineRegions=12, usedHeapMB=4472, maxHeapMB=16275, numberOfStores=12, numberOfStorefiles=29, storefileUncompressedSizeMB=10506, storefileSizeMB=10509, compressionRatio=1.0003, memstoreSizeMB=0, storefileIndexSizeMB=0, readRequestsCount=2572948, writeRequestsCount=11596818, rootIndexSizeKB=586, totalStaticIndexSizeKB=24278, totalStaticBloomSizeKB=16265, totalCompactingKVs=23177559, currentCompactedKVs=23177559, compactionProgressPct=1.0, coprocessors=[SecureBulkLoadEndpoint]</span><br><span class="line">        &quot;monitor120History,,1535746236467.697bd51213784f28ebbfc59d3a5a713c.&quot;</span><br><span class="line">....</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<h2 id="version"><a href="#version" class="headerlink" title="version"></a>version</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):005:0&gt; version</span><br><span class="line">1.2.0-cdh5.11.1, rUnknown, Thu Jun  1 10:19:43 PDT 2017</span><br></pre></td></tr></table></figure>
<h2 id="table-help"><a href="#table-help" class="headerlink" title="table help"></a>table help</h2><p>见上面</p>
<h2 id="whoami"><a href="#whoami" class="headerlink" title="whoami"></a>whoami</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):008:0&gt; whoami</span><br><span class="line">root (auth:SIMPLE)</span><br><span class="line">    groups: root</span><br></pre></td></tr></table></figure>
<h1 id="DDL-数据描述语言"><a href="#DDL-数据描述语言" class="headerlink" title="DDL(数据描述语言)"></a>DDL(数据描述语言)</h1><p>也就是一些宏观的结构操作，一般针对表。</p>
<h2 id="create"><a href="#create" class="headerlink" title="create"></a>create</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):010:0&gt; create &#x27;t_jimo&#x27;,&#x27;cf1&#x27;</span><br><span class="line">0 row(s) in 1.3430 seconds</span><br><span class="line"></span><br><span class="line">=&gt; Hbase::Table - t_jimo</span><br></pre></td></tr></table></figure>
<h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):011:0&gt; list</span><br><span class="line">TABLE</span><br><span class="line">homedata</span><br><span class="line">t_blog</span><br><span class="line">t_jimo</span><br><span class="line">testKfkBulkload</span><br></pre></td></tr></table></figure>
<h2 id="describe"><a href="#describe" class="headerlink" title="describe"></a>describe</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):012:0&gt; describe &#x27;t_jimo&#x27;</span><br><span class="line">Table t_jimo is ENABLED</span><br><span class="line">t_jimo</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; &#x27;cf1&#x27;, BLOOMFILTER =&gt; &#x27;ROW&#x27;, VERSIONS =&gt; &#x27;1&#x27;, IN_MEMORY =&gt; &#x27;false&#x27;, KEEP_DELETED_CELLS =&gt; &#x27;FALSE&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;NONE&#x27;, TTL =&gt; &#x27;FOREVER&#x27;, COMPRESSION =&gt; &#x27;NONE&#x27;, MIN_VERSIONS =&gt; &#x27;0&#x27;, BLOCKCACHE</span><br><span class="line"> =&gt; &#x27;true&#x27;, BLOCKSIZE =&gt; &#x27;65536&#x27;, REPLICATION_SCOPE =&gt; &#x27;0&#x27;&#125;</span><br><span class="line">1 row(s) in 0.1270 seconds</span><br></pre></td></tr></table></figure>
<h2 id="disable-amp-disable-all"><a href="#disable-amp-disable-all" class="headerlink" title="disable &amp; disable_all"></a>disable &amp; disable_all</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):013:0&gt; disable &#x27;t_jimo&#x27;</span><br><span class="line">0 row(s) in 2.2540 seconds</span><br></pre></td></tr></table></figure>
<h2 id="enable"><a href="#enable" class="headerlink" title="enable"></a>enable</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):014:0&gt; enable &#x27;t_jimo&#x27;</span><br><span class="line">0 row(s) in 1.2740 seconds</span><br></pre></td></tr></table></figure>
<h2 id="exists"><a href="#exists" class="headerlink" title="exists"></a>exists</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):015:0&gt; exists &#x27;t_jimo&#x27;</span><br><span class="line">Table t_jimo does exist</span><br><span class="line">0 row(s) in 0.0150 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):016:0&gt; exists &#x27;hehe&#x27;</span><br><span class="line">Table hehe does not exist</span><br><span class="line">0 row(s) in 0.0120 seconds</span><br></pre></td></tr></table></figure>
<h2 id="show-filters"><a href="#show-filters" class="headerlink" title="show_filters"></a>show_filters</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):017:0&gt; show_filters</span><br><span class="line">DependentColumnFilter</span><br><span class="line">KeyOnlyFilter</span><br><span class="line">ColumnCountGetFilter</span><br><span class="line">SingleColumnValueFilter</span><br><span class="line">PrefixFilter</span><br><span class="line">SingleColumnValueExcludeFilter</span><br><span class="line">FirstKeyOnlyFilter</span><br><span class="line">ColumnRangeFilter</span><br><span class="line">TimestampsFilter</span><br><span class="line">FamilyFilter</span><br><span class="line">QualifierFilter</span><br><span class="line">ColumnPrefixFilter</span><br><span class="line">RowFilter</span><br><span class="line">MultipleColumnPrefixFilter</span><br><span class="line">InclusiveStopFilter</span><br><span class="line">PageFilter</span><br><span class="line">ValueFilter</span><br><span class="line">ColumnPaginationFilter</span><br></pre></td></tr></table></figure>
<h2 id="alter"><a href="#alter" class="headerlink" title="alter"></a>alter</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):020:0&gt; alter &#x27;t_jimo&#x27;,&#123; NAME=&gt;&#x27;f1&#x27;,VERSIONS=&gt;2 &#125;</span><br><span class="line">Unknown argument ignored: f1</span><br><span class="line">Unknown argument ignored: VERSIONS</span><br><span class="line">Updating all regions with the new schema...</span><br><span class="line">1/1 regions updated.</span><br><span class="line">Done.</span><br><span class="line">0 row(s) in 1.9340 seconds</span><br><span class="line"></span><br><span class="line">  hbase&gt; alter &#x27;t1&#x27;, &#123; NAME =&gt; &#x27;f1&#x27;, VERSIONS =&gt; 3 &#125;,</span><br><span class="line">   &#123; MAX_FILESIZE =&gt; &#x27;134217728&#x27; &#125;, &#123; METHOD =&gt; &#x27;delete&#x27;, NAME =&gt; &#x27;f2&#x27; &#125;,</span><br><span class="line">   OWNER =&gt; &#x27;johndoe&#x27;, METADATA =&gt; &#123; &#x27;mykey&#x27; =&gt; &#x27;myvalue&#x27; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="drop-amp-drop-all"><a href="#drop-amp-drop-all" class="headerlink" title="drop &amp; drop_all"></a>drop &amp; drop_all</h2><p>drop前先要disable</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):040:0&gt; disable &#x27;t_jimo&#x27;</span><br><span class="line">0 row(s) in 2.4140 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):041:0&gt; drop &#x27;t_jimo&#x27;</span><br><span class="line">0 row(s) in 1.2380 seconds</span><br></pre></td></tr></table></figure>
<h1 id="DML-数据操作语言"><a href="#DML-数据操作语言" class="headerlink" title="DML(数据操作语言)"></a>DML(数据操作语言)</h1><h2 id="count"><a href="#count" class="headerlink" title="count"></a>count</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):022:0&gt; count &#x27;t_jimo&#x27;</span><br><span class="line">0 row(s) in 0.0850 seconds</span><br><span class="line"></span><br><span class="line">=&gt; 0</span><br><span class="line">hbase(main):023:0&gt; count &#x27;t_jimo&#x27;,CACHE=&gt;1000</span><br><span class="line">0 row(s) in 0.0110 seconds</span><br><span class="line"></span><br><span class="line">=&gt; 0</span><br></pre></td></tr></table></figure>
<h2 id="put"><a href="#put" class="headerlink" title="put"></a>put</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):024:0&gt; put &#x27;t_jimo&#x27;,&#x27;r1&#x27;,&#x27;cf1:c1&#x27;,&#x27;hehe&#x27;,10</span><br><span class="line">0 row(s) in 0.1450 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):025:0&gt; put &#x27;t_jimo&#x27;,&#x27;r1&#x27;,&#x27;cf1:c1&#x27;,&#x27;jimo&#x27;,20</span><br><span class="line">0 row(s) in 0.0060 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):026:0&gt; put &#x27;t_jimo&#x27;,&#x27;r2&#x27;,&#x27;cf1:c1&#x27;,&#x27;kaka&#x27;,30</span><br><span class="line">0 row(s) in 0.0080 seconds</span><br></pre></td></tr></table></figure>
<p>看下示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hbase&gt; put &#x27;ns1:t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, &#x27;value&#x27;</span><br><span class="line">hbase&gt; put &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, &#x27;value&#x27;</span><br><span class="line">hbase&gt; put &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, &#x27;value&#x27;, ts1</span><br><span class="line">hbase&gt; put &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, &#x27;value&#x27;, &#123;ATTRIBUTES=&gt;&#123;&#x27;mykey&#x27;=&gt;&#x27;myvalue&#x27;&#125;&#125;</span><br><span class="line">hbase&gt; put &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, &#x27;value&#x27;, ts1, &#123;ATTRIBUTES=&gt;&#123;&#x27;mykey&#x27;=&gt;&#x27;myvalue&#x27;&#125;&#125;</span><br><span class="line">hbase&gt; put &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, &#x27;value&#x27;, ts1, &#123;VISIBILITY=&gt;&#x27;PRIVATE|SECRET&#x27;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="get"><a href="#get" class="headerlink" title="get"></a>get</h2><p>默认只返回最新那条</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):029:0&gt; get &#x27;t_jimo&#x27;,&#x27;r1&#x27;</span><br><span class="line">COLUMN                                                CELL</span><br><span class="line"> cf1:c1                                               timestamp=20, value=jimo</span><br><span class="line">1 row(s) in 0.0210 seconds</span><br></pre></td></tr></table></figure>
<p>下面是常用语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">hbase&gt; get &#x27;ns1:t1&#x27;, &#x27;r1&#x27;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;TIMERANGE =&gt; [ts1, ts2]&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;COLUMN =&gt; &#x27;c1&#x27;&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;COLUMN =&gt; [&#x27;c1&#x27;, &#x27;c2&#x27;, &#x27;c3&#x27;]&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;COLUMN =&gt; &#x27;c1&#x27;, TIMESTAMP =&gt; ts1&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;COLUMN =&gt; &#x27;c1&#x27;, TIMERANGE =&gt; [ts1, ts2], VERSIONS =&gt; 4&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;COLUMN =&gt; &#x27;c1&#x27;, TIMESTAMP =&gt; ts1, VERSIONS =&gt; 4&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;FILTER =&gt; &quot;ValueFilter(=, &#x27;binary:abc&#x27;)&quot;&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, &#x27;c2&#x27;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, [&#x27;c1&#x27;, &#x27;c2&#x27;]</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;COLUMN =&gt; &#x27;c1&#x27;, ATTRIBUTES =&gt; &#123;&#x27;mykey&#x27;=&gt;&#x27;myvalue&#x27;&#125;&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;COLUMN =&gt; &#x27;c1&#x27;, AUTHORIZATIONS =&gt; [&#x27;PRIVATE&#x27;,&#x27;SECRET&#x27;]&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;CONSISTENCY =&gt; &#x27;TIMELINE&#x27;&#125;</span><br><span class="line">hbase&gt; get &#x27;t1&#x27;, &#x27;r1&#x27;, &#123;CONSISTENCY =&gt; &#x27;TIMELINE&#x27;, REGION_REPLICA_ID =&gt; 1&#125;</span><br></pre></td></tr></table></figure>
<h2 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):030:0&gt; scan &#x27;t_jimo&#x27;</span><br><span class="line">ROW                                                   COLUMN+CELL</span><br><span class="line"> r1                                                   column=cf1:c1, timestamp=20, value=jimo</span><br><span class="line"> r2                                                   column=cf1:c1, timestamp=30, value=kaka</span><br><span class="line">2 row(s) in 0.0110 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):031:0&gt; scan &#x27;t_jimo&#x27;,&#123;LIMIT=&gt;1&#125;</span><br><span class="line">ROW                                                   COLUMN+CELL</span><br><span class="line"> r1                                                   column=cf1:c1, timestamp=20, value=jimo</span><br><span class="line">1 row(s) in 0.0060 seconds</span><br></pre></td></tr></table></figure>
<h2 id="incr"><a href="#incr" class="headerlink" title="incr"></a>incr</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase&gt; incr &#x27;ns1:t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;</span><br><span class="line">hbase&gt; incr &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;</span><br><span class="line">hbase&gt; incr &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, 1</span><br><span class="line">hbase&gt; incr &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, 10</span><br><span class="line">hbase&gt; incr &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, 10, &#123;ATTRIBUTES=&gt;&#123;&#x27;mykey&#x27;=&gt;&#x27;myvalue&#x27;&#125;&#125;</span><br><span class="line">hbase&gt; incr &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, &#123;ATTRIBUTES=&gt;&#123;&#x27;mykey&#x27;=&gt;&#x27;myvalue&#x27;&#125;&#125;</span><br><span class="line">hbase&gt; incr &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, 10, &#123;VISIBILITY=&gt;&#x27;PRIVATE|SECRET&#x27;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="delete-amp-deleteall"><a href="#delete-amp-deleteall" class="headerlink" title="delete &amp; deleteall"></a>delete &amp; deleteall</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):033:0&gt; delete &#x27;t_jimo&#x27;,&#x27;r1&#x27;,&#x27;cf1:c1&#x27;</span><br><span class="line">0 row(s) in 0.0460 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):034:0&gt; scan &#x27;t_jimo&#x27;</span><br><span class="line">ROW                                                   COLUMN+CELL</span><br><span class="line"> r2                                                   column=cf1:c1, timestamp=30, value=kaka</span><br><span class="line">1 row(s) in 0.0060 seconds</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase&gt; delete &#x27;ns1:t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, ts1</span><br><span class="line">hbase&gt; delete &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, ts1</span><br><span class="line">hbase&gt; delete &#x27;t1&#x27;, &#x27;r1&#x27;, &#x27;c1&#x27;, ts1, &#123;VISIBILITY=&gt;&#x27;PRIVATE|SECRET&#x27;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="truncate"><a href="#truncate" class="headerlink" title="truncate"></a>truncate</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):037:0&gt; truncate &#x27;t_jimo&#x27;</span><br><span class="line">Truncating &#x27;t_jimo&#x27; table (it may take a while):</span><br><span class="line"> - Disabling table...</span><br><span class="line"> - Truncating table...</span><br><span class="line">0 row(s) in 3.4020 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):038:0&gt; scan &#x27;t_jimo&#x27;</span><br><span class="line">ROW                                                   COLUMN+CELL</span><br><span class="line">0 row(s) in 0.3210 seconds</span><br></pre></td></tr></table></figure>





      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本篇关于hbase常用命令。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/05/hadoop/001-hbase-shell-command/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/05/hadoop/001-hbase-shell-command/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/05/hadoop/001-hbase-shell-command/" data-id="cl1fw7fjn0052vkd36bsfcpmb" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hbase/" rel="tag">hbase</a><span class="article-tag-list-count">4</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-lang/010-redis-configuration" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/04/lang/010-redis-configuration/" class="article-date">
  <time datetime="2018-09-04T00:12:15.000Z" itemprop="datePublished">2018-09-04</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/04/lang/010-redis-configuration/">redis配置文件</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本文解释redis的配置文件。</p>
<h1 id="配置文件位置"><a href="#配置文件位置" class="headerlink" title="配置文件位置"></a>配置文件位置</h1><p>默认安装包下就有,当然也可以自己创建。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jimo redis-4.0.11]# ls</span><br><span class="line">00-RELEASENOTES  BUGS  CONTRIBUTING  COPYING  INSTALL  MANIFESTO  Makefile  README.md  deps  redis.conf  runtest  runtest-cluster  runtest-sentinel  sentinel.conf  src  tests  utils</span><br></pre></td></tr></table></figure>

<p>本文基于<code>redis.conf</code>。</p>
<h1 id="如何使用redis-conf"><a href="#如何使用redis-conf" class="headerlink" title="如何使用redis.conf"></a>如何使用redis.conf</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-server /path/to/redis.conf</span><br></pre></td></tr></table></figure>
<h1 id="容量解释"><a href="#容量解释" class="headerlink" title="容量解释"></a>容量解释</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 1k =&gt; 1000 bytes</span><br><span class="line"># 1kb =&gt; 1024 bytes</span><br><span class="line"># 1m =&gt; 1000000 bytes</span><br><span class="line"># 1mb =&gt; 1024*1024 bytes</span><br><span class="line"># 1g =&gt; 1000000000 bytes</span><br><span class="line"># 1gb =&gt; 1024*1024*1024 bytes</span><br></pre></td></tr></table></figure>
<p>不区分大小写，也就是说：1GB&#x3D;1gB&#x3D;1Gb</p>
<h1 id="包含其他配置文件"><a href="#包含其他配置文件" class="headerlink" title="包含其他配置文件"></a>包含其他配置文件</h1><p>为避免被覆盖，最好放在文件结尾：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># include /path/to/local.conf</span><br><span class="line"># include /path/to/other.conf</span><br></pre></td></tr></table></figure>
<h1 id="加载模块"><a href="#加载模块" class="headerlink" title="加载模块"></a>加载模块</h1><p>在启动时加载模块，如果加载失败则无法启动。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># loadmodule /path/to/my_module.so</span><br><span class="line"># loadmodule /path/to/other_module.so</span><br></pre></td></tr></table></figure>
<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>如果没有如下示例的<code>bind</code>，则server监听所有网卡。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># bind 192.168.1.100 10.0.0.1</span><br><span class="line"># bind 127.0.0.1 ::1</span><br></pre></td></tr></table></figure>
<p><em><strong>警告: 如果运行Redis的计算机直接暴露在互联网，绑定到所有接口是危险的，这将暴露对互联网上的每个人都有一个实例。 所以默认情况下我们取消注释遵循bind指令，这将强制Redis只监听IPv4回溯接口地址（这意味着Redis将能够仅接受来自运行到同一台计算机的客户端的连接在跑）</strong></em> 。</p>
<p>默认情况，绑定到本地：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind 127.0.0.1</span><br></pre></td></tr></table></figure>
<h2 id="保护模式"><a href="#保护模式" class="headerlink" title="保护模式"></a>保护模式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected-mode yes</span><br></pre></td></tr></table></figure>
<p>保护模式默认打开，可以避免暴露到网络上被攻击或访问。</p>
<p>如果保护模式打开，且满足：</p>
<ol>
<li>没有<code>bind</code>指令</li>
<li>没配置密码</li>
</ol>
<p>则redis只接受127.0.0.1 和 ::1的客户端。</p>
<h2 id="TCP-backlog"><a href="#TCP-backlog" class="headerlink" title="TCP backlog"></a>TCP backlog</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#默认值 511</span><br><span class="line">tcp-backlog：511</span><br></pre></td></tr></table></figure>

<p>此参数确定了TCP连接中已完成队列(完成三次握手之后)的长度， 当然此值 <strong>必须不大于Linux系统定义的</strong> <code>/proc/sys/net/core/somaxconn</code>值，默认是511，而Linux的默认参数值是128。当系统并发量大并且客户端速度缓慢的时候，可以将这二个参数一起参考设定。</p>
<p><strong>建议修改为 2048</strong></p>
<p>修改somaxconn</p>
<p>该内核参数默认值一般是128，对于负载很大的服务程序来说大大的不够。一般会将它修改为2048或者更大。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cat /proc/sys/net/core/somaxconn</span><br><span class="line">128</span><br></pre></td></tr></table></figure>

<p><code>echo 2048 &gt; /proc/sys/net/core/somaxconn</code> 但是这样系统重启后保存不了</p>
<p>在<code>/etc/sysctl.conf</code>中添加如下<code>net.core.somaxconn = 2048</code></p>
<p>然后在终端中执行<code>sysctl -p</code>.</p>
<h2 id="port"><a href="#port" class="headerlink" title="port"></a>port</h2><p>监听端口，如果为0，则不监听。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br></pre></td></tr></table></figure>
<h2 id="unix-socket"><a href="#unix-socket" class="headerlink" title="unix socket"></a>unix socket</h2><p>监听unix的socket连接，没有设置则不监听。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># unixsocket /tmp/redis.sock</span><br><span class="line"># unixsocketperm 700</span><br></pre></td></tr></table></figure>
<h2 id="timeout"><a href="#timeout" class="headerlink" title="timeout"></a>timeout</h2><p>在客户端空闲N秒后关闭连接（0表示禁用）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeout 0</span><br></pre></td></tr></table></figure>
<h2 id="TCP-keepalive"><a href="#TCP-keepalive" class="headerlink" title="TCP keepalive"></a>TCP keepalive</h2><p>如果非0，则在没有通信的情况下使用SO_KEEPALIVE向客户端发送TCP ACK。 这有两个原因：</p>
<ol>
<li>检测死的客户端。</li>
<li>从中间网络设备的角度看有效连接。</li>
</ol>
<p> 在Linux上，指定的值（以秒为单位）是用于发送ACK的时间段。 请注意，要关闭连接，需要两倍的时间。 在其他内核上，周期取决于内核配置。</p>
<p>此选项的合理值为300秒，这是从Redis 3.2.1开始的新Redis默认值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp-keepalive 300</span><br></pre></td></tr></table></figure>
<h1 id="通用配置"><a href="#通用配置" class="headerlink" title="通用配置"></a>通用配置</h1><h2 id="守护程序"><a href="#守护程序" class="headerlink" title="守护程序"></a>守护程序</h2><p>默认redis不开守护程序，如果打开，会写一个pid文件到<code>/var/run/redis.pid</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize no</span><br></pre></td></tr></table></figure>
<h2 id="supervised"><a href="#supervised" class="headerlink" title="supervised"></a>supervised</h2><p>如果从upstart或systemd运行Redis，Redis可以与您的监督树进行交互:</p>
<ul>
<li>supervised no - 不交互</li>
<li>supervised upsert - 将redis放入SIGSTOP模式与upstart发信号</li>
<li>supervised systemd - 通过写入READY&#x3D;1到$NOTIFY_SOCKET与systemd交互</li>
<li>supervised auto - 通过UPSERT_JOB 或 NOTIFY_SOCKET环境变量检测upstart或systemd方法</li>
</ul>
<p>他们只发送“进程准备好”的信号，并不保持持续的ping连接。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervised no</span><br></pre></td></tr></table></figure>
<h2 id="pid-file"><a href="#pid-file" class="headerlink" title="pid file"></a>pid file</h2><p>指定的pid文件会在启动时写入，退出时移除。</p>
<ul>
<li>如果守护进程关闭：pid文件不会创建；</li>
<li>否则一定会使用，默认是：<code>/var/run/redis.pid</code></li>
</ul>
<p>最好指定一个pid文件，即使无法创建也不会报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pidfile /var/run/redis_6379.pid</span><br></pre></td></tr></table></figure>
<h2 id="loglevel"><a href="#loglevel" class="headerlink" title="loglevel"></a>loglevel</h2><p>有<code>debug,verbose,notice,warning</code>,默认notice(生产环境)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel notice</span><br></pre></td></tr></table></figure>
<h2 id="logfile"><a href="#logfile" class="headerlink" title="logfile"></a>logfile</h2><p>如果为<code>&quot;&quot;</code>,则输出到标准输出，如果同时还开启了守护进程，则转到<code>/dev/null</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logfile &quot;&quot;</span><br></pre></td></tr></table></figure>
<h2 id="syslog-enabled"><a href="#syslog-enabled" class="headerlink" title="syslog-enabled"></a>syslog-enabled</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># syslog-enabled no</span><br></pre></td></tr></table></figure>
<h2 id="syslog-ident"><a href="#syslog-ident" class="headerlink" title="syslog-ident"></a>syslog-ident</h2><p>系统日志的主体(identity)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># syslog-ident redis</span><br></pre></td></tr></table></figure>
<h2 id="syslog-facility"><a href="#syslog-facility" class="headerlink" title="syslog-facility"></a>syslog-facility</h2><p>指定syslog工具, 必须是USER或LOCAL0-LOCAL7之间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># syslog-facility local0</span><br></pre></td></tr></table></figure>
<h2 id="databases"><a href="#databases" class="headerlink" title="databases"></a>databases</h2><p>设置数据库的数量。 默认数据库是DB 0，您可以使用<code>SELECT &lt;dbid&gt;</code>在每个连接上选择不同的数据库，其中dbid是介于0和’databases’-1之间的数字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">databases 16</span><br></pre></td></tr></table></figure>
<h2 id="always-show-logo"><a href="#always-show-logo" class="headerlink" title="always-show-logo"></a>always-show-logo</h2><p>默认情况下，只有在开始登录标准输出且标准输出为TTY时，Redis才会显示ASCII艺术徽标。 基本上这意味着通常只在交互式会话中显示徽标。</p>
<p>但是，通过将以下选项设置为yes，可以强制执行4.0之前的行为并始终在启动日志中显示ASCII艺术徽标。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">always-show-logo yes</span><br></pre></td></tr></table></figure>

<h1 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h1><h2 id="save"><a href="#save" class="headerlink" title="save"></a>save</h2><p>将数据库保存在磁盘上：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    save &lt;秒&gt; &lt;更改数量&gt;</span><br><span class="line"></span><br><span class="line">    如果同时发生了给定的秒数和针对DB的给定写入操作数，则将保存数据库。</span><br><span class="line"></span><br><span class="line">    在下面的示例中，行为将是保存：</span><br><span class="line">    如果至少1个键改变，则在900秒（15分钟）之后</span><br><span class="line">    如果至少改变了10个键，则在300秒（5分钟）后</span><br><span class="line">    如果至少10000键改变，60秒后</span><br><span class="line"></span><br><span class="line">    注意：您可以通过注释掉所有“save”行来完全禁用保存。</span><br><span class="line"></span><br><span class="line">    也可以通过添加带有单个空字符串参数的save指令来删除所有先前配置的保存点，如下例所示：</span><br><span class="line"></span><br><span class="line">    save &quot;&quot;</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>
<h2 id="stop-writes-on-bgsave-error"><a href="#stop-writes-on-bgsave-error" class="headerlink" title="stop-writes-on-bgsave-error"></a>stop-writes-on-bgsave-error</h2><p>默认情况下，如果启用了RDB快照（至少一个保存点）并且最新的后台保存失败，Redis将停止接受写入。 这将使用户意识到（以一种困难的方式）数据没有正确地保存在磁盘上，否则很可能没有人会注意到并且会发生一些灾难。</p>
<p>如果后台保存过程将再次开始工作，Redis将自动再次允许写入。</p>
<p>但是，如果您已设置对Redis服务器和持久性的正确监视，则可能需要禁用此功能，以便即使磁盘，权限等存在问题，Redis也将继续正常工作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop-writes-on-bgsave-error yes</span><br></pre></td></tr></table></figure>
<h2 id="rdbcompression"><a href="#rdbcompression" class="headerlink" title="rdbcompression"></a>rdbcompression</h2><p>转储.rdb数据库时使用LZF压缩字符串对象？ 默认设置为“是”，因为它几乎总是一个好处。 如果要在保存子项中节省一些CPU，请将其设置为“否”，但如果您具有可压缩值或键，则数据集可能会更大。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdbcompression yes</span><br></pre></td></tr></table></figure>
<h2 id="rdbchecksum"><a href="#rdbchecksum" class="headerlink" title="rdbchecksum"></a>rdbchecksum</h2><p>从RDB的第5版开始，CRC64校验和被放置在文件的末尾。 这使得格式更能抵抗损坏，但在保存和加载RDB文件时需要支付性能（大约10％），因此您可以禁用它以获得最佳性能。</p>
<p>禁用校验和创建的RDB文件的校验和为零，将告诉加载代码跳过检查。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdbchecksum yes</span><br></pre></td></tr></table></figure>
<h2 id="dbfilename"><a href="#dbfilename" class="headerlink" title="dbfilename"></a>dbfilename</h2><p>转储数据库的文件名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbfilename dump.rdb</span><br></pre></td></tr></table></figure>
<h2 id="dir"><a href="#dir" class="headerlink" title="dir"></a>dir</h2><p>工作目录。</p>
<p>数据库将使用’dbfilename’配置的文件名写入此目录。还将在此目录中创建仅可追加文件。</p>
<p>请注意，您必须在此处指定目录，而不是文件名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir ./</span><br></pre></td></tr></table></figure>
<h1 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h1><h2 id="slaveof"><a href="#slaveof" class="headerlink" title="slaveof"></a>slaveof</h2><p>主从复制。 使用slaveof使Redis实例成为另一台Redis服务器的副本。 关于Redis复制的一些事情要尽快理解。</p>
<ol>
<li>Redis复制是异步的，但是如果主机看起来与至少给定数量的从站没有连接，则可以配置主机停止接受写入。</li>
<li>如果复制链路丢失了相对较短的时间，Redis从站能够与主站进行部分重新同步。 您可能希望根据需要配置具有合理值的复制积压大小（请参阅此文件的下一部分）。</li>
<li>复制是自动的，不需要用户干预。 在网络分区从属设备自动尝试重新连接到主设备并与它们重新同步之后。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br></pre></td></tr></table></figure>
<h2 id="masterauth"><a href="#masterauth" class="headerlink" title="masterauth"></a>masterauth</h2>如果主服务器受密码保护（使用下面的“requirepass”配置指令），则可以在启动复制同步过程之前告知从服务器进行身份验证，否则主服务器将拒绝从服务器请求。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth &lt;master-password&gt;</span><br></pre></td></tr></table></figure>
<h2 id="slave-serve-stale-data"><a href="#slave-serve-stale-data" class="headerlink" title="slave-serve-stale-data"></a>slave-serve-stale-data</h2>stale: 陈旧的，过时的</li>
</ol>
<p>当从属设备失去与主设备的连接时，或者当复制仍在进行时，从设备可以以两种不同的方式操作：</p>
<ol>
<li><p>如果slave-serve-stale-data设置为“yes”（默认值），则slave仍将回复客户端请求，可能是过期数据，或者如果这是第一次同步，则数据集可能只是空。</p>
</li>
<li><p>如果slave-serve-stale-data设置为’no’，则slave将回复一个错误“SYNC with master in progress”到所有类型的命令，除了INFO和SLAVEOF。</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slave-serve-stale-data yes</span><br></pre></td></tr></table></figure>
<h2 id="slave-read-only"><a href="#slave-read-only" class="headerlink" title="slave-read-only"></a>slave-read-only</h2><p>您可以将从属实例配置为是否接受写入。 针对从属实例进行写入可能对存储一些短暂的数据很有用（因为在与主服务器重新同步后，将很容易删除写在从服务器上的数据），但如果客户端由于配置错误而写入数据，也可能会导致问题。</p>
<p>由于Redis 2.6默认情况下从属设备是只读的。</p>
<p><strong>注意：只读从站不适合在Internet上暴露给不受信任的客户端。 它只是一个防止滥用实例的保护层。 仍然只读的从属设备默认导出所有管理命令，如CONFIG，DEBUG等。 在某种程度上，您可以使用“rename-command”来隐藏所有管理&#x2F;危险命令，从而提高只读从站的安全性</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slave-read-only yes</span><br></pre></td></tr></table></figure>
<h2 id="repl-diskless-sync"><a href="#repl-diskless-sync" class="headerlink" title="repl-diskless-sync"></a>repl-diskless-sync</h2><p>复制SYNC策略：磁盘或套接字。</p>
<hr>
<p><strong>警告：目前无盘复制是实验性的</strong></p>
<hr>
<p>新的从站和重新连接的从站只能接收差异而无法继续复制过程，需要执行所谓的“完全同步”。 RDB文件从主服务器传输到从服务器。传输可以以两种不同的方式发生：</p>
<ol>
<li>磁盘：Redis主服务器创建一个将RDB文件写入磁盘的新进程。稍后，父进程将文件以递增方式传输到从属服务器。</li>
<li>无盘：Redis主站创建一个新进程，直接将RDB文件写入从套接字，而根本不接触磁盘。</li>
</ol>
<p>使用磁盘支持的复制，在生成RDB文件时，只要生成RDB文件的当前子代完成其工作，就可以将更多的从服务器排队并与RDB文件一起提供。使用无盘复制，一旦传输开始，到达的新从站将排队，并且当当前终端将终止时将开始新的传输。</p>
<p>使用无盘复制时，主机在开始传输之前等待一段可配置的时间（以秒为单位），希望多个从站到达并且传输可以并行化。</p>
<p>对于慢速磁盘和快速（大带宽）网络，无盘复制效果更好。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-diskless-sync no</span><br></pre></td></tr></table></figure>
<h2 id="repl-diskless-sync-delay"><a href="#repl-diskless-sync-delay" class="headerlink" title="repl-diskless-sync-delay"></a>repl-diskless-sync-delay</h2><p>启用无盘复制时，可以配置服务器等待的延迟，以便生成通过套接字将RDB传输到从属服务器的子服务器。</p>
<p>这很重要，因为一旦传输开始，就不可能为新的从站提供服务，这些新的服务器将排队等待下一次RDB传输，因此服务器会等待延迟以便让更多的从服务器到达。</p>
<p>延迟以秒为单位指定，默认为5秒。 要完全禁用它，只需将其设置为0秒，即可尽快启动传输。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-diskless-sync-delay 5</span><br></pre></td></tr></table></figure>
<h2 id="repl-ping-slave-period"><a href="#repl-ping-slave-period" class="headerlink" title="repl-ping-slave-period"></a>repl-ping-slave-period</h2><p>从站以预定义的间隔将PING发送到服务器。 可以使用repl_ping_slave_period选项更改此间隔。 默认值为10秒。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-ping-slave-period 10</span><br></pre></td></tr></table></figure>
<h2 id="repl-timeout"><a href="#repl-timeout" class="headerlink" title="repl-timeout"></a>repl-timeout</h2><p>以下选项设置复制超时：</p>
<ol>
<li>从从设备的角度来看，在SYNC期间批量传输I &#x2F; O.</li>
<li>从站（data，ping）的角度来看主站超时。</li>
<li>从主设备的角度来看从设备超时（REPLCONF ACK ping）。</li>
</ol>
<p><strong>确保此值大于为repl-ping-slave-period指定的值非常重要，否则每次主站和从站之间的流量较低时都会检测到超时。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-timeout 60</span><br></pre></td></tr></table></figure>
<h2 id="repl-disable-tcp-nodelay"><a href="#repl-disable-tcp-nodelay" class="headerlink" title="repl-disable-tcp-nodelay"></a>repl-disable-tcp-nodelay</h2><p>SYNC后，在从站socket禁用TCP_NODELAY？</p>
<p>如果选择“是”，Redis将使用较少数量的TCP数据包和较少的带宽将数据发送到从设备。 但这可能会增加数据在从属端出现的延迟，使用默认配置的Linux内核最多可达40毫秒。</p>
<p>如果选择“否”，将减少从站侧出现数据的延迟，但将使用更多带宽进行复制。</p>
<p>默认情况下，我们针对低延迟进行了优化，但是在非常高的流量条件下，或者当主设备和从设备远离许多跳时，将其转为“是”可能是个好主意。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-disable-tcp-nodelay no</span><br></pre></td></tr></table></figure>
<h2 id="repl-backlog-size"><a href="#repl-backlog-size" class="headerlink" title="repl-backlog-size"></a>repl-backlog-size</h2><p>设置复制积压大小。 积压是一个缓冲区，当从属设备断开连接一段时间后会累积从属数据，这样当一个从属设备想要再次重新连接时，通常不需要完全重新同步，只是部分重新同步就足够了。</p>
<p>复制积压越大，从站断开连接的时间就可以越长。</p>
<p>只有在至少连接了一个从站时才会分配积压。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-backlog-size 1mb</span><br></pre></td></tr></table></figure>
<h2 id="repl-backlog-ttl"><a href="#repl-backlog-ttl" class="headerlink" title="repl-backlog-ttl"></a>repl-backlog-ttl</h2><p>在主设备不再连接从设备一段时间后，将释放待办事项。 以下选项配置从上次从站断开连接开始需要经过的秒数，以释放待处理日志缓冲区。</p>
<p>请注意，从站永远不会因为超时释放积压，因为它们可能会在以后升级为主站，并且应该能够与从站正确“部分重新同步”：因此它们应始终积累积压。</p>
<p>值为0表示永远不会释放积压。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repl-backlog-ttl 3600</span><br></pre></td></tr></table></figure>
<h2 id="slave-priority"><a href="#slave-priority" class="headerlink" title="slave-priority"></a>slave-priority</h2><p>从属优先级一个整数。 如果主服务器不再正常工作，Redis Sentinel将使用它来选择要升级为主服务器的从服务器。</p>
<p>具有 <strong>低优先级编号的从站被认为更适合升级</strong> ，因此例如如果有三个优先级为10,100的从站，则Sentinel将选择优先级为10的从站，即最低的。</p>
<p>但是，<strong>特殊优先级为0表示从站无法执行主站角色</strong>，因此Redis Sentinel永远不会选择优先级为0的从站进行升级。</p>
<p>默认情况下，优先级为100。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slave-priority 100</span><br></pre></td></tr></table></figure>
<h2 id="min-slaves-to-write"><a href="#min-slaves-to-write" class="headerlink" title="min-slaves-to-write"></a>min-slaves-to-write</h2><p>如果连接的连接少于N个，滞后&lt;&#x3D; M秒，则主设备可以停止接受写入。</p>
<p>N个奴隶需要处于“在线”状态。</p>
<p>以秒为单位的延迟（必须&lt;&#x3D; 指定值）是根据从从站接收的最后一次ping计算的，通常每秒发送一次。</p>
<p>此选项不保证N个副本将接受写入，但是如果没有足够的从站可用，则将限制丢失写入的窗口，达到指定的秒数。</p>
<p>例如，要求至少3个具有滞后&lt;&#x3D; 10秒的从属使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">min-slaves-to-write 3</span><br><span class="line">min-slaves-max-lag 10</span><br></pre></td></tr></table></figure>
<p>将一个或另一个设置为0将禁用该功能。</p>
<p>默认情况下，min-slaves-to-write设置为0（功能禁用），min-slaves-max-lag设置为10。</p>
<h2 id="slave-announce"><a href="#slave-announce" class="headerlink" title="slave-announce"></a>slave-announce</h2><p>Redis主站能够以不同方式列出所连接从站的地址和端口。例如，“INFO复制”部分提供此信息，Redis Sentinel使用该信息以及其他工具来发现从属实例。<br>此信息可用的另一个位置是主站的“ROLE”命令的输出。</p>
<p>通常由从站报告的列出的IP和地址通过以下方式获得：</p>
<ul>
<li>IP：通过检查从设备用于连接主设备的套接字的对等地址，自动检测地址。</li>
<li>端口：端口在复制握手期间由从端进行通信，通常是从端用于列出连接的端口。</li>
</ul>
<p>但是，当使用端口转发或网络地址转换（NAT）时，从站实际上可以通过不同的IP和端口对访问。从站可以使用以下两个选项，以便向其主站报告一组特定的IP和端口，以便INFO和ROLE都报告这些值。</p>
<p>如果只需要覆盖端口或IP地址，则无需使用这两个选项。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># slave-announce-ip 5.5.5.5</span><br><span class="line"># slave-announce-port 1234</span><br></pre></td></tr></table></figure>
<h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><h2 id="requirepass"><a href="#requirepass" class="headerlink" title="requirepass"></a>requirepass</h2><p>访问redis-server的密码，最好很复杂，不然每秒150k的暴力破解很容易猜出来。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass kdsjfkdsj</span><br></pre></td></tr></table></figure>
<h2 id="rename-command"><a href="#rename-command" class="headerlink" title="rename-command"></a>rename-command</h2><p>对危险命令进行重命名，如果为””,则完全禁用此命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename-command CONFIG &quot;&quot;</span><br></pre></td></tr></table></figure>
<h1 id="Clients"><a href="#Clients" class="headerlink" title="Clients"></a>Clients</h1><p>设置客户端最大连接数，默认10000，如果达到限制，报错：<code>&#39;max number of clients reached&#39;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000</span><br></pre></td></tr></table></figure>
<h1 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h1><h2 id="maxmemory"><a href="#maxmemory" class="headerlink" title="maxmemory"></a>maxmemory</h2><p>最大内存限制,单位字节。</p>
<ul>
<li>当达到限制，redis会根据maxmemory-policy(见下面)移除key</li>
<li>如果无法移除，则对写命令报错，对读命令正常</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmeory &lt;bytes&gt;</span><br></pre></td></tr></table></figure>
<h2 id="maxmemory-policy"><a href="#maxmemory-policy" class="headerlink" title="maxmemory-policy"></a>maxmemory-policy</h2><p>当最大内存限制达到，如何清除keys：</p>
<ul>
<li><p>volatile-lru - &gt;移除近似LRU中的过期集。</p>
</li>
<li><p>allkeys-lru - &gt;移除近似LRU中的任何键。</p>
</li>
<li><p>volatile-lfu - &gt;移除近似LFU中的过期集。</p>
</li>
<li><p>allkeys-lfu - &gt;移除近似LFU中的任何键。</p>
</li>
<li><p>volatile-random - &gt;随机删除过期集合中的key。</p>
</li>
<li><p>allkeys-random - &gt;随机删除任意key。</p>
</li>
<li><p>volatile-ttl - &gt; 删除最近的达到TTL的key</p>
</li>
<li><p>noeviction - &gt;不删除任何key，只报错。</p>
</li>
<li><p>LRU means Least Recently Used</p>
</li>
<li><p>LFU means Least Frequently Used</p>
</li>
</ul>
<p>包括的写命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set setnx setex append</span><br><span class="line">incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span><br><span class="line">sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span><br><span class="line">zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span><br><span class="line">getset mset msetnx exec sort</span><br></pre></td></tr></table></figure>
<h1 id="懒删除"><a href="#懒删除" class="headerlink" title="懒删除"></a>懒删除</h1><p>redis删除key有2个命令：DEL和UNLINK，FLUSHALL，FLUSHDB</p>
<ul>
<li>DEL是一个同步阻塞操作，如果key关联的值非常大，则会阻塞很长时间</li>
<li>UNLINK就是非阻塞的删除</li>
</ul>
<p>服务器自己删除key的场景：</p>
<ol>
<li>内存爆了时</li>
<li>过期key</li>
<li>类型RENAME命令，SET，SUNIONSTORE会移除old keys</li>
<li>从站复制时会先删除再接收</li>
</ol>
<p>下面可以配置这些懒删除：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">slave-lazy-flush no</span><br></pre></td></tr></table></figure>
<h1 id="只读模式"><a href="#只读模式" class="headerlink" title="只读模式"></a>只读模式</h1><p>默认情况下，针对配置的save point，数据持久化可能会丢失数据。</p>
<p>AOF是AppendOnly File的缩写，是Redis系统提供了一种记录Redis操作的持久化方案，在AOF生成的文件中，将忠实记录发生在Redis的操作，从而达到在Redis服务器重启或者当机之后，继续恢复之前数据状态的机制。</p>
<h2 id="appendonly"><a href="#appendonly" class="headerlink" title="appendonly"></a>appendonly</h2><p>AOF和RDB可以同时启动。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly no</span><br></pre></td></tr></table></figure>
<h2 id="appendfilename"><a href="#appendfilename" class="headerlink" title="appendfilename"></a>appendfilename</h2><p>追加的文件名，默认<code>appendonly.aof</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br></pre></td></tr></table></figure>
<h2 id="appendfsync"><a href="#appendfsync" class="headerlink" title="appendfsync"></a>appendfsync</h2><p>fsync()是告诉操作系统将数据写入磁盘而不是buffer的确切操作。<br>有下面3种模式，如果不确定，使用everysec</p>
<ul>
<li>no: 不fsync</li>
<li>everysec: 默认，每秒一次</li>
<li>always： 每次写入都同步</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendfsync everysec</span><br></pre></td></tr></table></figure>
<h2 id="no-appendfsync-on-rewrite"><a href="#no-appendfsync-on-rewrite" class="headerlink" title="no-appendfsync-on-rewrite"></a>no-appendfsync-on-rewrite</h2><p>如果开启AOF并且有很大延迟，则改为yes，但最好是no</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no-appendfsync-on-rewrite no</span><br></pre></td></tr></table></figure>
<h2 id="auto-aof-rewrite"><a href="#auto-aof-rewrite" class="headerlink" title="auto-aof-rewrite"></a>auto-aof-rewrite</h2><p>当达到配置的存储大小的百分比后，自动重写文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure>
<h2 id="aof-load-truncates"><a href="#aof-load-truncates" class="headerlink" title="aof-load-truncates"></a>aof-load-truncates</h2><p>当OS发生故障时AOF文件可能会截断，下面的配置：</p>
<ul>
<li>如果设为yes，则截断AOF只是发出事件通知给用户</li>
<li>否则，服务器会报错而终止</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aof-load-truncated yes</span><br></pre></td></tr></table></figure>
<h2 id="aof-use-rdb-preamble"><a href="#aof-use-rdb-preamble" class="headerlink" title="aof-use-rdb-preamble"></a>aof-use-rdb-preamble</h2><p>如果为yes，则AOF文件会为<code>[RDB file][AOF tail]</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aof-use-rdb-preamble no</span><br></pre></td></tr></table></figure>
<h1 id="LUA-脚本"><a href="#LUA-脚本" class="headerlink" title="LUA 脚本"></a>LUA 脚本</h1><h2 id="lua-time-limit"><a href="#lua-time-limit" class="headerlink" title="lua-time-limit"></a>lua-time-limit</h2><p>lua脚本执行的最长时间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lua-time-limit 5000</span><br></pre></td></tr></table></figure>
<h1 id="redis集群"><a href="#redis集群" class="headerlink" title="redis集群"></a>redis集群</h1><h2 id="cluster-enabled"><a href="#cluster-enabled" class="headerlink" title="cluster-enabled"></a>cluster-enabled</h2><p>这是个实验功能，只有声明为cluster节点的的redis实例才能成为集群的一份子，如下：默认是没启用的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cluster-enabled yes</span><br></pre></td></tr></table></figure>
<h2 id="cluster-config-file"><a href="#cluster-config-file" class="headerlink" title="cluster-config-file"></a>cluster-config-file</h2><p>每个节点都有一个配置文件，但是不能手动更改，节点会自己更新管理这个文件，<strong>保证同一个机器上的节点的配置文件名不重复。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cluster-config-file nodes-6379.conf</span><br></pre></td></tr></table></figure>
<h2 id="cluster-node-timeout"><a href="#cluster-node-timeout" class="headerlink" title="cluster-node-timeout"></a>cluster-node-timeout</h2><p>节点超时时间是一个节点无法响应的最大时限：他就被认为挂了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cluster-node-timeout 15000</span><br></pre></td></tr></table></figure>

<p>&#x2F;&#x2F;TODO 其他参数</p>
<h1 id="集群docker-x2F-NAT支持"><a href="#集群docker-x2F-NAT支持" class="headerlink" title="集群docker&#x2F;NAT支持"></a>集群docker&#x2F;NAT支持</h1><p>redis的地址发现在docker等容器环境中会失败，为了支持docker等容器，可以采用以下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cluster-announce-ip 10.1.1.5</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 6380</span><br></pre></td></tr></table></figure>
<p>上面的意思就是把这个节点自己的ip和端口通知所有其他节点，让他们发现，这个总线端口就是用来收发消息的，如果不指定，将会采用节点端口偏移10000，比如上面为<code>6379+10000=16379</code>.</p>
<h1 id="slow-log"><a href="#slow-log" class="headerlink" title="slow log"></a>slow log</h1><p>执行时间：命令的执行时间不包括IO操作和与其他客户端通信的时间。</p>
<p>一条命令的执行时间达到配置的最大时间后写一条日志：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 10ms</span><br><span class="line">slowing-log-slower-than 10000</span><br></pre></td></tr></table></figure>
<p>配置这个日志队列的最大长度：新的来了老的移除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowing-max-len 128</span><br></pre></td></tr></table></figure>
<h1 id="延迟监视器"><a href="#延迟监视器" class="headerlink" title="延迟监视器"></a>延迟监视器</h1><p>为了收集redis实例延迟原因的数据。</p>
<p><code>LATENCY</code> 命令：打印图片和报告。</p>
<p>下面的命令为0表示关闭监视，否则代表延迟的最大时间限制，达到了就写入操作日志，单位为毫秒：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">latency-monitor-threshold 0</span><br></pre></td></tr></table></figure>
<p>可以在运行时动态配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;</span><br></pre></td></tr></table></figure>
<h1 id="事件通知"><a href="#事件通知" class="headerlink" title="事件通知"></a>事件通知</h1><p>redis可以通知Pub&#x2F;Sub客户端发生的事件，在键空间。例如，一个DEL操作删除了存储子啊database 0的<code>foo</code>key,2条信息会通过Pub&#x2F;Sub发送：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PUBLISH __keyspace@0__:foo del</span><br><span class="line">PUBLISH __keyevent@0__:del foo</span><br></pre></td></tr></table></figure>
<p>通知分为很多类，每类用一个字符标识：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#  K     Keyspace events, published with __keyspace@&lt;db&gt;__ prefix.</span><br><span class="line">#  E     Keyevent events, published with __keyevent@&lt;db&gt;__ prefix.</span><br><span class="line">#  g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</span><br><span class="line">#  $     String commands</span><br><span class="line">#  l     List commands</span><br><span class="line">#  s     Set commands</span><br><span class="line">#  h     Hash commands</span><br><span class="line">#  z     Sorted set commands</span><br><span class="line">#  x     Expired events (events generated every time a key expires)</span><br><span class="line">#  e     Evicted events (events generated when a key is evicted for maxmemory)</span><br><span class="line">#  A     Alias for g$lshzxe, so that the &quot;AKE&quot; string means all the events.</span><br></pre></td></tr></table></figure>
<p>例如：只启用list和无类型命令的事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notify-keyspace-events Elg</span><br></pre></td></tr></table></figure>
<p>默认空字符串，没开启任何事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notify-keyspace-events &quot;&quot;</span><br></pre></td></tr></table></figure>
<h1 id="高级配置"><a href="#高级配置" class="headerlink" title="高级配置"></a>高级配置</h1><h2 id="hash-max"><a href="#hash-max" class="headerlink" title="hash-max"></a>hash-max</h2><p>hash会被在内存中进行编码来节约空间，下面限制最大的entry项数量阈值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br></pre></td></tr></table></figure>
<h2 id="list-max"><a href="#list-max" class="headerlink" title="list-max"></a>list-max</h2><p>list也会被编码来节约空间，下面的参数限制了每个内部的list节点可以被指定的最大entry数量或者最大大小。</p>
<p>对于固定的最大大小，从-5到-1的含义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># -5: max size: 64 Kb  &lt;-- not recommended for normal workloads</span><br><span class="line"># -4: max size: 32 Kb  &lt;-- not recommended</span><br><span class="line"># -3: max size: 16 Kb  &lt;-- probably not recommended</span><br><span class="line"># -2: max size: 8 Kb   &lt;-- good</span><br><span class="line"># -1: max size: 4 Kb   &lt;-- good</span><br></pre></td></tr></table></figure>
<p>正数代表每个list节点确切的元素个数。通常性能最好的就是-2或-1，但如果你的应用场景不同，也可以调节：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list-max-ziplist-size -2</span><br></pre></td></tr></table></figure>
<h2 id="list-compress"><a href="#list-compress" class="headerlink" title="list-compress"></a>list-compress</h2><p>list也会被压缩，压缩的深度代表：list两端的不压缩节点个数，看下面就明白了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 0: 不压缩</span><br><span class="line"># 1: 只压缩除首尾外的中间节点</span><br><span class="line">#    如：[head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail]</span><br><span class="line">#    [head], [tail] 不会压缩; 内部节点压缩</span><br><span class="line"># 2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail]</span><br><span class="line">#    2 here means: don&#x27;t compress head or head-&gt;next or tail-&gt;prev or tail,</span><br><span class="line">#    but compress all nodes between them.</span><br><span class="line"># 3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</span><br><span class="line"># 等等</span><br></pre></td></tr></table></figure>
<p>默认是不压缩：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list-compress-depth 0</span><br></pre></td></tr></table></figure>
<h2 id="set-max"><a href="#set-max" class="headerlink" title="set-max"></a>set-max</h2><p>set只会在一种情况被编码：就是这个集合只有字符串组成，且这些字符串恰好都是64位的10进制整数。<br>下面的配置代表：使用这种编码的集合最大元素个数为512.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set-max-intset-entries 512</span><br></pre></td></tr></table></figure>
<h2 id="zset-max"><a href="#zset-max" class="headerlink" title="zset-max"></a>zset-max</h2><p>sorted set 也会编码来解决空间，只在数量低于下面的配置时才有用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br></pre></td></tr></table></figure>
<h2 id="hll-sparse-max-bytes"><a href="#hll-sparse-max-bytes" class="headerlink" title="hll-sparse-max-bytes"></a>hll-sparse-max-bytes</h2><p>HyperLogLog的稀疏表示限制，当超过下面的配置时就转为密集表示，大于16000是没必要的，因为这时候密集表示的效率已高于稀疏的，推荐用3000，如果CPU很厉害，只考虑空间，那么可以提高到10000。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hll-sparse-max-bytes 3000</span><br></pre></td></tr></table></figure>
<h2 id="activerehashing"><a href="#activerehashing" class="headerlink" title="activerehashing"></a>activerehashing</h2><h2 id="client-output-buffer-limit"><a href="#client-output-buffer-limit" class="headerlink" title="client-output-buffer-limit"></a>client-output-buffer-limit</h2><h2 id="client-query-buffer-limit"><a href="#client-query-buffer-limit" class="headerlink" title="client-query-buffer-limit"></a>client-query-buffer-limit</h2><h2 id="proto-max-bulk-len"><a href="#proto-max-bulk-len" class="headerlink" title="proto-max-bulk-len"></a>proto-max-bulk-len</h2><p>批量请求的单个string的长度限制在512MB，下面可以配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proto-max-bulk-len 512mb</span><br></pre></td></tr></table></figure>
<h2 id="hz"><a href="#hz" class="headerlink" title="hz"></a>hz</h2><p>redis有许多后台任务，比如关闭超时连接，删除过时key等。</p>
<p>并不是所有任务执行的频率都一样，但redis会根据hz的值来表现。</p>
<p>默认hz为10，提高hz会使CPU更活跃，响应更快，超时判断更精确。</p>
<p>hz范围为1-500，一般不会超过100。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hz 10</span><br></pre></td></tr></table></figure>
<h2 id="aof-rewrite-incremental-fsync"><a href="#aof-rewrite-incremental-fsync" class="headerlink" title="aof-rewrite-incremental-fsync"></a>aof-rewrite-incremental-fsync</h2><p>如果为yes，则AOF文件每生成32MB，就同步到磁盘，避免大的延迟飙升。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aof-rewrite-incremental-fsync yes</span><br></pre></td></tr></table></figure>
<h2 id="LFU调优参数"><a href="#LFU调优参数" class="headerlink" title="LFU调优参数"></a>LFU调优参数</h2><p>针对LFU移除算法进行你调优，有2个参数：计数器的对数因子和衰变因子，首先理解他们很重要。</p>
<h3 id="lfu-log-factor"><a href="#lfu-log-factor" class="headerlink" title="lfu-log-factor"></a>lfu-log-factor</h3><p>LFU计数器对与每个key是一个8位的数，最大值255，redis使用了一个对数行为的概率增量。给定老的计数器的值，这个计数器采用如下方式递增：</p>
<ol>
<li>生成一个0-1的随机数R；</li>
<li>概率P&#x3D;1&#x2F;(old_value*lfu_log_factor + 1);</li>
<li>仅当R&lt;P时才增加计数器。</li>
</ol>
<p>默认的lfu-log-factor&#x3D;10, 下面是一张表，描述了在不同的factor因子下，不同的访问次数对计数器改变频率的影响：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | factor | <span class="number">100</span> hits   | <span class="number">1000</span> hits  | 100K hits  | 1M hits    | 10M hits   |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | <span class="number">0</span>      | <span class="number">104</span>        | <span class="number">255</span>        | <span class="number">255</span>        | <span class="number">255</span>        | <span class="number">255</span>        |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | <span class="number">1</span>      | <span class="number">18</span>         | <span class="number">49</span>         | <span class="number">255</span>        | <span class="number">255</span>        | <span class="number">255</span>        |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | <span class="number">10</span>     | <span class="number">10</span>         | <span class="number">18</span>         | <span class="number">142</span>        | <span class="number">255</span>        | <span class="number">255</span>        |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br><span class="line"># | <span class="number">100</span>    | <span class="number">8</span>          | <span class="number">11</span>         | <span class="number">49</span>         | <span class="number">143</span>        | <span class="number">255</span>        |</span><br><span class="line"># +--------+------------+------------+------------+------------+------------+</span><br></pre></td></tr></table></figure>
<p>可以运行下面的命令得到上述结果(foo初始值为5)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark -n <span class="number">1000000</span> incr foo</span><br><span class="line">redis-cli object freq foo</span><br></pre></td></tr></table></figure>
<h3 id="lfu-decay-time"><a href="#lfu-decay-time" class="headerlink" title="lfu-decay-time"></a>lfu-decay-time</h3><p>衰变因子是一个时间，单位为分钟，控制计数器衰变的，到了指定时间，计数器会衰变（除以2，如果小于10则减一）。如果这个值为0，代表每次扫描到这个计数器都会衰减。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lfu-decay-time <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>为啥会有这个，也很简单，lfu-log-factor控制增加，lfu-decay-time控制减少，不然会满了。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本文解释redis的配置文件。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/04/lang/010-redis-configuration/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/04/lang/010-redis-configuration/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/04/lang/010-redis-configuration/" data-id="cl1fw7fm600e2vkd304016syf" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="article-tag-list-count">12</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-lang/009-redis-partition" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/03/lang/009-redis-partition/" class="article-date">
  <time datetime="2018-09-03T07:43:19.000Z" itemprop="datePublished">2018-09-03</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/03/lang/009-redis-partition/">redis分区：如何在多个Redis实例之间拆分数据</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>分区是将数据拆分为多个Redis实例的过程，因此每个实例只包含key的子集。 本文档的第一部分将向您介绍分区的概念，第二部分将向您展示Redis分区的替代方案。</p>
<img src="/2018/09/03/lang/009-redis-partition/000.png" class="">

<h1 id="为什么分区很有用"><a href="#为什么分区很有用" class="headerlink" title="为什么分区很有用"></a>为什么分区很有用</h1><p>Redis中的分区有两个主要目标：</p>
<ol>
<li>它允许更大的数据库，使用许多计算机的内存总和。 如果不进行分区，则限制为单台计算机可以支持的内存量。</li>
<li>它允许将计算能力扩展到多个核心和多台计算机，并将网络带宽扩展到多台计算机和网络适配器。</li>
</ol>
<h1 id="分区基础知识"><a href="#分区基础知识" class="headerlink" title="分区基础知识"></a>分区基础知识</h1><p>有不同的分区标准。 想象一下，我们有四个Redis实例R0，R1，R2，R3和许多代表用户的key：user:1，user:2，…等等，我们可以找到不同的方法来选择我们存储给定key的实例。 换句话说，有不同的系统将给定的key映射到给定的Redis服务器。</p>
<p>执行分区的最简单方法之一是使用范围分区，并通过将对象范围映射到特定的Redis实例来完成。 例如，我可以说从ID 0到ID 10000的用户将进入实例R0，而用户表单ID 10001到ID 20000将进入实例R1，依此类推。</p>
<p>那样可以工作并且实际上在实践中使用，但是，它具有需要将范围映射到实例的表的缺点。 需要管理此表，并且每种对象都需要一个表，因此Redis中的范围分区通常是不合需要的，因为它比其他替代分区方法效率低得多。</p>
<p>范围分区的替代方法是 <strong>散列分区</strong> 。 此方案适用于任何键，无需表格<code>object_name：&lt;id&gt;</code>中的键，并且简单如下：</p>
<ul>
<li>获取key名称并使用散列函数（例如，crc32散列函数）将其转换为数字。 例如，如果键是foobar，crc32（foobar）将输出类似93024922的内容。</li>
<li>使用带有此数字的模运算，以便将其转换为0到3之间的数字，以便可以将此数字映射到我的四个Redis实例之一。 93024922 modulo 4等于2，所以我知道我的密钥foobar应该存储在R2实例中。 注意：模运算返回除法运算的余数，并在许多编程语言中使用％运算符实现。</li>
</ul>
<p>还有许多其他方法可以执行分区，但是有了这两个例子，你应该明白这个想法。 一种高级的散列分区称为一致散列，由一些Redis客户端和代理实现。</p>
<h1 id="不同的分区实现"><a href="#不同的分区实现" class="headerlink" title="不同的分区实现"></a>不同的分区实现</h1><p>分区可能负责软件栈的不同部分。</p>
<ul>
<li><strong>客户端分区</strong> 意味着客户端直接选择正确的节点在哪里写或读取给定的key。许多Redis客户端实现客户端分区。</li>
<li><strong>代理辅助分区</strong> 意味着我们的客户端将请求发送到能懂Redis协议的代理，而不是直接向正确的Redis实例发送请求。代理将确保根据配置的分区架构将我们的请求转发到正确的Redis实例，并将回复发送回客户端。 Redis和Memcached代理Twemproxy实现代理辅助分区。</li>
<li><strong>查询路由</strong> 意味着您可以将查询发送到随机实例，实例将确保将查询转发到正确的节点。 Redis Cluster在客户端的帮助下实现了混合形式的查询路由（请求不是直接从Redis实例转发到另一个实例，而是将客户端重定向到正确的节点）。</li>
</ul>
<h1 id="分区的缺点"><a href="#分区的缺点" class="headerlink" title="分区的缺点"></a>分区的缺点</h1><p>Redis的某些功能在分区方面效果不佳：</p>
<ul>
<li>通常不支持涉及多个键的操作。例如，如果它们存储在映射到不同Redis实例的键中，则无法执行两个集合之间的交集（实际上有方法可以执行此操作，但不能直接执行此操作）。</li>
<li>无法使用涉及多个key的Redis事务。</li>
<li>分区粒度是关键，因此无法使用单个巨大的key（如非常大的有序集）对数据集进行分片。</li>
<li>使用分区时，数据处理更复杂，例如，您必须处理多个RDB &#x2F; AOF文件，并且需要从多个实例和主机聚合持久性文件来备份数据。</li>
<li>添加和删​​除容量可能很复杂。例如，Redis Cluster支持大多数透明的数据重新平衡，能够在运行时添加和删除节点，但其他系统（如客户端分区和代理）不支持此功能。然而，一种称为预分片的技术在这方面有所帮助。</li>
</ul>
<h1 id="数据存储还是缓存"><a href="#数据存储还是缓存" class="headerlink" title="数据存储还是缓存"></a>数据存储还是缓存</h1><p>虽然无论使用Redis作为数据存储还是作为缓存，Redis中的分区在概念上都是相同的，但在将其用作数据存储时存在很大的局限性。 当Redis用作数据存储时，给定的键必须始终映射到同一个Redis实例。 当Redis用作缓存时，如果给定节点不可用，然后使用不同的节点，则不会出现大问题，因为我们希望改善系统的可用性（即， 系统回复我们的查询）。</p>
<p>如果给定key的首选节点不可用，则一致的散列实现通常能够切换到其他节点。 同样，如果添加新节点，则新键的一部分将开始存储在新节点上。</p>
<p>这里的主要概念如下：</p>
<ul>
<li>如果使用Redis作为缓存，则使用一致性散列可以轻松扩展和缩小。</li>
<li>如果将Redis用作存储，则使用固定的键到节点映射，<strong>因此节点数必须固定且不能变化</strong>。 否则，需要一个能够在添加或删除节点时在节点之间重新平衡密钥的系统，并且目前只有Redis Cluster能够执行此操作 - 从2015年4月1日起，Redis Cluster通常可用并且可以投入生产。</li>
</ul>
<h1 id="Presharding-预分片"><a href="#Presharding-预分片" class="headerlink" title="Presharding(预分片)"></a>Presharding(预分片)</h1><p>我们了解到分区的问题在于，除非我们使用Redis作为缓存，否则添加和删除节点可能会非常棘手，并且使用固定的键实例映射会更加简单。</p>
<p>但是，数据存储需求可能随时间而变化。 今天我可以使用10个Redis节点（实例），但明天我可能需要50个节点。</p>
<p>由于Redis的占用空间非常小且轻量级（备用实例使用1 MB内存），因此从一开始就有很多实例可以解决这个问题。 即使您只使用一台服务器，您也可以决定从第一天开始就在分布式环境中生活，并使用分区在单个服务器中运行多个Redis实例。</p>
<p>并且您可以从一开始就选择此数量的实例。 例如，32或64个实例可以为大多数用户提供技巧，并将提供足够的增长空间。</p>
<p>这样，当您的数据存储需求增加并且需要更多Redis服务器时，只需将实例从一个服务器移动到另一个服务器即可。 添加第一个附加服务器后，您需要将一半的Redis实例从第一个服务器移动到第二个服务器，依此类推。</p>
<p>使用Redis复制，您可能可以在用户停机时间最短或无停机的情况下进行移动：</p>
<ul>
<li>在新服务器中启动空实例。</li>
<li>将配置这些新实例的数据作为源实例的从属数据移动。</li>
<li>阻止你的客户端。</li>
<li>使用新服务器IP地址更新已移动实例的配置。</li>
<li>将 <code>SLAVEOF NO ONE</code> 命令发送到新服务器中的从站。</li>
<li>使用新的更新配置重新启动客户端。</li>
<li>最后关闭旧服务器中不再使用的实例。</li>
</ul>
<h1 id="Redis分区的实现"><a href="#Redis分区的实现" class="headerlink" title="Redis分区的实现"></a>Redis分区的实现</h1><p>到目前为止，我们在理论上涵盖了Redis分区，但实践呢？ 你应该使用什么系统？</p>
<h2 id="Redis集群"><a href="#Redis集群" class="headerlink" title="Redis集群"></a>Redis集群</h2><p>Redis Cluster是获得自动分片和高可用性的首选方式。 从2015年4月1日起，它通常可用并且可以投入生产。您可以在群集教程中获得有关Redis群集的更多信息。</p>
<p>一旦Redis Cluster可用，并且符合Redis Cluster的客户端可用于您的语言，Redis Cluster将成为Redis分区的事实标准。</p>
<p>Redis Cluster是查询路由和客户端分区之间的混合。</p>
<h2 id="Twemproxy"><a href="#Twemproxy" class="headerlink" title="Twemproxy"></a>Twemproxy</h2><p>Twemproxy是Twitter在Memcached ASCII和Redis协议上开发的代理。 它是单线程的，用C语言编写，速度极快。 它是根据Apache 2.0许可条款发布的开源软件。</p>
<p>Twemproxy支持多个Redis实例之间的自动分区，如果节点不可用，则可选节点弹出（这将更改keys-instances映射，因此只有在使用Redis作为缓存时才应使用此功能）。</p>
<p>这不是单点故障，因为您可以启动多个代理并指示您的客户端连接到接受连接的第一个代理。</p>
<p>基本上，Twemproxy是客户端和Redis实例之间的中间层，它将以最小的额外复杂性可靠地处理分区。</p>
<p>您可以在此antirez博客文章中阅读有关Twemproxy的更多信息。</p>
<h2 id="支持一致哈希的客户端"><a href="#支持一致哈希的客户端" class="headerlink" title="支持一致哈希的客户端"></a>支持一致哈希的客户端</h2><p>Twemproxy的替代方法是使用通过一致散列或其他类似算法实现客户端分区的客户端。 有多个Redis客户端支持一致性哈希，尤其是<a target="_blank" rel="noopener" href="https://github.com/redis/redis-rb">Redis-rb</a>和<a target="_blank" rel="noopener" href="https://github.com/nrk/predis">Predis</a>。</p>
<p>请检查Redis客户端的完整列表，以检查是否存在具有针对您的语言的一致哈希实现的成熟客户端。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>分区是将数据拆分为多个Redis实例的过程，因此每个实例只包含key的子集。 本文档的第一部分将向您介绍分区的概念，第二部分将向您展示Redis分区的替代方案。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/03/lang/009-redis-partition/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/03/lang/009-redis-partition/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/03/lang/009-redis-partition/" data-id="cl1fw7fm700e3vkd352pucxch" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="article-tag-list-count">12</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-lang/008-redis-lru-cache" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/03/lang/008-redis-lru-cache/" class="article-date">
  <time datetime="2018-09-03T02:24:33.000Z" itemprop="datePublished">2018-09-03</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/03/lang/008-redis-lru-cache/">redis做LRU缓存</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>当Redis用作缓存时，通常可以让它在添加新数据时自动逐出旧数据。 这种行为在开发人员社区中非常有名，因为它是流行的memcached系统的默认行为。</p>
<p>LRU实际上只是支持的驱逐方法之一。 本页介绍了Redis maxmemory指令的更一般主题，该指令用于将内存使用限制为固定数量，并且它还深入介绍了Redis使用的LRU算法，实际上是精确LRU的近似值。</p>
<p>从Redis 4.0版开始，引入了新的LFU（最不常用,Least Frequently Used）驱逐策略。 本文档的单独部分对此进行了介绍。</p>
<img src="/2018/09/03/lang/008-redis-lru-cache/001.png" class="">

<h1 id="Maxmemory配置指令"><a href="#Maxmemory配置指令" class="headerlink" title="Maxmemory配置指令"></a>Maxmemory配置指令</h1><p>maxmemory配置指令用于配置Redis为数据集使用指定数量的内存。 可以使用redis.conf文件设置配置指令，或者稍后在运行时使用CONFIG SET命令设置配置指令。</p>
<p>例如，为了配置100兆字节的内存限制，可以在redis.conf文件中使用以下指令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory 100mb</span><br></pre></td></tr></table></figure>
<p>将maxmemory设置为零会导致无内存限制。 这是64位系统的默认行为，而32位系统使用3GB的隐式内存限制。</p>
<p>达到指定的内存量时，可以在不同的行为中进行选择，称为 <strong>策略</strong>。 Redis可以只返回可能导致使用更多内存的命令的错误，或者它可以逐出旧数据以便每次添加新数据时返回到指定的限制。</p>
<h1 id="驱逐策略"><a href="#驱逐策略" class="headerlink" title="驱逐策略"></a>驱逐策略</h1><p>使用maxmemory-policy配置指令配置达到maxmemory限制时Redis遵循的确切行为。</p>
<p>可以使用以下策略：</p>
<ul>
<li>noeviction：当达到内存限制并且客户端尝试执行可能导致使用更多内存的命令时返回错误（大多数写命令，但DEL和一些例外）。</li>
<li>allkeys-lru：首先尝试删除最近使用较少的（LRU）key，以便为添加的新数据腾出空间。</li>
<li>volatile-lru：首先尝试删除最近使用较少的（LRU）key，但仅在具有过期设置的key中删除，以便为添加的新数据腾出空间。</li>
<li>allkeys-random：随机逐出key，以便为添加的新数据腾出空间。</li>
<li>volatile-random：随机逐出key以便为添加的新数据腾出空间，但只驱逐带有过期集的key。</li>
<li>volatile-ttl：用过期集驱逐key，并尝试先用较短的生存时间（TTL）驱逐key，以便为添加的新数据腾出空间。</li>
</ul>
<p>如果没有用于驱逐匹配先决条件的key，则volatile-lru，volatile-random和volatile-ttl策略的行为类似于noeviction。</p>
<p>根据应用程序的访问模式选择正确的驱逐策略很重要，但是您可以在应用程序运行时在运行时重新配置策略，并使用Redis INFO输出监视缓存未命中和命中的数量，以便调整。</p>
<p>一般来说，作为经验法则：</p>
<ul>
<li>当您期望在请求的流行度中使用幂律分布时，使用allkeys-lru策略，也就是说，您希望访问元素的子集的频率远远高于其他元素。 如果您不确定，这是一个很好的选择。</li>
<li>如果您有连续扫描所有键的循环访问，或者您希望分布均匀（所有元素可能以相同的概率访问），请使用allkeys-random。</li>
<li>如果您希望能够在创建缓存对象时通过使用不同的TTL值向Redis提供有关到期的最佳候选者的提示，请使用volatile-ttl。</li>
</ul>
<p>当您希望使用单个实例进行缓存并拥有一组持久key时，volatile-lru和volatile-random策略非常有用。 但是，运行两个Redis实例来解决此类问题通常更好。</p>
<p>还值得注意的是，为key设置过期时间也有内存成本，因此使用像allkeys-lru这样的策略可以提高内存效率，因为在内存压力下不需要为key设置过期。</p>
<h1 id="驱逐进程如何运作"><a href="#驱逐进程如何运作" class="headerlink" title="驱逐进程如何运作"></a>驱逐进程如何运作</h1><p>重要的是要理解驱逐过程的工作方式如下：</p>
<ul>
<li>客户端运行新命令，导致添加更多数据。</li>
<li>Redis检查内存使用情况，如果它大于maxmemory限制，它会根据策略驱逐key。</li>
<li>执行新命令，依此类推。</li>
</ul>
<p>因此，我们不断跨越内存限制的边界，通过检查，然后通过驱逐key返回限制之下。</p>
<p>如果命令导致使用大量内存（如大集合交集然后存储在新key中的）一段时间内，内存限制可以被明显超过。</p>
<h1 id="近似LRU算法"><a href="#近似LRU算法" class="headerlink" title="近似LRU算法"></a>近似LRU算法</h1><p>Redis LRU算法不是一个精确的实现。 这意味着Redis无法选择最佳的驱逐候选者，即过去访问次数最多的访问。 相反，它将尝试运行近似的LRU算法，通过采样少量key，并逐出采样key中最好的（具有最早的访问时间）。</p>
<p>然而，自Redis 3.0以来，该算法得到了改进，同时也为一些好的候选人提供了驱逐。 这改善了算法的性能，使其能够更接近地逼近真实LRU算法的行为。</p>
<p>Redis LRU算法的重要之处在于，您可以通过更改样本数来调整算法的精度，以检查每次驱逐。 此参数由以下配置指令控制：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-samples 5</span><br></pre></td></tr></table></figure>
<p>Redis之所以不使用真正的LRU实现，是因为它需要更多的内存。 但是，对于使用Redis的应用程序，近似值几乎相同。 以下是Redis使用的LRU近似与真实LRU的比较的图形比较。</p>
<img src="/2018/09/03/lang/008-redis-lru-cache/000.png" class="">

<p>生成上述图表的测试填充了具有给定数量键的Redis服务器。 从第一个到最后一个访问key，因此第一个key是使用LRU算法进行驱逐的最佳候选者。 后来增加了50％的key，以迫使一半的旧key被驱逐。</p>
<p>你可以在图中看到三种点，形成三个不同的带。</p>
<ul>
<li>浅灰色带是被驱逐的对象。</li>
<li>灰色带是未被驱逐的对象。</li>
<li>绿色条带是添加的对象。</li>
</ul>
<p>在理论上的LRU实现中，我们期望在旧key中，前半部分将过期。 Redis LRU算法将仅在概率上使旧key失效。</p>
<p>正如您所看到的，与Redis 2.8相比，Redis 3.0在5个样本上做得更好，但是最新访问的大多数对象仍然由Redis 2.8保留。 在Redis 3.0中使用10的样本大小，近似值非常接近Redis 3.0的理论性能。</p>
<p>请注意，LRU只是一种模型，用于预测将来访问给定key的可能性。 此外，如果您的数据访问模式与幂律非常相似，那么大多数访问将在LRU近似算法能够很好地处理的key集中。</p>
<p>在模拟中，我们发现使用幂律访问模式，真实LRU和Redis近似之间的差异很小或根本不存在。</p>
<p>但是，您可以以一些额外的CPU使用量为代价将样本大小提高到10，以便接近真实的LRU，并检查这是否会影响您的缓存未命中率。</p>
<p>要使用 <code>CONFIG SET maxmemory-samples &lt;count&gt;</code> 命令对不同的样本量值进行生产实验，非常简单。</p>
<h1 id="新的LFU模式"><a href="#新的LFU模式" class="headerlink" title="新的LFU模式"></a>新的LFU模式</h1><p>从Redis 4.0开始，可以使用新的最少使用的逐出模式。 在某些情况下，此模式可能更好（提供更好的命中&#x2F;未命中率），因为使用LFU Redis将尝试跟踪item的访问频率，以便很少使用的item被驱逐，而使用的item通常具有更高的机会留在内存中。</p>
<p>如果您在LRU中考虑，最近访问但实际上几乎从未请求的item将不会过期，因此风险是驱逐将来有更高机会被请求的key。 LFU没有这个问题，并且通常应该更好地适应不同的访问模式。</p>
<p>要配置LFU模式，可以使用以下策略：</p>
<ul>
<li>volatile-lfu在具有过期集的key中使用近似LFU来驱逐。</li>
<li>allkeys-lfu使用近似的LFU驱逐任何key。</li>
</ul>
<p>LFU近似于LRU：它使用概率计数器，称为Morris计数器，以便仅使用每个对象的几个位来估计对象访问频率，并结合衰减周期，以便计数器随时间减少：在某些时候我们 不再需要考虑频繁访问的key，即使它们是过去的，因此算法可以适应访问模式的转变。</p>
<p>这些信息的采样与LRU的情况类似（如本文档上一节所述），以便选择驱逐候选者。</p>
<p>然而，与LRU不同，LFU具有某些可调参数：例如，如果频率项不再被访问，它的排名应该有多快？ 还可以调整Morris计数器范围，以便更好地使算法适应特定用例。</p>
<p>默认情况下，Redis 4.0配置为：</p>
<ul>
<li>使计数器饱和，大约有一百万个请求。</li>
<li>每隔一分钟腐烂柜台。</li>
</ul>
<p>这些应该是合理的值并且经过实验测试，但是用户可能想要使用这些配置设置以便选择最佳值。</p>
<p>有关如何调整这些参数的说明可以在源代码发布中的示例redis.conf文件中找到，但简单地说，它们是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lfu-log-factor 10</span><br><span class="line">lfu-decay-time 1</span><br></pre></td></tr></table></figure>
<p>衰减时间是显而易见的，它是计数器应该被衰减的分钟数，当被采样并且发现比该值更旧时。 特殊值0表示：每次扫描时总是衰减计数器，并且很少有用。</p>
<p>计数器对数因子改变了为了使频率计数器饱和所需的命中数，该频率计数器仅在0-255的范围内。 因子越高，需要越多的访问才能达到最大值。 根据下表，因子越低，低访问计数器的分辨率越高：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------+------------+------------+------------+------------+------------+</span><br><span class="line">| factor | 100 hits   | 1000 hits  | 100K hits  | 1M hits    | 10M hits   |</span><br><span class="line">+--------+------------+------------+------------+------------+------------+</span><br><span class="line">| 0      | 104        | 255        | 255        | 255        | 255        |</span><br><span class="line">+--------+------------+------------+------------+------------+------------+</span><br><span class="line">| 1      | 18         | 49         | 255        | 255        | 255        |</span><br><span class="line">+--------+------------+------------+------------+------------+------------+</span><br><span class="line">| 10     | 10         | 18         | 142        | 255        | 255        |</span><br><span class="line">+--------+------------+------------+------------+------------+------------+</span><br><span class="line">| 100    | 8          | 11         | 49         | 143        | 255        |</span><br><span class="line">+--------+------------+------------+------------+------------+------------+</span><br></pre></td></tr></table></figure>

<p>因此，基本上这个因素是在具有低访问权限和具有高访问权限的区分项目的较好区分项目之间的权衡。 示例redis.conf文件中提供了更多信息自我记录注释。</p>
<p>由于LFU是一项新功能，我们将非常感谢您在使用案例中与LRU相比的任何反馈。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>当Redis用作缓存时，通常可以让它在添加新数据时自动逐出旧数据。 这种行为在开发人员社区中非常有名，因为它是流行的memcached系统的默认行为。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/03/lang/008-redis-lru-cache/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/03/lang/008-redis-lru-cache/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/03/lang/008-redis-lru-cache/" data-id="cl1fw7fm500e1vkd31lca60w9" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="article-tag-list-count">12</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-lang/007-redis-mass-insertion" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/03/lang/007-redis-mass-insertion/" class="article-date">
  <time datetime="2018-09-03T01:29:01.000Z" itemprop="datePublished">2018-09-03</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/03/lang/007-redis-mass-insertion/">redis批量插入</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>有时，Redis实例需要在很短的时间内加载大量预先存在的或用户生成的数据，以便尽可能快地创建数百万个key。</p>
<p>这称为大量插入，本文档的目标是提供有关如何尽快为Redis提供数据的信息。</p>
<img src="/2018/09/03/lang/007-redis-mass-insertion/000.png" class="">

<h1 id="使用Luke协议"><a href="#使用Luke协议" class="headerlink" title="使用Luke协议"></a>使用Luke协议</h1><p>使用普通的Redis客户端进行大量插入并不是一个好主意，原因有几个：在另一个命令之后发送一个命令的天真方法很慢，因为你必须为每个命令支付往返时间。 可以使用流水线操作，但是为了大量插入许多记录，您需要在同时读取回复时编写新命令，以确保尽可能快地插入。</p>
<p>只有一小部分客户端支持非阻塞I&#x2F;O，并非所有客户端都能够以有效的方式解析回复以最大化吞吐量。 由于所有这些原因，将数据大量导入Redis的首选方法是以原始格式生成包含Redis协议的文本文件，以便调用插入所需数据所需的命令。</p>
<p>例如，如果我需要生成一个大型数据集，其中表格中有数十亿个键：&#96;keyN - &gt; ValueN’我将创建一个包含Redis协议格式的以下命令的文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SET Key0 Value0</span><br><span class="line">SET Key1 Value1</span><br><span class="line">...</span><br><span class="line">SET KeyN ValueN</span><br></pre></td></tr></table></figure>
<p>创建此文件后，剩下的操作是尽快将其提供给Redis。 在过去，执行此操作的方法是使用netcat和以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(cat data.txt; sleep 10) | nc localhost 6379 &gt; /dev/null</span><br></pre></td></tr></table></figure>
<p>但是，这不是一种非常可靠的方法来执行批量导入，因为netcat并不真正知道何时传输了所有数据并且无法检查错误。 在2.6或更高版本的Redis中，redis-cli实用程序支持一种称为管道模式的新模式，该模式是为了执行大规模插入而设计的。</p>
<p>使用管道模式运行的命令如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat data.txt | redis-cli --pipe</span><br></pre></td></tr></table></figure>
<p>这将产生类似于此的输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">All data transferred. Waiting for the last reply...</span><br><span class="line">Last reply received from server.</span><br><span class="line">errors: 0, replies: 1000000</span><br></pre></td></tr></table></figure>
<p>redis-cli实用程序还将确保仅将从Redis实例接收的错误重定向到标准输出。</p>
<h1 id="生成Redis协议"><a href="#生成Redis协议" class="headerlink" title="生成Redis协议"></a>生成Redis协议</h1><p>Redis协议生成和解析非常简单，并在此处记录。 但是，为了生成大规模插入目标的协议，您不需要了解协议的每个细节，而只需要按以下方式表示每个命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*&lt;args&gt;&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">$&lt;len&gt;&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">&lt;arg0&gt;&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">&lt;arg1&gt;&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">...</span><br><span class="line">&lt;argN&gt;&lt;cr&gt;&lt;lf&gt;</span><br></pre></td></tr></table></figure>

<p>其中 <code>&lt;cr&gt;</code> 表示“\ r”（或ASCII字符13），<code>&lt;lf&gt;</code> 表示“\ n”（或ASCII字符10）。</p>
<p>例如，命令 <code>SET key value</code> 由以下协议表示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*3&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">$3&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">SET&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">$3&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">key&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">$5&lt;cr&gt;&lt;lf&gt;</span><br><span class="line">value&lt;cr&gt;&lt;lf&gt;</span><br></pre></td></tr></table></figure>

<p>或表示为带引号的字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;*3\r\n$3\r\nSET\r\n$3\r\nkey\r\n$5\r\nvalue\r\n&quot;</span><br></pre></td></tr></table></figure>

<p>您需要为大量插入生成的文件只是由以上述方式表示的命令组成，一个接一个。</p>
<p>以下Ruby函数生成有效的协议：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gen_redis_proto</span>(<span class="params">*cmd</span>)</span><br><span class="line">    proto = <span class="string">&quot;&quot;</span></span><br><span class="line">    proto &lt;&lt; <span class="string">&quot;*&quot;</span>+cmd.length.to_s+<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    cmd.each&#123;|<span class="params">arg</span>|</span><br><span class="line">        proto &lt;&lt; <span class="string">&quot;$&quot;</span>+arg.to_s.bytesize.to_s+<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">        proto &lt;&lt; arg.to_s+<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    proto</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">puts gen_redis_proto(<span class="string">&quot;SET&quot;</span>,<span class="string">&quot;mykey&quot;</span>,<span class="string">&quot;Hello World!&quot;</span>).inspect</span><br></pre></td></tr></table></figure>
<p>使用上述函数，可以使用以下程序轻松生成上例中的键值对：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(0...1000).each&#123;|n|</span><br><span class="line">    STDOUT.write(gen_redis_proto(&quot;SET&quot;,&quot;Key#&#123;n&#125;&quot;,&quot;Value#&#123;n&#125;&quot;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以直接在管道中运行程序到redis-cli，以便执行我们的第一次批量导入会话。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ruby proto.rb | redis-cli --pipe</span><br><span class="line">All data transferred. Waiting for the last reply...</span><br><span class="line">Last reply received from server.</span><br><span class="line">errors: 0, replies: 1000</span><br></pre></td></tr></table></figure>
<h1 id="管道模式如何工作"><a href="#管道模式如何工作" class="headerlink" title="管道模式如何工作"></a>管道模式如何工作</h1><p>在redis-cli的管道模式中需要的魔法是和netcat一样快，并且仍然能够理解服务器同时发送最后一个回复的时间。</p>
<p>这是通过以下方式获得的：</p>
<ul>
<li>redis-cli –pipe尝试尽可能快地向服务器发送数据。</li>
<li>同时，它在可用时读取数据，尝试解析它。</li>
<li>一旦没有更多数据要从stdin读取，它就会发送一个带有随机20字节字符串的特殊ECHO命令：我们确定这是发送的最新命令，如果收到相同的20字节作为批量回复，我们确信我们可以匹配回复检查。</li>
<li>一旦发送了这个特殊的最终命令，接收回复的代码就会开始匹配这20个字节的回复。 当达到匹配的回复时，它可以成功退出。</li>
</ul>
<p>使用这个技巧,为了了解我们发送的命令数量，我们不需要解析我们发送给服务器的协议，只是回复即可。</p>
<p>但是，在解析回复时，我们会对所有已解析的回复进行计数，以便最后我们能够告诉用户大量插入会话传输到服务器的命令数量。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>有时，Redis实例需要在很短的时间内加载大量预先存在的或用户生成的数据，以便尽可能快地创建数百万个key。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/03/lang/007-redis-mass-insertion/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/03/lang/007-redis-mass-insertion/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/03/lang/007-redis-mass-insertion/" data-id="cl1fw7fm500dyvkd3czea6n0h" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="article-tag-list-count">12</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-lang/006-redis-transaction" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/03/lang/006-redis-transaction/" class="article-date">
  <time datetime="2018-09-03T00:07:48.000Z" itemprop="datePublished">2018-09-03</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/03/lang/006-redis-transaction/">redis事务</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>MULTI，EXEC，DISCARD和WATCH是Redis交易的基础。它们允许在一个步骤中执行一组命令，具有两个重要保证：</p>
<ul>
<li><p>事务中的所有命令都被序列化并按顺序执行。在执行Redis事务的过程中，不会发生由另一个客户端发出的请求。这可以保证命令作为单个隔离操作执行。</p>
</li>
<li><p>要么处理所有命令，要么都不处理，因此Redis事务也是原子的。 EXEC命令触发事务中所有命令的执行，因此如果客户端在调用MULTI命令之前在事务上下文中丢失了与服务器的连接，则不执行任何操作，而如果调用EXEC命令，则执行所有操作。使用 仅追加文件 时，Redis确保使用单个write（2）系统调用在磁盘上写入事务。但是，如果Redis服务器以某种困难的方式崩溃或被系统管理员杀死，则可能只注册了部分操作。 Redis将在重新启动时检测到此情况，并将退出并显示错误。使用redis-check-aof工具可以修复仅删除部分事务的append only文件，以便服务器可以重新启动。</p>
</li>
</ul>
<p>从版本2.2开始，Redis允许对上述两者进行额外保证，其形式为 <strong>乐观锁定</strong>，其方式与check and set（CAS）操作非常相似。这将在本页后面介绍。</p>
<img src="/2018/09/03/lang/006-redis-transaction/000.png" class="">

<h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><p>使用MULTI命令输入Redis事务。 该命令总是回复OK。 此时，用户可以发出多个命令。 Redis不会执行这些命令，而是将它们排队。 调用EXEC后执行所有命令。</p>
<p>而调用DISCARD将刷新事务队列并退出事务。</p>
<p>以下示例以原子方式递增键foo和bar。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">&gt; INCR foo</span><br><span class="line">QUEUED</span><br><span class="line">&gt; INCR bar</span><br><span class="line">QUEUED</span><br><span class="line">&gt; EXEC</span><br><span class="line">1) (integer) 1</span><br><span class="line">2) (integer) 1</span><br></pre></td></tr></table></figure>
<p>从上面的会话中可以看出，EXEC返回一个回复数组，其中每个元素都是事务中单个命令的回复，其顺序与发出命令的顺序相同。</p>
<p>当Redis连接在MULTI请求的上下文中时，所有命令都将使用字符串QUEUED进行回复（从Redis协议的角度发送为状态回复）。 排队命令只是在调用EXEC时被调度执行。</p>
<h1 id="事务中的错误"><a href="#事务中的错误" class="headerlink" title="事务中的错误"></a>事务中的错误</h1><p>在事务期间，可能会遇到两种命令错误：</p>
<ol>
<li>命令可能无法排队，因此在调用EXEC之前可能会出错。 例如，命令可能在语法错误（错误的参数数量，错误的命令名称，……），或者可能存在一些关键条件，如内存不足情况（如果服务器配置为使用maxmemory具有内存限制） 指示）。</li>
<li>调用EXEC后命令可能会失败，例如，因为我们对具有错误值的键执行了操作（比如对字符串值调用列表操作）。</li>
</ol>
<p>客户端通过检查排队命令的返回值来感知在EXEC调用之前发生的第一类错误：<strong>如果命令回复QUEUED，则它正确排队</strong>，否则Redis会返回错误。 如果在排队命令时出错，大多数客户端将中止丢弃该事务的事务。</p>
<p>但是从Redis 2.6.5开始，服务器会记住在命令累积期间出错，并且拒绝执行事务，在EXEC期间返回错误，并自动丢弃事务。</p>
<p>在Redis 2.6.5之前，行为是仅使用成功排队的命令子集来执行事务，以防客户端调用EXEC而不管以前的错误。 新行为使得使用流水线操作混合事务变得更加简单，因此可以立即发送整个事务，稍后立即读取所有回复。</p>
<p>EXEC之后发生的错误不是以特殊方式处理的：即使某些命令在事务期间失败，所有其他命令也将被执行。</p>
<p>在协议级别上更清楚。 在以下示例中，即使语法正确，执行时一个命令也会失败：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to localhost.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">MULTI</span><br><span class="line">+OK</span><br><span class="line">SET a 3</span><br><span class="line">abc</span><br><span class="line">+QUEUED</span><br><span class="line">LPOP a</span><br><span class="line">+QUEUED</span><br><span class="line">EXEC</span><br><span class="line">*2</span><br><span class="line">+OK</span><br><span class="line">-ERR Operation against a key holding the wrong kind of value</span><br></pre></td></tr></table></figure>
<p>EXEC返回两元素批量字符串回复，其中一个是OK代码，另一个是-ERR回复。 由客户端库来查找向用户提供错误的合理方法。</p>
<p>重要的是要注意，<strong>即使命令失败，队列中的所有其他命令也会被处理</strong> - Redis不会停止处理命令。</p>
<p>再一次使用telnet的有线协议的另一个例子显示了ASAP如何报告语法错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MULTI</span><br><span class="line">+OK</span><br><span class="line">INCR a b c</span><br><span class="line">-ERR wrong number of arguments for &#x27;incr&#x27; command</span><br></pre></td></tr></table></figure>
<p>这次由于语法错误，错误的INCR命令根本没有排队。</p>
<h1 id="为什么Redis不支持回滚？"><a href="#为什么Redis不支持回滚？" class="headerlink" title="为什么Redis不支持回滚？"></a>为什么Redis不支持回滚？</h1><p>如果您有关系数据库背景，Redis命令在事务期间可能会失败，但仍然Redis将执行事务的其余部分而不是回滚，这可能看起来很奇怪。</p>
<p>但是对于这种行为有很好的意见：</p>
<ul>
<li>只有在使用错误的语法调用时才会失败Redis命令（并且在命令排队期间无法检测到问题），或者对于持有错误数据类型的键，Redis命令可能会失败：这意味着实际上失败的命令是编程错误的结果， 以及在开发过程中很可能检测到的一种错误，而不是在生产中。</li>
<li>Redis内部简化且速度更快，因为它不需要回滚的能力。</li>
</ul>
<p>反对Redis观点的论点是错误发生，但应该注意的是，通常回滚不会使您免于编程错误。 例如，如果查询将键增加2而不是1，或者增加错误的键，则回滚机制无法提供帮助。 鉴于没有人可以将程序员从他或她的错误中解救出来，并且Redis命令失败所需的错误类型不太可能进入生产阶段，我们选择了更简单，更快速的方法，即不支持错误回滚。</p>
<h1 id="丢弃命令队列"><a href="#丢弃命令队列" class="headerlink" title="丢弃命令队列"></a>丢弃命令队列</h1><p>DISCARD可用于中止交易。 在这种情况下，不执行任何命令，并且连接状态恢复正常。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; SET foo 1</span><br><span class="line">OK</span><br><span class="line">&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">&gt; INCR foo</span><br><span class="line">QUEUED</span><br><span class="line">&gt; DISCARD</span><br><span class="line">OK</span><br><span class="line">&gt; GET foo</span><br><span class="line">&quot;1&quot;</span><br></pre></td></tr></table></figure>
<h1 id="使用CAS乐观锁"><a href="#使用CAS乐观锁" class="headerlink" title="使用CAS乐观锁"></a>使用CAS乐观锁</h1><p>WATCH用于为Redis事务提供检查和设置（CAS）行为。</p>
<p>监视WATCHed键 以检测对它们的更改。 如果在EXEC命令之前修改了至少一个监视key，则整个事务将中止，并且EXEC返回Null应答以通知该事务失败。</p>
<p>例如，假设我们需要将键的值原子递增1（假设Redis没有INCR）。</p>
<p>第一次尝试可能如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val = GET mykey</span><br><span class="line">val = val + 1</span><br><span class="line">SET mykey $val</span><br></pre></td></tr></table></figure>
<p>只有当我们有一个客户在给定时间内执行操作时，这才能可靠地工作。 如果多个客户端几乎在同一时间尝试递增key，则会出现竞争条件。 例如，客户端A和B将读取旧值，例如，10。两个客户端的值将增加到11，最后SET key的值。 所以最终值将是11而不是12。</p>
<p>感谢WATCH，我们能够非常好地模拟问题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WATCH mykey</span><br><span class="line">val = GET mykey</span><br><span class="line">val = val + 1</span><br><span class="line">MULTI</span><br><span class="line">SET mykey $val</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure>
<p>使用上面的代码，如果存在竞争条件而另一个客户端在我们调用WATCH和调用EXEC之间的时间内修改了val的结果，则事务将失败。</p>
<p>我们只需重复操作，希望这次我们不会再遇到新的竞争。 这种形式的锁称为乐观锁，是一种非常强大的锁形式。 在许多用例中，多个客户端将访问不同的key，因此不太可能发生冲突 - 通常不需要重复操作。</p>
<h1 id="WATCH解释"><a href="#WATCH解释" class="headerlink" title="WATCH解释"></a>WATCH解释</h1><p>那么WATCH究竟是什么呢？ 这是一个使EXEC成为条件的命令：只有在没有修改任何WATCHed键时，我们才会要求Redis执行事务,（但是它们可能会被交易中的同一客户更改而不会中止）否则交易根本不会输入。 （请注意，如果你观察一个易失性key并且Redis在你看完key后使key到期，那么EXEC仍然有用）。</p>
<p>可以多次调用WATCH。 简单地说，所有WATCH呼叫都会有效监视从呼叫开始的更改，直到调用EXEC。 您还可以向单个WATCH呼叫发送任意数量的key。</p>
<p>调用EXEC时，无论事务是否中止，所有键都是UNWATCHed。 此外，当客户端连接关闭时，所有内容都会被UNWATCHed。</p>
<p>也可以使用UNWATCH命令（不带参数）来刷新 <strong>所有</strong> 被监视的键。 有时这很有用，因为我们乐观地锁定了几个键，因为我们可能需要执行一个事务来改变这些键，但是在读完键的当前内容后我们不想继续。 当发生这种情况时，我们只需调用UNWATCH，以便连接可以自由地用于新事务。</p>
<h2 id="使用WATCH实现ZPOP"><a href="#使用WATCH实现ZPOP" class="headerlink" title="使用WATCH实现ZPOP"></a>使用WATCH实现ZPOP</h2><p>一个很好的例子来说明如何使用WATCH创建新的原子操作，因为Redis不支持ZPOP，这个操作以原子方式从排序集（sorted set）中弹出具有较低分数的元素。 这是最简单的实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WATCH zset</span><br><span class="line">element = ZRANGE zset 0 0</span><br><span class="line">MULTI</span><br><span class="line">ZREM zset element</span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure>
<p>如果EXEC失败（即返回Null回复），我们只需重复操作。</p>
<h1 id="Redis脚本和事务"><a href="#Redis脚本和事务" class="headerlink" title="Redis脚本和事务"></a>Redis脚本和事务</h1><p>根据定义，Redis脚本是事务性的，因此您可以使用Redis事务执行所有操作，也可以使用脚本执行操作，通常脚本更简单，更快速。</p>
<p>这种重复是因为在Redis 2.6中引入了脚本，而事务早就存在了。 但是，我们不太可能在短时间内删除对事务的支持，因为即使不使用Redis脚本，它仍然可以避免竞争条件，特别是因为Redis事务的实现复杂性很小，因此在语义上似乎是合适的。</p>
<p><strong>然而，在不久的将来，我们将看到整个用户群只是使用脚本并非不可能。 如果发生这种情况，我们可能会弃用并最终删除交易</strong>。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>MULTI，EXEC，DISCARD和WATCH是Redis交易的基础。它们允许在一个步骤中执行一组命令，具有两个重要保证：</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/03/lang/006-redis-transaction/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/03/lang/006-redis-transaction/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/03/lang/006-redis-transaction/" data-id="cl1fw7fm400dwvkd30bct0eni" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="article-tag-list-count">12</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-linux/015-vim-command" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/02/linux/015-vim-command/" class="article-date">
  <time datetime="2018-09-02T08:47:03.000Z" itemprop="datePublished">2018-09-02</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/02/linux/015-vim-command/">vim</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>以下是一些常用的vi命令</p>
<h1 id="注释多行"><a href="#注释多行" class="headerlink" title="注释多行"></a>注释多行</h1><p>可以使用替换命令 : <code>s/old/new</code>.</p>
<p>以下操作均在命令模式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">首先我们显示行号</span></span><br><span class="line">:set nu</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以<span class="comment">#号注释10到20行</span></span></span><br><span class="line">:10,20s/^/#</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">取消注释</span></span><br><span class="line">:10,20s/^#/</span><br></pre></td></tr></table></figure>


      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>以下是一些常用的vi命令</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/02/linux/015-vim-command/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/02/linux/015-vim-command/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/02/linux/015-vim-command/" data-id="cl1fw7fmj00f7vkd37gtqgxzt" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/" rel="tag">vim</a><span class="article-tag-list-count">2</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-lang/005-redis-pubsub" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/02/lang/005-redis-pubsub/" class="article-date">
  <time datetime="2018-09-02T07:26:06.000Z" itemprop="datePublished">2018-09-02</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/02/lang/005-redis-pubsub/">redis pub/sub</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>SUBSCRIBE，UNSUBSCRIBE和PUBLISH实现发布&#x2F;订阅消息传递范例，其中（引用维基百科）发件人（发布者）未被编程为将其消息发送给特定接收者（订阅者）。 相反，发布的消息被表征为信道，而不知道可能存在什么（如果有的话）订户。 订阅者表达对一个或多个频道的兴趣，并且仅接收感兴趣的消息，而不知道存在哪些（如果有的话）发布者。 发布者和订阅者的这种分离可以实现更大的可扩展性和更动态的网络拓扑。</p>
<p>例如，为了订阅频道foo和bar，客户端发出SUBSCRIBE，提供频道名称：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBSCRIBE foo bar</span><br></pre></td></tr></table></figure>
<p>其他客户端发送到这些频道的消息将由Redis推送到所有订阅的客户端。</p>
<p>订阅一个或多个频道的客户端不应发出命令，尽管它可以订阅和取消订阅其他频道。 对订阅和取消订阅操作的回复以消息的形式发送，以便客户端可以只读取连贯的消息流，其中第一个元素指示消息的类型。 订阅客户端上下文中允许的命令是SUBSCRIBE，PSUBSCRIBE，UNSUBSCRIBE，PUNSUBSCRIBE，PING和QUIT。</p>
<p>请注意，redis-cli在订阅模式下不会接受任何命令，只能使用Ctrl-C退出该模式。</p>
<h1 id="推送消息的格式"><a href="#推送消息的格式" class="headerlink" title="推送消息的格式"></a>推送消息的格式</h1><p>消息是具有三个元素的Array回复。</p>
<p>第一个元素是消息的类型：</p>
<ul>
<li><p>subscribe：表示我们成功订阅了作为回复中第二个元素的通道。 第三个参数表示我们当前订阅的频道数。</p>
</li>
<li><p>unsubscribe：表示我们成功取消订阅作为回复中第二个元素的频道。 第三个参数表示我们当前订阅的频道数。 当最后一个参数为零时，我们不再订阅任何通道，并且客户端可以发出任何类型的Redis命令，因为我们在Pub &#x2F; Sub状态之外。</p>
</li>
<li><p>message：它是由另一个客户端发出的PUBLISH命令接收的消息。 第二个元素是原始通道的名称，第三个参数是实际的消息有效负载。</p>
</li>
</ul>
<h1 id="数据库和范围"><a href="#数据库和范围" class="headerlink" title="数据库和范围"></a>数据库和范围</h1><p>Pub &#x2F; Sub与key空间无关。 它被认为不会在任何级别上干扰它，包括数据库号。</p>
<p>数据库1上的订阅者将听到db 10上的发布。</p>
<p>如果您需要某种范围，请在通道前加上环境名称（测试，登台，生产……）。</p>
<h1 id="有线协议示例"><a href="#有线协议示例" class="headerlink" title="有线协议示例"></a>有线协议示例</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SUBSCRIBE first second</span><br><span class="line">*3</span><br><span class="line">$9</span><br><span class="line">subscribe</span><br><span class="line">$5</span><br><span class="line">first</span><br><span class="line">:1</span><br><span class="line">*3</span><br><span class="line">$9</span><br><span class="line">subscribe</span><br><span class="line">$6</span><br><span class="line">second</span><br><span class="line">:2</span><br></pre></td></tr></table></figure>
<p>此时，我们从另一个客户端发出针对名为second的通道的PUBLISH操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; PUBLISH second Hello</span><br></pre></td></tr></table></figure>
<p>这是第一个客户端收到的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*3</span><br><span class="line">$7</span><br><span class="line">message</span><br><span class="line">$6</span><br><span class="line">second</span><br><span class="line">$5</span><br><span class="line">Hello</span><br></pre></td></tr></table></figure>
<p>现在，客户端使用UNSUBSCRIBE命令从所有通道取消订阅，而无需其他参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">UNSUBSCRIBE</span><br><span class="line">*3</span><br><span class="line">$11</span><br><span class="line">unsubscribe</span><br><span class="line">$6</span><br><span class="line">second</span><br><span class="line">:1</span><br><span class="line">*3</span><br><span class="line">$11</span><br><span class="line">unsubscribe</span><br><span class="line">$5</span><br><span class="line">first</span><br><span class="line">:0</span><br></pre></td></tr></table></figure>
<h1 id="模式匹配订阅"><a href="#模式匹配订阅" class="headerlink" title="模式匹配订阅"></a>模式匹配订阅</h1><p>Redis Pub &#x2F; Sub实现支持模式匹配。 客户端可以订阅glob样式模式，以便接收发送到与给定模式匹配的通道名称的所有消息。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PSUBSCRIBE news.*</span><br></pre></td></tr></table></figure>
<p>将收到发送到频道news.art.figurative，news.music.jazz等的所有消息。所有的glob样式模式都是有效的，因此支持多个通配符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUNSUBSCRIBE news.*</span><br></pre></td></tr></table></figure>
<p>然后将取消订阅该模式的客户端。 此连接不会影响其他订阅。</p>
<p>由于模式匹配而收到的消息以不同的格式发送：</p>
<ul>
<li>消息的类型是pmessage：它是由另一个客户端发出的PUBLISH命令接收的消息，匹配模式匹配订阅。 第二个元素是匹配的原始模式，第三个元素是原始通道的名称，最后一个元素是实际的消息有效负载。</li>
</ul>
<p>与SUBSCRIBE和UNSUBSCRIBE类似，系统通过使用与订阅和取消订阅消息格式相同的格式发送类型为psubscribe和punsubscribe的消息来确认PSUBSCRIBE和PUNSUBSCRIBE命令。</p>
<h1 id="匹配模式和频道订阅的消息"><a href="#匹配模式和频道订阅的消息" class="headerlink" title="匹配模式和频道订阅的消息"></a>匹配模式和频道订阅的消息</h1><p>如果客户端订阅了与已发布消息匹配的多个模式，或者如果订阅了与该消息匹配的模式和信道，则客户端可以多次接收单个消息。 如下例所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SUBSCRIBE foo</span><br><span class="line">PSUBSCRIBE f*</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，如果将消息发送到通道foo，则客户端将收到两条消息：一个是message消息，一个是pmessage。</p>
<h1 id="带模式匹配的订阅计数的含义"><a href="#带模式匹配的订阅计数的含义" class="headerlink" title="带模式匹配的订阅计数的含义"></a>带模式匹配的订阅计数的含义</h1><p>在订阅，取消订阅，psubscribe和punsubscribe消息类型中，最后一个参数是仍处于活动状态的订阅计数。 <strong>此数字实际上是客户端仍订阅的通道和模式的总数</strong>。 因此，只有当此计数从所有通道和模式取消订阅后降至零时，客户端才会退出发布&#x2F;订阅状态。</p>
<h1 id="编程示例"><a href="#编程示例" class="headerlink" title="编程示例"></a>编程示例</h1><p>Pieter Noordhuis使用EventMachine和Redis提供了一个很好的例子来创建一个多用户高性能的Web聊天。<br><a target="_blank" rel="noopener" href="https://gist.github.com/pietern/348262">code</a></p>
<h1 id="客户端库实现提示"><a href="#客户端库实现提示" class="headerlink" title="客户端库实现提示"></a>客户端库实现提示</h1><p>因为收到的所有消息都包含导致消息传递的原始订阅（message类型为通道，而pmessage类型为原始模式）客户端库可能会将原始订阅绑定到回调（可以是匿名函数， 块，函数指针），使用哈希表。</p>
<p>当收到消息时，可以进行O（1）查找，以便将消息传递给已注册的回调。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>SUBSCRIBE，UNSUBSCRIBE和PUBLISH实现发布&#x2F;订阅消息传递范例，其中（引用维基百科）发件人（发布者）未被编程为将其消息发送给特定接收者（订阅者）。 相反，发布的消息被表征为信道，而不知道可能存在什么（如果有的话）订户。 订阅者表达对一个或多个频道的兴趣，并且仅接收感兴趣的消息，而不知道存在哪些（如果有的话）发布者。 发布者和订阅者的这种分离可以实现更大的可扩展性和更动态的网络拓扑。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/02/lang/005-redis-pubsub/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/02/lang/005-redis-pubsub/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/02/lang/005-redis-pubsub/" data-id="cl1fw7fm300dtvkd3e9dag0rh" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="article-tag-list-count">12</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-lang/004-redis-pipelining" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/01/lang/004-redis-pipelining/" class="article-date">
  <time datetime="2018-09-01T15:08:56.000Z" itemprop="datePublished">2018-09-01</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/01/lang/004-redis-pipelining/">redis pipelining</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>使用pipelining技术加速Redis查询</p>
<h1 id="请求-x2F-响应协议和RTT"><a href="#请求-x2F-响应协议和RTT" class="headerlink" title="请求&#x2F;响应协议和RTT"></a>请求&#x2F;响应协议和RTT</h1><p>Redis是一个使用 客户端-服务器 模型的TCP服务器，也就是所谓的请求&#x2F;响应协议。</p>
<p>这意味着通常通过以下步骤完成请求：</p>
<ul>
<li>客户端向服务器发送查询，并通常以阻塞方式从套接字读取服务器响应。</li>
<li>服务器处理该命令并将响应发送回客户端。</li>
</ul>
<p>因此，例如，四个命令序列是这样的：</p>
<ul>
<li>客户端：INCR X.</li>
<li>服务器：1</li>
<li>客户端：INCR X.</li>
<li>服务器：2</li>
<li>客户端：INCR X.</li>
<li>服务器：3</li>
<li>客户端：INCR X.</li>
<li>服务器：4</li>
</ul>
<p>客户端端和服务器通过网络链接连接。这样的链接可以非常快（环回接口）或非常慢（在因特网上建立的连接，在两个主机之间有许多跳）。无论网络延迟是什么，数据包都有一段时间从客户端传输到服务器，然后从服务器返回到客户端以进行回复。</p>
<p>此时间称为RTT（往返时间,round trip time）。当客户端需要连续执行许多请求时（例如，将多个元素添加到同一列表或使用许多键填充数据库），很容易看出这会如何影响性能。例如，如果RTT时间是250毫秒（在因特网上的链路非常慢的情况下），即使服务器能够每秒处理100k个请求，我们也只能够以每秒最多四个请求进行处理。</p>
<p>如果使用的接口是环回接口，则RTT要短得多（例如我的主机报告为0.044毫秒，ping 127.0.0.1），但如果你需要连续执行多次写入，它仍然很多。</p>
<p>幸运的是，有一种方法可以改进这个用例。</p>
<h1 id="Redis-Pipelining"><a href="#Redis-Pipelining" class="headerlink" title="Redis Pipelining"></a>Redis Pipelining</h1><p>可以实现请求&#x2F;响应服务器，以便即使客户端尚未读取旧响应，它也能够处理新请求。 这样就可以在不等待回复的情况下向服务器发送多个命令，最后只需一步即可读取回复。</p>
<p>这被称为流水线技术，并且是几十年来广泛使用的技术。 例如，许多POP3协议实现已经支持此功能，大大加快了从服务器下载新电子邮件的过程。</p>
<p>Redis从很早就开始支持流水线操作，因此无论您运行什么版本，都可以使用Redis进行流水线操作。 这是使用原始netcat实用程序的示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ (printf &quot;PING\r\nPING\r\nPING\r\n&quot;; sleep 1) | nc localhost 6379</span><br><span class="line">+PONG</span><br><span class="line">+PONG</span><br><span class="line">+PONG</span><br></pre></td></tr></table></figure>
<p>这次我们不是为每次连接都支付RTT开销，而是为这三个命令只支付一次。</p>
<p>为了非常明确，使用流水线操作我们的第一个示例的操作顺序如下：</p>
<ul>
<li>客户端：INCR X.</li>
<li>客户端：INCR X.</li>
<li>客户端：INCR X.</li>
<li>客户端：INCR X.</li>
<li>服务器：1</li>
<li>服务器：2</li>
<li>服务器：3</li>
<li>服务器：4</li>
</ul>
<p>重要说明：当客户端使用流水线发送命令时，服务器将被强制使用内存对回复进行排队。 因此，如果您需要使用流水线发送大量命令，最好将它们作为具有合理数量的批次发送，例如10k命令，读取回复，然后再次发送另外10k命令，依此类推。 速度几乎相同，但使用的额外内存将最多为排队10k命令的回复所需的数量。</p>
<h1 id="这不仅仅是RTT的问题"><a href="#这不仅仅是RTT的问题" class="headerlink" title="这不仅仅是RTT的问题"></a>这不仅仅是RTT的问题</h1><p>流水线技术不仅仅是为了减少由于往返时间而导致的延迟成本的一种方式，它实际上大大提高了您在给定Redis服务器中每秒可执行的总操作量。 这是因为，在不使用流水线技术的情况下，从访问数据结构和产生回复的角度来看，为每个命令提供服务是非常便宜的，但是从执行套接字I&#x2F;O的角度来看，这是非常昂贵的。 这涉及调用read（）和write（）系统调用，这意味着从用户域到内核域。 上下文切换是一个巨大的速度惩罚。</p>
<p>使用流水线操作时，通常使用单个read（）系统调用读取许多命令，并使用单个write（）系统调用传递多个回复。 因此，每秒执行的总查询数最初会随着较长的管道线性增加而增加，最终达到不使用流水线技术获得的基线的10倍，如下图所示：</p>
<img src="/2018/09/01/lang/004-redis-pipelining/000.png" class="">

<h1 id="一些现实世界的代码示例"><a href="#一些现实世界的代码示例" class="headerlink" title="一些现实世界的代码示例"></a>一些现实世界的代码示例</h1><p>在下面的基准测试中，我们将使用支持流水线操作的Redis Ruby客户端来测试由于流水线操作而导致的速度提升：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;rubygems&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;redis&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bench</span>(<span class="params">descr</span>)</span><br><span class="line">    start = Time.now</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;descr&#125;</span> <span class="subst">#&#123;Time.now-start&#125;</span> seconds&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">without_pipelining</span></span><br><span class="line">    r = Redis.new</span><br><span class="line">    <span class="number">10000</span>.times &#123;</span><br><span class="line">        r.ping</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">with_pipelining</span></span><br><span class="line">    r = Redis.new</span><br><span class="line">    r.pipelined &#123;</span><br><span class="line">        <span class="number">10000</span>.times &#123;</span><br><span class="line">            r.ping</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">bench(<span class="string">&quot;without pipelining&quot;</span>) &#123;</span><br><span class="line">    without_pipelining</span><br><span class="line">&#125;</span><br><span class="line">bench(<span class="string">&quot;with pipelining&quot;</span>) &#123;</span><br><span class="line">    with_pipelining</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上面的简单脚本将在我的Mac OS X系统中提供以下数字，运行在环回接口上，其中流水线将提供最小的改进，因为RTT已经非常低：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">without pipelining 1.185238 seconds</span><br><span class="line">with pipelining 0.250783 seconds</span><br></pre></td></tr></table></figure>
<p>如您所见，使用流水线技术，我们将传输速度提高了五倍。</p>
<h1 id="流水线VS脚本"><a href="#流水线VS脚本" class="headerlink" title="流水线VS脚本"></a>流水线VS脚本</h1><p>使用Redis脚本（在Redis 2.6或更高版本中可用），可以使用执行服务器端所需的大量工作的脚本更有效地解决流水线操作的大量用例。 脚本编写的一大优点是它能够以最小的延迟读取和写入数据，使读取，计算，写入等操作非常快（流水线在这种情况下无法帮助，因为客户端在调用write命令之前需要回复read命令）。</p>
<p>有时，应用程序可能还希望在管道中发送EVAL或EVALSHA命令。 这是完全可能的，Redis使用SCRIPT LOAD命令显式支持它（它保证可以调用EVALSHA而不会出现失败的风险）。</p>
<h1 id="附录：为什么即使在环回接口上，繁忙的循环也很慢？"><a href="#附录：为什么即使在环回接口上，繁忙的循环也很慢？" class="headerlink" title="附录：为什么即使在环回接口上，繁忙的循环也很慢？"></a>附录：为什么即使在环回接口上，繁忙的循环也很慢？</h1><p>即使有了本页所涉及的所有背景，你仍然可能想知道为什么Redis基准测试如下（伪代码），即使在loopback接口中执行，当服务器和客户端在同一台物理机器上运行时也很慢：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FOR-ONE-SECOND:</span><br><span class="line">    Redis.SET(&quot;foo&quot;,&quot;bar&quot;)</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<p>毕竟，如果Redis进程和基准测试都在同一个box中运行，那么这难道不是通过内存从一个地方复制到另一个地方而没有任何实际延迟和实际网络的消息吗？</p>
<p>原因是系统中的进程并不总是在运行，实际上是内核调度程序让进程运行，所以会发生的情况是，例如，允许运行基准测试，从Redis服务器读取回复（相关）执行的最后一个命令），并写入一个新命令。该命令现在位于loopback接口缓冲区中，但是为了由服务器读取，内核应该调度服务器进程（当前在系统调用中被阻止）以运行，等等。因此，实际上，由于内核调度程序的工作原理，环回接口仍然涉及类似网络的延迟。</p>
<p>基本上，繁忙的循环基准测试是在网络服务器中测量性能时可以做的 <strong>最愚蠢</strong> 的事情。明智之举就是以这种方式避免基准测试。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><a target="_blank" rel="noopener" href="https://redis.io/topics/pipelining">https://redis.io/topics/pipelining</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>使用pipelining技术加速Redis查询</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/09/01/lang/004-redis-pipelining/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/09/01/lang/004-redis-pipelining/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/09/01/lang/004-redis-pipelining/" data-id="cl1fw7fm200dpvkd3flqz8e98" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="article-tag-list-count">12</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-lang/003-redis-datatype" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/31/lang/003-redis-datatype/" class="article-date">
  <time datetime="2018-08-31T06:10:00.000Z" itemprop="datePublished">2018-08-31</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/31/lang/003-redis-datatype/">redis数据类型</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>Redis不是普通的键值存储，它实际上是一个数据结构服务器，支持不同类型的值。 这意味着，在传统的键值存储中，您将字符串键与字符串值相关联，在Redis中，值不仅限于简单的字符串，还可以包含更复杂的数据结构。 以下是Redis支持的所有数据结构的列表，本教程将单独介绍它们：</p>
<ul>
<li>安全的二进制字符串。</li>
<li>列表：根据插入顺序排序的字符串元素的集合。它们基本上是链表。</li>
<li>集合：唯一的未排序字符串元素的集合。</li>
<li>排序集(sorted set)，类似于集，但每个字符串元素与浮点数值相关联，称为分数。元素总是按其分数排序，因此与集合不同，可以检索一系列元素（例如，您可能会问：给我前10个，或者下10个）。</li>
<li>散列，是由与值相关联的字段组成的映射。字段和值都是字符串。这与Ruby或Python哈希非常相似。</li>
<li>位数组（或简称位图）：可以使用特殊命令处理字符串值，如位数组：您可以设置和清除各个位，将所有位设置为1，查找第一组或未设置位，等等。</li>
<li>HyperLogLogs：这是一个概率数据结构，用于估计集合的基数。不要害怕，它比看起来更简单…请参阅本教程的HyperLogLog部分。</li>
</ul>
<h1 id="Redis-Keys"><a href="#Redis-Keys" class="headerlink" title="Redis Keys"></a>Redis Keys</h1><p>Redis键是二进制安全的，这意味着您可以使用任何二进制序列作为键，从“foo”这样的字符串到JPEG文件的内容。空字符串也是有效键。</p>
<p>关于键的一些其他规则：</p>
<ul>
<li>很长的Key不是一个好主意。例如，1024字节的key不仅是内存方面的坏主意，而且因为在数据集中查找key可能需要几次昂贵的key比较。即使当前的任务是匹配大值的存在，hash它（例如使用SHA1）也是一个更好的主意，特别是从内存和带宽的角度来看。</li>
<li>非常短的键往往不是一个好主意。如果您可以改写“user：1000：followers”，那么将“u1000flw”写为关键字几乎没有意义。前者更易读，与key和值使用的空间相比，增加的空间较小。虽然短键显然会消耗更少的内存，但您的工作就是找到合适的平衡点。</li>
<li>尝试坚持使用架构。例如，“object-type：id”是一个好主意，如“user：1000”。点或短划线通常用于多字词字段，如“comment：1234：reply.to”或“comment：1234：reply-to”。</li>
<li>允许的最大key大小为512 MB。</li>
</ul>
<h1 id="Redis-Strings"><a href="#Redis-Strings" class="headerlink" title="Redis Strings"></a>Redis Strings</h1><p>Redis String类型是可以与Redis密钥关联的最简单的值类型。 它是Memcached中唯一的数据类型，因此对于新手来说，在Redis中使用它也是非常自然的。</p>
<p>由于Redis键是字符串，当我们使用字符串类型作为值时，我们将字符串映射到另一个字符串。 字符串数据类型对许多用例很有用，例如缓存HTML片段或页面。</p>
<p>让我们使用redis-cli对字符串类型进行一些操作（所有示例都将在本教程中通过redis-cli执行）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; set mykey somevalue</span><br><span class="line">OK</span><br><span class="line">&gt; get mykey</span><br><span class="line">&quot;somevalue&quot;</span><br></pre></td></tr></table></figure>
<p>正如您所看到的，使用SET和GET命令是我们设置和检索字符串值的方式。 请注意，即使key与非字符串值相关联，SET也将替换已存在于key中的任何现有值。 所以SET执行一项赋值任务。</p>
<p>值可以是各种字符串（包括二进制数据），例如，您可以将jpeg图像存储在值中。 值不能大于512 MB。</p>
<p>SET命令有一些有趣的选项，它们作为附加参数提供。 例如，如果key已经存在，我可能会要求SET失败，或者相反(如果key存在也能成功）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; set mykey newval xx # 只有mykey存在(exist)才会成功，所以失败了</span><br><span class="line">(nil)</span><br><span class="line">&gt; set mykey newval nx # mykey不存在(not exist)也会成功，默认就是</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>即使字符串是Redis的基本值，也可以使用它们执行有趣的操作。 例如，一个是原子增量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; set counter 100</span><br><span class="line">OK</span><br><span class="line">&gt; incr counter</span><br><span class="line">(integer) 101</span><br><span class="line">&gt; incr counter</span><br><span class="line">(integer) 102</span><br><span class="line">&gt; incrby counter 50</span><br><span class="line">(integer) 152</span><br></pre></td></tr></table></figure>
<p>INCR命令将字符串值解析为整数，将其递增1，最后将获取的值设置为新值。还有其他类似的命令，如INCRBY，DECR和DECRBY。在内部，它始终是相同的命令，以稍微不同的方式运作。</p>
<p>INCR是原子的意味着什么？即使是针对相同key发布INCR的多个客户端也不会进入竞争状态。例如，客户端1读取“10”和客户端2同时读取“10”，两者都增加到11，并将新值设置为11 永远不会发生. 并且当所有其他客户端不同时执行读取命令时或执行增量设置操作，最终值将始终为12。</p>
<p>有许多用于操作字符串的命令。例如，GETSET命令将键设置为新值，并将旧值作为结果返回。例如，如果您的系统在每次网站收到新访问者时使用INCR递增Redis key，则可以使用此命令。您可能希望每小时收集一次此信息，而不会丢失一个增量。您可以GETSET键，为其指定新值“0”并返回旧值。</p>
<p>在单个命令中设置或检索多个键的值的能力对于减少延迟也是有用的。 因此，有MSET和MGET命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; mset a 10 b 20 c 30</span><br><span class="line">OK</span><br><span class="line">&gt; mget a b c</span><br><span class="line">1) &quot;10&quot;</span><br><span class="line">2) &quot;20&quot;</span><br><span class="line">3) &quot;30&quot;</span><br></pre></td></tr></table></figure>
<h1 id="修改和查询key空间"><a href="#修改和查询key空间" class="headerlink" title="修改和查询key空间"></a>修改和查询key空间</h1><p>有些命令没有在特定类型上定义，但是为了与键的空间交互很有用，因此可以与任何类型的键一起使用。</p>
<p>例如，EXISTS命令返回1或0以表示数据库中是否存在给定键，而DEL命令删除键和关联值，无论值是什么。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; set mykey hello</span><br><span class="line">OK</span><br><span class="line">&gt; exists mykey</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; del mykey</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; exists mykey</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>
<p>从示例中，您还可以看到DEL本身如何返回1或0，具体取决于key是否被删除（它是否存在）（没有具有该名称的key）。</p>
<p>有许多与key空间相关的命令，但上面两个是与TYPE命令一起必不可少的命令，它返回存储在指定键中的值的类型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; set mykey x</span><br><span class="line">OK</span><br><span class="line">&gt; type mykey</span><br><span class="line">string</span><br><span class="line">&gt; del mykey</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; type mykey</span><br><span class="line">none</span><br></pre></td></tr></table></figure>
<h1 id="Redis到期：生存时间有限的key"><a href="#Redis到期：生存时间有限的key" class="headerlink" title="Redis到期：生存时间有限的key"></a>Redis到期：生存时间有限的key</h1><p>在继续使用更复杂的数据结构之前，我们需要讨论另一个无论值类型如何都能工作的特性，并称为Redis过期。 您可以为key设置超时，这是一个有限的生存时间。 当生存时间过去时，key会自动销毁，就像用户使用key调用DEL命令一样。</p>
<p>关于Redis到期的一些快速信息：</p>
<ul>
<li>它们可以使用秒或毫秒精度进行设置。</li>
<li>但是，到期时间分辨率始终为1毫秒。</li>
<li>有关过期的信息将被复制并保留在磁盘上，当Redis服务器保持停止时，这个时间实际上会消失（这意味着Redis会在key即将过期时保存key过期的日期）。</li>
</ul>
<p>设置过期是很容易的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; set key some-value</span><br><span class="line">OK</span><br><span class="line">&gt; expire key 5</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; get key (immediately)</span><br><span class="line">&quot;some-value&quot;</span><br><span class="line">&gt; get key (after some time)</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<p>两个GET调用之间的key消失了，因为第二个调用被延迟超过5秒。 在上面的示例中，我们使用EXPIRE来设置（它也可以用来设置一个已经有一个过期时间的键的不同过期时间，就像PERSIST可以用来删除过期时间并使key永久持久化）。 但是，我们也可以使用其他Redis命令创建过期密钥。 例如，使用SET选项：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; set key 100 ex 10</span><br><span class="line">OK</span><br><span class="line">&gt; ttl key</span><br><span class="line">(integer) 9</span><br></pre></td></tr></table></figure>
<p>上面的示例设置一个字符串值为100的密钥，其过期为十秒。 稍后调用TTL命令以检查密钥的剩余生存时间。</p>
<p>要以毫秒为单位设置和检查过期，请检查PEXPIRE和PTTL命令以及SET选项的完整列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set k jimo px 5000                                                               </span><br><span class="line">OK                                                                                               </span><br><span class="line">127.0.0.1:6379&gt; ttl k                                                                            </span><br><span class="line">(integer) 1                                                                                      </span><br><span class="line">127.0.0.1:6379&gt; ttl k                                                                            </span><br><span class="line">(integer) -2     </span><br></pre></td></tr></table></figure>
<h1 id="Redis列表"><a href="#Redis列表" class="headerlink" title="Redis列表"></a>Redis列表</h1><p>为了解释List数据类型，最好从一点理论开始，因为术语List经常被信息技术人员以不正当的方式使用。例如，“Python Lists”不是名称所暗示的（Linked Lists），而是Arrays（实际上相同的数据类型在Ruby中称为Array）。</p>
<p>从非常一般的角度来看，List只是一系列有序元素：10,20,1,2,3 是一个列表。<strong>但是使用Array实现的List的属性与使用Linked List实现的List的属性非常不同</strong> 。</p>
<p>Redis列表通过 <strong>Linked List</strong> 实现。这意味着即使列表中有数百万个元素，也会在常量时间内在列表的头部或尾部添加新元素。使用LPUSH命令将新元素添加到具有十个元素的列表头部的速度与将一个元素添加到具有1000万个元素的列表头部相同。</p>
<p>有什么缺点？在使用Array（常量时间索引访问）实现的列表中，通过索引访问元素非常快，而在链接列表实现的列表中则不是那么快（其中操作需要与所访问元素的索引成比例的工作量）。</p>
<p>Redis列表是使用 <strong>链表</strong> 实现的，因为对于数据库系统而言，能够以非常快的方式将元素添加到很长的列表中是至关重要的。正如您将在片刻中看到的那样，Redis Lists可以在恒定时间内以恒定长度获取。</p>
<p>当快速访问大量元素集合的中间位置很重要时，可以使用不同的数据结构，称为排序集（sorted set）。排序集将在本教程后面介绍。</p>
<h2 id="Redis列表的第一步"><a href="#Redis列表的第一步" class="headerlink" title="Redis列表的第一步"></a>Redis列表的第一步</h2><p>LPUSH命令将新元素添加到左侧（头部）的列表中，而RPUSH命令将新元素添加到右侧（尾部）的列表中。 最后，LRANGE命令从列表中提取元素范围：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpush mylist A</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; rpush mylist B</span><br><span class="line">(integer) 2</span><br><span class="line">&gt; lpush mylist first</span><br><span class="line">(integer) 3</span><br><span class="line">&gt; lrange mylist 0 -1</span><br><span class="line">1) &quot;first&quot;</span><br><span class="line">2) &quot;A&quot;</span><br><span class="line">3) &quot;B&quot;</span><br></pre></td></tr></table></figure>
<p>请注意，LRANGE需要两个索引，即要返回的范围的第一个和最后一个元素。 两个索引都可以是负数，告诉Redis从结尾开始计数：所以-1是最后一个元素，-2是列表的倒数第二个元素，依此类推。</p>
<p>如您所见，RPUSH附加了列表右侧的元素，而最后的LPUSH附加了左侧的元素。</p>
<p>这两个命令都是可变参数命令，这意味着您可以在一次调用中将多个元素自由地推送到列表中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpush mylist 1 2 3 4 5 &quot;foo bar&quot;</span><br><span class="line">(integer) 9</span><br><span class="line">&gt; lrange mylist 0 -1</span><br><span class="line">1) &quot;first&quot;</span><br><span class="line">2) &quot;A&quot;</span><br><span class="line">3) &quot;B&quot;</span><br><span class="line">4) &quot;1&quot;</span><br><span class="line">5) &quot;2&quot;</span><br><span class="line">6) &quot;3&quot;</span><br><span class="line">7) &quot;4&quot;</span><br><span class="line">8) &quot;5&quot;</span><br><span class="line">9) &quot;foo bar&quot;</span><br></pre></td></tr></table></figure>
<p>Redis列表中定义的一个重要操作是弹出元素的能力。 Popping元素是从列表中检索元素并同时从列表中删除元素的操作。 您可以从左侧和右侧弹出元素，类似于如何在列表的两侧推送元素：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpush mylist a b c</span><br><span class="line">(integer) 3</span><br><span class="line">&gt; rpop mylist</span><br><span class="line">&quot;c&quot;</span><br><span class="line">&gt; rpop mylist</span><br><span class="line">&quot;b&quot;</span><br><span class="line">&gt; rpop mylist</span><br><span class="line">&quot;a&quot;</span><br></pre></td></tr></table></figure>
<p>我们添加了三个元素并弹出了三个元素，因此在这个命令序列的末尾，列表为空，并且没有更多元素可以弹出。 如果我们尝试弹出另一个元素，这就是我们得到的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpop mylist</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<p>Redis返回NULL值以表示列表中没有元素。</p>
<h2 id="列表的常见用例"><a href="#列表的常见用例" class="headerlink" title="列表的常见用例"></a>列表的常见用例</h2><p>列表对于许多任务很有用，两个非常有代表性的用例如下：</p>
<ul>
<li>记住用户发布到社交网络的最新更新。</li>
<li>进程之间的通信，使用生产者将item推入列表的消费者 - 生产者模式，以及消费者（通常是工人）消费这些item和执行的操作。 Redis具有特殊的列表命令，使这个用例更加可靠和高效。</li>
</ul>
<p>例如，流行的Ruby库resque和sidekiq都使用Redis列表来实现后台作业。</p>
<p>流行的Twitter社交网络将用户发布的最新推文收录到Redis列表中。</p>
<p>要逐步描述常见用例，请假设您的主页显示在照片共享社交网络中发布的最新照片，并且您希望加快访问速度。</p>
<ul>
<li>每次用户发布新照片时，我们都会将其ID添加到带有LPUSH的列表中。</li>
<li>当用户访问主页时，我们使用LRANGE 0 9来获取最新的10个帖子。</li>
</ul>
<h2 id="上限列表"><a href="#上限列表" class="headerlink" title="上限列表"></a>上限列表</h2><p>在许多用例中，我们只想使用列表来存储最新的项目，无论它们是什么：社交网络更新，日志或其他任何内容。</p>
<p>Redis允许我们使用列表作为上限集合，只记住最新的N项并使用 <strong>LTRIM</strong> 命令丢弃所有最旧的项。</p>
<p>LTRIM命令类似于LRANGE，但它不是显示指定范围的元素，而是将此范围设置为新列表值。 超出给定范围之外的所有元素。</p>
<p>一个例子将使它更清楚：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; rpush mylist 1 2 3 4 5</span><br><span class="line">(integer) 5</span><br><span class="line">&gt; ltrim mylist 0 2</span><br><span class="line">OK</span><br><span class="line">&gt; lrange mylist 0 -1</span><br><span class="line">1) &quot;1&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">3) &quot;3&quot;</span><br></pre></td></tr></table></figure>
<p>上面的LTRIM命令告诉Redis只从索引0到2中获取列表元素，其他所有内容都将被丢弃。 这允许一个非常简单但有用的模式：一起执行List推操作+ List修剪操作以添加新元素并丢弃超出限制的元素：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LPUSH mylist &lt;some element&gt;</span><br><span class="line">LTRIM mylist 0 999</span><br></pre></td></tr></table></figure>
<p>上面的组合添加了一个新元素，并且只将1000个最新元素放入列表中。 使用LRANGE，您可以访问top items，而无需记住非常旧的数据。</p>
<p><strong>注意：虽然LRANGE在技术上是一个O（N）命令，但是向列表的头部或尾部访问小范围是一个恒定时间操作</strong>。</p>
<h2 id="列表阻塞操作"><a href="#列表阻塞操作" class="headerlink" title="列表阻塞操作"></a>列表阻塞操作</h2><p>列表具有使其适合实现队列的特殊功能，并且通常作为进程间通信系统的构建块：阻塞操作。</p>
<p>想象一下，您希望使用一个流程将item推送到列表中，并使用不同的流程来实际对这些item进行某种工作。 这是通常的生产者&#x2F;消费者设置，可以通过以下简单方式实现：</p>
<ul>
<li>要将项目推入列表，生产者调用LPUSH。</li>
<li>要从列表中提取&#x2F;处理项目，消费者会调用RPOP。</li>
</ul>
<p>但是有时候列表可能是空的并且没有任何东西可以处理，所以RPOP只返回NULL。 在这种情况下，消费者被迫等待一段时间并再次使用RPOP重试。 这称为 <strong>轮询</strong> ，在这种情况下不是一个好主意，因为它有几个缺点：</p>
<ol>
<li>强制Redis和客户端处理无用命令（当列表为空时所有请求都不会完成实际工作，它们只会返回NULL）。</li>
<li>为item处理添加延迟，因为在工作程序收到NULL之后，它会等待一段时间。 为了使延迟更小，我们可以在对RPOP的呼叫之间等待更少，从而放大问题1的效果，即对Redis的无用呼叫。</li>
</ol>
<p>所以Redis实现了名为BRPOP和BLPOP的命令，它们是RPOP和LPOP的版本，如果列表为空则能够阻塞：只有当新元素添加到列表中时，或者当用户指定的超时时，它们才会返回调用者。</p>
<p>这是我们可以在worker中使用的BRPOP调用的示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; brpop tasks 5</span><br><span class="line">1) &quot;tasks&quot;</span><br><span class="line">2) &quot;do_something&quot;</span><br></pre></td></tr></table></figure>
<p>这意味着：“等待列表任务中的元素，但是如果5秒后没有元素可用则返回”。</p>
<p>请注意，您可以使用0作为超时来永久等待元素，并且您还可以指定多个列表而不仅仅是一个，以便同时在多个列表上等待，并在第一个列表收到元素时收到通知。</p>
<p>关于BRPOP的一些注意事项：</p>
<ol>
<li>客户端以有序的方式等待服务：阻塞列表的第一个客户端首先获得服务，以此类推。</li>
<li>与RPOP相比，返回值是不同的：它是一个双元素数组，它还包含键的名称，因为BRPOP和BLPOP能够阻止等待来自多个列表的元素。</li>
<li>如果达到超时，则返回NULL。</li>
</ol>
<p>关于列表和阻止操作，您应该了解更多内容。 我们建议您阅读以下内容：</p>
<ul>
<li>可以使用RPOPLPUSH构建更安全的队列或轮换队列。</li>
<li>还有一个阻塞命令的变体，称为BRPOPLPUSH。</li>
</ul>
<p><em><strong>brpop: block rpop</strong></em></p>
<h1 id="自动创建和删除key"><a href="#自动创建和删除key" class="headerlink" title="自动创建和删除key"></a>自动创建和删除key</h1><p>到目前为止，在我们的示例中，我们从不必在推送元素之前创建空列表，或者在内部不再包含元素时删除空列表。 Redis负责在列表为空时删除键，或者如果键不存在并且我们尝试向其添加元素，例如，使用LPUSH则创建空列表。</p>
<p>这不是特定于列表，它适用于由多个元素组成的所有Redis数据类型 - 集合，排序集和散列。</p>
<p>基本上我们可以用三个规则来概括行为：</p>
<ol>
<li>当我们向聚合数据类型添加元素时，如果目标键不存在，则在添加元素之前会创建空聚合数据类型。</li>
<li>当我们从聚合数据类型中删除元素时，如果值保持为空，则会自动销毁该键。</li>
<li>使用空键调用LLEN（返回列表长度）等只读命令或删除元素的写命令总是产生相同的结果，就好像键持有类型的空聚合类型一样 命令期望找到。</li>
</ol>
<p>规则1的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; del mylist</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; lpush mylist 1 2 3</span><br><span class="line">(integer) 3</span><br></pre></td></tr></table></figure>
<p>但是，如果key存在，我们无法对错误的类型执行操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; set foo bar</span><br><span class="line">OK</span><br><span class="line">&gt; lpush foo 1 2 3</span><br><span class="line">(error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br><span class="line">&gt; type foo</span><br><span class="line">string</span><br></pre></td></tr></table></figure>
<p>规则2的示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; lpush mylist 1 2 3</span><br><span class="line">(integer) 3</span><br><span class="line">&gt; exists mylist</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; lpop mylist</span><br><span class="line">&quot;3&quot;</span><br><span class="line">&gt; lpop mylist</span><br><span class="line">&quot;2&quot;</span><br><span class="line">&gt; lpop mylist</span><br><span class="line">&quot;1&quot;</span><br><span class="line">&gt; exists mylist</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>
<p>弹出所有元素后，键不再存在。</p>
<p>规则3的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; del mylist</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; llen mylist</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; lpop mylist</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<h1 id="Redis-Hashes"><a href="#Redis-Hashes" class="headerlink" title="Redis Hashes"></a>Redis Hashes</h1><p>Redis哈希看起来正是人们可能期望使用字段值对来查看“哈希”：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; hmset user:1000 username antirez birthyear 1977 verified 1</span><br><span class="line">OK</span><br><span class="line">&gt; hget user:1000 username</span><br><span class="line">&quot;antirez&quot;</span><br><span class="line">&gt; hget user:1000 birthyear</span><br><span class="line">&quot;1977&quot;</span><br><span class="line">&gt; hgetall user:1000</span><br><span class="line">1) &quot;username&quot;</span><br><span class="line">2) &quot;antirez&quot;</span><br><span class="line">3) &quot;birthyear&quot;</span><br><span class="line">4) &quot;1977&quot;</span><br><span class="line">5) &quot;verified&quot;</span><br><span class="line">6) &quot;1&quot;</span><br></pre></td></tr></table></figure>
<p>虽然散列很方便表示对象，但实际上可以放入散列中的字段数没有实际限制（除了可用内存），因此您可以在应用程序中以多种不同方式使用散列。</p>
<p>命令HMSET设置哈希的多个字段，而HGET检索单个字段。 HMGET类似于HGET，但返回一组值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; hmget user:1000 username birthyear no-such-field</span><br><span class="line">1) &quot;antirez&quot;</span><br><span class="line">2) &quot;1977&quot;</span><br><span class="line">3) (nil)</span><br></pre></td></tr></table></figure>
<p>还有一些命令能够对各个字段执行操作，例如HINCRBY：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; hincrby user:1000 birthyear 10</span><br><span class="line">(integer) 1987</span><br><span class="line">&gt; hincrby user:1000 birthyear 10</span><br><span class="line">(integer) 1997</span><br></pre></td></tr></table></figure>
<p>您可以在文档中找到哈希命令的完整列表。</p>
<p>值得注意的是，小哈希（即，具有小值的少数元素）以特殊方式编码在存储器中，使得它们非常有效地存储。</p>
<h1 id="Redis-Sets"><a href="#Redis-Sets" class="headerlink" title="Redis Sets"></a>Redis Sets</h1><p>Redis集是字符串的无序集合。 SADD命令将新元素添加到集合中。 也可以针对集合执行许多其他操作，例如测试给定元素是否已存在，执行多个集合之间的交集，并集或差异等等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; sadd myset 1 2 3</span><br><span class="line">(integer) 3</span><br><span class="line">&gt; smembers myset</span><br><span class="line">1. 3</span><br><span class="line">2. 1</span><br><span class="line">3. 2</span><br></pre></td></tr></table></figure>
<p>在这里，我已经为我的集合添加了三个元素，并告诉Redis返回所有元素。 如您所见，它们没有排序 - Redis可以在每次调用时以任意顺序返回元素，因为没有与用户签订元素排序的合同。</p>
<p>Redis有命令来测试成员属性。 例如，检查元素是否存在：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; sismember myset 3</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; sismember myset 30</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>
<p>“3”是该组的成员，而“30”不是。</p>
<p>集合适用于表示对象之间的关系。 例如，我们可以轻松使用集合来实现标签。</p>
<p>对此问题进行建模的一种简单方法是为我们要标记的每个对象设置一个集合。 该集包含与该对象关联的标记的ID。</p>
<p>一个例子是标记新闻文章。 如果文章ID 1000标记有标记1,2,5和77，则集合可以将这些标记ID与新闻项相关联：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sadd news:1000:tags 1 2 5 77</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>
<p>我们也可能想要反向关系：用给定标签标记的所有新闻的列表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; sadd tag:1:news 1000</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; sadd tag:2:news 1000</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; sadd tag:5:news 1000</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; sadd tag:77:news 1000</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<p>获取给定对象的所有标记是微不足道的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; smembers news:1000:tags</span><br><span class="line">1. 5</span><br><span class="line">2. 1</span><br><span class="line">3. 77</span><br><span class="line">4. 2</span><br></pre></td></tr></table></figure>
<p>注意：在示例中，我们假设您有另一个数据结构，例如Redis哈希，它将标记ID映射到标记名称。</p>
<p>使用正确的Redis命令仍然可以轻松实现其他非平凡的操作。 例如，我们可能想要一起列出标签1,2,10和27的所有对象的列表。 我们可以使用SINTER命令执行此操作，该命令执行不同组之间的交集。 我们可以用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sinter tag:1:news tag:2:news tag:10:news tag:27:news</span><br><span class="line">... results here ...</span><br></pre></td></tr></table></figure>
<p>除了交集之外，您还可以执行联合，差集，提取随机元素等等。</p>
<p>提取元素的命令称为SPOP，可以方便地模拟某些问题。 例如，为了实现基于网络的扑克游戏，您可能希望用set代表您的套牌。 想象一下，我们使用一个字符前缀（C）lubs，（D）iamonds，（H）earts，（S）pades：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;  sadd deck C1 C2 C3 C4 C5 C6 C7 C8 C9 C10 CJ CQ CK</span><br><span class="line">   D1 D2 D3 D4 D5 D6 D7 D8 D9 D10 DJ DQ DK H1 H2 H3</span><br><span class="line">   H4 H5 H6 H7 H8 H9 H10 HJ HQ HK S1 S2 S3 S4 S5 S6</span><br><span class="line">   S7 S8 S9 S10 SJ SQ SK</span><br><span class="line">   (integer) 52</span><br></pre></td></tr></table></figure>
<p>现在我们想为每位玩家提供5张牌。 <strong>SPOP命令删除一个随机元素</strong>，将其返回给客户端，因此在这种情况下它是完美的操作。</p>
<p>然而，如果我们直接在我们的牌组中调用它，在下一场比赛中我们将需要再次填充牌组，这可能并不理想。 因此，首先，我们可以将存储在卡片组中的集合的副本复制到game：1：deck。</p>
<p>这是使用SUNIONSTORE完成的，SUNIONSTORE通常执行多个集合之间的并集，并将结果存储到另一个集合中。 但是，由于单个集合的结合本身，我可以复制我的套牌：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sunionstore game:1:deck deck</span><br><span class="line">(integer) 52</span><br></pre></td></tr></table></figure>
<p>现在我准备为第一位玩家提供五张牌：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; spop game:1:deck</span><br><span class="line">&quot;C6&quot;</span><br><span class="line">&gt; spop game:1:deck</span><br><span class="line">&quot;CQ&quot;</span><br><span class="line">&gt; spop game:1:deck</span><br><span class="line">&quot;D1&quot;</span><br><span class="line">&gt; spop game:1:deck</span><br><span class="line">&quot;CJ&quot;</span><br><span class="line">&gt; spop game:1:deck</span><br><span class="line">&quot;SJ&quot;</span><br></pre></td></tr></table></figure>
<p>一对千斤顶，不是很好……</p>
<p>现在是介绍set命令的好时机，该命令提供了一组内的元素数量。 这通常在集合论的上下文中称为集合的基数，因此Redis命令称为SCARD。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; scard game:1:deck</span><br><span class="line">(integer) 47</span><br></pre></td></tr></table></figure>
<p>数学运算：52 - 5 &#x3D; 47。</p>
<p>当您需要获取随机元素而不从集合中删除它们时，SRANDMEMBER命令适合该任务。 它还具有返回重复和非重复元素的能力。</p>
<h1 id="Redis-sorted-set"><a href="#Redis-sorted-set" class="headerlink" title="Redis sorted set"></a>Redis sorted set</h1><p>排序集是一种数据类型，类似于Set和Hash之间的混合。 与集合一样，有序集合由唯一的，非重复的字符串元素组成，因此在某种意义上，有序集合也是一个集合。</p>
<p>但是，虽然内部集合中的元素没有排序，但是有序集合中的每个元素都与浮点值相关联，称为分数（这就是为什么类型也类似于散列，因为每个元素都映射到一个值）。</p>
<p>此外，排序集合中的元素按顺序排列（因此它们不是根据请求排序的，顺序是用于表示排序集合的数据结构的特性）。 它们按照以下规则排序：</p>
<ol>
<li>如果A和B是两个具有不同分数的元素，如果A.score是&gt; B.score ，那么A&gt; B。</li>
<li>如果A和B具有完全相同的分数，那么如果A字符串在字典上大于B字符串，则A&gt; B. A和B字符串不能相等，因为有序集只有唯一元素。</li>
</ol>
<p>让我们从一个简单的例子开始，添加一些选定的黑客名称作为有序集合元素，其出生年份为“得分”。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; zadd hackers 1940 &quot;Alan Kay&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1957 &quot;Sophie Wilson&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1953 &quot;Richard Stallman&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1949 &quot;Anita Borg&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1965 &quot;Yukihiro Matsumoto&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1914 &quot;Hedy Lamarr&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1916 &quot;Claude Shannon&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1969 &quot;Linus Torvalds&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; zadd hackers 1912 &quot;Alan Turing&quot;</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>
<p>正如您所看到的，ZADD与SADD类似，但需要一个额外的参数（放在要添加的元素之前），这是分数。 ZADD也是可变参数，因此您可以自由指定多个得分-值对，即使在上面的示例中未使用它。</p>
<p>对于排序集，返回按出生年份排序的黑客列表是微不足道的，因为实际上它们已经排序了。</p>
<p>实现说明：排序集是通过包含跳过列表和散列表的双端口数据结构实现的，因此每次添加元素时，Redis都会执行O（log（N））操作。 这很好，但是当我们要求排序的元素时，Redis根本不需要做任何工作，它已经全部排序了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrange hackers 0 -1</span><br><span class="line">1) &quot;Alan Turing&quot;</span><br><span class="line">2) &quot;Hedy Lamarr&quot;</span><br><span class="line">3) &quot;Claude Shannon&quot;</span><br><span class="line">4) &quot;Alan Kay&quot;</span><br><span class="line">5) &quot;Anita Borg&quot;</span><br><span class="line">6) &quot;Richard Stallman&quot;</span><br><span class="line">7) &quot;Sophie Wilson&quot;</span><br><span class="line">8) &quot;Yukihiro Matsumoto&quot;</span><br><span class="line">9) &quot;Linus Torvalds&quot;</span><br></pre></td></tr></table></figure>
<p>注意：0和-1表示从元素索引0到最后一个元素（-1就像在LRANGE命令的情况下一样工作）。</p>
<p>如果我想以相反的方式排序它们，最小到最老的怎么办？ 使用ZREVRANGE而不是ZRANGE：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrevrange hackers 0 -1</span><br><span class="line">1) &quot;Linus Torvalds&quot;</span><br><span class="line">2) &quot;Yukihiro Matsumoto&quot;</span><br><span class="line">3) &quot;Sophie Wilson&quot;</span><br><span class="line">4) &quot;Richard Stallman&quot;</span><br><span class="line">5) &quot;Anita Borg&quot;</span><br><span class="line">6) &quot;Alan Kay&quot;</span><br><span class="line">7) &quot;Claude Shannon&quot;</span><br><span class="line">8) &quot;Hedy Lamarr&quot;</span><br><span class="line">9) &quot;Alan Turing&quot;</span><br></pre></td></tr></table></figure>
<p>使用WITHSCORES参数也可以返回分数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrange hackers 0 -1 withscores</span><br><span class="line">1) &quot;Alan Turing&quot;</span><br><span class="line">2) &quot;1912&quot;</span><br><span class="line">3) &quot;Hedy Lamarr&quot;</span><br><span class="line">4) &quot;1914&quot;</span><br><span class="line">5) &quot;Claude Shannon&quot;</span><br><span class="line">6) &quot;1916&quot;</span><br><span class="line">7) &quot;Alan Kay&quot;</span><br><span class="line">8) &quot;1940&quot;</span><br><span class="line">9) &quot;Anita Borg&quot;</span><br><span class="line">10) &quot;1949&quot;</span><br><span class="line">11) &quot;Richard Stallman&quot;</span><br><span class="line">12) &quot;1953&quot;</span><br><span class="line">13) &quot;Sophie Wilson&quot;</span><br><span class="line">14) &quot;1957&quot;</span><br><span class="line">15) &quot;Yukihiro Matsumoto&quot;</span><br><span class="line">16) &quot;1965&quot;</span><br><span class="line">17) &quot;Linus Torvalds&quot;</span><br><span class="line">18) &quot;1969&quot;</span><br></pre></td></tr></table></figure>
<h2 id="Range操作"><a href="#Range操作" class="headerlink" title="Range操作"></a>Range操作</h2><p>排序集比这更强大。 他们可以在范围内操作。 让我们得到所有出生到1950年的人。 我们使用ZRANGEBYSCORE命令来执行此操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrangebyscore hackers -inf 1950</span><br><span class="line">1) &quot;Alan Turing&quot;</span><br><span class="line">2) &quot;Hedy Lamarr&quot;</span><br><span class="line">3) &quot;Claude Shannon&quot;</span><br><span class="line">4) &quot;Alan Kay&quot;</span><br><span class="line">5) &quot;Anita Borg&quot;</span><br></pre></td></tr></table></figure>
<p>我们要求Redis以负无穷大和1950之间的分数返回所有元素（包括两个极值）。</p>
<p>也可以删除元素范围。 让我们从排序集中删除1940年到1960年间出生的所有黑客：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; zremrangebyscore hackers 1940 1960</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>
<p>ZREMRANGEBYSCORE可能不是最好的命令名，但它可能非常有用，并返回已删除元素的数量。</p>
<p>为有序集元素定义的另一个非常有用的操作是get-rank操作。 可以询问有序元素集中元素的位置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrank hackers &quot;Anita Borg&quot;</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>
<p>考虑到按降序排序的元素，ZREVRANK命令也可用于获得排名。</p>
<h1 id="词典分数"><a href="#词典分数" class="headerlink" title="词典分数"></a>词典分数</h1><p>使用Redis 2.8的最新版本，引入了一个新功能，允许按字典顺序获取范围，假设排序集中的元素都插入了相同的相同分数（元素与C memcmp函数进行比较，每个Redis实例都将使用相同的输出进行回复）。</p>
<p>使用词典范围操作的主要命令是ZRANGEBYLEX，ZREVRANGEBYLEX，ZREMRANGEBYLEX和ZLEXCOUNT。</p>
<p>例如，让我们再次添加我们的着名黑客列表，但这次使用所有元素的得分为零：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; zadd hackers 0 &quot;Alan Kay&quot; 0 &quot;Sophie Wilson&quot; 0 &quot;Richard Stallman&quot; 0</span><br><span class="line">  &quot;Anita Borg&quot; 0 &quot;Yukihiro Matsumoto&quot; 0 &quot;Hedy Lamarr&quot; 0 &quot;Claude Shannon&quot;</span><br><span class="line">  0 &quot;Linus Torvalds&quot; 0 &quot;Alan Turing&quot;</span><br></pre></td></tr></table></figure>
<p>由于排序集排序规则，它们已经按字典顺序排序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrange hackers 0 -1</span><br><span class="line">1) &quot;Alan Kay&quot;</span><br><span class="line">2) &quot;Alan Turing&quot;</span><br><span class="line">3) &quot;Anita Borg&quot;</span><br><span class="line">4) &quot;Claude Shannon&quot;</span><br><span class="line">5) &quot;Hedy Lamarr&quot;</span><br><span class="line">6) &quot;Linus Torvalds&quot;</span><br><span class="line">7) &quot;Richard Stallman&quot;</span><br><span class="line">8) &quot;Sophie Wilson&quot;</span><br><span class="line">9) &quot;Yukihiro Matsumoto&quot;</span><br></pre></td></tr></table></figure>
<p>使用ZRANGEBYLEX我们可以要求词典范围：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; zrangebylex hackers [B [P</span><br><span class="line">1) &quot;Claude Shannon&quot;</span><br><span class="line">2) &quot;Hedy Lamarr&quot;</span><br><span class="line">3) &quot;Linus Torvalds&quot;</span><br></pre></td></tr></table></figure>
<p>范围可以是包含的或排他的（取决于第一个字符），字符串无限和负无限分别用+和 - 字符串指定。 有关更多信息，请参阅文档。</p>
<p>此功能很重要，因为它允许我们使用有序集作为通用索引。 例如，如果要通过128位无符号整数参数索引元素，则需要做的就是将元素添加到具有相同分数的排序集中（例如0），但使用由128组成的16字节前缀 big endian中的位数。 由于big endian中的数字按字典顺序排列（以原始字节顺序排列）实际上也是按数字顺序排序的，因此可以在128位空间中请求范围，并获取元素的值以丢弃前缀。</p>
<p>如果您想在更严肃的演示环境中查看该功能，请查看Redis自动完成演示。</p>
<p><a target="_blank" rel="noopener" href="http://autocomplete.redis.io/">http://autocomplete.redis.io/</a></p>
<h1 id="更新得分：排行榜"><a href="#更新得分：排行榜" class="headerlink" title="更新得分：排行榜"></a>更新得分：排行榜</h1><p>在切换到下一个主题之前，关于排序集的最后一个注释。 排序集的分数可以随时更新。 只针对已经包含在已排序集合中的元素调用ZADD将使用O（log（N））时间复杂度更新其得分（和位置）。 因此，当有大量更新时，排序集合是合适的。</p>
<p>由于这个特性，常见的用例是排行榜。 典型的应用程序是一个Facebook游戏，您可以将用户按高分排序，加上排名操作，以显示前N个用户以及排行榜中的用户排名（例如，“ 你是这里＃4932的最佳成绩“）。</p>
<h1 id="位图"><a href="#位图" class="headerlink" title="位图"></a>位图</h1><p>位图不是实际的数据类型，而是在String类型上定义的一组面向位的操作。 由于字符串是二进制安全blob，并且它们的最大长度为512 MB，因此它们适合设置232个不同的位。</p>
<p>位操作分为两组：恒定时单位(single bit)操作，如将位设置为1或0，或获取其值，以及对位组进行操作，例如计算给定位范围内的设置位数 （例如，人口统计）。</p>
<p>位图的最大优势之一是它们在存储信息时通常可以节省大量空间。 例如，在通过增量用户ID表示不同用户的系统中，可以使用仅512MB的存储器记住40亿用户的单个位信息（例如，知道用户是否想要接收新闻通讯）。</p>
<p>使用SETBIT和GETBIT命令设置和检索位：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; setbit key 10 1</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; getbit key 10</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; getbit key 11</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>
<p>SETBIT命令的第一个参数是位号，第二个参数是将该位设置为1或0的值。如果寻址位超出当前字符串长度，命令会自动放大字符串。</p>
<p>GETBIT只返回指定索引处的位值。 超出范围的位（寻址存储在目标密钥中的字符串长度之外的位）始终被认为是零。</p>
<p>有三组命令在一组位上运行：</p>
<ol>
<li>BITOP在不同的字符串之间执行逐位操作。 提供的操作是AND，OR，XOR和NOT。</li>
<li>BITCOUNT执行填充计数，报告设置为1的位数。</li>
<li>BITPOS查找具有指定值0或1的第一个位。</li>
</ol>
<p>BITPOS和BITCOUNT都能够以字符串的字节范围运行，而不是在字符串的整个长度上运行。 以下是BITCOUNT调用的一个简单示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; setbit key 0 1</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; setbit key 100 1</span><br><span class="line">(integer) 0</span><br><span class="line">&gt; bitcount key</span><br><span class="line">(integer) 2</span><br></pre></td></tr></table></figure>
<p>位图的常见用例是：</p>
<ul>
<li>各种实时分析。</li>
<li>存储与对象ID关联的节省空间但高性能的布尔信息。</li>
</ul>
<p>例如，想象一下您想知道网站用户每日访问的最长连续性。 您开始计算从零开始的天数，即您将网站公开的日期，并在每次用户访问网站时使用SETBIT设置一些。 作为位索引，您只需获取当前的unix时间，减去初始偏移量，然后除以3600 * 24。</p>
<p>这种方式对于每个用户，您都有一个包含每天访问信息的小字符串。 使用BITCOUNT可以轻松获得给定用户访问网站的天数，同时只需几次BITPOS调用，或者只是获取和分析位图客户端，就可以轻松计算出最长的条纹。</p>
<p>位图很容易分割成多个键，例如为了分片数据集，因为通常最好避免使用大键。 要在不同的key上拆分位图而不是将所有的位都设置为key，一个简单的策略就是每个key存储M位并获得带有 位号&#x2F;M 的key名称和第N位用于在key内部用位寻址 - 位号MOD M.</p>
<h1 id="HyperLogLogs"><a href="#HyperLogLogs" class="headerlink" title="HyperLogLogs"></a>HyperLogLogs</h1><p>HyperLogLog是用于计算唯一事物的概率数据结构（从技术上讲，这被称为估计集合的基数）。通常计算唯一项目需要使用与您想要计算的项目数量成比例的内存量，因为您需要记住过去已经看过的元素，以避免多次计算它们。然而，有一组算法可以交换内存以获得精确度：以标准错误的估计度量结束，在Redis实现的情况下小于1％。这种算法的神奇之处在于你不再需要使用与计数项目数量成比例的内存量，而是可以使用恒定的内存量！在最坏的情况下12k字节，或者如果您的HyperLogLog（我们从现在开始称它们为HLL）已经看到的元素非常少，则要少得多。</p>
<p>Redis中的HLL虽然在技术上是一种不同的数据结构，但是被编码为Redis字符串，因此您可以调用GET来序列化HLL，并使用SET将其反序列化回服务器。</p>
<p>从概念上讲，HLL API就像使用Sets来执行相同的任务一样。 您可以将每个观察到的元素SADD到一个集合中，并使用SCARD来检查集合中的元素数量，这是唯一的，因为SADD不会重新添加现有元素。</p>
<p>虽然您没有真正将项添加到HLL中，因为数据结构只包含不包含实际元素的状态，所以API是相同的：</p>
<ul>
<li>每次看到新元素时，都会使用PFADD将其添加到计数中。</li>
<li>每次要检索到目前为止使用PFADD添加的唯一元素的当前近似值时，都使用PFCOUNT。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; pfadd hll a b c d</span><br><span class="line">(integer) 1</span><br><span class="line">&gt; pfcount hll</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>
<p>此数据结构的用例示例是计算用户每天在搜索表单中执行的唯一查询。</p>
<p>Redis还能够执行HLL的联合，请查看完整文档以获取更多信息。</p>
<h1 id="其他值得注意的功能"><a href="#其他值得注意的功能" class="headerlink" title="其他值得注意的功能"></a>其他值得注意的功能</h1><p>Redis API中还有其他重要的内容无法在本文档的上下文中进行探讨，但值得您关注：</p>
<ol>
<li>可以递增地迭代大集合的key空间。</li>
<li>可以运行Lua脚本服务器端来改善延迟和带宽。</li>
<li>Redis也是Pub-Sub服务器。</li>
</ol>
<h1 id="接下来干什么"><a href="#接下来干什么" class="headerlink" title="接下来干什么"></a>接下来干什么</h1><p><a target="_blank" rel="noopener" href="https://redis.io/topics/data-types-intro">data-type</a><br><a target="_blank" rel="noopener" href="https://redis.io/documentation">DOC</a><br><a target="_blank" rel="noopener" href="https://redis.io/topics/twitter-clone">twitter</a><br><a target="_blank" rel="noopener" href="https://redis.io/commands#cluster">command</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>Redis不是普通的键值存储，它实际上是一个数据结构服务器，支持不同类型的值。 这意味着，在传统的键值存储中，您将字符串键与字符串值相关联，在Redis中，值不仅限于简单的字符串，还可以包含更复杂的数据结构。 以下是Redis支持的所有数据结构的列表，本教程将单独介绍它们：</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/08/31/lang/003-redis-datatype/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/08/31/lang/003-redis-datatype/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/08/31/lang/003-redis-datatype/" data-id="cl1fw7fm200drvkd35to62v4u" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a><span class="article-tag-list-count">12</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-server/001-nginx-http-load-balance" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/30/server/001-nginx-http-load-balance/" class="article-date">
  <time datetime="2018-08-30T00:40:53.000Z" itemprop="datePublished">2018-08-30</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/30/server/001-nginx-http-load-balance/">nginx-HTTP负载均衡</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本文关于nginx的HTTP负载均衡。</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>略</p>
<h1 id="代理HTTP流量到一组服务器"><a href="#代理HTTP流量到一组服务器" class="headerlink" title="代理HTTP流量到一组服务器"></a>代理HTTP流量到一组服务器</h1><p>无非就是来了HTTP请求，我应该发给谁（哪个服务器），分发的过程就是nginx做的事情，当然我们可以配置。</p>
<h2 id="指定服务器"><a href="#指定服务器" class="headerlink" title="指定服务器"></a>指定服务器</h2><p>我们使用upstream来定义一组服务器，名字叫backend。<strong>注意：下面的server不是server块，而是一条指令</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server backend1.example.com weight=5;</span><br><span class="line">        server backend2.example.com;</span><br><span class="line">        server 192.0.0.1 backup;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h2><p>也就很简单了，使用proxy_pass.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，根据不同的协议，还有其他选择： fastcgi_pass, memcached_pass, scgi_pass, or uwsgi_pass</p>
<h2 id="完整配置"><a href="#完整配置" class="headerlink" title="完整配置"></a>完整配置</h2><p><strong>默认情况，ngnix使用轮询（Round Robin）算法分配流量</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server backend1.example.com;</span><br><span class="line">        server backend2.example.com;</span><br><span class="line">        server 192.0.0.1 backup;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    server &#123;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="负载均衡算法"><a href="#负载均衡算法" class="headerlink" title="负载均衡算法"></a>负载均衡算法</h1><p>nginx一共配备了5种算法，下面介绍。</p>
<h2 id="1-Round-Robin（轮询）"><a href="#1-Round-Robin（轮询）" class="headerlink" title="1.Round Robin（轮询）"></a>1.Round Robin（轮询）</h2><p>请求在服务器之间均匀分布，会考虑服务器权重。 默认情况下使用此方法（无需启动指令）： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">   server backend1.example.com;</span><br><span class="line">   server backend2.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-Least-Connections（最少连接数）"><a href="#2-Least-Connections（最少连接数）" class="headerlink" title="2.Least Connections（最少连接数）"></a>2.Least Connections（最少连接数）</h2><p>将请求发送到具有 <strong>最少活动连接数</strong> 的服务器，同时考虑服务器权重：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-IP-Hash"><a href="#3-IP-Hash" class="headerlink" title="3.IP Hash"></a>3.IP Hash</h2><p>从客户端IP地址确定向其发送请求的服务器。<br>在这种情况下，使用IPv4地址的前三个八位字节或整个IPv6地址来计算哈希值。 <strong>该方法保证来自同一地址的请求到达同一服务器，除非它不可用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果需要从负载平衡轮换中临时删除其中一个服务器，则可以使用 <strong>down</strong> 参数对其进行标记，以便保留客户端IP地址的当前哈希值。<br>此服务器要处理的请求将自动发送到组中的下一个服务器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">    server backend3.example.com down;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-一般HASH"><a href="#4-一般HASH" class="headerlink" title="4.一般HASH"></a>4.一般HASH</h2><p>发送请求的服务器是从用户定义的 <strong>键（键值对的键）</strong> 确定的，该key可以是文本字符串，变量或他们的组合。</p>
<p>例如，key可以是配对的源IP地址和端口，也可以是本示例中的URI：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    hash $request_uri consistent;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>hash指令的可选参数 <strong>consistent</strong> 启用ketama一致哈希负载平衡。 根据用户定义的散列键值，请求均匀分布在所有上游(upstream)服务器上。 如果将上游服务器添加到上游组或从上游组中删除，则仅重新映射几个key，这在负载平衡缓存服务器或其他累积状态的应用程序的情况下 <strong>最小化缓存未命中</strong> 。</p>
<h2 id="5-Least-Time-最小时间，只在NGINX-PLUS有"><a href="#5-Least-Time-最小时间，只在NGINX-PLUS有" class="headerlink" title="5.Least Time(最小时间，只在NGINX PLUS有)"></a>5.Least Time(最小时间，只在NGINX PLUS有)</h2><p>对于每个请求，NGINX Plus选择具有最低平均延迟和最低活动连接数的服务器，其中最低平均延迟是根据包含的 <strong>least_time</strong> 指令中的参数计算的,参数如下：</p>
<ol>
<li>header - 从服务器接收第一个字节的时间</li>
<li>last_byte - 从服务器接收完整响应的时间</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    least_time header;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="服务器权重"><a href="#服务器权重" class="headerlink" title="服务器权重"></a>服务器权重</h1><p>默认情况，weight都是1，每个服务器权重一样，但可以改变：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com weight=5;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">    server 192.0.0.1 backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述示例中，backend1.example.com的权重为5; 其他两台服务器具有默认权重（1），但IP地址为192.0.0.1的服务器标记为 <strong>备份服务器</strong> ，除非其他两台服务器都不可用，否则不会接收请求。<br>通过这种权重配置，每六个请求中就有五个发送到backend1.example.com，一个发送到backend2.example.com。</p>
<h1 id="服务器慢启动"><a href="#服务器慢启动" class="headerlink" title="服务器慢启动"></a>服务器慢启动</h1><p>服务器慢启动功能可防止最近恢复的服务器被连接淹没，因为这可能会超时并导致服务器再次被标记为失败。</p>
<p>在NGINX Plus中，慢启动允许上游服务器在恢复或可用之后 <strong>逐渐将其权重从零恢复到其标准值</strong> 。 这可以使用server指令的slow_start参数来完成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com slow_start=30s;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">    server 192.0.0.1 backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>时间值（此处为30秒）设置NGINX Plus将服务器连接数增加到最大值的时间。</p>
<p><strong>请注意，如果组中只有一个服务器，则忽略server指令的max_fails，fail_timeout和slow_start参数，并且永远不会将服务器视为不可用。</strong></p>
<h1 id="启用会话保持"><a href="#启用会话保持" class="headerlink" title="启用会话保持"></a>启用会话保持</h1><p>会话保持 意味着NGINX Plus识别用户会话并将给定会话中的所有请求路由到 <strong>同一上游服务器</strong> 。</p>
<p>NGINX Plus支持三种会话保持方法，使用sticky指令设置。 （对于使用NGINX OSS的会话持久性，请使用如上所述的hash或ip_hash指令。）</p>
<h2 id="1-Sticky-Cookie"><a href="#1-Sticky-Cookie" class="headerlink" title="1.Sticky Cookie"></a>1.Sticky Cookie</h2><p>NGINX Plus为来自上游组的第一个响应添加会话cookie，并识别发送响应的服务器。 客户端的下一个请求包含cookie值，NGINX Plus将请求路由到响应第一个请求的上游服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">    sticky cookie srv_id expires=1h domain=.example.com path=/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在该示例中，srv_id是cookie的名称。 可选的expires参数设置浏览器保留cookie的时间（此处为1小时）。 可选的domain参数定义为其设置cookie的域，可选的path参数定义cookie的设置路径。 这是最简单的会话持久性方法。</p>
<h2 id="2-Sticky-Route"><a href="#2-Sticky-Route" class="headerlink" title="2.Sticky Route"></a>2.Sticky Route</h2><p>NGINX Plus在收到第一个请求时为客户端分配“路由”。 将所有后续请求与server指令的route参数进行比较，以标识请求被代理到的服务器。 路由信息来自cookie或URI。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com route=a;</span><br><span class="line">    server backend2.example.com route=b;</span><br><span class="line">    sticky route $route_cookie $route_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-Cookie-learn"><a href="#3-Cookie-learn" class="headerlink" title="3.Cookie learn"></a>3.Cookie learn</h2><p>NGINX Plus首先通过检查请求和响应来查找会话标识符。 然后NGINX Plus“学习”哪个上游服务器对应哪个会话标识符。 通常，这些标识符在HTTP cookie中传递。 如果请求包含已经“学习”的会话标识符，NGINX Plus会将请求转发到相应的服务器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">   server backend1.example.com;</span><br><span class="line">   server backend2.example.com;</span><br><span class="line">   sticky learn</span><br><span class="line">       create=$upstream_cookie_examplecookie</span><br><span class="line">       lookup=$cookie_examplecookie</span><br><span class="line">       zone=client_sessions:1m</span><br><span class="line">       timeout=1h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在该示例中，其中一个上游服务器通过在响应中设置cookie EXAMPLECOOKIE来创建会话。</p>
<p>必需的create参数指定一个变量，指示如何创建新会话。 在该示例中，从上游服务器发送的cookie EXAMPLECOOKIE创建新会话。</p>
<p>lookup参数指定如何搜索现有会话。 在我们的示例中，在客户端发送的cookie EXAMPLECOOKIE中搜索现有会话。</p>
<p>zone参数指定共享内存区域，其中保留有关粘性会话的所有信息。 在我们的示例中，该区域名为client_sessions，大小为1兆字节。</p>
<p>这是一种比前两种方法更复杂的会话持久性方法，因为它不需要在客户端保留任何cookie：<strong>所有信息都保存在服务器端的共享内存区域中</strong> 。</p>
<h1 id="限制连接数"><a href="#限制连接数" class="headerlink" title="限制连接数"></a>限制连接数</h1><p>使用NGINX Plus，可以通过使用max_conns参数指定最大数量来限制与上游服务器的连接数。</p>
<p>如果已达到max_conns限制，则将请求 <strong>置于队列中</strong> 以进行进一步处理，前提是还包括queue指令以设置可同时在队列中的最大请求数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com max_conns=3;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">    queue 100 timeout=70;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果队列填满了请求，或者在可选的timeout参数指定的超时期间无法选择上游服务器，<strong>则客户端会收到错误</strong> 。</p>
<p>请注意，如果在其他工作进程中打开了空闲的keepalive连接，则会忽略max_conns限制。 因此，在与多个工作进程共享内存的配置中，与服务器的连接总数可能会超过max_conns值。</p>
<h1 id="被动健康检查"><a href="#被动健康检查" class="headerlink" title="被动健康检查"></a>被动健康检查</h1><p>当NGINX认为服务器不可用时，它会暂时停止向服务器发送请求，直到它再次被视为活动状态。 server指令的以下参数配置NGINX认为服务器不可用的条件：</p>
<ul>
<li>max_fails - 设置NGINX将服务器标记为不可用的连续失败尝试次数。</li>
<li>fail_timeout - 必须先设置max_fails参数指定的失败尝试次数，fail_timeout为NGINX认为服务器不可用的时间长度。</li>
</ul>
<p>默认值为1次尝试和10秒超时。 因此，如果服务器不接受或不响应（即一个）请求，NGINX会立即认为服务器不可用10秒钟。</p>
<p>以下示例显示如何设置这些参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">    server backend2.example.com max_fails=3 fail_timeout=30s;</span><br><span class="line">    server backend3.example.com max_fails=2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="积极健康检查"><a href="#积极健康检查" class="headerlink" title="积极健康检查"></a>积极健康检查</h1><p>接下来是一些用于跟踪NGINX Plus中服务器可用性的更复杂功能。</p>
<p>定期向每个服务器发送特殊请求并检查满足某些条件的响应可以监视服务器的可用性。</p>
<p>要在nginx.conf文件中启用此类型的运行状况监视，请在将请求传递到上游组的位置包含health_check指令。 此外，上游组必须包含zone指令以定义共享内存区域，其中存储有关运行状况的信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        zone backend 64k;</span><br><span class="line">        server backend1.example.com;</span><br><span class="line">        server backend2.example.com;</span><br><span class="line">        server backend3.example.com;</span><br><span class="line">        server backend4.example.com;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">            health_check;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>zone指令定义在工作进程之间共享的内存区域，用于存储服务器组的配置。 这使工作进程能够使用同一组计数器来跟踪来自上游服务器的响应。 上游组的动态配置也需要zone指令。</li>
<li>不带任何参数的health_check指令使用默认设置配置运行状况监视：NGINX Plus每5秒向后端组中的每个服务器发送一个请求。 如果发生任何通信错误或超时（或代理服务器以2_xx_或3_xx_之外的状态代码响应），则该服务器的运行状况检查将失败。 任何未通过运行状况检查的服务器都被认为是不健康的，并且NGINX Plus会停止向客户端发送请求，直到它再次通过运行状况检查。</li>
</ul>
<p>可以使用health_check指令的参数覆盖默认行为。 这里，interval参数将运行状况检查之间的持续时间减少到5秒。 failure &#x3D; 3参数表示在连续3次健康检查失败而不是默认值1之后服务器被认为是不健康的。使用pass参数，服务器需要通过2次连续检查（而不是1次）才能再次被视为健康。</p>
<p>要定义要请求的URI（此处为&#x2F; some &#x2F; path）而不是默认值，请包含uri参数。 URI附加到服务器的域名或IP地址，由上游块中的server指令指定。 例如，对于上面配置的后端组中的第一个服务器，运行状况检查是对<a target="_blank" rel="noopener" href="http://backend1.example.com/some/path%E7%9A%84%E8%AF%B7%E6%B1%82%E3%80%82">http://backend1.example.com/some/path的请求。</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://backend;</span><br><span class="line">    health_check interval=5 fails=3 passes=2 uri=/some/path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，您可以设置响应必须满足NGINX Plus的自定义条件，以使服务器健康。 条件在匹配块中指定，然后由health_check指令的match参数引用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    # ...</span><br><span class="line">    match server_ok &#123;</span><br><span class="line">        status 200-399;</span><br><span class="line">        body !~ &quot;maintenance mode&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    server &#123;</span><br><span class="line">        # ...</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">            health_check match=server_ok;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果响应中的状态代码在200到399范围内，并且响应正文与指定的正则表达式不匹配，则传递运行状况检查。</p>
<p>match指令使NGINX Plus能够检查状态，标题字段和响应正文。 使用此指令可以验证状态代码是否在指定范围内，响应包括标题，或者标题或正文与正则表达式匹配（以任何组合形式）。 match指令可以包含一个状态条件，一个正文条件和多个标题条件。 要使运行状况检查成功，响应必须满足匹配块中指定的所有条件。</p>
<p>例如，以下匹配块要求响应具有状态代码200，包含具有精确值text &#x2F; html的Content-Type标头，并在正文中包含文本“Welcome to nginx！”：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">match welcome &#123;</span><br><span class="line">    status 200;</span><br><span class="line">    header Content-Type = text/html;</span><br><span class="line">    body ~ &quot;Welcome to nginx!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在以下使用感叹号（！）的示例中，块匹配响应其中状态代码不是301,302,303和307，并且Refresh不在标题中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">match not_redirect &#123;</span><br><span class="line">    status ! 301-303 307;</span><br><span class="line">    header ! Refresh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以为NGINX Plus代理的非HTTP协议启用运行状况检查：FastCGI，memcached，SCGI和uwsgi。</p>
<h1 id="与多个工作进程共享数据"><a href="#与多个工作进程共享数据" class="headerlink" title="与多个工作进程共享数据"></a>与多个工作进程共享数据</h1><p>如果上游块不包含zone指令，则每个工作进程都会保留其自己的服务器组配置副本，并维护自己的一组相关计数器。 计数器包括组中每个服务器的当前连接数以及将请求传递到服务器的失败尝试次数。 因此，无法动态修改服务器组配置。</p>
<p>当zone指令包含在上游块中时，上游组的配置保存在所有工作进程之间共享的内存区域中。 此方案是可动态配置的，因为工作进程访问组配置的相同副本并使用相同的相关计数器。</p>
<p>zone指令对于活动运行状况检查和上游组的动态重新配置是必需的。 但是，上游组的其他功能也可以从该指令的使用中受益。</p>
<p>例如，如果未共享组的配置，则每个工作进程都会维护自己的计数器，以便将请求传递给服务器（由max_fails参数设置失败）。 在这种情况下，每个请求只能访问一个工作进程。 当选择处理请求的工作进程无法将请求传输到服务器时，其他工作进程对此一无所知。 虽然某些工作进程可以认为服务器不可用，但其他人可能仍会向此服务器发送请求。 对于最终被视为不可用的服务器，fail_timeout参数设置的时间范围内的失败尝试次数必须等于max_fails乘以工作进程数。 另一方面，zone指令保证了预期的行为。</p>
<p>同样，如果没有zone指令，Least Connections负载平衡方法可能无法正常工作，至少在低负载下。 此方法将请求传递给具有最少活动连接数的服务器。 如果未共享组的配置，则每个工作进程使用其自己的计数器作为连接数，并可能将请求发送到另一个工作进程刚刚发送请求的同一服务器。 但是，您可以增加请求数以减少此影响。 在高负载下，请求在工作进程之间均匀分布，并且最少连接方法按预期工作。</p>
<h3 id="设置zone大小"><a href="#设置zone大小" class="headerlink" title="设置zone大小"></a>设置zone大小</h3><p>不可能推荐理想的内存区大小，因为使用模式差异很大。 所需的内存量取决于启用了哪些功能（例如会话持久性，运行状况检查或DNS重新解析）以及如何识别上游服务器。</p>
<p>例如，使用sticky_route会话持久性方法并启用单个运行状况检查，256 KB区域可以容纳有关指示的上游服务器数量的信息：</p>
<ul>
<li>128台服务器（每台服务器定义为IP地址：端口对）</li>
<li>88个服务器（每个服务器定义为主机名：主机名解析为单个IP地址的端口对）</li>
<li>12个服务器（每个服务器定义为主机名：主机名解析为多个IP地址的端口对）</li>
</ul>
<h1 id="使用DNS配置HTTP负载均衡"><a href="#使用DNS配置HTTP负载均衡" class="headerlink" title="使用DNS配置HTTP负载均衡"></a>使用DNS配置HTTP负载均衡</h1><p>可以使用DNS在运行时修改服务器组的配置。</p>
<p>对于在服务器指令中使用域名标识的上游组中的服务器，NGINX Plus可以监视对应DNS记录中IP地址列表的更改，并自动将更改应用于上游组的负载平衡，而无需 重启。 这可以通过将http块中的resolver指令和resolve参数包含在server指令中来完成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    resolver 10.0.0.1 valid=300s ipv6=off;</span><br><span class="line">    resolver_timeout 10s;</span><br><span class="line">    server &#123;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        zone backend 32k;</span><br><span class="line">        least_conn;</span><br><span class="line">        # ...</span><br><span class="line">        server backend1.example.com resolve;</span><br><span class="line">        server backend2.example.com resolve;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在该示例中，server指令的resolve参数告诉NGINX Plus定期将backend1.example.com和backend2.example.com域名重新解析为IP地址。</p>
<p>解析器指令定义NGINX Plus向其发送请求的DNS服务器的IP地址（此处为10.0.0.1）。默认情况下，NGINX Plus会以记录中的生存时间（TTL）指定的频率重新解析DNS记录，但您可以使用有效参数覆盖TTL值;在示例中，它是300秒或5分钟。</p>
<p>可选的ipv6 &#x3D; off参数表示只有IPv4地址用于负载均衡，但默认情况下支持解析IPv4和IPv6地址。</p>
<p>如果域名解析为多个IP地址，则地址将保存到上游配置并进行负载平衡。在我们的示例中，服务器根据最小连接负载平衡方法进行负载平衡。如果服务器的IP地址列表已更改，NGINX Plus会立即在新的地址集中启动负载平衡。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>好吧，看到后面有点烦了。</p>
<p><a target="_blank" rel="noopener" href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/">https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本文关于nginx的HTTP负载均衡。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/08/30/server/001-nginx-http-load-balance/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/08/30/server/001-nginx-http-load-balance/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/08/30/server/001-nginx-http-load-balance/" data-id="cl1fw7fnb00ibvkd3arkvdua6" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="article-tag-list-count">57</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/load-balance/" rel="tag">load balance</a><span class="article-tag-list-count">1</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a><span class="article-tag-list-count">6</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-server/000-nginx-begin" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/29/server/000-nginx-begin/" class="article-date">
  <time datetime="2018-08-29T07:15:08.000Z" itemprop="datePublished">2018-08-29</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/29/server/000-nginx-begin/">nginx for beginners</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>这是nginx的入门一文。</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>略</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>略</p>
<h1 id="入门指导"><a href="#入门指导" class="headerlink" title="入门指导"></a>入门指导</h1><p><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/beginners_guide.html">https://nginx.org/en/docs/beginners_guide.html</a></p>
<h1 id="配置文件地址"><a href="#配置文件地址" class="headerlink" title="配置文件地址"></a>配置文件地址</h1><p>&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf, &#x2F;etc&#x2F;nginx, or&#x2F;usr&#x2F;local&#x2F;etc&#x2F;nginx.</p>
<img src="/2018/08/29/server/000-nginx-begin/000.png" class="">

<h1 id="日志的位置"><a href="#日志的位置" class="headerlink" title="日志的位置"></a>日志的位置</h1><p>&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs or &#x2F;var&#x2F;log&#x2F;nginx</p>
<h1 id="启动，停止和重新加载配置"><a href="#启动，停止和重新加载配置" class="headerlink" title="启动，停止和重新加载配置"></a>启动，停止和重新加载配置</h1><h2 id="start"><a href="#start" class="headerlink" title="start"></a>start</h2><img src="/2018/08/29/server/000-nginx-begin/001.png" class="">
<h2 id="reload"><a href="#reload" class="headerlink" title="reload"></a>reload</h2><p>重新加载配置文件</p>
<img src="/2018/08/29/server/000-nginx-begin/002.png" class="">
<h2 id="reopen"><a href="#reopen" class="headerlink" title="reopen"></a>reopen</h2><p>重新打开log文件<br> <img src="/2018/08/29/server/000-nginx-begin/003.png" class=""></p>
<h2 id="quit"><a href="#quit" class="headerlink" title="quit"></a>quit</h2><p>优雅的关闭<br> <img src="/2018/08/29/server/000-nginx-begin/004.png" class=""></p>
<h2 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h2><p>快速关闭<br> <img src="/2018/08/29/server/000-nginx-begin/005.png" class=""></p>
<h2 id="quit和stop的区别"><a href="#quit和stop的区别" class="headerlink" title="quit和stop的区别"></a>quit和stop的区别</h2><p>quit：相当于发送SIGQUIT信号，等待nginx工作线程完成才退出，很友好；<br>stop：相当于发送SIGTERM信号，要你强制退出。</p>
<img src="/2018/08/29/server/000-nginx-begin/006.png" class="">
<h2 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h2> <img src="/2018/08/29/server/000-nginx-begin/007.png" class="">

<p><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/control.html">https://nginx.org/en/docs/control.html</a></p>
<h1 id="配置文件结构"><a href="#配置文件结构" class="headerlink" title="配置文件结构"></a>配置文件结构</h1><p><a target="_blank" rel="noopener" href="https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/">https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/</a></p>
<p>nginx由模块组成，这些模块由配置文件中指定的指令控制。 指令分为简单指令和块指令。 一个简单的指令包括由空格分隔的名称和参数，以分号（;）结尾。 块指令与简单指令具有相同的结构，但它不是以分号结尾，而是以大括号（{和}）包围的一组附加指令结束。 如果块指令在大括号内包含其他指令，则称为上下文（示例：events，http，server和location）。</p>
<p>放置在任何上下文之外的配置文件中的指令被认为是在主上下文中。 事件和http指令驻留在主上下文中，服务器位于http中，位于服务器中。</p>
<p>＃符号后面的其余部分被视为评论。</p>
<p>我来翻译翻译上面的话：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">主上下文</span><br><span class="line">模块</span><br><span class="line">	简单指令 ;</span><br><span class="line">	块指令&#123;&#125;</span><br><span class="line">		包含简单指令</span><br><span class="line">		形成上下文(context)</span><br><span class="line"># 评论</span><br></pre></td></tr></table></figure>

<p>下面是分别描述</p>
<h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><p>以分号结尾的命令，包含在块中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user             nobody;</span><br><span class="line">error_log        logs/error.log notice;</span><br><span class="line">worker_processes 1;</span><br></pre></td></tr></table></figure>
<h2 id="指定配置文件地址"><a href="#指定配置文件地址" class="headerlink" title="指定配置文件地址"></a>指定配置文件地址</h2><p>nginx.conf可以包含单个模块的配置文件引用，配置文件位于&#x2F;etc&#x2F;nginx&#x2F;conf.d</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">include conf.d/http;</span><br><span class="line">include conf.d/stream;</span><br><span class="line">include conf.d/exchange-enhanced;</span><br></pre></td></tr></table></figure>
<h2 id="上下文"><a href="#上下文" class="headerlink" title="上下文"></a>上下文</h2><p>一般来说有几种context:</p>
<ol>
<li>events:通用连接处理</li>
<li>http:HTTP流量相关</li>
<li>mail：邮件流量相关</li>
<li>stream：TCP和UDP流量相关</li>
</ol>
<h2 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">user nobody; # a directive in the &#x27;main&#x27; context</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    # configuration of connection processing</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    # Configuration specific to HTTP and affecting all virtual servers  </span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        # configuration of HTTP virtual server 1       </span><br><span class="line">        location /one &#123;</span><br><span class="line">            # configuration for processing URIs starting with &#x27;/one&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        location /two &#123;</span><br><span class="line">            # configuration for processing URIs starting with &#x27;/two&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    server &#123;</span><br><span class="line">        # configuration of HTTP virtual server 2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    # Configuration specific to TCP/UDP and affecting all virtual servers</span><br><span class="line">    server &#123;</span><br><span class="line">        # configuration of TCP virtual server 1 </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="服务静态内容"><a href="#服务静态内容" class="headerlink" title="服务静态内容"></a>服务静态内容</h1><p>首先，我们会用到2个模块：http和server</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再server里定义location指令，指定根路径和image路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">server &#123;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root /mnt/e/data/www;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /images &#123;</span><br><span class="line">            root /mnt/e/data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看下完整配置：<br> <img src="/2018/08/29/server/000-nginx-begin/008.png" class=""></p>
<p>看下我们的静态资源：</p>
<img src="/2018/08/29/server/000-nginx-begin/009.png" class="">

<p>如果nginx在运行，需要重新加载下配置：<br> <img src="/2018/08/29/server/000-nginx-begin/010.png" class=""></p>
<p>结果：<br>默认是在80端口</p>
 <img src="/2018/08/29/server/000-nginx-begin/011.png" class="">
<img src="/2018/08/29/server/000-nginx-begin/012.png" class="">

<img src="/2018/08/29/server/000-nginx-begin/013.png" class="">

<h1 id="设置一个简单的代理服务器"><a href="#设置一个简单的代理服务器" class="headerlink" title="设置一个简单的代理服务器"></a>设置一个简单的代理服务器</h1><p>这个例子将会在一个nginx配置文件里配置多个服务器，只是端口号不同而已。<br>看完整配置：</p>
 <img src="/2018/08/29/server/000-nginx-begin/014.png" class="">

<p>看下文件目录：</p>
<img src="/2018/08/29/server/000-nginx-begin/015.png" class="">
<p>重新加载配置。</p>
<p>我们访问被代理的8080服务器，没问题：</p>
 <img src="/2018/08/29/server/000-nginx-begin/016.png" class="">

<p>访问代理服务器80端口也可以：</p>
 <img src="/2018/08/29/server/000-nginx-begin/017.png" class="">

<p>接下来是关键：8080下没有静态资源的，只有代理服务器上有：</p>
 <img src="/2018/08/29/server/000-nginx-begin/018.png" class="">
 <img src="/2018/08/29/server/000-nginx-begin/019.png" class="">

<p>这就完成了一个简单的CDN服务器配置。</p>
<h1 id="接下来学什么"><a href="#接下来学什么" class="headerlink" title="接下来学什么"></a>接下来学什么</h1><p>也就是作为nginx管理员要学什么，也就是nginx可以做什么，也就是闲的无聊，下面就是了：</p>
<ol>
<li>负载均衡：HTTP，TCP&#x2F;UDP</li>
<li>内容缓存：CDN等</li>
<li>Web服务器：静态或动态的</li>
<li>安全控制</li>
<li>监控：log，活动等</li>
<li>高可用：你懂的</li>
<li>动态模块：cookie，GEOIP，Filter，JS等</li>
<li>邮件代理服务器</li>
</ol>
<p>其实上述涉及了一个核心概念：代理。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>这是nginx的入门一文。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/08/29/server/000-nginx-begin/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/08/29/server/000-nginx-begin/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/08/29/server/000-nginx-begin/" data-id="cl1fw7fna00i8vkd3cyapfmdl" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="article-tag-list-count">57</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/" rel="tag">nginx</a><span class="article-tag-list-count">6</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-cloudcompute/014-docker-network" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/07/cloudcompute/014-docker-network/" class="article-date">
  <time datetime="2018-08-07T05:51:55.000Z" itemprop="datePublished">2018-08-07</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/07/cloudcompute/014-docker-network/">8.docker网络</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <img src="/2018/08/07/cloudcompute/014-docker-network/005.png" class="">

<p>见<a target="_blank" rel="noopener" href="http://www.cnblogs.com/CloudMan6/p/7066851.html">博客</a></p>
<p>网络链接图:</p>
<img src="/2018/08/07/cloudcompute/014-docker-network/000.jpg" class="">

<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/CloudMan6/p/7077198.html">boke</a></p>
<img src="/2018/08/07/cloudcompute/014-docker-network/001.jpg" class="">

<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/CloudMan6/p/7087765.html">博客</a></p>
<img src="/2018/08/07/cloudcompute/014-docker-network/002.jpg" class="">

<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/CloudMan6/p/7107407.html">博客</a></p>
<img src="/2018/08/07/cloudcompute/014-docker-network/003.jpg" class="">

<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/CloudMan6/p/7118860.html">博客</a></p>



      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <img src="/2018/08/07/cloudcompute/014-docker-network/005.png" class="">

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/08/07/cloudcompute/014-docker-network/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/08/07/cloudcompute/014-docker-network/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/08/07/cloudcompute/014-docker-network/" data-id="cl1fw7fip002yvkd32c4k6bh3" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="article-tag-list-count">16</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-cloudcompute/013-docker-container-limit" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/06/cloudcompute/013-docker-container-limit/" class="article-date">
  <time datetime="2018-08-06T05:51:55.000Z" itemprop="datePublished">2018-08-06</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/06/cloudcompute/013-docker-container-limit/">7.容器资源限制</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <img src="/2018/08/06/cloudcompute/013-docker-container-limit/002.png" class="">

<h1 id="限制内存"><a href="#限制内存" class="headerlink" title="限制内存"></a>限制内存</h1><p>参数解释:</p>
<ol>
<li>–vm 1: 启动一个内存工作线程</li>
<li>–vm-bytes: 每个线程分配的内存</li>
<li>-m: 内存</li>
<li>–memory-swap: 内存 + 交换内存 (<strong>若不指定,则默认为 -m 的2倍</strong>)</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker run -it -m 200M --memory-swap=300M progrium/stress --vm 1 --vm-bytes 180M</span><br><span class="line">WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.</span><br><span class="line">stress: info: [1] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd</span><br><span class="line">stress: dbug: [1] using backoff sleep of 3000us</span><br><span class="line">stress: dbug: [1] --&gt; hogvm worker 1 [5] forked</span><br><span class="line">stress: dbug: [5] allocating 188743680 bytes ...</span><br><span class="line">stress: dbug: [5] touching bytes in strides of 4096 bytes ...</span><br><span class="line">stress: dbug: [5] freed 188743680 bytes</span><br><span class="line">stress: dbug: [5] allocating 188743680 bytes ...</span><br><span class="line">stress: dbug: [5] touching bytes in strides of 4096 bytes ...</span><br></pre></td></tr></table></figure>
<p>可以看到我的内核不支持交换空间,所以上面的例子是小于内存的,会反复执行分配释放过程.</p>
<p>当大于200M内存,会卡死在那.</p>
<h1 id="限制CPU"><a href="#限制CPU" class="headerlink" title="限制CPU"></a>限制CPU</h1><p>看他们之间的相对比例.</p>
<ol>
<li>–cpu : 设置工作线程的数量</li>
<li>-c&#x2F;–cpu-shares  : 设置使用CPU的资源.</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker run --name container_A -it -c 1024 progrium/stress --cpu 1</span><br><span class="line">stress: info: [1] dispatching hogs: 1 cpu, 0 io, 0 vm, 0 hdd</span><br><span class="line">stress: dbug: [1] using backoff sleep of 3000us</span><br><span class="line">stress: dbug: [1] --&gt; hogcpu worker 1 [5] forked</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker run --name container_B -it -c 512 progrium/stress --cpu 1</span><br><span class="line">stress: info: [1] dispatching hogs: 1 cpu, 0 io, 0 vm, 0 hdd</span><br><span class="line">stress: dbug: [1] using backoff sleep of 3000us</span><br><span class="line">stress: dbug: [1] --&gt; hogcpu worker 1 [5] forked</span><br></pre></td></tr></table></figure>
<p>看以下CPU消耗</p>
<img src="/2018/08/06/cloudcompute/013-docker-container-limit/001.png" class="">

<p>然后暂停container_A</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:/home/jimo# docker pause container_A</span><br><span class="line">container_A</span><br></pre></td></tr></table></figure>
<img src="/2018/08/06/cloudcompute/013-docker-container-limit/000.png" class="">

<h1 id="限制IO"><a href="#限制IO" class="headerlink" title="限制IO"></a>限制IO</h1><p>–blkio-weight 与 –cpu-shares 类似，设置的是相对权重值，默认为 500,大家都一样.</p>
<p>bps 是 byte per second，每秒读写的数据量。<br>iops 是 io per second，每秒 IO 的次数。</p>
<p>可通过以下参数控制容器的 bps 和 iops：</p>
<ol>
<li>–device-read-bps，限制读某个设备的 bps。</li>
<li>–device-write-bps，限制写某个设备的 bps。</li>
<li>–device-read-iops，限制读某个设备的 iops。</li>
<li>–device-write-iops，限制写某个设备的 iops</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker run -it --device-write-bps /dev/sda:30MB ubuntu</span><br><span class="line">root@fa812ba7a517:/# time dd if=/dev/zero of=test.out bs=1M count=100 oflag=direct</span><br><span class="line">100+0 records in</span><br><span class="line">100+0 records out</span><br><span class="line">104857600 bytes (105 MB, 100 MiB) copied, 4.41395 s, 23.8 MB/s</span><br><span class="line"></span><br><span class="line">real	0m4.430s</span><br><span class="line">user	0m0.067s</span><br><span class="line">sys	0m0.015s</span><br></pre></td></tr></table></figure>
<h1 id="底层技术"><a href="#底层技术" class="headerlink" title="底层技术"></a>底层技术</h1><ol>
<li>实现资源限制利用了cgroup(control group).</li>
<li>资源隔离使用了namespace.</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker run -it --cpu-shares 512 progrium/stress -c 1</span><br><span class="line">stress: info: [1] dispatching hogs: 1 cpu, 0 io, 0 vm, 0 hdd</span><br><span class="line">stress: dbug: [1] using backoff sleep of 3000us</span><br><span class="line">stress: dbug: [1] --&gt; hogcpu worker 1 [5] forked</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES</span><br><span class="line">fc631c15666d        progrium/stress     &quot;/usr/bin/stress --v…&quot;   About a minute ago   Up About a minute                       pensive_hamilton</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# ls /sys/fs/cgroup/cpu/docker/fc631c15666de759766eaa8635ffac600b6bf015f5684797f37d8f941755de73/</span><br><span class="line">cgroup.clone_children  cpuacct.stat   cpuacct.usage_all     cpuacct.usage_percpu_sys   cpuacct.usage_sys   cpu.cfs_period_us  cpu.shares  notify_on_release</span><br><span class="line">cgroup.procs           cpuacct.usage  cpuacct.usage_percpu  cpuacct.usage_percpu_user  cpuacct.usage_user  cpu.cfs_quota_us   cpu.stat    tasks</span><br></pre></td></tr></table></figure>

<p>详情见<a target="_blank" rel="noopener" href="http://www.cnblogs.com/CloudMan6/p/7045784.html">博客</a>.</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <img src="/2018/08/06/cloudcompute/013-docker-container-limit/002.png" class="">

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/08/06/cloudcompute/013-docker-container-limit/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/08/06/cloudcompute/013-docker-container-limit/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/08/06/cloudcompute/013-docker-container-limit/" data-id="cl1fw7fim002uvkd32h3i5zp9" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="article-tag-list-count">16</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-cloudcompute/012-docker-container" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/05/cloudcompute/012-docker-container/" class="article-date">
  <time datetime="2018-08-05T05:51:55.000Z" itemprop="datePublished">2018-08-05</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/05/cloudcompute/012-docker-container/">6.容器的使用</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <img src="/2018/08/05/cloudcompute/012-docker-container/000.png" class="">

<h1 id="暂停"><a href="#暂停" class="headerlink" title="暂停"></a>暂停</h1><p>比如打个快照之类的. <strong>注意看下面的状态</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">3ecd69d08416        ubuntu              &quot;/bin/bash&quot;         45 seconds ago      Up 44 seconds                           confident_kalam</span><br><span class="line">root@jimo-VirtualBox:~# docker pause confident_kalam</span><br><span class="line">confident_kalam</span><br><span class="line">root@jimo-VirtualBox:~# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                  PORTS               NAMES</span><br><span class="line">3ecd69d08416        ubuntu              &quot;/bin/bash&quot;         8 minutes ago       Up 8 minutes (Paused)                       confident_kalam</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker unpause confident_kalam</span><br><span class="line">confident_kalam</span><br><span class="line">root@jimo-VirtualBox:~# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">3ecd69d08416        ubuntu              &quot;/bin/bash&quot;         8 minutes ago       Up 8 minutes                            confident_kalam</span><br></pre></td></tr></table></figure>

<h1 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h1><p>退出的容器依然会占用空间,所以可以删除.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">3ecd69d08416        ubuntu              &quot;/bin/bash&quot;              15 minutes ago      Up 15 minutes                                   confident_kalam</span><br><span class="line">cfb902a91605        ubuntu              &quot;/bin/bash&quot;              18 minutes ago      Exited (0) 18 minutes ago                       hungry_bell</span><br><span class="line">ee2a6312fbe5        my-image            &quot;sh&quot;                     18 minutes ago      Exited (0) 18 minutes ago                       cocky_payne</span><br><span class="line">ffac6be3da49        busybox             &quot;sh&quot;                     13 days ago         Exited (0) 13 days ago                          zen_leavitt</span><br><span class="line">bdd94e3338fb        ubuntu              &quot;/bin/bash -c &#x27;while…&quot;   13 days ago         Exited (137) 13 days ago                        gifted_hopper</span><br><span class="line">b4027dadae2a        ubuntu              &quot;/bin/bash -c &#x27;while…&quot;   13 days ago         Exited (137) 13 days ago                        eager_easley</span><br><span class="line">5faa46b16ea9        httpd               &quot;httpd-foreground&quot;       13 days ago         Exited (0) 13 days ago                          my-http-server</span><br><span class="line">549aa9db3954        ubuntu              &quot;/bin/bash -c &#x27;while…&quot;   13 days ago         Exited (137) 13 days ago                        elastic_cray</span><br><span class="line">16858e7ee65c        ubuntu              &quot;/bin/bash -c &#x27;while…&quot;   13 days ago         Exited (137) 13 days ago                        clever_murdock</span><br><span class="line">a67b81d3ff90        ubuntu              &quot;/bin/bash -c &#x27;echo …&quot;   13 days ago         Exited (0) 13 days ago                          xenodochial_elbakyan</span><br><span class="line">21f6607ec8dc        ubuntu              &quot;/bin/bash -c &#x27;while…&quot;   13 days ago         Exited (137) 13 days ago                        eager_perlman</span><br><span class="line">e34dcec1bd64        ubuntu              &quot;/bin/basg -c &#x27;while…&quot;   13 days ago         Created                                         happy_hugle</span><br><span class="line">524c62fc3f68        ubuntu              &quot;pwd&quot;                    13 days ago         Exited (0) 13 days ago                          pensive_khorana</span><br><span class="line">80f81f33ed15        registry:latest     &quot;/entrypoint.sh /etc…&quot;   2 weeks ago         Exited (2) 2 weeks ago                          agitated_clarke</span><br><span class="line">06d0403206f8        registry:latest     &quot;/entrypoint.sh /etc…&quot;   2 weeks ago         Created                                         mystifying_hawking</span><br><span class="line">0fe657284887        my-image            &quot;sh&quot;                     2 weeks ago         Exited (0) 2 weeks ago                          determined_boyd</span><br><span class="line">e7bac1b935b3        2d8187e6451a        &quot;sh&quot;                     2 weeks ago         Exited (127) 2 weeks ago                        unruffled_keldysh</span><br><span class="line">3e9f5c9eae7c        2d8187e6451a        &quot;/bin/sh -c &#x27;/bin/ba…&quot;   2 weeks ago         Exited (127) 2 weeks ago                        laughing_mendeleev</span><br><span class="line">4a12c1ec8971        ubuntu              &quot;/bin/bash&quot;              2 weeks ago         Exited (127) 2 weeks ago                        eager_austin</span><br><span class="line">2eda339fa711        hello-world         &quot;/hello&quot;                 2 weeks ago         Exited (0) 2 weeks ago                          practical_shaw</span><br><span class="line">01fa717064e8        httpd               &quot;httpd-foreground&quot;       2 weeks ago         Exited (0) 2 weeks ago                          hardcore_lewin</span><br><span class="line">36ee204c603c        httpd               &quot;httpd-foreground&quot;       2 weeks ago         Created                                         eloquent_turing</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker rm 36ee204c603c 01fa717064e8</span><br><span class="line">36ee204c603c</span><br><span class="line">01fa717064e8</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker ps -aq -f status=exited</span><br><span class="line">cfb902a91605</span><br><span class="line">ee2a6312fbe5</span><br><span class="line">ffac6be3da49</span><br><span class="line">bdd94e3338fb</span><br><span class="line">b4027dadae2a</span><br><span class="line">5faa46b16ea9</span><br><span class="line">549aa9db3954</span><br><span class="line">16858e7ee65c</span><br><span class="line">a67b81d3ff90</span><br><span class="line">21f6607ec8dc</span><br><span class="line">524c62fc3f68</span><br><span class="line">80f81f33ed15</span><br><span class="line">0fe657284887</span><br><span class="line">e7bac1b935b3</span><br><span class="line">3e9f5c9eae7c</span><br><span class="line">4a12c1ec8971</span><br><span class="line">2eda339fa711</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker rm -v $(docker ps -aq -f status=exited)</span><br><span class="line">cfb902a91605</span><br><span class="line">ee2a6312fbe5</span><br><span class="line">ffac6be3da49</span><br><span class="line">bdd94e3338fb</span><br><span class="line">b4027dadae2a</span><br><span class="line">5faa46b16ea9</span><br><span class="line">549aa9db3954</span><br><span class="line">16858e7ee65c</span><br><span class="line">a67b81d3ff90</span><br><span class="line">21f6607ec8dc</span><br><span class="line">524c62fc3f68</span><br><span class="line">80f81f33ed15</span><br><span class="line">0fe657284887</span><br><span class="line">e7bac1b935b3</span><br><span class="line">3e9f5c9eae7c</span><br><span class="line">4a12c1ec8971</span><br><span class="line">2eda339fa711</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">3ecd69d08416        ubuntu              &quot;/bin/bash&quot;              17 minutes ago      Up 17 minutes                           confident_kalam</span><br><span class="line">e34dcec1bd64        ubuntu              &quot;/bin/basg -c &#x27;while…&quot;   13 days ago         Created                                 happy_hugle</span><br><span class="line">06d0403206f8        registry:latest     &quot;/entrypoint.sh /etc…&quot;   2 weeks ago         Created                                 mystifying_hawking</span><br><span class="line">root@jimo-VirtualBox:~#</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>一张图理解.内容来自<a target="_blank" rel="noopener" href="http://www.cnblogs.com/CloudMan6/p/6961665.html">blog</a></p>
<img src="/2018/08/05/cloudcompute/012-docker-container/001.jpg" class="">

<p><strong>注意以下几点:</strong></p>
<ol>
<li>状态的几种变换</li>
<li>docker run &#x3D; docker create + docker start</li>
<li>–restart 只在容器进程退出时才有效.</li>
</ol>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <img src="/2018/08/05/cloudcompute/012-docker-container/000.png" class="">

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/08/05/cloudcompute/012-docker-container/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/08/05/cloudcompute/012-docker-container/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/08/05/cloudcompute/012-docker-container/" data-id="cl1fw7fil002tvkd3gcxy3rxn" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="article-tag-list-count">16</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-cloudcompute/011-docker-container" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/04/cloudcompute/011-docker-container/" class="article-date">
  <time datetime="2018-08-04T05:51:55.000Z" itemprop="datePublished">2018-08-04</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/04/cloudcompute/011-docker-container/">5.docker container run</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>容器的运行,进入与分类.</p>
<img src="/2018/08/04/cloudcompute/011-docker-container/000.png" class="">

<h1 id="一闪而过运行容器"><a href="#一闪而过运行容器" class="headerlink" title="一闪而过运行容器"></a>一闪而过运行容器</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker run ubuntu pwd</span><br><span class="line">/</span><br><span class="line">root@jimo-VirtualBox:~#</span><br></pre></td></tr></table></figure>
<p>查看容器运行状态:发现并没运行,而是一闪而过.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker container ls -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS                          PORTS               NAMES</span><br><span class="line">524c62fc3f68        ubuntu              &quot;pwd&quot;                    About a minute ago   Exited (0) About a minute ago                       pensive_khorana</span><br></pre></td></tr></table></figure>
<h1 id="长时间运行容器"><a href="#长时间运行容器" class="headerlink" title="长时间运行容器"></a>长时间运行容器</h1><p>因为容器的生命周期依赖于启动时执行的命令，只要该命令不结束，容器也就不会退出。<br>理解了这个原理，我们就可以通过执行一个长期运行的命令来保持容器的运行状态:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:/home/jimo# docker run ubuntu /bin/bash -c &quot;while true ; do sleep 1; done&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">另一终端</span></span><br><span class="line">root@jimo-VirtualBox:~# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES</span><br><span class="line">549aa9db3954        ubuntu              &quot;/bin/bash -c &#x27;while…&quot;   36 seconds ago       Up 34 seconds                           elastic_cray</span><br></pre></td></tr></table></figure>
<p>-d参数: 后台运行.<br>–name : 指定名字,不指定会随机分配.<br>如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker run --name &quot;my-http-server&quot; -d httpd</span><br><span class="line">5faa46b16ea9437f7230cb6c276014640e7cc73b661341fbe38305d3effbaebd</span><br><span class="line">root@jimo-VirtualBox:~# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS               NAMES</span><br><span class="line">5faa46b16ea9        httpd               &quot;httpd-foreground&quot;   5 seconds ago       Up 4 seconds        80/tcp              my-http-server</span><br></pre></td></tr></table></figure>
<p>通过history可看到是通过CMD执行的:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker history httpd</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">fb2f3851a971        3 weeks ago         /bin/sh -c #(nop)  CMD [&quot;httpd-foreground&quot;]     0B               </span><br></pre></td></tr></table></figure>
<h1 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker stop 549aa9db3954</span><br><span class="line">549aa9db3954</span><br></pre></td></tr></table></figure>
<h1 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h1><ol>
<li>attach方式:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker run -d -it ubuntu /bin/bash -c &quot;while true;do sleep 2;echo In_container;done&quot;</span><br><span class="line">bdd94e3338fbfebdc2f2b679773f1755796bfee9f3d3da48e765977b311bf0cb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可通过 Ctrl+p 然后 Ctrl+q 组合键退出 attach 终端,但启动时要加-it</span></span><br><span class="line">root@jimo-VirtualBox:~# docker attach bdd94e3338fbfebdc2f2b679773f1755796bfee9f3d3da48e765977b311bf0cb</span><br><span class="line">In_container</span><br><span class="line">In_container</span><br><span class="line">read escape sequence</span><br></pre></td></tr></table></figure></li>
<li>exec方式: docker exec -it ID bash|sh<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker exec -it bdd94e3338fb bash</span><br><span class="line">root@bdd94e3338fb:/# ps -elf</span><br><span class="line">F S UID        PID  PPID  C PRI  NI ADDR SZ WCHAN  STIME TTY          TIME CMD</span><br><span class="line">4 S root         1     0  0  80   0 -  4594 wait   06:34 pts/0    00:00:00 /bin/</span><br><span class="line">4 S root        80     0  0  80   0 -  4627 wait   06:37 pts/1    00:00:00 bash</span><br><span class="line">0 S root        93     1  0  80   0 -  1133 hrtime 06:37 pts/0    00:00:00 sleep</span><br><span class="line">4 R root        94    80  0  80   0 -  8600 -      06:37 pts/1    00:00:00 ps -e</span><br><span class="line">root@bdd94e3338fb:/# exit</span><br><span class="line">exit</span><br><span class="line">root@jimo-VirtualBox:~#</span><br></pre></td></tr></table></figure></li>
<li>exec VS attach<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. attach 直接进入容器 启动命令 的终端，不会启动新的进程。</span><br><span class="line">2. exec 则是在容器中打开新的终端，并且可以启动新的进程。</span><br><span class="line">3. 如果想直接在终端中查看启动命令的输出，用 attach；其他情况使用 exec。</span><br></pre></td></tr></table></figure></li>
<li>如果只是为了查看启动命令的输出，可以使用 docker logs 命令,-f会连续打印输出<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker logs -f bdd94e3338fb</span><br><span class="line">In_container</span><br><span class="line">In_container</span><br><span class="line">In_container</span><br><span class="line">In_container</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="容器分类"><a href="#容器分类" class="headerlink" title="容器分类"></a>容器分类</h1><ol>
<li>服务类容器以 daemon 的形式运行，对外提供服务。比如 web server，数据库等。通过 -d 以后台方式启动这类容器是非常合适的。如果要排查问题，可以通过 exec -it 进入容器。</li>
<li>工具类容器通常给能我们提供一个临时的工作环境，通常以 run -it 方式运行,如:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker run -it busybox</span><br><span class="line">/ # wget www.baidu.com</span><br><span class="line">Connecting to www.baidu.com (61.135.169.121:80)</span><br><span class="line">index.html           100% |**************************************************************************************************************************************************************|  2381   0:00:00 ETA</span><br><span class="line">/ # exit</span><br></pre></td></tr></table></figure>
<h1 id="指定容器的方式"><a href="#指定容器的方式" class="headerlink" title="指定容器的方式"></a>指定容器的方式</h1></li>
<li>短ID。</li>
<li>长ID。</li>
<li>容器名称。 可通过 –name 为容器命名。重命名容器可执行docker rename。</li>
</ol>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>容器的运行,进入与分类.</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/08/04/cloudcompute/011-docker-container/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/08/04/cloudcompute/011-docker-container/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/08/04/cloudcompute/011-docker-container/" data-id="cl1fw7fij002qvkd37gfj0fqq" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="article-tag-list-count">16</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-tools/011-win10-linux-subsystem" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/04/tools/011-win10-linux-subsystem/" class="article-date">
  <time datetime="2018-08-04T00:17:46.000Z" itemprop="datePublished">2018-08-04</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/04/tools/011-win10-linux-subsystem/">win10-linux-subsystem</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>在win10上安装linux子系统。</p>
<ol>
<li>在控制面板–&gt;程序里启用。</li>
</ol>
<img src="/2018/08/04/tools/011-win10-linux-subsystem/001.png" class="">

<ol start="2">
<li><p>在商店安装想要的系统.</p>
</li>
<li><p>使用，主要是如何访问windows的东西，下图明了。</p>
</li>
</ol>
<img src="/2018/08/04/tools/011-win10-linux-subsystem/000.png" class="">

<p><strong>注意：不要用windows修改在linux中创建的文件。</strong></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>在win10上安装linux子系统。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/08/04/tools/011-win10-linux-subsystem/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/08/04/tools/011-win10-linux-subsystem/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/08/04/tools/011-win10-linux-subsystem/" data-id="cl1fw7fo300l2vkd301ss7q5e" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-cloudcompute/010-docker-registry" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/03/cloudcompute/010-docker-registry/" class="article-date">
  <time datetime="2018-08-03T05:51:55.000Z" itemprop="datePublished">2018-08-03</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/03/cloudcompute/010-docker-registry/">4.docker Registry</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <h1 id="总图导航"><a href="#总图导航" class="headerlink" title="总图导航"></a>总图导航</h1><img src="/2018/08/03/cloudcompute/010-docker-registry/000.png" class="">

<h1 id="镜像命名"><a href="#镜像命名" class="headerlink" title="镜像命名"></a>镜像命名</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker images</span></span><br><span class="line">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">my-image                      latest              135177378c5b        About an hour ago   1.15MB</span><br></pre></td></tr></table></figure>
<p>镜像名称组成: REPOSITORY:TAG,默认TAG是latest,并无强制要求.</p>
<h1 id="TAG最佳实践"><a href="#TAG最佳实践" class="headerlink" title="TAG最佳实践"></a>TAG最佳实践</h1><ol>
<li>采用docker社区普遍采用的3级格式.</li>
<li>一个版本可以有多个TAG.</li>
</ol>
<p>命令如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">最初为1.9.1</span></span><br><span class="line">docker tag myimage-v1.9.1 myimage:1</span><br><span class="line">docker tag myimage-v1.9.1 myimage:1.9</span><br><span class="line">docker tag myimage-v1.9.1 myimage:1.9.1</span><br><span class="line">docker tag myimage-v1.9.1 myimage:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">升级到1.9.2</span></span><br><span class="line">docker tag myimage-v1.9.2 myimage:1</span><br><span class="line">docker tag myimage-v1.9.2 myimage:1.9</span><br><span class="line">docker tag myimage-v1.9.2 myimage:1.9.2</span><br><span class="line">docker tag myimage-v1.9.2 myimage:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.0.0发布</span></span><br><span class="line">docker tag myimage-v2.0.0 myimage:2</span><br><span class="line">docker tag myimage-v2.0.0 myimage:2.0</span><br><span class="line">docker tag myimage-v2.0.0 myimage:2.0.0</span><br><span class="line">docker tag myimage-v2.0.0 myimage:latest</span><br></pre></td></tr></table></figure>

<p>如下图:</p>
<img src="/2018/08/03/cloudcompute/010-docker-registry/001.png" class="">

<p>这种TAG的解释和好处:</p>
<ol>
<li>myimage:1 始终指向 1 这个分支中最新的镜像。</li>
<li>myimage:1.9 始终指向 1.9.x 中最新的镜像。</li>
<li>myimage:latest 始终指向所有版本中最新的镜像。</li>
<li>如果想使用特定版本，可以选择 myimage:1.9.1、myimage:1.9.2 或 myimage:2.0.0。</li>
</ol>
<h1 id="上传到Registry"><a href="#上传到Registry" class="headerlink" title="上传到Registry"></a>上传到Registry</h1><p>注意个人需要带上 : 用户名&#x2F;image:tag</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~/workplace/dockerfile# docker login -u jackpler</span><br><span class="line">Password: </span><br><span class="line">Login Succeeded</span><br><span class="line">root@jimo-VirtualBox:~/workplace/dockerfile# docker tag my-image jackpler/my-image:v1</span><br><span class="line">root@jimo-VirtualBox:~/workplace/dockerfile# docker images</span><br><span class="line">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">jackpler/my-image             v1                  135177378c5b        About an hour ago   1.15MB</span><br><span class="line">my-image                      latest              135177378c5b        About an hour ago   1.15MB</span><br><span class="line">root@jimo-VirtualBox:~/workplace/dockerfile# docker push jackpler/my-image:v1</span><br><span class="line">The push refers to repository [docker.io/jackpler/my-image]</span><br><span class="line">f89ed34343be: Pushed </span><br><span class="line">d2fc55a59506: Pushed </span><br><span class="line">7046cf07d08a: Pushed </span><br><span class="line">bdad0d9725ad: Pushed </span><br><span class="line">0314be9edf00: Mounted from library/busybox </span><br><span class="line">v1: digest: sha256:a07e725b2cf9fdfbbb80ee71efa890070cab2bea9fb1006fb31078e8eaeb7898 size: 1355</span><br></pre></td></tr></table></figure>
<p>在网站可看到:</p>
<img src="/2018/08/03/cloudcompute/010-docker-registry/002.png" class="">

<p>在网站上可以删除.</p>
<h1 id="搭建本地Registry"><a href="#搭建本地Registry" class="headerlink" title="搭建本地Registry"></a>搭建本地Registry</h1><p>原因很多: 网速,费用,安全.</p>
<p>使用<a target="_blank" rel="noopener" href="https://hub.docker.com/r/library/registry/">官方的registry</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~/workplace/dockerfile# docker run -d -p 5001:5000 -v /home/jimo/myregistry:/var/lib/registry registry:latest</span><br><span class="line">Unable to find image &#x27;registry:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/registry</span><br><span class="line">81033e7c1d6a: Pull complete </span><br><span class="line">b235084c2315: Pull complete </span><br><span class="line">c692f3a6894b: Pull complete </span><br><span class="line">ba2177f3a70e: Pull complete </span><br><span class="line">a8d793620947: Pull complete </span><br><span class="line">Digest: sha256:feb40d14cd33e646b9985e2d6754ed66616fedb840226c4d917ef53d616dcd6c</span><br><span class="line">Status: Downloaded newer image for registry:latest</span><br><span class="line">80f81f33ed15616f5334d6e49642da0eff1cd4777aae075f816f48f6de52269a</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~/workplace/dockerfile# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">80f81f33ed15        registry:latest     &quot;/entrypoint.sh /etc…&quot;   11 seconds ago      Up 10 seconds       0.0.0.0:5001-&gt;5000/tcp   agitated_clarke</span><br></pre></td></tr></table></figure>
<p>-p : 绑定在5001端口<br>-v : 把镜像存储映射到本地<br>-d : 后台运行</p>
<p>上传到本地registry</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@jimo-VirtualBox:~# docker tag jackpler/my-image:v1 localhost:5001/jackpler/my-image:v1.1</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker images</span><br><span class="line">REPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">jackpler/my-image                  v1                  135177378c5b        2 hours ago         1.15MB</span><br><span class="line">my-image                           latest              135177378c5b        2 hours ago         1.15MB</span><br><span class="line">localhost:5001/jackpler/my-image   v1.1                135177378c5b        2 hours ago         1.15MB</span><br><span class="line"></span><br><span class="line">root@jimo-VirtualBox:~# docker push localhost:5001/jackpler/my-image:v1.1</span><br><span class="line">The push refers to repository [localhost:5001/jackpler/my-image]</span><br><span class="line">f89ed34343be: Pushed </span><br><span class="line">d2fc55a59506: Pushed </span><br><span class="line">7046cf07d08a: Pushed </span><br><span class="line">bdad0d9725ad: Pushed </span><br><span class="line">0314be9edf00: Pushed </span><br><span class="line">v1.1: digest: sha256:a07e725b2cf9fdfbbb80ee71efa890070cab2bea9fb1006fb31078e8eaeb7898 size: 1355</span><br></pre></td></tr></table></figure>
<p><strong>注意:</strong><br>REPOSITORY的格式: [registry-host]:[port]&#x2F;[username]&#x2F;xxx<br>只有docker hub上的镜像可以省略 [registry-host]:[port] </p>
<p>本文来自<a target="_blank" rel="noopener" href="http://www.cnblogs.com/CloudMan6/p/6902325.html">blog</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <h1 id="总图导航"><a href="#总图导航" class="headerlink" title="总图导航"></a>总图导航</h1><img src="/2018/08/03/cloudcompute/010-docker-registry/000.png" class="">

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/2018/08/03/cloudcompute/010-docker-registry/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/2018/08/03/cloudcompute/010-docker-registry/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/08/03/cloudcompute/010-docker-registry/" data-id="cl1fw7fij002pvkd3gqengrzw" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="article-tag-list-count">16</span></li></ul>

      </footer>
      </div>
      
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/12/">&amp;laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/14/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AI/" rel="tag">AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI-test/" rel="tag">UI test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/annotation/" rel="tag">annotation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ant/" rel="tag">ant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aop/" rel="tag">aop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/archiva/" rel="tag">archiva</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/asciidoc/" rel="tag">asciidoc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awk/" rel="tag">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/axios/" rel="tag">axios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/basic/" rel="tag">basic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/big-data/" rel="tag">big data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blockchain/" rel="tag">blockchain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/" rel="tag">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cglib/" rel="tag">cglib</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/checkstyle/" rel="tag">checkstyle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome/" rel="tag">chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/computer-principle/" rel="tag">computer principle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cors/" rel="tag">cors</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/data-structure/" rel="tag">data structure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-pattern/" rel="tag">design-pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/" rel="tag">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es/" rel="tag">es</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eureka/" rel="tag">eureka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/firefox/" rel="tag">firefox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/" rel="tag">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geohash/" rel="tag">geohash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/geomesa/" rel="tag">geomesa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitlab/" rel="tag">gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/" rel="tag">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/groovy/" rel="tag">groovy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/" rel="tag">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hbase/" rel="tag">hbase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/idea/" rel="tag">idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ip/" rel="tag">ip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/junit/" rel="tag">junit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jupyter/" rel="tag">jupyter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jupyterhub/" rel="tag">jupyterhub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/" rel="tag">jvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jwt/" rel="tag">jwt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/" rel="tag">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/katalon/" rel="tag">katalon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/keepalived/" rel="tag">keepalived</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/latex/" rel="tag">latex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/" rel="tag">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-kernel/" rel="tag">linux kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/load-balance/" rel="tag">load balance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log/" rel="tag">log</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log4j/" rel="tag">log4j</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log4j12/" rel="tag">log4j12</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logback/" rel="tag">logback</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lombok/" rel="tag">lombok</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lru/" rel="tag">lru</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lucene/" rel="tag">lucene</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/magnet/" rel="tag">magnet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/make/" rel="tag">make</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/makefile/" rel="tag">makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manjaro/" rel="tag">manjaro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/" rel="tag">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/md5/" rel="tag">md5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mhtml/" rel="tag">mhtml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/microservice/" rel="tag">microservice</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/" rel="tag">music</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/notebook/" rel="tag">notebook</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nvidia/" rel="tag">nvidia</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oauth/" rel="tag">oauth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/optimization/" rel="tag">optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pandas/" rel="tag">pandas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pandoc/" rel="tag">pandoc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pgsql/" rel="tag">pgsql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/probability/" rel="tag">probability</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyspark/" rel="tag">pyspark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/quartz/" rel="tag">quartz</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/resource/" rel="tag">resource</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/review/" rel="tag">review</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sbt/" rel="tag">sbt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/" rel="tag">scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/slf4j/" rel="tag">slf4j</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/" rel="tag">spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-boot/" rel="tag">spring-boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlserver/" rel="tag">sqlserver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/statistics/" rel="tag">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/syslog/" rel="tag">syslog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/term/" rel="tag">term</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/texlive/" rel="tag">texlive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thread/" rel="tag">thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/" rel="tag">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/" rel="tag">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/urban-computing/" rel="tag">urban computing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/video/" rel="tag">video</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vpn/" rel="tag">vpn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-dav/" rel="tag">web-dav</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/week/" rel="tag">week</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wordcloud/" rel="tag">wordcloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/work/" rel="tag">work</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/" rel="tag">xml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zipkin/" rel="tag">zipkin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/" rel="tag">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="tag">云计算</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%83%E7%BC%96%E7%A8%8B/" rel="tag">元编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%8E%E5%B8%82%E8%AE%A1%E7%AE%97/" rel="tag">城市计算</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A6%82%E5%BF%B5/" rel="tag">概念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag">运维</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AI/" style="font-size: 10.53px;">AI</a> <a href="/tags/UI-test/" style="font-size: 10px;">UI test</a> <a href="/tags/algorithm/" style="font-size: 10.53px;">algorithm</a> <a href="/tags/android/" style="font-size: 10.53px;">android</a> <a href="/tags/annotation/" style="font-size: 10px;">annotation</a> <a href="/tags/ansible/" style="font-size: 13.16px;">ansible</a> <a href="/tags/ant/" style="font-size: 10px;">ant</a> <a href="/tags/aop/" style="font-size: 10px;">aop</a> <a href="/tags/archiva/" style="font-size: 10px;">archiva</a> <a href="/tags/asciidoc/" style="font-size: 10px;">asciidoc</a> <a href="/tags/awk/" style="font-size: 10px;">awk</a> <a href="/tags/axios/" style="font-size: 10px;">axios</a> <a href="/tags/basic/" style="font-size: 13.16px;">basic</a> <a href="/tags/big-data/" style="font-size: 10.53px;">big data</a> <a href="/tags/blockchain/" style="font-size: 10px;">blockchain</a> <a href="/tags/centos/" style="font-size: 12.11px;">centos</a> <a href="/tags/cglib/" style="font-size: 10px;">cglib</a> <a href="/tags/checkstyle/" style="font-size: 10px;">checkstyle</a> <a href="/tags/chrome/" style="font-size: 11.05px;">chrome</a> <a href="/tags/computer-principle/" style="font-size: 10px;">computer principle</a> <a href="/tags/cors/" style="font-size: 10.53px;">cors</a> <a href="/tags/data-structure/" style="font-size: 10px;">data structure</a> <a href="/tags/design-pattern/" style="font-size: 10.53px;">design-pattern</a> <a href="/tags/docker/" style="font-size: 17.89px;">docker</a> <a href="/tags/elasticsearch/" style="font-size: 13.16px;">elasticsearch</a> <a href="/tags/es/" style="font-size: 10px;">es</a> <a href="/tags/eureka/" style="font-size: 10px;">eureka</a> <a href="/tags/firefox/" style="font-size: 10px;">firefox</a> <a href="/tags/flask/" style="font-size: 10px;">flask</a> <a href="/tags/geohash/" style="font-size: 10px;">geohash</a> <a href="/tags/geomesa/" style="font-size: 10px;">geomesa</a> <a href="/tags/git/" style="font-size: 13.16px;">git</a> <a href="/tags/gitlab/" style="font-size: 11.05px;">gitlab</a> <a href="/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/tags/groovy/" style="font-size: 10px;">groovy</a> <a href="/tags/hadoop/" style="font-size: 10.53px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 11.58px;">hbase</a> <a href="/tags/hexo/" style="font-size: 10.53px;">hexo</a> <a href="/tags/html/" style="font-size: 10.53px;">html</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/idea/" style="font-size: 11.05px;">idea</a> <a href="/tags/ip/" style="font-size: 10px;">ip</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/javascript/" style="font-size: 11.58px;">javascript</a> <a href="/tags/js/" style="font-size: 13.16px;">js</a> <a href="/tags/junit/" style="font-size: 10px;">junit</a> <a href="/tags/jupyter/" style="font-size: 10px;">jupyter</a> <a href="/tags/jupyterhub/" style="font-size: 10.53px;">jupyterhub</a> <a href="/tags/jvm/" style="font-size: 10px;">jvm</a> <a href="/tags/jwt/" style="font-size: 10px;">jwt</a> <a href="/tags/k8s/" style="font-size: 11.05px;">k8s</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/katalon/" style="font-size: 10px;">katalon</a> <a href="/tags/keepalived/" style="font-size: 10.53px;">keepalived</a> <a href="/tags/latex/" style="font-size: 11.05px;">latex</a> <a href="/tags/life/" style="font-size: 18.95px;">life</a> <a href="/tags/linux/" style="font-size: 19.47px;">linux</a> <a href="/tags/linux-kernel/" style="font-size: 10px;">linux kernel</a> <a href="/tags/load-balance/" style="font-size: 10px;">load balance</a> <a href="/tags/log/" style="font-size: 10px;">log</a> <a href="/tags/log4j/" style="font-size: 10px;">log4j</a> <a href="/tags/log4j12/" style="font-size: 10px;">log4j12</a> <a href="/tags/logback/" style="font-size: 10px;">logback</a> <a href="/tags/lombok/" style="font-size: 10px;">lombok</a> <a href="/tags/lru/" style="font-size: 10px;">lru</a> <a href="/tags/lucene/" style="font-size: 10px;">lucene</a> <a href="/tags/magnet/" style="font-size: 10px;">magnet</a> <a href="/tags/make/" style="font-size: 10px;">make</a> <a href="/tags/makefile/" style="font-size: 10px;">makefile</a> <a href="/tags/manjaro/" style="font-size: 10px;">manjaro</a> <a href="/tags/math/" style="font-size: 11.05px;">math</a> <a href="/tags/maven/" style="font-size: 15.26px;">maven</a> <a href="/tags/md5/" style="font-size: 10px;">md5</a> <a href="/tags/mhtml/" style="font-size: 10px;">mhtml</a> <a href="/tags/microservice/" style="font-size: 14.21px;">microservice</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/mybatis/" style="font-size: 11.05px;">mybatis</a> <a href="/tags/mysql/" style="font-size: 12.11px;">mysql</a> <a href="/tags/nginx/" style="font-size: 12.63px;">nginx</a> <a href="/tags/notebook/" style="font-size: 10px;">notebook</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/nvidia/" style="font-size: 10px;">nvidia</a> <a href="/tags/oauth/" style="font-size: 10px;">oauth</a> <a href="/tags/openstack/" style="font-size: 12.11px;">openstack</a> <a href="/tags/optimization/" style="font-size: 10px;">optimization</a> <a href="/tags/pandas/" style="font-size: 10px;">pandas</a> <a href="/tags/pandoc/" style="font-size: 10px;">pandoc</a> <a href="/tags/pgsql/" style="font-size: 11.58px;">pgsql</a> <a href="/tags/probability/" style="font-size: 10px;">probability</a> <a href="/tags/pyspark/" style="font-size: 10px;">pyspark</a> <a href="/tags/python/" style="font-size: 17.37px;">python</a> <a href="/tags/quartz/" style="font-size: 10.53px;">quartz</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/redis/" style="font-size: 15.79px;">redis</a> <a href="/tags/resource/" style="font-size: 10px;">resource</a> <a href="/tags/review/" style="font-size: 10px;">review</a> <a href="/tags/sbt/" style="font-size: 10px;">sbt</a> <a href="/tags/scala/" style="font-size: 14.74px;">scala</a> <a href="/tags/shell/" style="font-size: 12.63px;">shell</a> <a href="/tags/slf4j/" style="font-size: 10px;">slf4j</a> <a href="/tags/spark/" style="font-size: 14.74px;">spark</a> <a href="/tags/spring/" style="font-size: 15.79px;">spring</a> <a href="/tags/spring-cloud/" style="font-size: 12.11px;">spring cloud</a> <a href="/tags/spring-boot/" style="font-size: 13.68px;">spring-boot</a> <a href="/tags/springboot/" style="font-size: 11.05px;">springboot</a> <a href="/tags/sql/" style="font-size: 11.05px;">sql</a> <a href="/tags/sqlserver/" style="font-size: 10.53px;">sqlserver</a> <a href="/tags/ssh/" style="font-size: 12.11px;">ssh</a> <a href="/tags/statistics/" style="font-size: 10px;">statistics</a> <a href="/tags/syslog/" style="font-size: 10px;">syslog</a> <a href="/tags/term/" style="font-size: 10px;">term</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/texlive/" style="font-size: 10px;">texlive</a> <a href="/tags/thread/" style="font-size: 10px;">thread</a> <a href="/tags/tomcat/" style="font-size: 13.16px;">tomcat</a> <a href="/tags/tool/" style="font-size: 16.84px;">tool</a> <a href="/tags/ubuntu/" style="font-size: 16.32px;">ubuntu</a> <a href="/tags/urban-computing/" style="font-size: 10px;">urban computing</a> <a href="/tags/video/" style="font-size: 10px;">video</a> <a href="/tags/vim/" style="font-size: 10.53px;">vim</a> <a href="/tags/vpn/" style="font-size: 10px;">vpn</a> <a href="/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/tags/vue/" style="font-size: 11.05px;">vue</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/web-dav/" style="font-size: 10px;">web-dav</a> <a href="/tags/webpack/" style="font-size: 10.53px;">webpack</a> <a href="/tags/week/" style="font-size: 18.42px;">week</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/wordcloud/" style="font-size: 10px;">wordcloud</a> <a href="/tags/work/" style="font-size: 10px;">work</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a> <a href="/tags/zipkin/" style="font-size: 10px;">zipkin</a> <a href="/tags/zookeeper/" style="font-size: 10px;">zookeeper</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 12.63px;">云计算</a> <a href="/tags/%E5%85%83%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">元编程</a> <a href="/tags/%E5%9F%8E%E5%B8%82%E8%AE%A1%E7%AE%97/" style="font-size: 10px;">城市计算</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">架构</a> <a href="/tags/%E6%A6%82%E5%BF%B5/" style="font-size: 10px;">概念</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">测试</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">爬虫</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">运维</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/03/31/redis/000-redis-interview/">Redis面试总结202203</a>
          </li>
        
          <li>
            <a href="/2019/10/27/maven/009-maven-deploy/">使用IDEA部署jar包到maven仓库(maven deploy)</a>
          </li>
        
          <li>
            <a href="/2019/10/24/java/075-pluggable-annotation-processing-lombok/">Pluggable Annotation Processing的讲解与实践</a>
          </li>
        
          <li>
            <a href="/2019/10/18/life/036-weekly-learn/">2019-42-周报</a>
          </li>
        
          <li>
            <a href="/2019/10/15/shell/003-carriage-linechange/">r command not found</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Jackpler<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">home</a>
  
    <a href="/archives" class="mobile-nav-link">archives</a>
  
    <a href="/about" class="mobile-nav-link">about</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>