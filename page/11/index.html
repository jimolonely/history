<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-111673440-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>在我的世界</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="who,where,what">
<meta property="og:type" content="website">
<meta property="og:title" content="在我的世界">
<meta property="og:url" content="http://jimolonely.github.io/history/page/11/index.html">
<meta property="og:site_name" content="在我的世界">
<meta property="og:description" content="who,where,what">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Jackpler">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/history/atom.xml" title="在我的世界" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/history/css/style.css">

<meta name="generator" content="Hexo 6.1.0"><link rel="stylesheet" href="/history/css/prism-atom-dark.css" type="text/css">
<link rel="stylesheet" href="/history/css/prism-line-numbers.css" type="text/css"><script src="/history/js/prism.js"></script>
<script src="/history/js/prism-line-numbers.min.js"></script></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/history/" id="logo">在我的世界</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/history/">home</a>
        
          <a class="main-nav-link" href="/history/archives">archives</a>
        
          <a class="main-nav-link" href="/history/about">about</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/history/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://jimolonely.github.io/history"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-java/022-jvm-monitor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/11/29/java/022-jvm-monitor/" class="article-date">
  <time datetime="2018-11-29T09:28:32.000Z" itemprop="datePublished">2018-11-29</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/11/29/java/022-jvm-monitor/">java JVM 监控</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本文涉及JVM工具的使用，命令行参数使用。</p>
<p>命令行参数：<a target="_blank" rel="noopener" href="https://gist.github.com/rafaeltuelho/f3334d3526bdb0e6d3f2cc41a79e0523">https://gist.github.com/rafaeltuelho/f3334d3526bdb0e6d3f2cc41a79e0523</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本文涉及JVM工具的使用，命令行参数使用。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/11/29/java/022-jvm-monitor/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/11/29/java/022-jvm-monitor/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/11/29/java/022-jvm-monitor/" data-id="cl1fw7fl0009tvkd3505l8gj6" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-linux/017-ubuntu-wallpaper-slide" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/11/27/linux/017-ubuntu-wallpaper-slide/" class="article-date">
  <time datetime="2018-11-26T23:48:55.000Z" itemprop="datePublished">2018-11-27</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/11/27/linux/017-ubuntu-wallpaper-slide/">ubuntu设置桌面背景幻灯片</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>定时切换ubuntu18.04 桌面幻灯片。</p>
<p>使用自带工具Shotwell即可。</p>
<p>选中所有图片—》文件—》set as desktop slideshow.</p>
<p><a target="_blank" rel="noopener" href="http://ubuntuhandbook.org/index.php/2018/07/4-wallpaper-changer-ubuntu-18-04/">4种方法设置</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>定时切换ubuntu18.04 桌面幻灯片。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/11/27/linux/017-ubuntu-wallpaper-slide/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/11/27/linux/017-ubuntu-wallpaper-slide/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/11/27/linux/017-ubuntu-wallpaper-slide/" data-id="cl1fw7fml00fhvkd38fgdczdo" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/linux/" rel="tag">linux</a><span class="article-tag-list-count">57</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/ubuntu/" rel="tag">ubuntu</a><span class="article-tag-list-count">13</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-life/003-work-ready" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/11/26/life/003-work-ready/" class="article-date">
  <time datetime="2018-11-26T12:11:26.000Z" itemprop="datePublished">2018-11-26</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/11/26/life/003-work-ready/">begin to work</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>how to quickly begin to work?</p>
<h1 id="openvpn"><a href="#openvpn" class="headerlink" title="openvpn"></a>openvpn</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt install openvpn</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把config目录拷过来</span></span><br><span class="line"></span><br><span class="line">sudo openvpn --config client-lenovo.ovpn</span><br></pre></td></tr></table></figure>

<h1 id="navicat"><a href="#navicat" class="headerlink" title="navicat"></a>navicat</h1><ol>
<li><p>下载解压</p>
</li>
<li><p>解决中文乱码问题:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41376740/article/details/80499545">blog</a></p>
</li>
</ol>
<h1 id="配置gitlab-ssh"><a href="#配置gitlab-ssh" class="headerlink" title="配置gitlab ssh"></a>配置gitlab ssh</h1><h1 id="下载项目并导入"><a href="#下载项目并导入" class="headerlink" title="下载项目并导入"></a>下载项目并导入</h1><p>记得切换分支i后再pull一下，保持最新代码。</p>
<h1 id="IDEA-配置"><a href="#IDEA-配置" class="headerlink" title="IDEA 配置"></a>IDEA 配置</h1><ol>
<li>给IDEA安装阿里的插件。</li>
<li>注释模板</li>
<li>修改快捷键（alt+w）</li>
</ol>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>how to quickly begin to work?</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/11/26/life/003-work-ready/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/11/26/life/003-work-ready/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/11/26/life/003-work-ready/" data-id="cl1fw7fjy0066vkd347hocwy2" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/life/" rel="tag">life</a><span class="article-tag-list-count">32</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/work/" rel="tag">work</a><span class="article-tag-list-count">1</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-life/002-just-forward" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/11/22/life/002-just-forward/" class="article-date">
  <time datetime="2018-11-22T00:54:48.000Z" itemprop="datePublished">2018-11-22</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/11/22/life/002-just-forward/">只是向前</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>在一个早上，我突然自己内心狂躁。</p>
<p>我的眼里只有前方，已经懒得回头看一看身后，我曾经学过的，曾经放下的，曾经想要的，曾经得不到的。</p>
<p>然而，在紧张的生活进程里，如果回过头，会发现以前学过的忘了，曾经放下的还可以拿起，曾经想要的得到了，曾经得不到的也不想要了。</p>
<p>回头看，这是个反思的过程，这是个总结的过程，我已经失去了过目不忘的本领，过了一日千里的学习能力，我剩下的只是经验的沉淀，加上自己的判断原则，我依然保持着对世间万物的批判，却已经没有改变他们的勇气。</p>
<p>好多事情都在走回头路，发展的速度跟不上满足人们好奇心的速度，所以将以前的东西包装一下，人们也会愚蠢地被吸引，偶尔有人犹豫了一下，但也懒得思考了。在这个碎片化地信息时代，人们懒得思考了。</p>
<p>一直向前不可避免，但不能阻止我的倒退。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>在一个早上，我突然自己内心狂躁。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/11/22/life/002-just-forward/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/11/22/life/002-just-forward/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/11/22/life/002-just-forward/" data-id="cl1fw7fjy0065vkd3aab48bko" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/life/" rel="tag">life</a><span class="article-tag-list-count">32</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-basic/004-microservices-martin-flower" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/11/15/basic/004-microservices-martin-flower/" class="article-date">
  <time datetime="2018-11-15T00:56:46.000Z" itemprop="datePublished">2018-11-15</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/11/15/basic/004-microservices-martin-flower/">微服务-martin fowler</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本文翻译自<a target="_blank" rel="noopener" href="https://martinfowler.com/articles/microservices.html">Martin Fowler的微服务</a></p>
<p>“微服务” - 在拥挤的软件架构街道上又一个新名词。 虽然我们的自然倾向是通过轻蔑的眼神传递这些东西，但这一点术语描述了我们发现越来越有吸引力的软件系统风格。 我们已经看到许多项目在过去几年中使用了这种风格，到目前为止的结果是积极的，以至于对于我们的许多同事而言，这已经成为构建企业应用程序的默认样式。 然而，遗憾的是，没有太多信息可以概述微服务的风格以及如何实现。</p>
<p>简而言之，微服务架构风格[1]是一种将单个应用程序开发为一套小型服务的方法，每个小型服务都在自己的进程中运行，并用轻量级机制（通常是HTTP资源API）进行通信。 这些服务围绕业务功能构建，可通过全自动部署机制独立部署。 这些服务至少可以集中管理，可以用不同的编程语言编写，并使用不同的数据存储技术。</p>
<p>为了开始解释微服务架构，将它与整体应用架构进行比较是有用的：作为单个整体构建的单片应用程序。 企业应用程序通常由三个主要部分构成：客户端用户界面（由用户机器上的浏览器中运行的HTML页面和javascript组成）数据库（由插入到公共数据库管理中的许多表组成，通常是关系数据库管理系统）和服务器端应用程序。 服务器端应用程序将处理HTTP请求，执行逻辑，从数据库检索和更新数据，以及选择和填充要发送到浏览器的HTML视图。 这个服务器端应用程序是一个整体 - 一个逻辑可执行文件[2]。 对系统的任何更改都涉及构建和部署新版本的服务器端应用程序。</p>
<p>这种单个服务器是构建这种系统的自然方式。 处理请求的所有逻辑都在一个进程中运行，允许您使用语言的基本功能将应用程序划分为类，函数和命名空间。 需要注意的是，您可以在开发人员的笔记本电脑上运行和测试应用程序，并使用部署管道确保对更改进行适当测试并将其部署到生产环境中。 您可以通过在负载均衡器后面运行许多实例来水平扩展整体。</p>
<p>单个应用程序可以取得成功，但越来越多的人对它们感到沮丧 - 特别是在将更多应用程序部署到云中时。 变更周期联系在一起 - 对应用程序的一小部分进行了更改，需要重建和部署整个整体。 随着时间的推移，通常很难保持良好的模块化结构，使得更难以保持应该只影响该模块中的一个模块的更改。 扩展需要扩展整个应用程序，而不是需要更多资源的部分。</p>
<img src="/2018/11/15/basic/004-microservices-martin-flower/000.png" class="">

<p>这些挫折导致产生了微服务架构风格：将应用程序构建为服务套件。 除了服务可独立部署和扩展的事实之外，每个服务还提供了一个牢固的模块边界，甚至允许以不同的编程语言编写不同的服务。 他们也可以由不同的团队管理。</p>
<p>我们并不认为微服务风格是新颖的或创新的，其根源至少可以归结为Unix的设计原则。 但我们认为没有足够的人考虑微服务架构，如果使用它们，许多软件开发会更好。</p>
<h1 id="微服务架构的特征"><a href="#微服务架构的特征" class="headerlink" title="微服务架构的特征"></a>微服务架构的特征</h1><p>我们不能说微服务架构风格有正式的定义，但我们可以尝试描述我们认为适合架构的共同特征。 与概述共同特征的任何定义一样，并非所有微服务架构都具有所有特征，但我们确实期望大多数微服务架构都具有大多数特征。 虽然我们的作者一直是这个相当宽松的社区的积极成员，但我们的目的是尝试描述我们在自己的工作中所看到的以及我们所知道的团队的类似努力。 特别是我们没有规定一些符合的定义。</p>
<h2 id="通过服务进行组件化"><a href="#通过服务进行组件化" class="headerlink" title="通过服务进行组件化"></a>通过服务进行组件化</h2><p>只要我们参与软件行业，就一直希望通过将组件集成在一起来构建系统，就像我们在物理世界中看到事物的方式一样。 在过去的几十年中，我们已经看到了大多数语言平台的大型公共库的大量进展。</p>
<p>在谈论组件时，我们遇到了定义组件的困难。 我们的定义是组件是可<strong>独立更换</strong>和<strong>升级</strong>的软件单元。</p>
<p>微服务架构会使用依赖库，但他们将自己的软件组件化的主要方式是分解为服务。 我们将库定义为链接到程序中并调用内存中函数的组件，而服务是与Web服务请求或RPC等机制进行通信的<strong>进程外组件</strong>。 （这与许多面向对象程序中的服务对象的概念不同[3]。）</p>
<p>将服务用作组件（而不是库）的一个主要原因是服务可以独立部署。 如果您在单个进程中有一个由多个库组成的应用程序[4]，则对任何单个组件的更改都会导致必须重新部署整个应用程序。 但是，如果将该应用程序分解为多个服务，您可以预期许多单个服务更改只需要重新部署该服务。 这不是绝对的，一些变化将改变服务接口，从而产生一些协调，但良好的微服务架构的目标是通过服务合同中的紧密服务边界和演化机制来最小化这些。</p>
<p>将服务用作组件的另一个结果是更明确的组件接口。 大多数语言没有用于定义<a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/PublishedInterface.html">显式发布接口</a>的良好机制。 通常，它只是文档和规程阻止客户端破坏组件的封装，导致组件之间过于紧密的耦合。 通过使用显式远程调用机制，服务可以更轻松地避免这种情况。</p>
<p>使用这样的服务确实有缺点。 远程调用比进程内调用更昂贵，因此远程API需要更粗糙，这通常更难以使用。 如果您需要更改组件之间的职责分配，那么当您跨越流程边界时，这种行为的变化就更难。</p>
<p>在第一次近似中，我们可以观察到服务映射到运行时进程，但这只是第一次近似。 服务可能包含多个始终一起开发和部署的进程，例如应用程序进程和仅由该服务使用的数据库。</p>
<h2 id="围绕业务功能进行组织"><a href="#围绕业务功能进行组织" class="headerlink" title="围绕业务功能进行组织"></a>围绕业务功能进行组织</h2><p>在将大型应用程序拆分为多个部分时，通常管理侧重于技术层，从而导致UI团队，服务器端逻辑团队和数据库团队。 当团队按照这些方式分开时，即使是简单的更改也可能导致跨团队项目需要时间和预算批准。 一个聪明的团队将围绕这个进行优化，并为两个恶魔中的较小者提供丰富的优势 - 只需将逻辑强制应用到他们可以访问的任何应用程序中。 换句话说，逻辑无处不在。 这是康威定律[5]的一个例子。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">设计系统（广泛定义）的任何组织都将产生一种设计，其结构是组织通信结构的副本。</span><br><span class="line"></span><br><span class="line">- Melvyn Conway，1967年</span><br></pre></td></tr></table></figure>
<img src="/2018/11/15/basic/004-microservices-martin-flower/001.png" class="">

<p>微服务通过围绕业务功能组织来划分服务的方法是不同的。 此类服务为该业务领域采用广泛的软件实现，包括用户界面，持久存储和任何外部协作。 因此，团队是跨职能的，包括开发所需的全部技能：用户体验，数据库和项目管理。</p>
<img src="/2018/11/15/basic/004-microservices-martin-flower/002.png" class="">

<p>以这种方式组建的一家公司是 <a href="www.comparethemarket.com">www.comparethemarket.com</a>。 跨职能团队负责构建和运营每个产品，每个产品分为多个通过消息总线进行通信的单独服务。</p>
<p>大型单片应用程序也可以围绕业务功能进行模块化，尽管这不是常见的情况。 当然，我们会敦促一个庞大的团队构建一个单一的应用程序，以便沿着业务线划分自己。 我们在这里看到的主要问题是，它们往往围绕太多的背景进行组织。 如果整体跨越许多这些模块化边界，团队的个别成员可能难以将它们装入短期记忆中。 此外，我们看到模块化生产线需要大量的纪律来执行。 服务组件所需的更明确的分离使得更容易保持团队边界清晰。</p>
<h2 id="产品不是项目"><a href="#产品不是项目" class="headerlink" title="产品不是项目"></a>产品不是项目</h2><p>我们看到的大多数应用程序开发工作都使用项目模型：其目的是提供一些软件然后被认为是完成的。 完成后，软件将移交给维护组织，构建它的项目团队将被解散。</p>
<p>微服务支持者倾向于避免使用这种模式，而更倾向于认为团队应该在其整个生命周期内拥有产品。 对此的一个共同启示是亚马逊的<a target="_blank" rel="noopener" href="https://queue.acm.org/detail.cfm?id=1142065">“你构建，运行它”</a>的概念，开发团队对生产中的软件负全部责任。 这使开发人员能够日常接触他们的软件在生产中的行为，并增加与用户的联系，因为他们必须承担至少一些支持负担。</p>
<p>产品心态，与业务能力的联系紧密相连。 不是将软件视为一组要完成的功能，而是存在一种持续的关系，其中的问题是软件如何帮助其用户增强业务能力。</p>
<p>没有理由为什么这种方法不能与单一应用程序一起使用，但较小的服务粒度可以使创建服务开发人员与其用户之间的个人关系变得更加容易。</p>
<h2 id="智能endpoints和dump-pipes"><a href="#智能endpoints和dump-pipes" class="headerlink" title="智能endpoints和dump pipes"></a>智能endpoints和dump pipes</h2><p>在不同进程之间建立沟通结构时，我们已经看到许多产品和方法都强调将重要的智慧放入沟通机制本身。 一个很好的例子是企业服务总线（ESB），其中ESB产品通常包括用于消息路由，编排，转换和应用业务规则的复杂工具。</p>
<p>微服务社区倾向于采用另一种方法：智能endpoints和dump pipes。 从微服务构建的应用程序旨在尽可能地分离和内聚 - 它们拥有自己的域逻辑，并且更像是传统Unix意义上的过滤器 - 接收请求，适当地应用逻辑并产生响应。 这些是使用简单的RESTish协议而不是复杂的协议（如WS-Choreography或BPEL或中央工具的编排）编排的。</p>
<p>最常用的两种协议是带有资源API的HTTP请求-响应 和 轻量级消息传递[8]。 第一个最好的表达方式是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">成为网络，而不是在网络后面</span><br><span class="line"></span><br><span class="line">- 伊恩罗宾逊</span><br></pre></td></tr></table></figure>
<p>微服务团队使用万维网（在很大程度上，Unix）构建的原则和协议。 经常使用的资源可以通过开发人员或操作人员的非常小的努力来缓存。</p>
<p>常用的第二种方法是通过轻量级消息总线进行消息传递。 所选择的基础设施通常是愚蠢的（如同仅作为消息路由器那样愚蠢） - 诸如RabbitMQ或ZeroMQ之类的简单实现除了提供可靠的异步结构之外没有多大作用 - 智能仍然存在于生产和 消费信息; 在服务中。</p>
<p>在整体应用中，组件在进程中执行，它们之间的通信是通过方法调用或函数调用。 将整体变为微服务的最大问题在于改变通信模式。 从内存中方法调用到RPC的简单转换会导致繁琐的通信无法正常执行。 相反，您需要用粗粒度的方法替换细粒度的通信。</p>
<h2 id="去中心化治理"><a href="#去中心化治理" class="headerlink" title="去中心化治理"></a>去中心化治理</h2><p>集中治理的后果之一是在单一技术平台上实现标准化的趋势。 经验表明，这种方法是有限的 - 并非每个问题都是钉子而不是每个解决方案都是锤子。 我们更喜欢使用正确的工具来完成工作，而单片应用程序可以在一定程度上利用不同的语言，但这并不常见。</p>
<p>将整体应用的组件拆分为服务，我们可以在构建每个组件时做出选择。 您想使用Node.js站立一个简单的报告页面吗？ 去吧。 C++是否适用于特别近乎实时的组件？ 精细。 您想要交换不同风格的数据库，以更好地适应一个组件的读取行为？ 我们有重建他的技术。</p>
<p>当然，仅仅因为你可以做某事，并不意味着你应该 - 但以这种方式对系统进行划分意味着你可以选择。</p>
<p>构建微服务的团队也更喜欢采用不同的标准方法。 他们不是使用在纸上某处写下的一组定义标准，而是更愿意生成有用的工具，其他开发人员可以使用它来解决与他们面临的类似问题。 这些工具通常从实现中收集并与更广泛的组共享，有时不仅仅是使用内部开源模型。 现在git和github已成为事实上的版本控制系统，开源实践在内部变得越来越普遍。</p>
<p>Netflix是遵循这一理念的一个很好的例子。 共享有用的，尤其是经过实战考验的代码，因为库鼓励其他开发人员以类似的方式解决类似的问题，但如果需要，可以选择不同的方法。 共享库往往侧重于数据存储，进程间通信的常见问题，我们将在下面进一步讨论基础架构自动化。</p>
<p>对于微服务社区来说，管理费用特别缺乏吸引力。这并不是说社区不重视服务合同。恰恰相反，因为往往会有更多。只是他们正在寻找管理这些合同的不同方式。<a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/TolerantReader.html">容忍阅读器</a>和<a target="_blank" rel="noopener" href="https://martinfowler.com/articles/consumerDrivenContracts.html">消费者驱动合同</a>等模式通常应用于微服务。这些援助服务合同独立发展。在构建过程中执行消费者驱动的合同可以增强信心并快速反馈您的服务是否正常运行。事实上，我们知道澳大利亚的一个团队通过消费者驱动的合同推动新服务的建设。他们使用简单的工具，允许他们定义服务的合同。在编写新服务的代码之前，这将成为自动构建的一部分。然后，该服务仅在满足合同的情况下构建 - 这是在构建新软件时避免’YAGNI’(“YAGNI”或“You Aren’t Going To Need It 你不会需要它”是一个XP原则和劝告，直到你知道你需要它们才能添加功能) 困境的优雅方法。这些技术和围绕它们成长的工具通过减少服务之间的时间耦合来限制中央合同管理的需要。</p>
<p>也许分散治理的最高点是由亚马逊推广的精神建立&#x2F;运行它。 团队负责他们构建的软件的所有方面，包括全天候运行软件。 放弃这种责任水平绝对不是常态，但我们确实看到越来越多的公司将责任推向开发团队。 Netflix是另一个采用这种精神的组织[11]。 每天晚上凌晨3点被您的手机唤醒肯定是在编写代码时注重质量的强大动力。 这些想法与传统的集中治理模式相差甚远。</p>
<h2 id="去中心化数据管理"><a href="#去中心化数据管理" class="headerlink" title="去中心化数据管理"></a>去中心化数据管理</h2><p>数据管理的分散化以多种不同的方式呈现。 在最抽象的层面上，它意味着世界的概念模型在不同系统之间会有所不同。 这是在大型企业中集成时的常见问题，客户的销售视图将与支持视图不同。 销售视图中称为客户的某些内容可能根本不会出现在支持视图中。 那些做的可能具有不同的属性和（更糟糕的）具有微妙不同语义的共同属性。</p>
<p>此问题在应用程序之间很常见，但也可能在应用程序中发生，特别是当该应用程序分为单独的组件时。 一种有用的思考方式是<a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/BoundedContext.html">有界上下文</a> 的领域驱动设计概念。 DDD将复杂域划分为多个有界上下文，并映射出它们之间的关系。 此过程对单片和微服务体系结构都很有用，但服务和上下文边界之间存在自然关联，这有助于澄清，正如我们在业务功能部分中所述，强化了分离。</p>
<p>除了关于概念模型的分散决策之外，微服务还分散了数据存储决策。 虽然单一应用程序更喜欢单个逻辑数据库来存储持久性数据，但企业通常更喜欢跨越一系列应用程序的单个数据库 - 其中许多决策是通过供应商围绕许可的商业模型来实现的。 微服务更喜欢让每个服务管理自己的数据库，可以是相同数据库技术的不同实例，也可以是完全不同的数据库系统 - 这种方法称为<a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/PolyglotPersistence.html">多语言持久性(Polyglot Persistence)</a>。 您可以在整体应用中使用多语言持久性，但它在微服务中更常出现。</p>
<img src="/2018/11/15/basic/004-microservices-martin-flower/003.png" class="">

<p>跨微服务的分散数据对数据更新有影响。 处理更新的常用方法是在更新多个资源时使用事务来保证一致性。 这种方法通常用于整体结构中。</p>
<p>使用这样的事务有助于保持一致性，但会产生显着的时间耦合，这在多个服务中是有问题的。 众所周知，分布式事务很难实现，因此微服务架构<a target="_blank" rel="noopener" href="http://www.eaipatterns.com/ramblings/18_starbucks.html">强调服务之间的无事务协调</a>，明确认识到一致性可能只是最终的一致性，而问题是通过补偿操作来处理的。</p>
<p>选择以这种方式管理数据不一致 是许多开发团队面临的新挑战，但它通常与业务实践相匹配。 企业通常会处理一定程度的不一致，以便快速响应需求，同时采取某种逆转流程来应对错误。 只要修复错误的成本低于在更大的一致性下丢失业务的成本，那么权衡是值得的。</p>
<h2 id="基础设施自动化"><a href="#基础设施自动化" class="headerlink" title="基础设施自动化"></a>基础设施自动化</h2><p>基础设施自动化技术在过去几年中发生了巨大变化 - 特别是云和AWS的发展降低了构建、部署和运行微服务的操作复杂性。</p>
<p>许多使用微服务构建的产品或系统都是由具有丰富的<a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/ContinuousDelivery.html">持续交付</a>和其前身<a target="_blank" rel="noopener" href="https://martinfowler.com/articles/continuousIntegration.html">持续集成</a>经验的团队构建的。 以这种方式构建软件的团队广泛使用基础设施自动化技术。 这在下面显示的构建管道中说明。</p>
<img src="/2018/11/15/basic/004-microservices-martin-flower/004.png" class="">

<p>由于这不是关于持续交付的文章，我们将在这里注意几个关键功能。 我们希望尽可能多的信心，我们的软件正在运行，因此我们运行了大量的<strong>自动化测试</strong>。 软件“向上”的管道意味着我们自动部署到每个新环境。</p>
<p>通过这些环境，整个应用程序将非常开心地构建、测试并推动。 事实证明，一旦你投资自动化的生产之路，那么部署更多应用程序似乎不再那么可怕了。 请记住，CD的目标之一就是使部署无聊，所以无论是一个还是三个应用程序，只要它仍然无聊就无所谓[12]。</p>
<p>我们看到团队使用广泛的基础设施自动化的另一个领域是管理生产中的微服务。 与我们上面的断言相反，只要部署很无聊，整体和微服务之间没有太大的区别，每个部署的运营环境可能会截然不同。</p>
<img src="/2018/11/15/basic/004-microservices-martin-flower/005.png" class="">

<h2 id="设计失败处理"><a href="#设计失败处理" class="headerlink" title="设计失败处理"></a>设计失败处理</h2><p>使用服务作为组件的结果是，需要设计程序让它们能够容忍服务的失败。 由于供应者不可用，任何服务调用都可能失败，客户必须尽可能优雅地对此做出响应。 与单片设计相比，这是一个缺点，因为它引入了额外的复杂性来处理它。 结果是微服务团队不断反思服务失败如何影响用户体验。 Netflix的Simian Army在工作日引发服务甚至数据中心的故障，以测试应用程序的弹性和监控。</p>
<p>生产中的这种自动化测试足以让大多数操作组在休息一周之前就会出现这种情绪。 这并不是说整体式建筑风格不具备复杂的监控设置 - 在我们的经验中它不常见。</p>
<p>由于服务可能随时发生故障，因此能够快速检测故障并在可能的情况下自动恢复服务非常重要。 微服务应用程序非常重视应用程序的实时监控，检查架构元素（数据库每秒获得多少请求）和业务相关度量（例如每分钟收到多少订单）。 语义监控可以提供出现问题的早期预警系统，从而触发开发团队跟进和调查。</p>
<p>这对于微服务架构尤为重要，因为微服务对编排和<a target="_blank" rel="noopener" href="https://martinfowler.com/eaaDev/EventCollaboration.html">事件协作</a> 的偏好会导致紧急行为。 虽然许多权威人士赞扬偶然出现的价值，但事实是，新兴行为有时可能是一件坏事。 监控对于快速发现不良紧急行为至关重要，因此可以修复。</p>
<p>整体结构可以像微服务一样透明 - 事实上，它们应该是。 不同之处在于您绝对需要知道在不同进程中运行的服务何时断开连接。 对于同一过程中的库，这种透明性不太可能有用。</p>
<p>微服务团队希望看到针对每个服务的复杂监控和日志记录设置，例如显示上&#x2F;下状态的仪表板以及各种运营和业务相关指标。 有关断路器状态，当前吞吐量和延迟的详细信息是我们经常遇到的其他示例。</p>
<h2 id="进化设计"><a href="#进化设计" class="headerlink" title="进化设计"></a>进化设计</h2><p>微服务从业者通常来自进化设计背景，并将服务分解视为进一步的工具，使应用程序开发人员能够控制应用程序中的更改， 而不会降低变更速度。 变更控制并不一定意味着改变 - 通过正确的态度和工具，您可以对软件进行频繁，快速和良好控制的更改。</p>
<p>每当您尝试将软件系统分解为组件时，您就面临着如何分割各个部分的决定 - 我们决定切割应用程序的原则是什么？ 组件的关键属性是独立替换和可升级性的概念[13]  - 这意味着我们寻找可以想象在不影响其协作者的情况下重写组件的点。 实际上，许多微服务组通过明确地期望许多服务被废弃而不是长期演变来进一步考虑这一点。</p>
<p>Guardian网站是一个设计和构建为整体的应用程序的一个很好的例子，但是在微服务方向上不断发展。 monolith仍然是网站的核心，但他们更喜欢通过构建使用monolith API的微服务来添加新功能。 这种方法对于本质上是临时的功能尤其方便，例如处理体育赛事的专用页面。 网站的这一部分可以使用快速开发语言快速组合在一起，并在事件结束后删除。 我们在金融机构看到过类似的方法，为市场机会增加新服务，并在几个月甚至几周后丢弃。</p>
<p>这种对可替换性的强调是模块化设计的更一般原则的一个特例， 即通过变化模式驱动模块化[14]。 您希望在同一模块中保持同时更改的内容。 很少变化的系统部分应该与目前正在经历大量流失的系统处于不同的服务中。 如果您发现自己反复更改两项服务，那就表明它们应该合并。</p>
<p>将组件放入服务中可以为更细粒度的发布计划添加机会。 对于整体，任何更改都需要完整构建和部署整个应用程序。 但是，使用微服务，您只需要重新部署您修改的服务。 这可以简化并加快发布过程。 缺点是您必须担心一项服务的变化会打破其消费者。 传统的集成方法是尝试使用版本控制来解决这个问题，但微服务世界中的偏好仅仅是<a target="_blank" rel="noopener" href="https://martinfowler.com/articles/enterpriseREST.html#versioning">使用版本控制作为最后的手段</a>。 我们可以通过设计服务尽可能容忍提供者的变化来避免大量的版本控制。</p>
<h1 id="微服务是未来吗？"><a href="#微服务是未来吗？" class="headerlink" title="微服务是未来吗？"></a>微服务是未来吗？</h1><p>我们写这篇文章的主要目的是解释微服务的主要思想和原则。 通过花时间来做到这一点，我们清楚地认为微服务架构风格是一个重要的想法 - 值得认真考虑企业应用程序。 我们最近使用这种方式构建了几个系统，并了解了其他使用和支持这种方法的人。</p>
<p>我们知道谁在某种程度上开创了这种架构风格，包括亚马逊，Netflix，卫报，英国政府数字服务，realestate.com.au，Forward和comparethemarket.com。 2013年的会议周充满了一些公司的例子，这些公司正在转向可以归类为微服务的公司 - 包括Travis CI。 此外，有很多组织长期以来一直在做我们称之为微服务的东西，但没有使用过这个名字。 （通常这被标记为SOA  - 尽管如我们所说，SOA有许多相互矛盾的形式。[15]）</p>
<p>然而，尽管有这些积极的经验，但我们并不认为我们确信微服务是软件架构的未来发展方向。 虽然到目前为止我们的经验与整体应用相比是积极的，但我们意识到没有足够的时间让我们做出充分的判断。</p>
<p>通常，您的架构决策的真正后果只有在您制作它们几年后才会明显。 我们已经看到一个项目，其中一个强大的团队，对模块化的强烈渴望，已经构建了一个多年来已经腐朽的单片架构。 许多人认为，微服务不太可能出现这种衰退，因为服务边界是明确的，很难修补。 然而，在我们看到足够的系统具有足够的年龄之前，我们无法真正评估微服务架构是如何成熟的。</p>
<p>人们可能会期望微服务成熟得很好。 在组件化的任何努力中，成功取决于软件在组件中的适用程度。 很难弄清楚组件边界的确切位置。 进化设计认识到正确边界的困难，因此很容易重构它们的重要性。 但是，当您的组件是具有远程通信的服务时，则重构比使用进程内库更难。 跨服务边界移动代码是困难的，任何接口更改都需要在参与者之间进行协调，需要添加向后兼容性层，并且测试变得更加复杂。</p>
<p>另一个问题是如果组件没有干净地组成，那么您所做的就是将复杂性从组件内部转移到组件之间的连接。 这不仅仅是移动复杂性，而是将其移动到一个不那么明确且难以控制的地方。 当你看到一个小而简单的组件内部时，很容易认为事情会更好，同时缺少服务之间的混乱连接。</p>
<p>最后，还有团队技能的因素。 新技术往往被更熟练的团队所采用。 但对于技能更高的团队来说，一种更有效的技术并不一定适用于技能较低的团队。 我们已经看到很多不太熟练的团队构建凌乱的单片架构，但是当微服务发生这种混乱时，需要花时间看看会发生什么。 一个糟糕的团队总是会创建一个糟糕的系统 - 很难说微服务是否可以减少这种情况下的混乱或使情况变得更糟。</p>
<p>我们听到的一个合理的论点是，您不应该从微服务架构开始。 而是<a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/MonolithFirst.html">从整体开始</a>，保持模块化，并在整体成为问题时将其拆分为微服务。 （虽然<a target="_blank" rel="noopener" href="https://martinfowler.com/articles/dont-start-monolith.html">这个建议并不理想</a>，但是好的进程内接口通常不是一个好的服务接口。）</p>
<p>所以我们谨慎乐观地写下这个。 到目前为止，我们已经看到了足够的微服务风格，觉得它可能是<a target="_blank" rel="noopener" href="https://martinfowler.com/microservices/">一条值得走的路</a>。 我们无法确定最终会在哪里结束，但软件开发的挑战之一是您只能根据您当前必须提供的不完善信息做出决策。</p>
<h1 id="旁注"><a href="#旁注" class="headerlink" title="旁注"></a>旁注</h1><h2 id="微服务有多大？"><a href="#微服务有多大？" class="headerlink" title="微服务有多大？"></a>微服务有多大？</h2><p>虽然“微服务”已经成为这种建筑风格的流行名称，但它的名字确实导致了对服务规模的不幸关注以及关于什么构成“微”的争论。 在我们与微服务从业者的对话中，我们看到了各种规模的服务。 报道的最大尺寸遵循亚马逊关于Two Pizza Team的概念（即整个团队可以由两个比萨饼喂养），意味着不超过十几个人。 在规模较小的规模上，我们已经看到了一个由六人组成的团队支持六项服务的设置。</p>
<p>这导致了这样的问题：在这个尺寸范围内是否存在足够大的差异，即每个人的服务和每人服务的尺寸不应该集中在一个微服务标签下。 目前我们认为将它们组合在一起会更好，但当我们进一步探索这种风格时，我们肯定会改变主意。</p>
<h2 id="微服务和SOA"><a href="#微服务和SOA" class="headerlink" title="微服务和SOA"></a>微服务和SOA</h2><p>当我们谈到微服务时，一个常见的问题是这是否只是我们十年前看到的面向服务架构（SOA）。这一点有其优点，因为微服务风格与一些SOA倡导者非常相似。然而，问题是SOA意味着<a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/ServiceOrientedAmbiguity.html">太多不同的东西</a>，而且大多数时候我们遇到称为“SOA”的东西，它与我们在这里描述的样式有很大的不同，通常是因为我们专注于ESBs整合单片应用程序。</p>
<p>特别是我们已经看到了许多拙劣的服务导向实现 - 从隐藏ESB [6]中的复杂性的趋势，到耗资数百万并且没有价值的失败的多年计划，到积极抑制变化的集中治理模型，有时很难看到过去的这些问题。</p>
<p>当然，微服务社区中使用的许多技术都是从开发人员在大型组织中集成服务的经验中发展而来的。<a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/TolerantReader.html">容忍读者模式</a>就是一个例子。使用网络的努力做出了贡献，使用简单的协议是从这些经验中获得的另一种方法 - 远离中心标准的反应，这种标准已达到复杂性，<a target="_blank" rel="noopener" href="http://wiki.apache.org/ws/WebServiceSpecifications">坦率地说，令人惊叹</a>。 （只要你需要一个本体来管理你的本体，你就知道你遇到了很大的麻烦。）</p>
<p>SOA的这种常见表现导致一些微服务提倡者完全拒绝SOA标签，尽管其他人认为微服务是SOA的一种形式[7]，也许服务导向正确。无论哪种方式，SOA代表这些不同的事物 意味着有一个更清晰地定义这种建筑风格的术语是有价值的。</p>
<h2 id="许多语言，很多选择"><a href="#许多语言，很多选择" class="headerlink" title="许多语言，很多选择"></a>许多语言，很多选择</h2><p>JVM作为一个平台的发展只是在一个通用平台中混合语言的最新例子。 通常的做法是采用更高级别的语言来利用几十年来更高级别的抽象。 正如下降到裸机并将性能敏感代码写入较低级别的代码。 然而，许多整体应用不需要这种级别的性能优化，也不需要DSL和更高级别的抽象（令我们沮丧）。 相反，单一应用通常是单一语言，其趋势是限制使用的技术数量[10]。</p>
<h2 id="经过实战检验的标准和强制执行的标准"><a href="#经过实战检验的标准和强制执行的标准" class="headerlink" title="经过实战检验的标准和强制执行的标准"></a>经过实战检验的标准和强制执行的标准</h2><p>微服务团队倾向于避开企业架构小组制定的严格执行标准，但很乐意使用甚至传播HTTP，ATOM和其他微格式等开放标准的使用，这有点二分法。</p>
<p>关键的区别在于如何制定标准以及如何实施标准。 由IETF等团体管理的标准只有在更广泛的世界中有多个实时实施并且通常来自成功的开源项目时才成为标准。</p>
<p>这些标准与企业界的许多标准不同，它们通常由最近没有编程经验或受供应商过度影响的团体开发。</p>
<h2 id="做正确的事情很容易"><a href="#做正确的事情很容易" class="headerlink" title="做正确的事情很容易"></a>做正确的事情很容易</h2><p>我们发现由于持续交付和部署而增加自动化的一个副作用是创建有用的工具来帮助开发人员和操作人员。 用于创建人工制品，管理代码库，提供简单服务或添加标准监视和日志记录的工具现在非常普遍。 网上最好的例子可能是<a target="_blank" rel="noopener" href="http://netflix.github.io/">Netflix的开源工具集</a>，但还有其他一些，包括我们广泛使用的<a target="_blank" rel="noopener" href="http://dropwizard.codahale.com/">Dropwizard</a>。</p>
<h2 id="断路器和生产就绪代码"><a href="#断路器和生产就绪代码" class="headerlink" title="断路器和生产就绪代码"></a>断路器和生产就绪代码</h2><p><a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/CircuitBreaker.html">断路器</a>出现在 <a target="_blank" rel="noopener" href="https://www.amazon.com/gp/product/B00A32NXZO?ie=UTF8&tag=martinfowlerc-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=B00A32NXZO">Release It</a> 中，以及其他模式，如Bulkhead和Timeout。 这些模式一起实施，在构建通信应用程序时至关重要。 这篇<a target="_blank" rel="noopener" href="http://techblog.netflix.com/2012/02/fault-tolerance-in-high-volume.html">Netflix博客文章</a>很好地解释了它们的应用。</p>
<h2 id="同步调用被认为是有害的"><a href="#同步调用被认为是有害的" class="headerlink" title="同步调用被认为是有害的"></a>同步调用被认为是有害的</h2><p>每当您在服务之间进行多次同步调用时，您将遇到停机的乘法效应。 简而言之，这就是系统停机时间成为各个组件停机时间的产物。 您面临一个选择，使您的呼叫异步或管理停机时间。 在<a target="_blank" rel="noopener" href="http://www.guardian.co.uk,他们在新平台上实施了一个简单的规则/">www.guardian.co.uk，他们在新平台上实施了一个简单的规则</a> - 每个用户请求一个同步调用，而在Netflix，他们的平台API重新设计已经在API结构中构建了异步性。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本文翻译自<a target="_blank" rel="noopener" href="https://martinfowler.com/articles/microservices.html">Martin Fowler的微服务</a></p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/11/15/basic/004-microservices-martin-flower/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/11/15/basic/004-microservices-martin-flower/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/11/15/basic/004-microservices-martin-flower/" data-id="cl1fw7fho000lvkd34m654udo" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/microservice/" rel="tag">microservice</a><span class="article-tag-list-count">9</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/021-mock-test" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/11/13/java/021-mock-test/" class="article-date">
  <time datetime="2018-11-13T00:00:01.000Z" itemprop="datePublished">2018-11-13</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/11/13/java/021-mock-test/">Mock对象用于测试</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Mock入门"><a href="#Mock入门" class="headerlink" title="Mock入门"></a>Mock入门</h1><p><a target="_blank" rel="noopener" href="https://site.mockito.org/">java的mock框架</a>，<a target="_blank" rel="noopener" href="https://static.javadoc.io/org.mockito/mockito-core/2.23.0/org/mockito/Mockito.html">其文档</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/21444517">参考</a></p>
<h2 id="依赖的2种情况"><a href="#依赖的2种情况" class="headerlink" title="依赖的2种情况"></a>依赖的2种情况</h2><ol>
<li>一个类的方法依赖另一个类的方法</li>
</ol>
<img src="/2018/11/13/java/021-mock-test/000.png" class="">

<ol start="2">
<li>同一个类的方法间依赖</li>
</ol>
<img src="/2018/11/13/java/021-mock-test/001.png" class="">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> B b;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> b.b();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">a1</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> a2();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">a2</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;a2&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;this is b&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mock使用"><a href="#Mock使用" class="headerlink" title="Mock使用"></a>Mock使用</h2><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.mockito/mockito-core --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mockito&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.23.0&lt;/version&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>需要注意的就是：springboot的<code>spring-boot-starter-test</code>以及包含junit和mockito依赖。</p>
<h3 id="如何模拟一个对象"><a href="#如何模拟一个对象" class="headerlink" title="如何模拟一个对象"></a>如何模拟一个对象</h3><h4 id="原生方法"><a href="#原生方法" class="headerlink" title="原生方法"></a>原生方法</h4><p>以List为例，使用mock方法即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">//mock creation</span></span><br><span class="line"><span class="type">List</span> <span class="variable">mockedList</span> <span class="operator">=</span> mock(List.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//using mock object</span></span><br><span class="line">mockedList.add(<span class="string">&quot;one&quot;</span>);</span><br><span class="line">mockedList.clear();</span><br><span class="line"></span><br><span class="line"><span class="comment">//verification</span></span><br><span class="line">verify(mockedList).add(<span class="string">&quot;one&quot;</span>);</span><br><span class="line">verify(mockedList).clear();</span><br></pre></td></tr></table></figure>
<h4 id="依赖情况1"><a href="#依赖情况1" class="headerlink" title="依赖情况1"></a>依赖情况1</h4><p>或者使用注解：</p>
<p><a target="_blank" rel="noopener" href="https://static.javadoc.io/org.mockito/mockito-core/2.23.0/org/mockito/InjectMocks.html">文档</a> ,<br><code>@InjectMocks只会注入使用@Spy或@Mock注释创建的mock/spy对象</code></p>
<ol>
<li>构造函数注入</li>
<li>setter注入</li>
<li>字段注入</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ATest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 被测对象</span></span><br><span class="line">	<span class="meta">@InjectMocks</span></span><br><span class="line">	<span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 被引用的对象，需要模拟的</span></span><br><span class="line">	<span class="meta">@Mock</span></span><br><span class="line">	<span class="keyword">private</span> B b;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">// 使注解生效，可以继承</span></span><br><span class="line">		MockitoAnnotations.initMocks(<span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">		when(b.b()).thenReturn(<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">		<span class="keyword">final</span> <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="built_in">this</span>.a.a();</span><br><span class="line"></span><br><span class="line">		assertEquals(<span class="string">&quot;bb&quot;</span>, s);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="依赖情况2"><a href="#依赖情况2" class="headerlink" title="依赖情况2"></a>依赖情况2</h4><p>这时候创建被测类的spy对象，才可以模拟其方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">a1</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// 模拟A类的a2方法, 创建a的spy对象，只部分化a对象</span></span><br><span class="line">		a = spy(a);</span><br><span class="line">		when(a.a2()).thenReturn(<span class="string">&quot;aa&quot;</span>);</span><br><span class="line"><span class="comment">//		或者：doReturn(&quot;aaa&quot;).when(a).a2();</span></span><br><span class="line">		assertEquals(<span class="string">&quot;aaa&quot;</span>, a.a1());</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="JUnit-Mockito"><a href="#JUnit-Mockito" class="headerlink" title="JUnit+Mockito"></a>JUnit+Mockito</h4><p>当然，在junit测试框架下，我们可以完全使用注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(MockitoJUnitRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ATest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 被测对象</span></span><br><span class="line">	<span class="meta">@InjectMocks</span></span><br><span class="line">	<span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 被引用的对象</span></span><br><span class="line">	<span class="meta">@Mock</span></span><br><span class="line">	<span class="keyword">private</span> B b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模拟方法返回值"><a href="#模拟方法返回值" class="headerlink" title="模拟方法返回值"></a>模拟方法返回值</h3><p>这是我们最常用的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test(expected = RuntimeException.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stub</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">// 创建模拟的LinkedList</span></span><br><span class="line">	<span class="type">LinkedList</span> <span class="variable">mockedList</span> <span class="operator">=</span> mock(LinkedList.class);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 模拟返回值（stub）</span></span><br><span class="line">	when(mockedList.get(<span class="number">0</span>)).thenReturn(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">	<span class="comment">// 模拟抛异常</span></span><br><span class="line">	when(mockedList.get(<span class="number">1</span>)).thenThrow(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>());</span><br><span class="line"></span><br><span class="line">	assertEquals(<span class="string">&quot;first&quot;</span>, mockedList.get(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 第99个元素没有被模拟，所以返回null</span></span><br><span class="line">	assertNull(mockedList.get(<span class="number">99</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 抛异常</span></span><br><span class="line">	mockedList.get(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模拟方法参数"><a href="#模拟方法参数" class="headerlink" title="模拟方法参数"></a>模拟方法参数</h3><p>有时我们不关心参数的值，只需要随便给一个，mock可以随机一些：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">arguments</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">// 创建模拟的LinkedList</span></span><br><span class="line">	<span class="type">LinkedList</span> <span class="variable">mockedList</span> <span class="operator">=</span> mock(LinkedList.class);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 不管参数是什么（必须是int），都返回element</span></span><br><span class="line">	when(mockedList.get(anyInt())).thenReturn(<span class="string">&quot;element&quot;</span>);</span><br><span class="line"></span><br><span class="line">	assertEquals(<span class="string">&quot;element&quot;</span>, mockedList.get(<span class="number">3</span>));</span><br><span class="line">	assertEquals(<span class="string">&quot;element&quot;</span>, mockedList.get(<span class="number">999</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，除了anyInt(),还有其他类型：Stirng,Short,Char,List,Set,Map,Iterable,参考源码：<code>org.mockito.ArgumentMatchers</code>.</p>
<p>或者我们自定义参数条件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">arg</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">ListOfTwoElements</span> <span class="keyword">implements</span> <span class="title class_">ArgumentMatcher</span>&lt;List&gt; &#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(List list)</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> list.size() == <span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="comment">//printed in verification errors</span></span><br><span class="line">			<span class="keyword">return</span> <span class="string">&quot;[list of 2 elements]&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">List</span> <span class="variable">mock</span> <span class="operator">=</span> mock(List.class);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 也可以用lambda表达式 list -&gt; list.size()&gt;2</span></span><br><span class="line">	when(mock.addAll(argThat(<span class="keyword">new</span> <span class="title class_">ListOfTwoElements</span>()))).thenReturn(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	assertTrue(mock.addAll(Arrays.asList(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>)));</span><br><span class="line">	assertFalse(mock.addAll(Arrays.asList(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证方法的调用次数"><a href="#验证方法的调用次数" class="headerlink" title="验证方法的调用次数"></a>验证方法的调用次数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">timesTest</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="comment">// 创建模拟的LinkedList</span></span><br><span class="line">	<span class="type">LinkedList</span> <span class="variable">mockedList</span> <span class="operator">=</span> mock(LinkedList.class);</span><br><span class="line"></span><br><span class="line">	mockedList.add(<span class="string">&quot;once&quot;</span>);</span><br><span class="line"></span><br><span class="line">	mockedList.add(<span class="string">&quot;twice&quot;</span>);</span><br><span class="line">	mockedList.add(<span class="string">&quot;twice&quot;</span>);</span><br><span class="line"></span><br><span class="line">	mockedList.add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line">	mockedList.add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line">	mockedList.add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 默认是一次</span></span><br><span class="line">	verify(mockedList).add(<span class="string">&quot;once&quot;</span>);</span><br><span class="line">	verify(mockedList, times(<span class="number">1</span>)).add(<span class="string">&quot;once&quot;</span>);</span><br><span class="line"></span><br><span class="line">	verify(mockedList, times(<span class="number">2</span>)).add(<span class="string">&quot;twice&quot;</span>);</span><br><span class="line">	verify(mockedList, times(<span class="number">3</span>)).add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// never(). never() == times(0)</span></span><br><span class="line">	verify(mockedList, never()).add(<span class="string">&quot;never happened&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 还有至少和至多多少次：atLeast()/atMost()</span></span><br><span class="line">	verify(mockedList, atLeastOnce()).add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line">	verify(mockedList, atLeast(<span class="number">2</span>)).add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line">	verify(mockedList, atMost(<span class="number">5</span>)).add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好理解，但是为什么需要？</p>
<p>假如我们的被测方法存在一个循环，循环里有条件判断，可以判断某个方法因为条件的不同执行的次数。</p>
<h3 id="doXxxx方法"><a href="#doXxxx方法" class="headerlink" title="doXxxx方法"></a>doXxxx方法</h3><p><a target="_blank" rel="noopener" href="https://static.javadoc.io/org.mockito/mockito-core/2.23.0/org/mockito/Mockito.html#do_family_methods_stubs">文档</a></p>
<p>一般来说，<code>when().thenReturn()</code>基本能满足需求，所以什么时候需要使用do系列方法？</p>
<ol>
<li>模拟void的方法</li>
<li>模拟spy对象，上面</li>
<li>在一个测试中多次修改一个方法的行为</li>
</ol>
<p>说一下多次修改一个方法的返回值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getInstanceInfoActive</span><span class="params">()</span> &#123;</span><br><span class="line">		when(openstackService.execute(anyString(), anyString(), anyString(), anyString(),</span><br><span class="line">				anyString(), anyString(), argThat(s -&gt; !s.contains(<span class="string">&quot;&amp;marker=&quot;</span>)))).thenReturn(getOneServerJson(<span class="number">2</span>));</span><br><span class="line"><span class="comment">//		doReturn(getOneServerJson(2)).when(openstackService).execute(anyString(), anyString(), anyString(), anyString(),</span></span><br><span class="line"><span class="comment">//				anyString(), anyString(), argThat(s -&gt; !s.contains(&quot;&amp;marker=&quot;)));</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> service.getInstanceInfoActive(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">		assertEquals(<span class="number">2</span>, count);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 模拟返回超过1000条数据</span></span><br><span class="line">		doReturn(getOneServerJson(<span class="number">1000</span>)).when(openstackService).execute(anyString(), anyString(), anyString(), anyString(),</span><br><span class="line">				anyString(), anyString(), argThat(s -&gt; !s.contains(<span class="string">&quot;&amp;marker=&quot;</span>)));</span><br><span class="line">		doReturn(getOneServerJson(<span class="number">999</span>)).when(openstackService).execute(anyString(), anyString(), anyString(), anyString(),</span><br><span class="line">				anyString(), anyString(), argThat(s -&gt; s.contains(<span class="string">&quot;&amp;marker=&quot;</span>)));</span><br><span class="line"><span class="comment">//		when(openstackService.execute(anyString(), anyString(), anyString(), anyString(),</span></span><br><span class="line"><span class="comment">//				anyString(), anyString(), argThat(s -&gt; s.contains(&quot;&amp;marker=&quot;)))).thenReturn(getOneServerJson(999));</span></span><br><span class="line">		<span class="keyword">final</span> <span class="type">int</span> <span class="variable">count2</span> <span class="operator">=</span> service.getInstanceInfoActive(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">		assertEquals(<span class="number">1999</span>, count2);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="根据参数返回不同的值"><a href="#根据参数返回不同的值" class="headerlink" title="根据参数返回不同的值"></a>根据参数返回不同的值</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/22338536/mockito-return-value-based-on-property-of-a-parameter">https://stackoverflow.com/questions/22338536/mockito-return-value-based-on-property-of-a-parameter</a></p>
<p>使用doAnswer()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">    doAnswer(<span class="keyword">new</span> <span class="title class_">Answer</span>&lt;String&gt;()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">answer</span><span class="params">(InvocationOnMock invocation)</span>&#123;</span><br><span class="line">			<span class="type">Obj</span> <span class="variable">yours</span> <span class="operator">=</span> innovation.getArguments(<span class="number">0</span>);</span><br><span class="line">			theProperty = yours.getXXX();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;value&quot;</span>.equals(theProperty))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;result&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;otherValue&quot;</span>.equals(theProperty)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;otherResult&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> xxx;</span><br><span class="line">        &#125;&#125;).when(mockObject).myMethod(anyString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法没有返回值"><a href="#方法没有返回值" class="headerlink" title="方法没有返回值"></a>方法没有返回值</h3><p>理论上应该抛出异常，否则就是方法本身不可测了。</p>
<h3 id="方法是私有的"><a href="#方法是私有的" class="headerlink" title="方法是私有的"></a>方法是私有的</h3><p>mockito框架不支持测试私有方法，<a target="_blank" rel="noopener" href="https://github.com/mockito/mockito/wiki/Mockito-And-Private-Methods">原因</a></p>
<p>但有另一个强大的框架：<a target="_blank" rel="noopener" href="https://github.com/powermock/powermock">powermock</a>,可以<a target="_blank" rel="noopener" href="https://github.com/powermock/powermock/wiki/MockPrivate">测试私有方法</a>。</p>
<p>修改权限：改为包权限。</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>参考文档：<br><a target="_blank" rel="noopener" href="https://static.javadoc.io/org.mockito/mockito-core/2.23.0/org/mockito/Mockito.html">https://static.javadoc.io/org.mockito/mockito-core/2.23.0/org/mockito/Mockito.html</a></p>
<h1 id="为什么使用Mock"><a href="#为什么使用Mock" class="headerlink" title="为什么使用Mock"></a>为什么使用Mock</h1><ol>
<li><p>Mockito是一个非常好的模拟框架。它允许您使用简洁的API编写漂亮的测试。 Mockito不会让你糊涂，因为测试非常易读并且会产生干净的验证错误。</p>
</li>
<li><p>StackOverflow社区将Mockito评为最佳的java模拟框架。尽管StackOverflow避开可能引发情绪争论的问题，但事实上Mockito获得的选票最多。</p>
</li>
<li><p>所有库中的前10个Java库，不仅仅是测试工具。 2013年底，对30,000个GitHub项目进行了分析。尽管Mockito在主报告中排名第9，但mockito-core和mockito-all都是相同的工具，因此Mockito的实际位置是4号，超过了Guava或Spring等著名工具。将这项研究视为Mockito每天用Java编写的单元测试所产生巨大影响的指标。</p>
</li>
<li><p>行为驱动开发的创始人Dan North在2008年写道：<br>  “我们在主会议期间决定使用JUnit 4和Mockito，因为我们认为它们是TDD和Java中Mock的未来”</p>
</li>
</ol>
<h1 id="Spring中的Mock"><a href="#Spring中的Mock" class="headerlink" title="Spring中的Mock"></a>Spring中的Mock</h1><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html">spring-boot官方测试文档</a></p>
<p>spring-boot包含的测试依赖</p>
<p>mock在spring中的分类和使用</p>
<h1 id="ScalaTest-Mock"><a href="#ScalaTest-Mock" class="headerlink" title="ScalaTest+Mock"></a>ScalaTest+Mock</h1><p>官方文档：<a target="_blank" rel="noopener" href="http://www.scalatest.org/user_guide/testing_with_mock_objects">http://www.scalatest.org/user_guide&#x2F;testing_with_mock_objects</a></p>
<p>scala的mock有4种常用框架：</p>
<p>scala-mock是scala原生支持的：<a target="_blank" rel="noopener" href="http://scalamock.org/quick-start/">http://scalamock.org/quick-start/</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <h1 id="Mock入门"><a href="#Mock入门" class="headerlink" title="Mock入门"></a>Mock入门</h1><p><a target="_blank" rel="noopener" href="https://site.mockito.org/">java的mock框架</a>，<a target="_blank" rel="noopener" href="https://static.javadoc.io/org.mockito/mockito-core/2.23.0/org/mockito/Mockito.html">其文档</a></p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/11/13/java/021-mock-test/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/11/13/java/021-mock-test/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/11/13/java/021-mock-test/" data-id="cl1fw7fkz009qvkd37weqadsw" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/scala/" rel="tag">scala</a><span class="article-tag-list-count">10</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/020-spring-boot-unit-test-with-h2db-in-memory" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/31/java/020-spring-boot-unit-test-with-h2db-in-memory/" class="article-date">
  <time datetime="2018-10-31T07:05:35.000Z" itemprop="datePublished">2018-10-31</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/31/java/020-spring-boot-unit-test-with-h2db-in-memory/">spring-boot集成h2内存数据库进行单元测试</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>我们使用<a target="_blank" rel="noopener" href="http://www.h2database.com/html/features.html">h2内存数据库</a>.然后集成在框架里。<br>以下是测试环境搭建过程：</p>
<h1 id="加入h2依赖"><a href="#加入h2依赖" class="headerlink" title="加入h2依赖"></a>加入h2依赖</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.h2database&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;h2&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h1 id="新增测试环境配置文件"><a href="#新增测试环境配置文件" class="headerlink" title="新增测试环境配置文件"></a>新增测试环境配置文件</h1><p>复制一份<code>application-dev.yml</code>,重命名为：<code>application-test.yml</code>.内容只有数据库配置改变：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: app</span><br><span class="line">  #数据库连接</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:h2:mem:test;DB_CLOSE_DELAY=-<span class="number">1</span>;MODE=PostgreSQL</span><br><span class="line">#    url: jdbc:h2:mem:test;MODE=PostgreSQL;INIT=CREATE SCHEMA IF NOT EXISTS <span class="keyword">public</span>;SCHEMA=<span class="keyword">public</span></span><br><span class="line">    username:</span><br><span class="line">    password:</span><br><span class="line">    driverClassName: org.h2.Driver</span><br><span class="line">    schema: classpath:sql/init-table.sql</span><br><span class="line">    data: classpath:sql/data.sql</span><br><span class="line"></span><br><span class="line"># mybatis xml配置</span><br><span class="line">mybatis:</span><br><span class="line">  config-location: classpath:mybatis-config.xml</span><br><span class="line">  mapper-locations: classpath:mappers<span class="comment">/**/*.xml</span></span><br></pre></td></tr></table></figure>

<h1 id="准备测试数据"><a href="#准备测试数据" class="headerlink" title="准备测试数据"></a>准备测试数据</h1><p>看上面的配置文件，有一个初始数据表的sql：init-table.sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> asset;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> asset (</span><br><span class="line">  id serial ,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">100</span>),</span><br><span class="line">  ip <span class="type">varchar</span>(<span class="number">100</span>),</span><br><span class="line">  hostname <span class="type">varchar</span>(<span class="number">100</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>还有初始化数据的：data.sql:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> asset(name,ip,hostname) <span class="keyword">values</span>(<span class="string">&#x27;openstack&#x27;</span>,<span class="string">&#x27;172.1.1.2&#x27;</span>,<span class="string">&#x27;controller&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="待测mapper"><a href="#待测mapper" class="headerlink" title="待测mapper"></a>待测mapper</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(basePackages = &#123;&quot;com.jimo.mapper&quot;&#125;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDaoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(TestDaoApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AssetMapper</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Asset a)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">	List&lt;Asset&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Asset</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String hostname;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的语句：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.jimo.mapper.AssetMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delete&quot;</span>&gt;</span></span><br><span class="line">        delete from asset where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span>&gt;</span></span><br><span class="line">        insert into asset(name,hostname,ip) set name=#&#123;a.name&#125;,hostname=#&#123;a.hostname&#125;,ip=#&#123;a.ip&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.jimo.model.Asset&quot;</span>&gt;</span></span><br><span class="line">      SELECT  * from asset</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="编写测试类"><a href="#编写测试类" class="headerlink" title="编写测试类"></a>编写测试类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="comment">// 使用测试环境配置</span></span><br><span class="line"><span class="meta">@ActiveProfiles(&quot;test&quot;)</span></span><br><span class="line"><span class="comment">// 不加载web环境，更快</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.NONE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssetMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> AssetMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> List&lt;Asset&gt; assets = mapper.selectAll();</span><br><span class="line">        assertEquals(<span class="number">1</span>, assets.size());</span><br><span class="line"></span><br><span class="line">        mapper.delete(<span class="number">1</span>);</span><br><span class="line">        assertEquals(<span class="number">0</span>, mapper.selectAll().size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>h2内存数据库可以模拟多种数据库，但不是所有语法都满足，所以需要折中处理。</p>
<p>如果可以，还是使用一个测试的数据库环境最好。</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>我们使用<a target="_blank" rel="noopener" href="http://www.h2database.com/html/features.html">h2内存数据库</a>.然后集成在框架里。<br>以下是测试环境搭建过程：</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/31/java/020-spring-boot-unit-test-with-h2db-in-memory/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/31/java/020-spring-boot-unit-test-with-h2db-in-memory/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/31/java/020-spring-boot-unit-test-with-h2db-in-memory/" data-id="cl1fw7fkz009ovkd3ehub3oa4" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/spring-boot/" rel="tag">spring-boot</a><span class="article-tag-list-count">8</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/test/" rel="tag">test</a><span class="article-tag-list-count">1</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-math/002-those-math-concepts" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/31/math/002-those-math-concepts/" class="article-date">
  <time datetime="2018-10-31T00:36:12.000Z" itemprop="datePublished">2018-10-31</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/31/math/002-those-math-concepts/">那些深度学习要知道的数学概念</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>那些深度学习要知道的数学概念,包括线性代数，高等数学，统计学，概率论等。</p>
<h1 id="线性代数"><a href="#线性代数" class="headerlink" title="线性代数"></a>线性代数</h1><h2 id="矩阵的行列式"><a href="#矩阵的行列式" class="headerlink" title="矩阵的行列式"></a>矩阵的行列式</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.shuxuele.com/algebra/matrix-determinant.html">知道怎么算</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%A1%8C%E5%88%97%E5%BC%8F">理解其数学意义</a></li>
</ol>
<h2 id="矩阵的特征值"><a href="#矩阵的特征值" class="headerlink" title="矩阵的特征值"></a>矩阵的特征值</h2><ol>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%89%B9%E5%BE%81%E5%80%BC%E5%92%8C%E7%89%B9%E5%BE%81%E5%90%91%E9%87%8F">wiki-知道如何推理出来</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/woainishifu/article/details/76418176">特征值在图像上的意义</a></li>
<li><a target="_blank" rel="noopener" href="http://www2.edu-edu.com.cn/lesson_crs78/self/j_4184/soft/ch0501.html">什么是特征多项式+怎么计算特征值和特征向量</a></li>
</ol>
<h2 id="酉矩阵"><a href="#酉矩阵" class="headerlink" title="酉矩阵"></a>酉矩阵</h2><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%85%89%E7%9F%A9%E9%98%B5">概念</a></p>
<h2 id="正交矩阵"><a href="#正交矩阵" class="headerlink" title="正交矩阵"></a>正交矩阵</h2><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AD%A3%E4%BA%A4%E7%9F%A9%E9%98%B5">概念</a></p>
<p><strong>注意和酉矩阵的区别</strong></p>
<h2 id="奇异值分解-SVD"><a href="#奇异值分解-SVD" class="headerlink" title="奇异值分解(SVD)"></a>奇异值分解(SVD)</h2><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%A5%87%E5%BC%82%E5%80%BC%E5%88%86%E8%A7%A3">概念和计算</a></p>
<p><strong>奇异值：</strong> 奇异值分解后的中间对角矩阵的元素。</p>
<p><strong>注意与特征值分解的关系</strong></p>
<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p><a target="_blank" rel="noopener" href="http://www.yunsuanzi.com/matrixcomputations/solveeigdecomp.html">在线求解矩阵计算</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>那些深度学习要知道的数学概念,包括线性代数，高等数学，统计学，概率论等。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/31/math/002-those-math-concepts/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/31/math/002-those-math-concepts/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/31/math/002-those-math-concepts/" data-id="cl1fw7fmw00gnvkd39y7fbysr" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/math/" rel="tag">math</a><span class="article-tag-list-count">3</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/019-java-refactoring-and" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/29/java/019-java-refactoring-and/" class="article-date">
  <time datetime="2018-10-29T12:01:30.000Z" itemprop="datePublished">2018-10-29</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/29/java/019-java-refactoring-and/">java重构和单元测试规范</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>报着希望来重构。</p>
<h1 id="重构代码规范"><a href="#重构代码规范" class="headerlink" title="重构代码规范"></a>重构代码规范</h1><h2 id="重构目标"><a href="#重构目标" class="headerlink" title="重构目标"></a>重构目标</h2><ol>
<li>让代码可读</li>
<li>让代码可测</li>
<li>消除代码警告</li>
</ol>
<p>按照我们讨论过的《Java代码规范》进行重构代码，使代码变得可测。<br>需要进行以下修改：</p>
<p>以DictController为例</p>
<h2 id="重构之前"><a href="#重构之前" class="headerlink" title="重构之前"></a>重构之前</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// controller</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/selectModuleByService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">selectModuleByService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> dictService.selectModuleByService(request, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// service</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> OmsLogServiceDictDao serviceDictDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">selectModuleByService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">    List&lt;OmsLogServiceDict&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">service</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;service&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(service)) &#123;</span><br><span class="line">            list = serviceDictDao.selectByService(service);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            list = serviceDictDao.selectAll();</span><br><span class="line">        &#125;</span><br><span class="line">        result.setError_code(ResultConstants.SUCCESS);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_NULL);</span><br><span class="line">        result.setData(list);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        result.setError_code(ResultConstants.FAILED);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_EXCEPTION);</span><br><span class="line">        logger.error(ResultConstants.MESSAGE_EXCEPTION, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="重构过程"><a href="#重构过程" class="headerlink" title="重构过程"></a>重构过程</h2><h3 id="参数提取到controller层"><a href="#参数提取到controller层" class="headerlink" title="参数提取到controller层"></a>参数提取到controller层</h3><p>同时在controller层验证参数，然后传给service层：</p>
<h4 id="无需封装的情况"><a href="#无需封装的情况" class="headerlink" title="无需封装的情况"></a>无需封装的情况</h4><p>当参数个数<code>&lt;=7</code>个时。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//controller</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/selectModuleByService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">selectModuleByService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">service</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;service&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> dictService.selectModuleByService(service);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// service</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">selectModuleByService</span><span class="params">(String service)</span> &#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">    List&lt;OmsLogServiceDict&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(service)) &#123;</span><br><span class="line">            list = serviceDictDao.selectByService(service);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            list = serviceDictDao.selectAll();</span><br><span class="line">        &#125;</span><br><span class="line">        result.setError_code(ResultConstants.SUCCESS);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_NULL);</span><br><span class="line">        result.setData(list);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        result.setError_code(ResultConstants.FAILED);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_EXCEPTION);</span><br><span class="line">        logger.error(ResultConstants.MESSAGE_EXCEPTION, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="需要封装参数"><a href="#需要封装参数" class="headerlink" title="需要封装参数"></a>需要封装参数</h4><p>如果参数超过7个，则封装为<code>Query对象</code>,如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addCounterName</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">    String[] column = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;countername&quot;</span>, <span class="string">&quot;status&quot;</span>, <span class="string">&quot;title&quot;</span>, <span class="string">&quot;units&quot;</span>, <span class="string">&quot;originalUnits&quot;</span>,</span><br><span class="line">    <span class="string">&quot;unitsFactor&quot;</span>, <span class="string">&quot;deviceName&quot;</span>, <span class="string">&quot;datatype&quot;</span>, <span class="string">&quot;precision&quot;</span>, <span class="string">&quot;ifgather&quot;</span>, <span class="string">&quot;ifclear&quot;</span>, <span class="string">&quot;validstart&quot;</span>,</span><br><span class="line">    <span class="string">&quot;validend&quot;</span>, <span class="string">&quot;createtime&quot;</span>, <span class="string">&quot;memo&quot;</span>, <span class="string">&quot;num&quot;</span>, <span class="string">&quot;ctgroup&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">countername</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;countername&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;status&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;title&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">units</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;units&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">originalUnits</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;originalUnits&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">unitsFactor</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;unitsFactor&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">deviceName</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;deviceName&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">datatype</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;datatype&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">precision</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;precision&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">ifgather</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;ifgather&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">ifclear</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;ifclear&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">validstart</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;validstart&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">validend</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;validend&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">memo</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;memo&quot;</span>));</span><br><span class="line">        <span class="type">long</span> <span class="variable">num</span> <span class="operator">=</span> counterNameDao.getNum(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">numStr</span> <span class="operator">=</span> IntegerUtil.decimalToHLevelForLength(num + <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">ctgroup</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;ctgroup&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">createtime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        String[] value = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;countername, status, title, units, originalUnits, unitsFactor,</span><br><span class="line">            deviceName, datatype, precision, ifgather, ifclear, validstart, validend,</span><br><span class="line">            createtime, memo, numStr, ctgroup&#125;;</span><br><span class="line"></span><br><span class="line">        counterNameDao.addCounterName(countername, column, value);</span><br><span class="line">        counterNameDao.getNum(<span class="number">1</span>);</span><br><span class="line">        result.setError_code(ResultConstants.SUCCESS);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_NULL);</span><br><span class="line">        result.setData(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        result.setError_code(ResultConstants.FAILED);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_EXCEPTION);</span><br><span class="line">        logger.error(ResultConstants.MESSAGE_EXCEPTION, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，如果你发现该类还有一个或多个参数类似的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">modifyCounterName</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">    String[] column = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;countername&quot;</span>, <span class="string">&quot;status&quot;</span>, <span class="string">&quot;title&quot;</span>, <span class="string">&quot;units&quot;</span>, <span class="string">&quot;originalUnits&quot;</span>, <span class="string">&quot;unitsFactor&quot;</span>,</span><br><span class="line">     <span class="string">&quot;deviceName&quot;</span>, <span class="string">&quot;datatype&quot;</span>, <span class="string">&quot;precision&quot;</span>, <span class="string">&quot;ifgather&quot;</span>, <span class="string">&quot;ifclear&quot;</span>, <span class="string">&quot;validstart&quot;</span>, <span class="string">&quot;validend&quot;</span>,</span><br><span class="line">     <span class="string">&quot;updatetime&quot;</span>, <span class="string">&quot;num&quot;</span>, <span class="string">&quot;memo&quot;</span>, <span class="string">&quot;ctgroup&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">rowkey</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;rowkey&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">countername</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;countername&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;status&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;title&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">units</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;units&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">originalUnits</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;originalUnits&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">unitsFactor</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;unitsFactor&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">deviceName</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;deviceName&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">datatype</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;datatype&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">precision</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;precision&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">ifgather</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;ifgather&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">ifclear</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;ifclear&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">validstart</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;validstart&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">validend</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;validend&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">memo</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;memo&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">ctgroup</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;ctgroup&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">num</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">updatetime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        String[] value = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;countername, status, title, units, originalUnits, unitsFactor,</span><br><span class="line">             deviceName, datatype, precision, ifgather, ifclear, validstart, validend,</span><br><span class="line">             updatetime, num, memo, ctgroup&#125;;</span><br><span class="line"></span><br><span class="line">        counterNameDao.modifyCounterName(rowkey, countername, column, value);</span><br><span class="line">        result.setError_code(ResultConstants.SUCCESS);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_NULL);</span><br><span class="line">        result.setData(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        result.setError_code(ResultConstants.FAILED);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_EXCEPTION);</span><br><span class="line">        logger.error(ResultConstants.MESSAGE_EXCEPTION, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>则可以按多的参数来封装，这样多个方法也可以复用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterQuery</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String rowKey;</span><br><span class="line">	<span class="keyword">private</span> String counterName;</span><br><span class="line">	<span class="keyword">private</span> String status;</span><br><span class="line">	<span class="keyword">private</span> String title;</span><br><span class="line">	<span class="keyword">private</span> String units;</span><br><span class="line">	<span class="keyword">private</span> String originalUnits;</span><br><span class="line">	<span class="keyword">private</span> String unitsFactor;</span><br><span class="line">	<span class="keyword">private</span> String deviceName;</span><br><span class="line">	<span class="keyword">private</span> String dataType;</span><br><span class="line">	<span class="keyword">private</span> String precision;</span><br><span class="line">	<span class="keyword">private</span> String ifGather;</span><br><span class="line">	<span class="keyword">private</span> String ifClear;</span><br><span class="line">	<span class="keyword">private</span> String validStart;</span><br><span class="line">	<span class="keyword">private</span> String validEnd;</span><br><span class="line">	<span class="keyword">private</span> String memo;</span><br><span class="line">	<span class="keyword">private</span> String ctGroup;</span><br><span class="line">	<span class="keyword">private</span> String num;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">CounterQuery</span><span class="params">(String rowKey, String counterName, String status, String title, String units,</span></span><br><span class="line"><span class="params">						String originalUnits, String unitsFactor, String deviceName, String dataType,</span></span><br><span class="line"><span class="params">						String precision, String ifGather, String ifClear, String validStart, String validEnd,</span></span><br><span class="line"><span class="params">						String memo, String ctGroup, String num)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.rowKey = rowKey;</span><br><span class="line">		<span class="built_in">this</span>.counterName = counterName;</span><br><span class="line">		<span class="built_in">this</span>.status = status;</span><br><span class="line">		<span class="built_in">this</span>.title = title;</span><br><span class="line">		<span class="built_in">this</span>.units = units;</span><br><span class="line">		<span class="built_in">this</span>.originalUnits = originalUnits;</span><br><span class="line">		<span class="built_in">this</span>.unitsFactor = unitsFactor;</span><br><span class="line">		<span class="built_in">this</span>.deviceName = deviceName;</span><br><span class="line">		<span class="built_in">this</span>.dataType = dataType;</span><br><span class="line">		<span class="built_in">this</span>.precision = precision;</span><br><span class="line">		<span class="built_in">this</span>.ifGather = ifGather;</span><br><span class="line">		<span class="built_in">this</span>.ifClear = ifClear;</span><br><span class="line">		<span class="built_in">this</span>.validStart = validStart;</span><br><span class="line">		<span class="built_in">this</span>.validEnd = validEnd;</span><br><span class="line">		<span class="built_in">this</span>.memo = memo;</span><br><span class="line">		<span class="built_in">this</span>.ctGroup = ctGroup;</span><br><span class="line">		<span class="built_in">this</span>.num = num;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//getters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>提出的对象命名：根据业务场景的对象+Query，如上面的CounterQuery</li>
<li>属性必须采用驼峰命名法，不能出现拼写错误下划线警告</li>
<li>该类放在model包的query（需新建）包下</li>
</ol>
<p>重构后的service层如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addCounterName</span><span class="params">(CounterQuery counter)</span> &#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">    String[] column = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;countername&quot;</span>, <span class="string">&quot;status&quot;</span>, <span class="string">&quot;title&quot;</span>, <span class="string">&quot;units&quot;</span>, <span class="string">&quot;originalUnits&quot;</span>, <span class="string">&quot;unitsFactor&quot;</span>,</span><br><span class="line">            <span class="string">&quot;deviceName&quot;</span>, <span class="string">&quot;datatype&quot;</span>, <span class="string">&quot;precision&quot;</span>, <span class="string">&quot;ifgather&quot;</span>, <span class="string">&quot;ifclear&quot;</span>, <span class="string">&quot;validstart&quot;</span>, <span class="string">&quot;validend&quot;</span>,</span><br><span class="line">            <span class="string">&quot;createtime&quot;</span>, <span class="string">&quot;memo&quot;</span>, <span class="string">&quot;num&quot;</span>, <span class="string">&quot;ctgroup&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">num</span> <span class="operator">=</span> counterNameDao.getNum(<span class="number">0</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">numStr</span> <span class="operator">=</span> IntegerUtil.decimalToHLevelForLength(num + <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">createtime</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        String[] value = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;counter.getCounterName(), counter.getStatus(), counter.getTitle(),</span><br><span class="line">                counter.getUnits(), counter.getOriginalUnits(), counter.getUnitsFactor(),</span><br><span class="line">                counter.getDeviceName(), counter.getDataType(), counter.getPrecision(),</span><br><span class="line">                counter.getIfGather(), counter.getIfClear(), counter.getValidStart(), counter.getValidEnd(),</span><br><span class="line">                createtime, counter.getMemo(), numStr, counter.getCtGroup()&#125;;</span><br><span class="line"></span><br><span class="line">        counterNameDao.addCounterName(counter.getCounterName(), column, value);</span><br><span class="line">        counterNameDao.getNum(<span class="number">1</span>);</span><br><span class="line">        result.setError_code(ResultConstants.SUCCESS);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_NULL);</span><br><span class="line">        result.setData(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        result.setError_code(ResultConstants.FAILED);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_EXCEPTION);</span><br><span class="line">        logger.error(ResultConstants.MESSAGE_EXCEPTION, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>controller现在负责接收参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/addCounterName&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addCounterName</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">countername</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;countername&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;status&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;title&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">units</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;units&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">originalUnits</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;originalUnits&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">unitsFactor</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;unitsFactor&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">deviceName</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;deviceName&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">datatype</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;datatype&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">precision</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;precision&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">ifgather</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;ifgather&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">ifclear</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;ifclear&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">validstart</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;validstart&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">validend</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;validend&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">memo</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;memo&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">ctgroup</span> <span class="operator">=</span> StringUtils.nullToString(request.getParameter(<span class="string">&quot;ctgroup&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> counterNameService.addCounterName(<span class="keyword">new</span> <span class="title class_">CounterQuery</span>(<span class="literal">null</span>, countername, status,</span><br><span class="line">            title, units, originalUnits, unitsFactor, deviceName, datatype, precision, ifgather,</span><br><span class="line">            ifclear, validstart, validend, memo, ctgroup, <span class="literal">null</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="返回Map对象"><a href="#返回Map对象" class="headerlink" title="返回Map对象"></a>返回Map对象</h3><p>对于service返回封装的Map对象是不推荐的，如下：<code>com.sinorail.base.service.impl.HomeServiceImpl#homeData</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">map.put(<span class="string">&quot;vcpus_used_Count&quot;</span>, vcpus_used_Count + <span class="string">&quot;&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;vcpusCount&quot;</span>, vcpusCount + <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">map.put(<span class="string">&quot;mem_used_Count&quot;</span>, mem_used_Count);</span><br><span class="line">map.put(<span class="string">&quot;memCount&quot;</span>, memCount);</span><br><span class="line">map.put(<span class="string">&quot;store&quot;</span>, store);</span><br><span class="line"></span><br><span class="line">map.put(<span class="string">&quot;node_cpu_max&quot;</span>, node_cpu_max);</span><br><span class="line">map.put(<span class="string">&quot;node_cpu_avg&quot;</span>, node_cpu_avg);</span><br><span class="line">map.put(<span class="string">&quot;activeVm_cpu_max&quot;</span>, activeVm_cpu_max);</span><br><span class="line">map.put(<span class="string">&quot;activeVm_cpu_avg&quot;</span>, activeVm_cpu_avg);</span><br></pre></td></tr></table></figure>

<p>需要封装成对象：<code>DTO(data transfer object)</code>：</p>
<ol>
<li>放在model包的dto包下</li>
<li>封装的对象命名： 业务对象+DTO</li>
<li>成员属性命名要符合规范</li>
</ol>
<h3 id="service层的DAO采用构造注入"><a href="#service层的DAO采用构造注入" class="headerlink" title="service层的DAO采用构造注入"></a>service层的DAO采用构造注入</h3><p>这种方式是推荐的：</p>
<ol>
<li>没有警告</li>
<li>便于后面测试</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OmsLogServiceDictDao serviceDictDao;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OmsLogOpDictDao opDictDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">DictServiceImpl</span><span class="params">(OmsLogServiceDictDao serviceDictDao, OmsLogOpDictDao opDictDao)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.serviceDictDao = serviceDictDao;</span><br><span class="line">    <span class="built_in">this</span>.opDictDao = opDictDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="根据IDEA的阿里插件提示消除警告"><a href="#根据IDEA的阿里插件提示消除警告" class="headerlink" title="根据IDEA的阿里插件提示消除警告"></a>根据IDEA的阿里插件提示消除警告</h3><h4 id="消除代码警告"><a href="#消除代码警告" class="headerlink" title="消除代码警告"></a>消除代码警告</h4><p>比如，这个service的<code>new ArrayList&lt;&gt;()</code>是没有必要的，应该舍去：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">selectModuleByService</span><span class="params">(String service)</span> &#123;</span><br><span class="line">    <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">    List&lt;OmsLogServiceDict&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(service)) &#123;</span><br><span class="line">            list = serviceDictDao.selectByService(service);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            list = serviceDictDao.selectAll();</span><br><span class="line">        &#125;</span><br><span class="line">        result.setError_code(ResultConstants.SUCCESS);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_NULL);</span><br><span class="line">        result.setData(list);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        result.setError_code(ResultConstants.FAILED);</span><br><span class="line">        result.setError_message(ResultConstants.MESSAGE_EXCEPTION);</span><br><span class="line">        logger.error(ResultConstants.MESSAGE_EXCEPTION, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="加上类和方法注释"><a href="#加上类和方法注释" class="headerlink" title="加上类和方法注释"></a>加上类和方法注释</h4><p>标注修改的时间和人，采用以下格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/10/29 10:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DictServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DictService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;根据服务名查找服务，如果服务名为空，返回所有&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> service 服务名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2018/10/29 10:10</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">selectModuleByService</span><span class="params">(String service)</span> &#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        List&lt;OmsLogServiceDict&gt; list;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(service)) &#123;</span><br><span class="line">                list = serviceDictDao.selectByService(service);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                list = serviceDictDao.selectAll();</span><br><span class="line">            &#125;</span><br><span class="line">            result.setError_code(ResultConstants.SUCCESS);</span><br><span class="line">            result.setError_message(ResultConstants.MESSAGE_NULL);</span><br><span class="line">            result.setData(list);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            result.setError_code(ResultConstants.FAILED);</span><br><span class="line">            result.setError_message(ResultConstants.MESSAGE_EXCEPTION);</span><br><span class="line">            logger.error(ResultConstants.MESSAGE_EXCEPTION, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="命名重构"><a href="#命名重构" class="headerlink" title="命名重构"></a>命名重构</h2><ol>
<li>mybatis的接口命名：XxxMapper（我们现在很多Dao，要不要改？）</li>
<li>其他参考之前讨论过的命名方式</li>
</ol>
<p>接下来是编写单元测试，测试重构后是否正确，我们对2层编写测试：</p>
<ol>
<li>DAO层：包括pgsql，hbase，es等</li>
<li>service层</li>
</ol>
<h1 id="单元测试规范"><a href="#单元测试规范" class="headerlink" title="单元测试规范"></a>单元测试规范</h1><p>依然接着上面。</p>
<p>如果测试环境有单独的配置文件，则需要声明：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@ActiveProfiles(&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XxxTest</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置文件以 <code>application-test.yml</code>命名。</p>
<p>使用<code>Ctrl+shift+T</code>生成测试类，需要以下几个注意点：</p>
<p>覆盖的范围，采用<code>BCDE</code>原则：</p>
<ul>
<li>B：Border，边界值测试，包括循环边界、特殊取值、特殊时间点、数据顺序等。</li>
<li>C：Correct，正确的输入，并得到预期的结果。</li>
<li>D：Design，与设计文档相结合，来编写单元测试。</li>
<li>E：Error，强制错误信息输入（如：非法数据、异常流程、非业务允许输入等），并得<br>到预期的结果。</li>
</ul>
<h2 id="测试类和方法命名"><a href="#测试类和方法命名" class="headerlink" title="测试类和方法命名"></a>测试类和方法命名</h2><ol>
<li>测试类命名采用在后面加<code>Test</code>的命名方式</li>
<li>方法命名保持不变</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DictServiceImplTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectModuleByService</span><span class="params">()</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于有些方法可以放在一起测的，只写一个方法就行，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AssetMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	Asset <span class="title function_">getAsset</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> String id)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">batchInsert</span><span class="params">(<span class="meta">@Param(&quot;assets&quot;)</span> List&lt;Asset&gt; assets)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以先插入再获取判断结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Rollback</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchInsert_getAsset</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    List&lt;Asset&gt; assets = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Asset</span> <span class="variable">asset1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Asset</span>();</span><br><span class="line">    asset1.setId(<span class="string">&quot;id1&quot;</span>);</span><br><span class="line">    asset1.setIad_tag(<span class="string">&quot;tag-jimo&quot;</span>);</span><br><span class="line">    assets.add(asset1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Asset</span> <span class="variable">asset2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Asset</span>();</span><br><span class="line">    asset2.setId(<span class="string">&quot;id2&quot;</span>);</span><br><span class="line">    asset2.setIad_tag(<span class="string">&quot;tag-jimo2&quot;</span>);</span><br><span class="line">    assets.add(asset2);</span><br><span class="line"></span><br><span class="line">    mapper.batchInsert(assets);</span><br><span class="line"></span><br><span class="line">    assertEquals(<span class="string">&quot;tag-jimo2&quot;</span>, mapper.getAsset(<span class="string">&quot;id2&quot;</span>).getIad_tag());</span><br><span class="line">    assertEquals(<span class="string">&quot;tag-jimo&quot;</span>, mapper.getAsset(<span class="string">&quot;id1&quot;</span>).getIad_tag());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个方法的命名采用方法名+下划线连接（&#x2F;&#x2F;TODO这个讨论）</p>
<h2 id="DAO层"><a href="#DAO层" class="headerlink" title="DAO层"></a>DAO层</h2><h3 id="使用真的数据库"><a href="#使用真的数据库" class="headerlink" title="使用真的数据库"></a>使用真的数据库</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OmsLogServiceDictDaoTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> OmsLogServiceDictDao dictDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectByService</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// Correct</span></span><br><span class="line">		<span class="keyword">final</span> List&lt;OmsLogServiceDict&gt; nova = dictDao.selectByService(<span class="string">&quot;nova&quot;</span>);</span><br><span class="line">		<span class="keyword">for</span> (OmsLogServiceDict n : nova) &#123;</span><br><span class="line">			assertEquals(<span class="string">&quot;nova&quot;</span>, n.getService());</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 不存在的数据</span></span><br><span class="line">		<span class="keyword">final</span> List&lt;OmsLogServiceDict&gt; list = dictDao.selectByService(<span class="string">&quot;jimo love jimo&quot;</span>);</span><br><span class="line">		assertEquals(<span class="number">0</span>, list.size());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 不合法参数</span></span><br><span class="line">		<span class="keyword">final</span> List&lt;OmsLogServiceDict&gt; list2 = dictDao.selectByService(<span class="literal">null</span>);</span><br><span class="line">		assertEquals(<span class="number">0</span>, list2.size());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于有修改的操作，采用事务：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.NONE)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssetMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchInsert</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        List&lt;Asset&gt; assets = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Asset</span> <span class="variable">asset1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Asset</span>();</span><br><span class="line">        asset1.setId(<span class="string">&quot;id1&quot;</span>);</span><br><span class="line">        asset1.setIad_tag(<span class="string">&quot;tag-jimo&quot;</span>);</span><br><span class="line">        assets.add(asset1);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Asset</span> <span class="variable">asset2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Asset</span>();</span><br><span class="line">        asset2.setId(<span class="string">&quot;id2&quot;</span>);</span><br><span class="line">        asset2.setIad_tag(<span class="string">&quot;tag-jimo2&quot;</span>);</span><br><span class="line">        assets.add(asset2);</span><br><span class="line"></span><br><span class="line">        mapper.batchInsert(assets);</span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="string">&quot;tag-jimo2&quot;</span>, mapper.getAsset(<span class="string">&quot;id2&quot;</span>).getIad_tag());</span><br><span class="line">        assertEquals(<span class="string">&quot;tag-jimo&quot;</span>, mapper.getAsset(<span class="string">&quot;id1&quot;</span>).getIad_tag());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用内存数据库模拟"><a href="#使用内存数据库模拟" class="headerlink" title="使用内存数据库模拟"></a>使用内存数据库模拟</h3><p>我们使用<a target="_blank" rel="noopener" href="http://www.h2database.com/html/features.html">h2内存数据库</a>.然后集成在框架里。<br>以下是测试环境搭建过程：</p>
<h4 id="加入h2依赖"><a href="#加入h2依赖" class="headerlink" title="加入h2依赖"></a>加入h2依赖</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.h2database&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;h2&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="新增测试环境配置文件"><a href="#新增测试环境配置文件" class="headerlink" title="新增测试环境配置文件"></a>新增测试环境配置文件</h4><p>复制一份<code>application-dev.yml</code>,重命名为：<code>application-test.yml</code>.内容只有数据库配置改变，以iad-web为例：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">iad-web</span></span><br><span class="line">  <span class="comment">#数据库连接</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;MODE=PostgreSQL</span></span><br><span class="line"><span class="comment">#    url: jdbc:h2:mem:test;MODE=PostgreSQL;INIT=CREATE SCHEMA IF NOT EXISTS public;SCHEMA=public</span></span><br><span class="line">    <span class="attr">username:</span></span><br><span class="line">    <span class="attr">password:</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">org.h2.Driver</span></span><br><span class="line">    <span class="attr">schema:</span> <span class="string">classpath:sql/init-table.sql</span></span><br><span class="line">    <span class="attr">data:</span> <span class="string">classpath:sql/data-asset.sql</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#     redis配置</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.17</span><span class="number">.68</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span></span><br><span class="line">    <span class="attr">jedis:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">1000</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">500</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">300</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis xml配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis-config.xml</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mappers/**/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  elasticsearch</span></span><br><span class="line"><span class="attr">es:</span></span><br><span class="line">  <span class="attr">cluster-name:</span> <span class="string">sinorail</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.17</span><span class="number">.57</span><span class="string">,192.168.17.64,192.168.17.65</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9300</span></span><br><span class="line"></span><br><span class="line"><span class="attr">hbase:</span></span><br><span class="line">  <span class="attr">quorum:</span> <span class="string">hadoop4:2181,hadoop5:2181,hadoop6:2181</span></span><br><span class="line">  <span class="attr">rootDir:</span> <span class="string">/hbase</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传文件的临时目录</span></span><br><span class="line"><span class="attr">upload-temp-dir:</span> <span class="string">E:\\</span></span><br></pre></td></tr></table></figure>

<h4 id="准备测试数据"><a href="#准备测试数据" class="headerlink" title="准备测试数据"></a>准备测试数据</h4><p>就目前阶段来说，我们可以直接从数据库导出一部分数据，然后稍微修改一下，就可以给h2用了。</p>
<p>看上面的配置文件，有一个初始数据表的sql：init-table.sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> assets_asset;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> assets_asset (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  ip <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  hostname <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  is_delete <span class="type">varchar</span>(<span class="number">10</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  region <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  cloud_uuid <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  iad_tag <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  monitor_name <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  createtime <span class="type">varchar</span>(<span class="number">50</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  updatetime <span class="type">varchar</span>(<span class="number">50</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  host_type <span class="type">varchar</span>(<span class="number">5</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  cabinet_id <span class="type">varchar</span>(<span class="number">100</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  vm_uuid <span class="type">varchar</span>(<span class="number">64</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  role <span class="type">varchar</span>(<span class="number">100</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  az <span class="type">varchar</span>(<span class="number">100</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  code <span class="type">varchar</span>(<span class="number">20</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  ipmi_monitor_name <span class="type">varchar</span>(<span class="number">100</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>::<span class="type">character</span> <span class="type">varying</span>,</span><br><span class="line">  tags text</span><br><span class="line">)</span><br><span class="line">;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> assets_asset <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> assets_asset_pkey <span class="keyword">PRIMARY</span> KEY (id);</span><br></pre></td></tr></table></figure>

<p>还有初始化数据的：data-asset.sql:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;95c79372-ef67-4e13-8763-51de090b9d19&#x27;</span>, <span class="string">&#x27;192.168.17.81&#x27;</span>, <span class="string">&#x27;sr-controller-1 192.168.17.81&#x27;</span>, <span class="string">&#x27;sr-controller-1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="string">&#x27;tag1&#x27;</span>, <span class="string">&#x27;sr-controller-1-192.168.17.81&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;node&#x27;</span>, <span class="string">&#x27;7f482dc5-2e8d-4235-b154-3a989b5ff55c&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;controller&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[testtt3,quchunjian,openstack集群]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;9ce0d5f7-fb30-4879-8c0d-32b75f2df4a9&#x27;</span>, <span class="string">&#x27;192.168.68.10&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_controller-2_457a6de0-43&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="string">&#x27;tag2&#x27;</span>, <span class="string">&#x27;9ce0d5f7-fb30-4879-8c0d-32b75f2df4a9&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="string">&#x27;7f482dc5-2e8d-4235-b154-3a989b5ff55c&#x27;</span>, <span class="string">&#x27;457a6de0-43ba-4446-b2a4-68f7414c0631&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;3725ce2d-ad04-4643-9a2d-be4be90295d6&#x27;</span>, <span class="string">&#x27;192.168.68.17&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_xkjtest_7a488799-82&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;3725ce2d-ad04-4643-9a2d-be4be90295d6&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="string">&#x27;7f482dc5-2e8d-4235-b154-3a989b5ff55c&#x27;</span>, <span class="string">&#x27;7a488799-826a-4849-ad23-46506c2df006&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[testtt3,testtt2]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;e0f3825a-538a-4a9b-9dfa-061cd5bf3209&#x27;</span>, <span class="string">&#x27;192.168.68.15&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_xkjtest3-j349Yskc-0_e275d517-c2&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;e0f3825a-538a-4a9b-9dfa-061cd5bf3209&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="string">&#x27;7f482dc5-2e8d-4235-b154-3a989b5ff55c&#x27;</span>, <span class="string">&#x27;e275d517-c2db-438b-b06e-51dec0a13e8b&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;0bf59686-449b-413b-8d0f-b35aaa4c1039&#x27;</span>, <span class="string">&#x27;192.168.68.13&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_kyf-mon-test_2bd4445a-d1&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0bf59686-449b-413b-8d0f-b35aaa4c1039&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="string">&#x27;7f482dc5-2e8d-4235-b154-3a989b5ff55c&#x27;</span>, <span class="string">&#x27;2bd4445a-d12f-4bcb-9738-83db13bdbad2&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;7c4e03de-c08f-4fac-868a-c272fe075bd9&#x27;</span>, <span class="string">&#x27;192.168.68.7&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_fdd-mon-test_abf88ee7-a5&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="string">&#x27;tag3&#x27;</span>, <span class="string">&#x27;7c4e03de-c08f-4fac-868a-c272fe075bd9&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="string">&#x27;7f482dc5-2e8d-4235-b154-3a989b5ff55c&#x27;</span>, <span class="string">&#x27;abf88ee7-a564-4d09-95a0-54176323b179&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;edac0b31-0217-452d-8f71-ef663d4add67&#x27;</span>, <span class="string">&#x27;192.168.68.5&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_勿删-iad-test-new_333ea8e0-73&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;edac0b31-0217-452d-8f71-ef663d4add67&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="string">&#x27;7f482dc5-2e8d-4235-b154-3a989b5ff55c&#x27;</span>, <span class="string">&#x27;333ea8e0-73b1-4fb9-ae43-c5922dcfe95a&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[testtt3,testtt2]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;f05b8971-027f-47dd-bc63-61f93a5f0e6e&#x27;</span>, <span class="string">&#x27;192.168.68.12&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_controller-3_1f6b331f-40&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;f05b8971-027f-47dd-bc63-61f93a5f0e6e&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1f6b331f-40c4-4d35-97aa-697c8e986ed6&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;caa53ba6-df04-40f5-b4da-5331c4c76374&#x27;</span>, <span class="string">&#x27;192.168.68.20&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_xkjtest2_9deaa847-78&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="string">&#x27;tag3&#x27;</span>, <span class="string">&#x27;caa53ba6-df04-40f5-b4da-5331c4c76374&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;9deaa847-7813-4f21-8599-bb0c085171a0&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;a67a866b-eb74-4156-a847-06b93a006fa0&#x27;</span>, <span class="string">&#x27;192.168.68.19&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_xkjtest3-j349Yskc-3_7cb018c8-0d&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="string">&#x27;tag2&#x27;</span>, <span class="string">&#x27;a67a866b-eb74-4156-a847-06b93a006fa0&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;7cb018c8-0da0-4c74-834d-f20eb37b4448&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> assets_asset <span class="keyword">VALUES</span> (<span class="string">&#x27;baa7e333-0578-412a-81f8-49cd870b48f8&#x27;</span>, <span class="string">&#x27;192.168.68.21&#x27;</span>, <span class="string">&#x27;openstack集群192.168.17.96_xkjtest3-j349Yskc-4_33273ca7-58&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;RegionFCsan&#x27;</span>, <span class="string">&#x27;bc33ca7c-36a0-4b02-b81e-9b1862edf902&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;baa7e333-0578-412a-81f8-49cd870b48f8&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;2018-10-30 12:51:58.35294+08&#x27;</span>, <span class="string">&#x27;vm&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;33273ca7-58af-412f-b428-72da15df19cd&#x27;</span>, <span class="string">&#x27;others&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;1023&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;[]&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>注意点：我们导出的数据如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> &quot;public&quot;.&quot;assets_asset&quot;;</span><br></pre></td></tr></table></figure>
<p><strong>我们需要去除schema（也就是public）和双引号，直接替换或者写个程序转换，否则会出现语法错误</strong></p>
<h4 id="编写测试类"><a href="#编写测试类" class="headerlink" title="编写测试类"></a>编写测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@ActiveProfiles(&quot;test&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.NONE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssetMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> AssetMapper mapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getAsset</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">Asset</span> <span class="variable">asset</span> <span class="operator">=</span> mapper.getAsset(<span class="string">&quot;95c79372-ef67-4e13-8763-51de090b9d19&quot;</span>);</span><br><span class="line">		assertEquals(<span class="string">&quot;192.168.17.81&quot;</span>, asset.getIp());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchInsert</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">Asset</span> <span class="variable">asset</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Asset</span>();</span><br><span class="line">		asset.setId(<span class="string">&quot;id1&quot;</span>);</span><br><span class="line">		asset.setIad_tag(<span class="string">&quot;tag-jimo&quot;</span>);</span><br><span class="line">		List&lt;Asset&gt; assets = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		assets.add(asset);</span><br><span class="line">		asset.setId(<span class="string">&quot;id2&quot;</span>);</span><br><span class="line">		assets.add(asset);</span><br><span class="line"></span><br><span class="line">		mapper.batchInsert(assets);</span><br><span class="line">		assertEquals(<span class="number">4</span>, mapper.allIagtag().size());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAll_AllIadTag</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">final</span> List&lt;Asset&gt; assets = mapper.allIagtag();</span><br><span class="line">		assertEquals(<span class="number">3</span>, assets.size());</span><br><span class="line"></span><br><span class="line">		mapper.deleteAll();</span><br><span class="line">		assertEquals(<span class="number">0</span>, mapper.allIagtag().size());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的批量插入报语法错误，这也是没办法的事。但基本查询都没问题。</p>
<p>还有需要知道的是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用测试的配置文件</span></span><br><span class="line"><span class="meta">@ActiveProfiles(&quot;test&quot;)</span></span><br><span class="line"><span class="comment">// 不加载web环境，跑起来更快</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.NONE)</span></span><br></pre></td></tr></table></figure>

<h3 id="具体怎么做？"><a href="#具体怎么做？" class="headerlink" title="具体怎么做？"></a>具体怎么做？</h3><p><strong>真实数据库有好处也有坏处：好处就是能得到最真实的结果。坏处就多了：比如</strong></p>
<ol>
<li>可能遇到冷启动（初始时没数据）</li>
<li>不稳定（数据会不断变化，导致测试用例不能重复执行）</li>
<li>还有一个就是慢。</li>
</ol>
<p><strong>内存数据库固然不错，但并不能支持pgsql的所有语法，导致有些测试无法进行。</strong></p>
<p>而使用开发数据库来测是不稳定的，所以最好的办法就是有一套测试的数据库，内置一些数据来测试。</p>
<p>&#x2F;&#x2F;TODO hbase, ES 等的数据构造</p>
<h2 id="Service层"><a href="#Service层" class="headerlink" title="Service层"></a>Service层</h2><p>这一层可以经过简化，不需要加载整个应用，所以需要用到Mock对象，这是Spring自带的，<br>通过模拟数据库DAO层的数据，我们只关注Service层的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.mockito.InjectMocks;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Mock;</span><br><span class="line"><span class="keyword">import</span> org.mockito.junit.MockitoJUnitRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.when;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(MockitoJUnitRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DictServiceImplTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@InjectMocks</span></span><br><span class="line">	<span class="keyword">private</span> DictServiceImpl dictService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Mock</span></span><br><span class="line">	<span class="keyword">private</span> OmsLogServiceDictDao dictDao;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectModuleByService</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">service</span> <span class="operator">=</span> <span class="string">&quot;glance&quot;</span>;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">OmsLogServiceDict</span> <span class="variable">d1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsLogServiceDict</span>();</span><br><span class="line">		d1.setService(service);</span><br><span class="line">		<span class="keyword">final</span> <span class="type">OmsLogServiceDict</span> <span class="variable">d2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OmsLogServiceDict</span>();</span><br><span class="line">		d2.setService(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Correct</span></span><br><span class="line">		when(dictDao.selectByService(<span class="string">&quot;glance&quot;</span>)).thenReturn(Collections.singletonList(d1));</span><br><span class="line">		assertEquals(<span class="number">1</span>, ((List) dictService.selectModuleByService(<span class="string">&quot;glance&quot;</span>).getData()).size());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Error</span></span><br><span class="line">		when(dictDao.selectByService(<span class="string">&quot;nova&quot;</span>)).thenThrow(IllegalArgumentException.class);</span><br><span class="line">		assertEquals(<span class="string">&quot;1&quot;</span>, dictService.selectModuleByService(<span class="string">&quot;nova&quot;</span>).getError_code());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Border</span></span><br><span class="line">		when(dictDao.selectByService(<span class="string">&quot;glance&quot;</span>)).thenReturn(Arrays.asList(d1, d2));</span><br><span class="line">		assertEquals(<span class="number">0</span>, ((List) dictService.selectModuleByService(<span class="string">&quot;neutron&quot;</span>).getData()).size());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h1><ol>
<li>构造测试的数据</li>
<li>保持测试代码的持久性</li>
</ol>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>祝大家好运！</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>报着希望来重构。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/29/java/019-java-refactoring-and/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/29/java/019-java-refactoring-and/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/29/java/019-java-refactoring-and/" data-id="cl1fw7fky009lvkd3f32f6jw5" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-basic/003-unit-testing" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/28/basic/003-unit-testing/" class="article-date">
  <time datetime="2018-10-28T08:51:00.000Z" itemprop="datePublished">2018-10-28</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/28/basic/003-unit-testing/">如何写单元测试</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>可能大家会觉得，单元测试有什么好讲的，那请大家思考以下问题：</p>
<ol>
<li>你有没有写过单元测试</li>
<li>你写过多少单元测试，是否感到厌烦</li>
<li>当提到单元测试，你的第一反应是什么？只是写一段代码来测试代码？有没有一套完整的原则去遵循？</li>
<li>当你写了一段代码来测试，是否只是测试了正确输入，得到正确结果？</li>
<li>你的单元测试运行过多少次？ 是否只是第一次运行了就再也没管过，尽管后来代码改了？</li>
</ol>
<p>如果上面有哪一条满足了，我觉得就有必要研究下单元测试。</p>
<h1 id="单元测试是什么"><a href="#单元测试是什么" class="headerlink" title="单元测试是什么"></a>单元测试是什么</h1><p>必须先形成一种思想：是发自内心的，而不是被强迫去做，成为一种负担。不要为了写单元测试而写单元测试！</p>
<p>谨记：单元测试不是负担，而是一种资产，能够为我们带来价值和便利。</p>
<p>价值：</p>
<ol>
<li>深入理解需求</li>
<li>覆盖边界条件，减少bug</li>
<li>工作量证明，有据可寻，出现问题易于排查，心理上的安慰</li>
</ol>
<p>便利：</p>
<ol>
<li>修改代码后可以快速判断对不对（<a target="_blank" rel="noopener" href="https://infinitest.github.io/">infinitetest</a>）</li>
<li>从测试理解函数的作用，对别人有帮助</li>
</ol>
<p>缺点：</p>
<ol>
<li>工作量变大了：体现在2个方面<ol>
<li>写的多了</li>
<li>改得多了，如果原来的业务变了，则该删的和该修改的代码也多了</li>
</ol>
</li>
<li>对程序员的要求高了：如果是TDD，则需要先写测试，而很多人都是在写完业务才理解业务逻辑的</li>
<li>单元测试不能应对所有情况，有可能单个方法是对的，但集成在一起就出问题了</li>
</ol>
<p>总的来说：利大于弊，单元测试能让未来更加美好！</p>
<h1 id="单元测试的粒度"><a href="#单元测试的粒度" class="headerlink" title="单元测试的粒度"></a>单元测试的粒度</h1><p>面向过程和面向对象以模块和类区分文件，但单元测试的粒度建议以方法（函数）来写。</p>
<p>理论上：根据单一性原则，一个类只完成一个业务，一个方法只完成一个功能，但现实是很残酷的，不是所有人都这么做，也不是所有功能的界限都那么明确。</p>
<p>比如登录功能：写在一个方法，但其实可以划分得更细：参数检测，用户名密码查询，返回结果。</p>
<p>我们采用一个方法一个单元测试：但一个单元测试并不是只有一个方法：</p>
<p>如果一个方法很复杂，参数太多，一个测试方法可能很长，可以适当地拆分，但只有一个方法有<code>@Test</code>注解:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样的话，拆分出的方法为了满足开闭原则，应该是private的，这给测试带来了了困扰。<br>&#x2F;&#x2F;TODO<br>试试看反射是否满足要求</p>
<h1 id="单元测试原则"><a href="#单元测试原则" class="headerlink" title="单元测试原则"></a>单元测试原则</h1><p>每次谈原则之类地东西都觉得是虚的，太过于理论，我开始也这么觉得，但后来逐渐明白，原则，或者说原理是经过高度总结概括和抽象地，<br>如果看不懂原则，那说明你还处在社会底层，不能理解上流社会的简洁与美丽。<br>我可以举个简单的例子来说明这个过程如何达到：小时候我们肯定听过一句话：书读百遍，其意自现。</p>
<p>当然，背诵不是唯一的途径，主要是当提到单元测试时，内心第一反应就是这些原则，我们所坚信的东西。可以在每次写测试前后对代码进行原则比较，<br>看是否满足。</p>
<h2 id="FIRST"><a href="#FIRST" class="headerlink" title="FIRST"></a>FIRST</h2><ul>
<li>Fast：除去被测方法本身，单元测试不应该过于复杂，保证速度快，如果方法本身很慢就没办法了</li>
<li>Isolated：隔离性，单元测试间不应该相互依赖，且没有先后顺序</li>
<li>Repeatable：可重复执行，而不是随时间变化而不可预测</li>
<li>Self-validating：可以自我验证结果，不需要人工干预，也就是使用Assert，而不是打印出来判断</li>
<li>Timely：及时性，你肯定不会等代码上线了才来补测试把，能尽快就尽快</li>
</ul>
<h2 id="AIR"><a href="#AIR" class="headerlink" title="AIR"></a>AIR</h2><p>阿里的空气原则，来自Java开发手册：</p>
<ul>
<li>Automatic:自动化，类似Self-validating</li>
<li>Independent：独立性，等于隔离性</li>
<li>Repeatable：可重复性</li>
</ul>
<h1 id="测试的最佳实践"><a href="#测试的最佳实践" class="headerlink" title="测试的最佳实践"></a>测试的最佳实践</h1><h2 id="BCDE原则"><a href="#BCDE原则" class="headerlink" title="BCDE原则"></a>BCDE原则</h2><p>阿里手册里提到的关于测试的范围的原则：</p>
<ul>
<li>B：Border，边界值测试，包括循环边界、特殊取值、特殊时间点、数据顺序等。</li>
<li>C：Correct，正确的输入，并得到预期的结果。</li>
<li>D：Design，与设计文档相结合，来编写单元测试。</li>
<li>E：Error，强制错误信息输入（如：非法数据、异常流程、非业务允许输入等），并得<br>到预期的结果。</li>
</ul>
<h2 id="命名清晰"><a href="#命名清晰" class="headerlink" title="命名清晰"></a>命名清晰</h2><p>关于测试方法的命名不需要节省字符，尽量把做什么和期待什么结果写出来，这样注释就可以省了：比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">testCreateUserCorrect()</span><br><span class="line">testCreateUserNullShouldThrowException()</span><br><span class="line">testCreateUserDuplicatedShouldFail()</span><br></pre></td></tr></table></figure>

<h2 id="测试代码与业务代码分离"><a href="#测试代码与业务代码分离" class="headerlink" title="测试代码与业务代码分离"></a>测试代码与业务代码分离</h2><h2 id="对异常的捕获"><a href="#对异常的捕获" class="headerlink" title="对异常的捕获"></a>对异常的捕获</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test(expected=SomeDomainSpecificException.SubException.class)</span></span><br></pre></td></tr></table></figure>

<h2 id="别依赖于你的机器"><a href="#别依赖于你的机器" class="headerlink" title="别依赖于你的机器"></a>别依赖于你的机器</h2><p>单元测试里不应该包含只有你的电脑上才有的东西，比如一个PATH路径，一个文件之类的。</p>
<h2 id="DAO层如何测试"><a href="#DAO层如何测试" class="headerlink" title="DAO层如何测试"></a>DAO层如何测试</h2><h2 id="Service层如何测试"><a href="#Service层如何测试" class="headerlink" title="Service层如何测试"></a>Service层如何测试</h2><p>使用spring Mock</p>
<h1 id="我们的测试规范"><a href="#我们的测试规范" class="headerlink" title="我们的测试规范"></a>我们的测试规范</h1><h2 id="Junit"><a href="#Junit" class="headerlink" title="Junit"></a>Junit</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BeforeClass</span></span><br><span class="line"><span class="meta">@AfterClass</span></span><br></pre></td></tr></table></figure>

<h1 id="java和scala如何写单元测试"><a href="#java和scala如何写单元测试" class="headerlink" title="java和scala如何写单元测试"></a>java和scala如何写单元测试</h1>
      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>可能大家会觉得，单元测试有什么好讲的，那请大家思考以下问题：</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/28/basic/003-unit-testing/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/28/basic/003-unit-testing/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/28/basic/003-unit-testing/" data-id="cl1fw7fho000jvkd34xr30u4r" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a><span class="article-tag-list-count">1</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/018-spring-builder" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/25/java/018-spring-builder/" class="article-date">
  <time datetime="2018-10-25T00:46:45.000Z" itemprop="datePublished">2018-10-25</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/25/java/018-spring-builder/">spring中的builder模式</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本文学习Spring框架中使用的Builder模式，从模仿到应用（举个例子）。</p>
<h1 id="builder模式理解"><a href="#builder模式理解" class="headerlink" title="builder模式理解"></a>builder模式理解</h1><p><a target="_blank" rel="noopener" href="http://www.runoob.com/design-pattern/builder-pattern.html">导读</a>.</p>
<p>所以，如果你读了上面的例子，会发现几个不变的东西：</p>
<ol>
<li>意图是什么： 就是你认为用户搞不清楚构造过程，只知道要构建哪些东西，只关注结果而不是过程的老板</li>
<li>举个例子： 麦当劳的套餐组合，电脑的组装，构造一个文件等等</li>
</ol>
<p>那么我们就可以开始了。</p>
<h1 id="Spring中的Builder"><a href="#Spring中的Builder" class="headerlink" title="Spring中的Builder"></a>Spring中的Builder</h1><p>在IDEA里输入Builder，借助智能提示，我们可以找到很多spring里的Builder类，而且大多数是内部类，以下是一些例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.interceptor.CachePutOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ContentDisposition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;</span><br></pre></td></tr></table></figure>

<p>具体细节展示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ConditionMessage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ConditionMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ConditionMessage.Builder <span class="title function_">forCondition</span><span class="params">(String condition, Object... details)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">ConditionMessage</span>()).andCondition(condition, details);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String condition;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">Builder</span><span class="params">(String condition)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.condition = condition;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ConditionMessage <span class="title function_">foundExactly</span><span class="params">(Object result)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.found(<span class="string">&quot;&quot;</span>).items(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentDisposition</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ContentDisposition</span><span class="params">(<span class="meta">@Nullable</span> String type, <span class="meta">@Nullable</span> String name, <span class="meta">@Nullable</span> String filename, <span class="meta">@Nullable</span> Charset charset, <span class="meta">@Nullable</span> Long size, <span class="meta">@Nullable</span> ZonedDateTime creationDate, <span class="meta">@Nullable</span> ZonedDateTime modificationDate, <span class="meta">@Nullable</span> ZonedDateTime readDate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.filename = filename;</span><br><span class="line">        <span class="built_in">this</span>.charset = charset;</span><br><span class="line">        <span class="built_in">this</span>.size = size;</span><br><span class="line">        <span class="built_in">this</span>.creationDate = creationDate;</span><br><span class="line">        <span class="built_in">this</span>.modificationDate = modificationDate;</span><br><span class="line">        <span class="built_in">this</span>.readDate = readDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ContentDisposition.Builder <span class="title function_">builder</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ContentDisposition</span>.BuilderImpl(type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        ContentDisposition.Builder <span class="title function_">name</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">        ContentDisposition.Builder <span class="title function_">filename</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">        ContentDisposition.Builder <span class="title function_">filename</span><span class="params">(String var1, Charset var2)</span>;</span><br><span class="line"></span><br><span class="line">        ContentDisposition.Builder <span class="title function_">size</span><span class="params">(Long var1)</span>;</span><br><span class="line"></span><br><span class="line">        ContentDisposition.Builder <span class="title function_">creationDate</span><span class="params">(ZonedDateTime var1)</span>;</span><br><span class="line"></span><br><span class="line">        ContentDisposition.Builder <span class="title function_">modificationDate</span><span class="params">(ZonedDateTime var1)</span>;</span><br><span class="line"></span><br><span class="line">        ContentDisposition.Builder <span class="title function_">readDate</span><span class="params">(ZonedDateTime var1)</span>;</span><br><span class="line"></span><br><span class="line">        ContentDisposition <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">RequestMappingInfo</span> <span class="keyword">implements</span> <span class="title class_">RequestCondition</span>&lt;RequestMappingInfo&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RequestMappingInfo.Builder <span class="title function_">paths</span><span class="params">(String... paths)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RequestMappingInfo</span>.DefaultBuilder(paths);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        RequestMappingInfo.Builder <span class="title function_">paths</span><span class="params">(String... var1)</span>;</span><br><span class="line"></span><br><span class="line">        RequestMappingInfo.Builder <span class="title function_">methods</span><span class="params">(RequestMethod... var1)</span>;</span><br><span class="line"></span><br><span class="line">        RequestMappingInfo.Builder <span class="title function_">params</span><span class="params">(String... var1)</span>;</span><br><span class="line"></span><br><span class="line">        RequestMappingInfo.Builder <span class="title function_">headers</span><span class="params">(String... var1)</span>;</span><br><span class="line"></span><br><span class="line">        RequestMappingInfo.Builder <span class="title function_">consumes</span><span class="params">(String... var1)</span>;</span><br><span class="line"></span><br><span class="line">        RequestMappingInfo.Builder <span class="title function_">produces</span><span class="params">(String... var1)</span>;</span><br><span class="line"></span><br><span class="line">        RequestMappingInfo.Builder <span class="title function_">mappingName</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">        RequestMappingInfo.Builder <span class="title function_">customCondition</span><span class="params">(RequestCondition&lt;?&gt; var1)</span>;</span><br><span class="line"></span><br><span class="line">        RequestMappingInfo.Builder <span class="title function_">options</span><span class="params">(RequestMappingInfo.BuilderConfiguration var1)</span>;</span><br><span class="line"></span><br><span class="line">        RequestMappingInfo <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我想敏感的人已经看出来这是一个统一的模式，模式如下：</p>
<ol>
<li>Builder都是被构建类的内部类，且被构建类提供了一个静态创建Builder的方法</li>
<li>Builder会返回构建的类，可能通过<code>build()</code>方法，也可能其他方法</li>
<li>构建过程有很多参数，如果参数少，直接用构造函数好一点，且参数可以有默认值，用户只需选择想要的参数</li>
</ol>
<p>现在我们提取出这套模式代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BuilderTemplate</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Object param1;</span><br><span class="line">	<span class="keyword">private</span> Object param2;</span><br><span class="line">	<span class="comment">// params...</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造函数,一般为private,也可能根据需要为public,取决于需求</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@date</span> 2018/10/25 9:48</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">BuilderTemplate</span><span class="params">(Object param1, Object param2)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.param1 = param1;</span><br><span class="line">		<span class="built_in">this</span>.param2 = param2;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title function_">builder</span><span class="params">(Object... params)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BuilderImpl</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BuilderImpl</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">		Object param1;</span><br><span class="line">		Object param2;</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">method1</span><span class="params">(Object param1)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.param1 = param1;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">method2</span><span class="params">(Object param2)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.param2 = param2;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> BuilderTemplate <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="comment">// 也可能复杂一点的构造过程,比如有顺序之类的</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BuilderTemplate</span>(param1, param2);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// other methods</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">		Builder <span class="title function_">method1</span><span class="params">(Object param1)</span>;</span><br><span class="line"></span><br><span class="line">		Builder <span class="title function_">method2</span><span class="params">(Object param2)</span>;</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">		BuilderTemplate <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如何使用呢？我想大家已经很熟悉了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">BuilderTemplate</span> <span class="variable">template</span> <span class="operator">=</span> BuilderTemplate.builder()</span><br><span class="line">        .method1(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">        .method2(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line"><span class="comment">// 调用template对象的其他方法</span></span><br></pre></td></tr></table></figure>

<h1 id="模仿到应用"><a href="#模仿到应用" class="headerlink" title="模仿到应用"></a>模仿到应用</h1><p>假如我们开了个对象中介所，给广大男女找寻另一半，伟大的工作，哈。<br>关键来了：找对象的人只会提要求（身高，体重，美貌，家境等），而不知道如何去找这样的人，这个就交给我们了。</p>
<p>为了简化一点，我们暂时只定义以下4条件：</p>
<ol>
<li>身高（cm）</li>
<li>年龄（范围）</li>
<li>颜值（数字1-10）</li>
<li>收入（最低）</li>
</ol>
<p>当然有些人没有条件，只要是异性就行（鉴于我国法律还没有允许同性婚姻，暂时保持异性把），这样就可以什么条件都不传。</p>
<p>以下就是按照模板写的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 婚姻中介所</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/10/25 10:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MarriageAgency</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> Description desc;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">MarriageAgency</span><span class="params">(Description desc)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.desc = desc;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@date</span> 2018/10/25 10:42</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BuilderImpl</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 从数据库检索符合条件的对象</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> client 想找对象的人</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@date</span> 2018/10/25 10:17</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findMate</span><span class="params">(Description client)</span> &#123;</span><br><span class="line">		desc.sex = client.sex == <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 对象描述信息</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@date</span> 2018/10/25 10:36</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Description</span> &#123;</span><br><span class="line">		<span class="type">int</span> height;</span><br><span class="line">		Age age;</span><br><span class="line">		<span class="type">int</span> income;</span><br><span class="line">		<span class="type">int</span> beautiness;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 0:男性,1:女性</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="type">int</span> sex;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Age</span> &#123;</span><br><span class="line">		<span class="type">int</span> low;</span><br><span class="line">		<span class="type">int</span> high;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="title function_">Age</span><span class="params">(<span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.low = low;</span><br><span class="line">			<span class="built_in">this</span>.high = high;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BuilderImpl</span> <span class="keyword">implements</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line"></span><br><span class="line">		Description desc;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">height</span><span class="params">(<span class="type">int</span> height)</span> &#123;</span><br><span class="line">			Assert.isTrue(height &gt; <span class="number">10</span> &amp;&amp; height &lt; <span class="number">300</span>, <span class="string">&quot;这不是合法的人类高度&quot;</span>);</span><br><span class="line">			<span class="built_in">this</span>.desc.height = height;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">ageBetween</span><span class="params">(<span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.desc.age = <span class="keyword">new</span> <span class="title class_">Age</span>(low, high);</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">income</span><span class="params">(<span class="type">int</span> low)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.desc.income = low;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Builder <span class="title function_">beautiness</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.desc.beautiness = value;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> MarriageAgency <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">		Builder <span class="title function_">height</span><span class="params">(<span class="type">int</span> height)</span>;</span><br><span class="line"></span><br><span class="line">		Builder <span class="title function_">ageBetween</span><span class="params">(<span class="type">int</span> low, <span class="type">int</span> high)</span>;</span><br><span class="line"></span><br><span class="line">		Builder <span class="title function_">income</span><span class="params">(<span class="type">int</span> low)</span>;</span><br><span class="line"></span><br><span class="line">		Builder <span class="title function_">beautiness</span><span class="params">(<span class="type">int</span> value)</span>;</span><br><span class="line"></span><br><span class="line">		MarriageAgency <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">MarriageAgency</span> <span class="variable">agency</span> <span class="operator">=</span> MarriageAgency.builder()</span><br><span class="line">        .ageBetween(<span class="number">20</span>, <span class="number">30</span>)</span><br><span class="line">        .beautiness(<span class="number">9</span>)</span><br><span class="line">        .height(<span class="number">160</span>)</span><br><span class="line">        .income(<span class="number">10000</span>)</span><br><span class="line">        .build();</span><br><span class="line">agency.findMate(<span class="keyword">new</span> <span class="title class_">Description</span>());</span><br></pre></td></tr></table></figure>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本文学习Spring框架中使用的Builder模式，从模仿到应用（举个例子）。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/25/java/018-spring-builder/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/25/java/018-spring-builder/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/25/java/018-spring-builder/" data-id="cl1fw7fkx009jvkd323d1fupn" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/spring/" rel="tag">spring</a><span class="article-tag-list-count">12</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-js/004-js-new-concept" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/19/js/004-js-new-concept/" class="article-date">
  <time datetime="2018-10-19T06:18:22.000Z" itemprop="datePublished">2018-10-19</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/19/js/004-js-new-concept/">js高级编程必知</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>下面是高级或冷门js知识。</p>
<h1 id="1-script标签"><a href="#1-script标签" class="headerlink" title="1.script标签"></a>1.script标签</h1><p>看一般导入外部js文件的语法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/xxx.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>html不支持<code>/&gt;</code>语法，但XHTML支持，所以XHTML里可以写：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/xxx.js&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>script的type属性默认为<code>text/javascript</code>，虽然已经过时，但大家都这样用所以成默认了。</p>
<p>noscript标签：会在下面的情况下显示(不过现在很少见了)</p>
<ol>
<li>浏览器不支持脚本</li>
<li>浏览器禁用脚本<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span>请支持（启用）浏览器脚本<span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="2-严格模式"><a href="#2-严格模式" class="headerlink" title="2.严格模式"></a>2.严格模式</h1><h2 id="2-1-声明方式"><a href="#2-1-声明方式" class="headerlink" title="2.1 声明方式"></a>2.1 声明方式</h2><p>在文件开始或方法内开始：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-2-那些严格的限制"><a href="#2-2-那些严格的限制" class="headerlink" title="2.2 那些严格的限制"></a>2.2 那些严格的限制</h2><ol>
<li>不能声明eval或arguments的变量</li>
<li>不能删除未定义变量：<code>&quot;use strict&quot;; delete a; VM786:1 Uncaught SyntaxError: Delete of an unqualified identifier in strict mode.</code></li>
</ol>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Number(<span class="literal">true</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line">Number(<span class="literal">false</span>)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h1><h2 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h2><p>值类型：基本类型</p>
<p>引用类型：对象</p>
<p>参数传递：值传递</p>
<p>typeof 与 instanceof</p>
<p>常用引用类型：</p>
<h3 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h3><p><code>var person = new Object() or var person = &#123;&#125;</code></p>
<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><p><code>var arrs = new Array() or var arr = [];</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var color = [&quot;black&quot;];</span><br><span class="line">color[99] = &quot;red&quot;;</span><br><span class="line">console.log(color.length) == 100</span><br></pre></td></tr></table></figure>
<p>检测数组：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array.isArray(value)</span><br></pre></td></tr></table></figure>
<p>转换为字符串：<br><code>toString() 和 toLocalString() </code>,后者调用数组元素的方法。</p>
<p>Array可以当栈用：<code>push() pop()</code></p>
<p>也可以当队列用：<code>push() shift() or unshift() pop()</code></p>
<p>重排序：<code>sort(compare_func) or reverse()</code></p>
<p>数组切分、连接<br><code>slice(begin,end), concat(arr)</code></p>
<p>强大的删除、插入、替换方法：splice(…)</p>
<p>位置方法<br><code>indexOf() , lastIndexOf()</code></p>
<p>迭代方法<br><code>every(func), filter(), forEach(), map(), some()</code></p>
<p>缩小方法：<code>reduce(prev,curr,index,array)</code></p>
<h3 id="Date对象"><a href="#Date对象" class="headerlink" title="Date对象"></a>Date对象</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">new Date(Date.parse(&quot;2018-10-01&quot;))</span><br><span class="line">Mon Oct 01 2018 08:00:00 GMT+0800 (中国标准时间)</span><br><span class="line"></span><br><span class="line">// 区别：月份、小时从0开始</span><br><span class="line">new Date(Date.UTC(2018,10,1))</span><br><span class="line">Thu Nov 01 2018 08:00:00 GMT+0800 (中国标准时间)</span><br></pre></td></tr></table></figure>

<h3 id="RegExp对象"><a href="#RegExp对象" class="headerlink" title="RegExp对象"></a>RegExp对象</h3><p><code>var exp = / pattern / flags(i,g,m)</code></p>
<h3 id="Function类型"><a href="#Function类型" class="headerlink" title="Function类型"></a>Function类型</h3><p>实际上是对象类型。</p>
<p>没有重载</p>
<h2 id="变量没有块级作用域"><a href="#变量没有块级作用域" class="headerlink" title="变量没有块级作用域"></a>变量没有块级作用域</h2><p>只有执行环境，没有var声明的变量成为全局变量。</p>
<p>有以下环境：</p>
<ol>
<li>函数环境</li>
<li>全局环境（window）</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function bu()&#123;</span><br><span class="line">	var url = &quot;jiko&quot;;</span><br><span class="line">	with(url)&#123;</span><br><span class="line">		var kk = url+&quot;11&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	function b2()&#123;</span><br><span class="line">		var cc = 1;</span><br><span class="line">	&#125;</span><br><span class="line">	console.log(cc);</span><br><span class="line">	return kk;</span><br><span class="line">&#125;</span><br><span class="line">// Uncaught ReferenceError: cc is not defined</span><br></pre></td></tr></table></figure>


<h2 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h2><ol>
<li>引用计数（废弃）</li>
<li>标记清除</li>
</ol>
<h1 id="OOP"><a href="#OOP" class="headerlink" title="OOP"></a>OOP</h1><p><a target="_blank" rel="noopener" href="https://jsfiddle.net/">https://jsfiddle.net/</a></p>
<p><a target="_blank" rel="noopener" href="https://playcode.io/150941?tabs=console&amp;script.js&amp;output">https://playcode.io/150941?tabs=console&amp;script.js&amp;output</a></p>
<h2 id="ECMA5"><a href="#ECMA5" class="headerlink" title="ECMA5"></a>ECMA5</h2><p>ECMA5没有类的概念，类只是属性和函数的集合。</p>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000007908692">关于枚举属性</a></p>
<h4 id="属性类型："><a href="#属性类型：" class="headerlink" title="属性类型："></a>属性类型：</h4><ol>
<li>configurable：删除属性重定义 or 修改属性配置</li>
<li>enumerable：for-in循环返回属性</li>
<li>writable：可修改<strong>值</strong></li>
<li>value：默认undefined</li>
</ol>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(person,<span class="string">&quot;name&quot;</span>,&#123;</span><br><span class="line">		<span class="attr">configuration</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&quot;jimo&quot;</span>,</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改值</span></span><br><span class="line">person.<span class="property">name</span> = <span class="string">&quot;hehe&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改配置</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(person,<span class="string">&quot;name&quot;</span>,&#123;</span><br><span class="line">		<span class="attr">configuration</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&quot;tudou&quot;</span>,</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历属性</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> p <span class="keyword">in</span> person)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：在严格模式下的区别</p>
<h4 id="访问器属性："><a href="#访问器属性：" class="headerlink" title="访问器属性："></a>访问器属性：</h4><ol>
<li>configuration：修改，重定义</li>
<li>enumerable：遍历属性</li>
<li>get：读取时调用，默认undefined</li>
<li>set：写入时调用，默认undefined</li>
</ol>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* &quot;use strict&quot;; */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">   <span class="attr">_name</span>: <span class="string">&quot;jimo&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">_name</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(person,<span class="string">&quot;name&quot;</span>,&#123;</span><br><span class="line">       <span class="attr">configuration</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="comment">//enumerable: false,</span></span><br><span class="line">   <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;调用getter&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span>  <span class="variable language_">this</span>.<span class="property">_name</span>;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">newName</span>)&#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;调用setter&quot;</span>);</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">_name</span> = newName;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只定义了get或set</span></span><br><span class="line">person.<span class="property">name</span> = <span class="string">&quot;hehe&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改配置</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(person,<span class="string">&quot;name&quot;</span>,&#123;</span><br><span class="line">       <span class="attr">configuration</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">value</span>: <span class="string">&quot;tudou&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历属性</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> p <span class="keyword">in</span> person)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>可以只定义getter或setter其中一个</li>
<li>支持这个方法：IE9+</li>
<li>value&#x2F;writeable和get&#x2F;set不能一起定义：<code>(index):37 Uncaught TypeError: Invalid property descriptor. Cannot both specify accessors and a value or writable attribute, #&lt;Object&gt;</code></li>
<li><code>_name</code>只是一种共识，不是强制的规定</li>
</ol>
<h4 id="定义多个属性"><a href="#定义多个属性" class="headerlink" title="定义多个属性"></a>定义多个属性</h4><p>上面都是对一个属性单独的定义，下面可以一次定义多个：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* &quot;use strict&quot;; */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(person, &#123;</span><br><span class="line">   <span class="attr">_name</span>: &#123;</span><br><span class="line">   <span class="attr">value</span>: <span class="string">&quot;jimo&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">age</span>: &#123;</span><br><span class="line">   <span class="attr">value</span>: <span class="number">100</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">name</span>: &#123;</span><br><span class="line">   <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">name</span>);</span><br></pre></td></tr></table></figure>

<h4 id="读取属性"><a href="#读取属性" class="headerlink" title="读取属性"></a>读取属性</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(person, &#123;</span><br><span class="line">   <span class="attr">_name</span>: &#123;</span><br><span class="line">   <span class="attr">value</span>: <span class="string">&quot;jimo&quot;</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">age</span>: &#123;</span><br><span class="line">   <span class="attr">value</span>: <span class="number">100</span></span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">name</span>: &#123;</span><br><span class="line">   <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单个</span></span><br><span class="line"><span class="keyword">var</span> desc = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(person, <span class="string">&quot;_name&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(desc);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个</span></span><br><span class="line"><span class="keyword">var</span> descs = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(person);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(descs);</span><br><span class="line"><span class="comment">// or 包括可枚举和不可枚举的</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(person).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">key</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key,person[key]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以枚举的</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> p <span class="keyword">in</span> person)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h3><p>接下来的方式多种多样，原因在于解决原始创建方式的一些弊端：</p>
<ol>
<li>创建的繁琐，重复性；</li>
<li>会产生重复代码，不可重用；</li>
</ol>
<p>根本原因：程序员的洁癖特征。</p>
<h4 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createPerson</span>(<span class="params">name,age,job</span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> o = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">  o.<span class="property">name</span> = name;</span><br><span class="line">  o.<span class="property">age</span> = age;</span><br><span class="line">  o.<span class="property">job</span> = job;</span><br><span class="line">  o.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="title function_">createPerson</span>(<span class="string">&quot;jimo&quot;</span>,<span class="number">100</span>,<span class="string">&quot;teacher&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="title function_">createPerson</span>(<span class="string">&quot;hehe&quot;</span>,<span class="number">99</span>,<span class="string">&quot;doctor&quot;</span>);</span><br><span class="line"></span><br><span class="line">person1.<span class="title function_">sayName</span>();</span><br><span class="line">person2.<span class="title function_">sayName</span>();</span><br></pre></td></tr></table></figure>
<p>解决的问题：相似对象的多次创建；</p>
<p>存在的问题：对象识别问题（如何知道一个对象的类型）</p>
<h4 id="构造函数模式"><a href="#构造函数模式" class="headerlink" title="构造函数模式"></a>构造函数模式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name,age,job</span>)&#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">job</span> = job;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jimo&quot;</span>,<span class="number">100</span>,<span class="string">&quot;teacher&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;hehe&quot;</span>,<span class="number">99</span>,<span class="string">&quot;doctor&quot;</span>);</span><br><span class="line"></span><br><span class="line">person1.<span class="title function_">sayName</span>();</span><br><span class="line">person2.<span class="title function_">sayName</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造函数属性</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">constructor</span> == <span class="title class_">Person</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person2.<span class="property">constructor</span> == <span class="title class_">Person</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断类型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1 <span class="keyword">instanceof</span> <span class="title class_">Object</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1 <span class="keyword">instanceof</span> <span class="title class_">Person</span>);</span><br></pre></td></tr></table></figure>
<p>为什么上面的代码成立？ 因为函数也是对象，function也是Object，所以可以new出来。</p>
<p>也可以直接调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接当函数调用</span></span><br><span class="line"><span class="title class_">Person</span>(<span class="string">&quot;kaka&quot;</span>,<span class="number">101</span>,<span class="string">&quot;loser&quot;</span>);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">sayName</span>();</span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">window</span>,<span class="string">&quot;lala&quot;</span>,<span class="number">11</span>,<span class="string">&quot;Nurse&quot;</span>);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">sayName</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在另一个作用域内调用</span></span><br><span class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">call</span>(o,<span class="string">&quot;xixi&quot;</span>,<span class="number">11</span>,<span class="string">&quot;Nurse&quot;</span>);</span><br><span class="line">o.<span class="title function_">sayName</span>();</span><br></pre></td></tr></table></figure>
<p>解决的问题：对象识别</p>
<p>存在的问题：函数<code>sayName()</code>每次都被重新创建，本可以共享的，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name,age,job</span>)&#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">job</span> = job;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">sayName</span> = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">&quot;console.log(this.name)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以移到外面：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name,age,job</span>)&#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">job</span> = job;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">sayName</span> = sayName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayName</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但这样破坏了<strong>封装性</strong>.</p>
<h4 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&quot;jimo&quot;</span>;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">age</span> = <span class="number">100</span>;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">job</span> = <span class="string">&quot;teacher&quot;</span>;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p1.<span class="title function_">sayName</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p2.<span class="title function_">sayName</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">sayName</span> === p2.<span class="property">sayName</span>);</span><br></pre></td></tr></table></figure>
<h5 id="如何理解原型对象"><a href="#如何理解原型对象" class="headerlink" title="如何理解原型对象"></a>如何理解原型对象</h5><img src="/2018/10/19/js/004-js-new-concept/001.png" class="">

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断原型对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">isPrototypeOf</span>(p1));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">isPrototypeOf</span>(p2));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(p1) === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(p1).<span class="property">name</span>);</span><br></pre></td></tr></table></figure>
<p>修改属性的值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p1.<span class="property">name</span> = <span class="string">&quot;hehe&quot;</span>;</span><br><span class="line">p1.<span class="title function_">sayName</span>();</span><br><span class="line">p2.<span class="title function_">sayName</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 证明这个值是p1实例的</span></span><br><span class="line"><span class="keyword">delete</span> p1.<span class="property">name</span>;</span><br><span class="line">p1.<span class="title function_">sayName</span>();</span><br></pre></td></tr></table></figure>
<h5 id="理解原型链"><a href="#理解原型链" class="headerlink" title="理解原型链"></a>理解原型链</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&quot;jimo&quot;</span>;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">age</span> = <span class="number">100</span>;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">job</span> = <span class="string">&quot;teacher&quot;</span>;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p1.<span class="title function_">sayName</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p2.<span class="title function_">sayName</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">p1.<span class="property">name</span> = <span class="string">&quot;hehe&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;name&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;name&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> p1.<span class="property">name</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="title function_">hasOwnProperty</span>(<span class="string">&quot;name&quot;</span>));</span><br></pre></td></tr></table></figure>
<img src="/2018/10/19/js/004-js-new-concept/002.png" class="">

<h5 id="in操作符"><a href="#in操作符" class="headerlink" title="in操作符"></a>in操作符</h5><p>不管name属性是在哪，只要有就返回true</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name&quot;</span> <span class="keyword">in</span> p1);</span><br></pre></td></tr></table></figure>

<p>&#x2F;&#x2F; TODO 访问属性</p>
<h5 id="更简单的原型语法"><a href="#更简单的原型语法" class="headerlink" title="更简单的原型语法"></a>更简单的原型语法</h5><p>上面每次输入Person.prototype太麻烦，可以简化：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;jimo&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">job</span>: <span class="string">&quot;teacher&quot;</span>,</span><br><span class="line">  <span class="attr">sayName</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p1.<span class="title function_">sayName</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意，这样的constructor指向变了：</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">constructor</span> == <span class="title class_">Person</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">constructor</span> == <span class="title class_">Object</span>);</span><br></pre></td></tr></table></figure>
<p>于是继续修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示设置constructor的值</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="attr">constructor</span>: <span class="title class_">Person</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;jimo&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">job</span>: <span class="string">&quot;teacher&quot;</span>,</span><br><span class="line">  <span class="attr">sayName</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p1.<span class="title function_">sayName</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">constructor</span> == <span class="title class_">Person</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 但这样会导致constructor属性的enumerable为true，所以再改改：</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>,<span class="string">&quot;constructor&quot;</span>,&#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">value</span>: <span class="title class_">Person</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="动态性"><a href="#动态性" class="headerlink" title="动态性"></a>动态性</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增方法</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHi</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">p1.<span class="title function_">sayHi</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 但是，如果重新定义就会出问题</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="attr">constructor</span>: <span class="title class_">Person</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;jimo&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">job</span>: <span class="string">&quot;teacher&quot;</span>,</span><br><span class="line">  <span class="attr">sayName</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">sayYes</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">p1.<span class="title function_">sayYes</span>();</span><br></pre></td></tr></table></figure>
<p>为什么？</p>
<img src="/2018/10/19/js/004-js-new-concept/003.png" class="">

<h5 id="原生对象的原型"><a href="#原生对象的原型" class="headerlink" title="原生对象的原型"></a>原生对象的原型</h5><p>现在，我们可以理解原生对象的原型了，并且可以重写他们：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sort</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">substring</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增方法</span></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">startsWith</span> = <span class="keyword">function</span>(<span class="params">text</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">indexOf</span>(text) === <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;jimo haha&quot;</span>.<span class="title function_">startsWith</span>(<span class="string">&quot;jimo&quot;</span>));</span><br></pre></td></tr></table></figure>
<h5 id="该出问题了"><a href="#该出问题了" class="headerlink" title="该出问题了"></a>该出问题了</h5><p>原型对象的问题很容易理解，对于引用对象也成为共享的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="attr">constructor</span>: <span class="title class_">Person</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;jimo&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">job</span>: <span class="string">&quot;teacher&quot;</span>,</span><br><span class="line">  <span class="attr">friends</span>: [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;xixi&quot;</span>],</span><br><span class="line">  <span class="attr">sayName</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">friends</span>)</span><br><span class="line">p1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&quot;nani&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">friends</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">friends</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">friends</span> === p2.<span class="property">friends</span>);</span><br></pre></td></tr></table></figure>
<h4 id="构造模式-原型模式"><a href="#构造模式-原型模式" class="headerlink" title="构造模式+原型模式"></a>构造模式+原型模式</h4><p>注意他们解决的问题：</p>
<ol>
<li>构造模式：每个对象相互隔离</li>
<li>原型模式：每个对象相互共享</li>
</ol>
<p>我们的目标：属性隔离，方法共享！！！</p>
<p>很容易想到：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name,age,job</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">job</span> = job;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">friends</span> = [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 共享函数</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="attr">constructor</span>: <span class="title class_">Person</span>,</span><br><span class="line">  <span class="attr">sayName</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jimo&quot;</span>,<span class="number">100</span>,<span class="string">&quot;teacher&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;lili&quot;</span>,<span class="number">19</span>,<span class="string">&quot;doctor&quot;</span>);</span><br><span class="line"></span><br><span class="line">p1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&quot;vakin&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">friends</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">friends</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">sayName</span> === p2.<span class="property">sayName</span>);</span><br></pre></td></tr></table></figure>

<p>用处：定义引用类型。</p>
<p>但还没完，程序员的折腾永不停止。。。</p>
<h4 id="动态原型模式"><a href="#动态原型模式" class="headerlink" title="动态原型模式"></a>动态原型模式</h4><p>只因为上面的写法很怪。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name,age,job</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">job</span> = job;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">friends</span> = [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>];</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span>.<span class="property">sayName</span> !== <span class="string">&quot;function&quot;</span>)&#123;</span><br><span class="line">    <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jimo&quot;</span>,<span class="number">100</span>,<span class="string">&quot;teacher&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;lili&quot;</span>,<span class="number">19</span>,<span class="string">&quot;doctor&quot;</span>);</span><br><span class="line"></span><br><span class="line">p1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&quot;vakin&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">friends</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">friends</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">sayName</span> === p2.<span class="property">sayName</span>);</span><br></pre></td></tr></table></figure>
<h4 id="寄生构造函数模式"><a href="#寄生构造函数模式" class="headerlink" title="寄生构造函数模式"></a>寄生构造函数模式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name,age,job</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">  o.<span class="property">name</span> = name;</span><br><span class="line">  o.<span class="property">age</span> = age;</span><br><span class="line">  o.<span class="property">job</span> = job;</span><br><span class="line">  o.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jimo&quot;</span>,<span class="number">100</span>,<span class="string">&quot;teacher&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;lili&quot;</span>,<span class="number">19</span>,<span class="string">&quot;doctor&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">sayName</span> === p2.<span class="property">sayName</span>);</span><br></pre></td></tr></table></figure>

<p>用途：增强原对象功能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">CArray</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> arr = [];</span><br><span class="line">  arr.<span class="property">push</span>.<span class="title function_">apply</span>(arr,<span class="variable language_">arguments</span>);</span><br><span class="line">  <span class="comment">// 添加方法</span></span><br><span class="line">  arr.<span class="property">toPipedString</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">join</span>(<span class="string">&quot;|&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> names = <span class="keyword">new</span> <span class="title class_">CArray</span>(<span class="string">&quot;jimo&quot;</span>,<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(names.<span class="title function_">toPipedString</span>());</span><br></pre></td></tr></table></figure>
<p>存在的问题：构造函数的问题，无法识别类型。</p>
<h4 id="稳妥构造函数模式"><a href="#稳妥构造函数模式" class="headerlink" title="稳妥构造函数模式"></a>稳妥构造函数模式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name,age,job</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">  o.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="title class_">Person</span>(<span class="string">&quot;jimo&quot;</span>,<span class="number">11</span>,<span class="string">&quot;doctor&quot;</span>);</span><br><span class="line">p1.<span class="title function_">sayName</span>();</span><br></pre></td></tr></table></figure>
<p>好处：对象一旦创建完毕就不能修改，且只能使用sayName访问属性，用在安全环境等。</p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>理解接口继承和实现继承。</p>
<h4 id="理解原型链-1"><a href="#理解原型链-1" class="headerlink" title="理解原型链"></a>理解原型链</h4><p>js的继承是通过原型来实现的，所以理解原型链很重要的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Super</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">property</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Super</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getSuperValue</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">property</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Sub</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">subProperty</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承父类</span></span><br><span class="line"><span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Super</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getSubValue</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">subProperty</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> <span class="title class_">Sub</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance.<span class="title function_">getSuperValue</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance.<span class="title function_">getSubValue</span>());</span><br></pre></td></tr></table></figure>

<img src="/2018/10/19/js/004-js-new-concept/004.png" class="">

<p>搜索机制：从低到高，从子到父。</p>
<p>问：instance的constructor属性指向谁？</p>
<h5 id="默认原型"><a href="#默认原型" class="headerlink" title="默认原型"></a>默认原型</h5><img src="/2018/10/19/js/004-js-new-concept/005.png" class="">

<h5 id="原型链的问题"><a href="#原型链的问题" class="headerlink" title="原型链的问题"></a>原型链的问题</h5><p>依然是引用类型的问题：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Super</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&quot;red&quot;</span>,<span class="string">&quot;blue&quot;</span>,<span class="string">&quot;green&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Sub</span>(<span class="params"></span>)&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承父类</span></span><br><span class="line"><span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Super</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ins1 = <span class="keyword">new</span> <span class="title class_">Sub</span>();</span><br><span class="line"><span class="keyword">var</span> ins2 = <span class="keyword">new</span> <span class="title class_">Sub</span>();</span><br><span class="line">ins1.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&quot;black&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ins1.<span class="property">colors</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ins2.<span class="property">colors</span>);</span><br></pre></td></tr></table></figure>
<h4 id="借用构造函数"><a href="#借用构造函数" class="headerlink" title="借用构造函数"></a>借用构造函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Super</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&quot;red&quot;</span>,<span class="string">&quot;blue&quot;</span>,<span class="string">&quot;green&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Sub</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Super</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承父类</span></span><br><span class="line"><span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Super</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ins1 = <span class="keyword">new</span> <span class="title class_">Sub</span>();</span><br><span class="line"><span class="keyword">var</span> ins2 = <span class="keyword">new</span> <span class="title class_">Sub</span>();</span><br><span class="line">ins1.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&quot;black&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ins1.<span class="property">colors</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ins2.<span class="property">colors</span>);</span><br></pre></td></tr></table></figure>
<p>为什么？ this代表了子类对象，也就是现在的环境是Sub，而不是Super了，所以sub会有super的一份副本。</p>
<h5 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Super</span>(<span class="params">name</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Sub</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Super</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>,<span class="string">&quot;jimo&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承父类</span></span><br><span class="line"><span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Super</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ins1 = <span class="keyword">new</span> <span class="title class_">Sub</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ins1.<span class="property">name</span>);</span><br></pre></td></tr></table></figure>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><p>函数无法复用，父类方法不可见。</p>
<h4 id="组合继承：构造-原型"><a href="#组合继承：构造-原型" class="headerlink" title="组合继承：构造+原型"></a>组合继承：构造+原型</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Super</span>(<span class="params">name</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&quot;red&quot;</span>,<span class="string">&quot;blue&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Sub</span>(<span class="params">name,age</span>)&#123;</span><br><span class="line">    <span class="title class_">Super</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>,name);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承父类</span></span><br><span class="line"><span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Super</span>();</span><br><span class="line"><span class="comment">// 原型方法</span></span><br><span class="line"><span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayAge</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ins1 = <span class="keyword">new</span> <span class="title class_">Sub</span>(<span class="string">&quot;jimo&quot;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ins1.<span class="title function_">sayAge</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ins2 = <span class="keyword">new</span> <span class="title class_">Sub</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ins1.<span class="property">sayAge</span> === ins2.<span class="property">sayAge</span>);</span><br></pre></td></tr></table></figure>
<p>存在的问题：Super的构造函数被调用了2次。</p>
<h4 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">copyObject</span>(<span class="params">o</span>)&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;jimo&quot;</span>,</span><br><span class="line">    <span class="attr">friends</span>: [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="title function_">copyObject</span>(person);</span><br><span class="line">p1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&quot;lili&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="title function_">copyObject</span>(person);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">friends</span>);</span><br></pre></td></tr></table></figure>

<p>本质：对象的浅复制。</p>
<p>用处：快速基于已有对象构建新对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">copyObject</span>(<span class="params">o</span>)&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;jimo&quot;</span>,</span><br><span class="line">    <span class="attr">friends</span>: [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5引入了这个方法</span></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="title class_">Object</span>.<span class="title function_">create</span>(person);</span><br><span class="line">p1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&quot;lili&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="title function_">copyObject</span>(person);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">friends</span>);</span><br></pre></td></tr></table></figure>
<h4 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h4><p>同上，基于已有对象增强对象功能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">buildStrong</span>(<span class="params">original</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> clone = <span class="title class_">Object</span>.<span class="title function_">create</span>(original);</span><br><span class="line">    clone.<span class="property">sayHi</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;jimo&quot;</span>,</span><br><span class="line">    <span class="attr">friends</span>: [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="title function_">buildStrong</span>(person);</span><br><span class="line">p1.<span class="title function_">sayHi</span>();</span><br></pre></td></tr></table></figure>
<h4 id="寄生组合式继承"><a href="#寄生组合式继承" class="headerlink" title="寄生组合式继承"></a>寄生组合式继承</h4><p>源于组合式的那点小问题，如下图：</p>
<img src="/2018/10/19/js/004-js-new-concept/006.png" class="">

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inheritPrototype</span>(<span class="params">sub,superType</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> prototype = <span class="title class_">Object</span>.<span class="title function_">create</span>(superType.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    prototype.<span class="property">constructor</span> = sub;</span><br><span class="line">    sub.<span class="property"><span class="keyword">prototype</span></span> = prototype;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Super</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&quot;red&quot;</span>,<span class="string">&quot;blue&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Super</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Sub</span>(<span class="params">name,age</span>)&#123;</span><br><span class="line">    <span class="title class_">Super</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>,name);</span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">inheritPrototype</span>(<span class="title class_">Sub</span>,<span class="title class_">Super</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayAge</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ins1 = <span class="keyword">new</span> <span class="title class_">Sub</span>(<span class="string">&quot;jimo&quot;</span>,<span class="number">100</span>);</span><br><span class="line">ins1.<span class="title function_">sayName</span>();</span><br><span class="line">ins1.<span class="title function_">sayAge</span>();</span><br></pre></td></tr></table></figure>
<p>问题：这种方式真的是继承吗？哪里体现了？</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>问2个问题就行：</p>
<ol>
<li>创建对象最常用的方式是什么？</li>
<li>继承最常用的方式是什么？</li>
</ol>
<h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><p><a target="_blank" rel="noopener" href="http://es6-features.org/#ClassDefinition">http://es6-features.org/#ClassDefinition</a></p>
<p><a target="_blank" rel="noopener" href="https://es6.ruanyifeng.com/#docs/class">https://es6.ruanyifeng.com/#docs/class</a></p>
<p>ES6引入了class关键字，但只是一种语法，ES5都可以实现，只是有了class之后更符合OOP的表演。</p>
<h3 id="一个简单例子"><a href="#一个简单例子" class="headerlink" title="一个简单例子"></a>一个简单例子</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name,age</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">friends</span> = [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">toString</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;name:&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;,age:&quot;</span> + <span class="variable language_">this</span>.<span class="property">age</span> + <span class="string">&quot;,friends:&quot;</span> + <span class="variable language_">this</span>.<span class="property">friends</span>.<span class="title function_">join</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jimo&quot;</span>,<span class="number">100</span>);</span><br><span class="line">p1.<span class="property">friends</span>.<span class="title function_">push</span>(<span class="string">&quot;qiqi&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;lili&quot;</span>,<span class="number">101</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实质是函数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Person</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Person</span> === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">toString</span> === p2.<span class="property">toString</span>);</span><br></pre></td></tr></table></figure>

<p>和ES5的不同点：</p>
<ol>
<li>方法不可枚举：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name,age</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">friends</span> = [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">toString</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;name:&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;,age:&quot;</span> + <span class="variable language_">this</span>.<span class="property">age</span> + <span class="string">&quot;,friends:&quot;</span> + <span class="variable language_">this</span>.<span class="property">friends</span>.<span class="title function_">join</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>));</span><br></pre></td></tr></table></figure></li>
<li>ES6默认使用严格模式</li>
<li>必须new一个对象，而函数可以直接执行<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name,age</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">friends</span> = [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">toString</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;name:&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;,age:&quot;</span> + <span class="variable language_">this</span>.<span class="property">age</span> + <span class="string">&quot;,friends:&quot;</span> + <span class="variable language_">this</span>.<span class="property">friends</span>.<span class="title function_">join</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="title class_">Person</span>();</span><br><span class="line"><span class="comment">// Uncaught TypeError: Class constructor Person cannot be invoked without &#x27;new&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="proto-属性"><a href="#proto-属性" class="headerlink" title="__proto__属性"></a>__proto__属性</h3><p><code>__proto__</code> 并不是语言本身的特性，这是各大厂商具体实现时添加的私有属性，虽然目前很多现代浏览器的 JS 引擎中都提供了这个私有属性，但依旧不建议在生产中使用该属性，避免对环境产生依赖。生产环境中，我们可以使用 <code>Object.getPrototypeOf</code> 方法来获取实例对象的原型，然后再来为原型添加方法&#x2F;属性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name,age</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">friends</span> = [<span class="string">&quot;kaka&quot;</span>,<span class="string">&quot;hehe&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">toString</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;name:&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;,age:&quot;</span> + <span class="variable language_">this</span>.<span class="property">age</span> + <span class="string">&quot;,friends:&quot;</span> + <span class="variable language_">this</span>.<span class="property">friends</span>.<span class="title function_">join</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">__proto__</span> === p2.<span class="property">__proto__</span>);</span><br></pre></td></tr></table></figure>
<h3 id="类表达式"><a href="#类表达式" class="headerlink" title="类表达式"></a>类表达式</h3><p>和函数表达式类似，赋给变量的类：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Person</span> = <span class="keyword">class</span> <span class="title class_">P</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">friends</span> = [<span class="string">&quot;kaka&quot;</span>, <span class="string">&quot;hehe&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(P.<span class="property">name</span>,P);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;name:&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;,age:&quot;</span> + <span class="variable language_">this</span>.<span class="property">age</span> + <span class="string">&quot;,friends:&quot;</span> + <span class="variable language_">this</span>.<span class="property">friends</span>.<span class="title function_">join</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jimo&quot;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure>

<p>当然也可以省略名称。</p>
<h3 id="匿名类"><a href="#匿名类" class="headerlink" title="匿名类"></a>匿名类</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> <span class="keyword">class</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">sayName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(<span class="string">&#x27;jimo&#x27;</span>);</span><br><span class="line"></span><br><span class="line">person.<span class="title function_">sayName</span>();</span><br></pre></td></tr></table></figure>
<h3 id="没有变量提升"><a href="#没有变量提升" class="headerlink" title="没有变量提升"></a>没有变量提升</h3><p>即不可以先使用，后定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Uncaught ReferenceError: Person is not defined</span></span><br></pre></td></tr></table></figure>
<p>原因：与继承有关。</p>
<h3 id="get-x2F-set属性"><a href="#get-x2F-set属性" class="headerlink" title="get&#x2F;set属性"></a>get&#x2F;set属性</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">name</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">n</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_name</span> = n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ins = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;jimo&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ins.<span class="property">name</span>);</span><br></pre></td></tr></table></figure>
<p>注意：<code>_name</code>依然只是建议，如果属性和方法名一样，会造成栈溢出。</p>
<h3 id="静态方法和属性"><a href="#静态方法和属性" class="headerlink" title="静态方法和属性"></a>静态方法和属性</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">sayName</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">sayName</span>();</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">p.<span class="title function_">sayName</span>();</span><br></pre></td></tr></table></figure>
<p>静态方法可以继承。</p>
<p>ES6没规定静态属性，但可以这样实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">sayName</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property">name</span> = <span class="string">&quot;jimo&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">new</span>.<span class="property">target</span> === <span class="title class_">Animal</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;本类无法实例化&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">printName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name, size</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(name);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">size</span> = size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">printName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">printName</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;size:&quot;</span>+ <span class="variable language_">this</span>.<span class="property">size</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">Bird</span>(<span class="string">&quot;麻雀&quot;</span>,<span class="number">12</span>);</span><br><span class="line">b.<span class="title function_">printName</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br></pre></td></tr></table></figure>

<h1 id="函数表达式"><a href="#函数表达式" class="headerlink" title="函数表达式"></a>函数表达式</h1><h2 id="什么是this"><a href="#什么是this" class="headerlink" title="什么是this"></a>什么是this</h2><p>是<strong>运行时</strong>对象基于执行环境绑定的，注意是运行时，也就是说可以动态改变this。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* var tag = &quot;window-age&quot;; */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">    <span class="attr">tag</span>: <span class="string">&quot;jimo&quot;</span>,</span><br><span class="line">    <span class="attr">getFunc</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> tag = <span class="string">&quot;hehe&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> tag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模仿块级作用域"><a href="#模仿块级作用域" class="headerlink" title="模仿块级作用域"></a>模仿块级作用域</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">output</span>(<span class="params">count</span>) &#123;</span><br><span class="line">    (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">output</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>等价于：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">output</span>(<span class="params">count</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> func = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">func</span>();</span><br><span class="line">    <span class="comment">// error</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">output</span>(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>这种匿名闭包的好处：</p>
<ol>
<li>大型多人开发中避免命名冲突，不会搞乱全局作用域；</li>
<li>减少内存占用，因为运行完会被立即回收；</li>
</ol>
<h2 id="模块模式"><a href="#模块模式" class="headerlink" title="模块模式"></a>模块模式</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//私有变量和函数</span></span><br><span class="line">    <span class="keyword">var</span> components = [];</span><br><span class="line">    </span><br><span class="line">    components.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 公共方法</span></span><br><span class="line">    app.<span class="property">getCount</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> components.<span class="property">length</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    app.<span class="property">addComponent</span> = <span class="keyword">function</span>(<span class="params">comp</span>)&#123;</span><br><span class="line">        components.<span class="title function_">push</span>(comp);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> app;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(app.<span class="title function_">getCount</span>())</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(app.<span class="property">componenets</span>.<span class="property">length</span>)</span><br></pre></td></tr></table></figure>


<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="为何null-x3D-x3D-undefined"><a href="#为何null-x3D-x3D-undefined" class="headerlink" title="为何null&#x3D;&#x3D;undefined?"></a>为何null&#x3D;&#x3D;undefined?</h2><p>因为undefined派生自null。</p>
<h2 id="那些true-x2F-false"><a href="#那些true-x2F-false" class="headerlink" title="那些true&#x2F;false"></a>那些true&#x2F;false</h2><img src="/2018/10/19/js/004-js-new-concept/000.png" class="">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// not applicable (不适用)</span></span><br><span class="line">Boolean(<span class="string">&#x27;n/a&#x27;</span>)</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"></span><br><span class="line">NaN==NaN</span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>下面是高级或冷门js知识。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/19/js/004-js-new-concept/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/19/js/004-js-new-concept/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/19/js/004-js-new-concept/" data-id="cl1fw7fju005rvkd3aa9s4ivh" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/javascript/" rel="tag">javascript</a><span class="article-tag-list-count">4</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/017-java-static-and-dynamic-proxy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/17/java/017-java-static-and-dynamic-proxy/" class="article-date">
  <time datetime="2018-10-17T06:36:23.000Z" itemprop="datePublished">2018-10-17</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/17/java/017-java-static-and-dynamic-proxy/">java静态代理和动态代理</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本文以图片为例实现java版本的动静态代理，并分析他们的区别。</p>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>我们使用一个具有展示功能的图片接口为例，通过代理类实现AOP功能，在展示的前后做一些事情。</p>
<h1 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h1><p>接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">display</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PngImage</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(String name)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;展示png图片：&quot;</span> + name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpgImage</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(String name)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;展示jpg图片：&quot;</span> + name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代理类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageProxy</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> Image image;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ImageProxy</span><span class="params">(Image image)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.image = image;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(String name)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;调整下图片大小,美化一下...&quot;</span>);</span><br><span class="line">		image.display(name);</span><br><span class="line">		System.out.println(<span class="string">&quot;图片资源清理...&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">PngImage</span> <span class="variable">pngImage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PngImage</span>();</span><br><span class="line"><span class="type">ImageProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageProxy</span>(pngImage);</span><br><span class="line">proxy.display(<span class="string">&quot;jimo.png&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="type">JpgImage</span> <span class="variable">jpgImage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JpgImage</span>();</span><br><span class="line">proxy = <span class="keyword">new</span> <span class="title class_">ImageProxy</span>(jpgImage);</span><br><span class="line">proxy.display(<span class="string">&quot;jimo.jpg&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">调整下图片大小,美化一下...</span><br><span class="line">展示png图片：jimo.png</span><br><span class="line">图片资源清理...</span><br><span class="line">调整下图片大小,美化一下...</span><br><span class="line">展示jpg图片：jimo.jpg</span><br><span class="line">图片资源清理...</span><br></pre></td></tr></table></figure>
<h1 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h1><p>新的代理类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicImageProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">(String name, Image image)</span> &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">Image</span> <span class="variable">proxiedImage</span> <span class="operator">=</span> (Image) Proxy.newProxyInstance(Image.class.getClassLoader(),</span><br><span class="line">				<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Image.class&#125;,</span><br><span class="line">				<span class="keyword">new</span> <span class="title class_">ImageProxyHandler</span>(image));</span><br><span class="line">		proxiedImage.display(name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ImageProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> Object image;</span><br><span class="line"></span><br><span class="line">		ImageProxyHandler(Object image) &#123;</span><br><span class="line">			<span class="built_in">this</span>.image = image;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;调整下图片大小,美化一下...&quot;</span>);</span><br><span class="line">			<span class="keyword">final</span> <span class="type">Object</span> <span class="variable">invoke</span> <span class="operator">=</span> method.invoke(image, args);</span><br><span class="line">			System.out.println(<span class="string">&quot;图片资源清理...&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span> invoke;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要解释一下Proxy.newProxyInstance()方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 返回指定接口的被代理类的实例，该接口将方法调用分派给指定的调用处理程序</span></span><br><span class="line"><span class="comment"> * loader：定义被代理类的class loader</span></span><br><span class="line"><span class="comment"> * interfaces: 被代理类实现的接口，可能不止一个</span></span><br><span class="line"><span class="comment"> * h： 处理程序，处理被代理类，调用其方法，加一些处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">newProxyInstance</span><span class="params">(ClassLoader loader,</span></span><br><span class="line"><span class="params">                      Class&lt;?&gt;[] interfaces,</span></span><br><span class="line"><span class="params">                      InvocationHandler h)</span></span><br><span class="line">                               <span class="keyword">throws</span> IllegalArgumentException</span><br><span class="line">等价于：</span><br><span class="line">Proxy.getProxyClass(loader, interfaces).</span><br><span class="line">         getConstructor(<span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; InvocationHandler.class &#125;).</span><br><span class="line">         newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[] &#123; handler &#125;);</span><br></pre></td></tr></table></figure>

<p>可以看到我们是通过反射来调用对象的方法。</p>
<p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">PngImage</span> <span class="variable">pngImage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PngImage</span>();</span><br><span class="line">DynamicImageProxy.display(<span class="string">&quot;jimo.png&quot;</span>, pngImage);</span><br><span class="line"></span><br><span class="line">DynamicImageProxy.display(<span class="string">&quot;jimo.jpg&quot;</span>, <span class="keyword">new</span> <span class="title class_">JpgImage</span>());</span><br></pre></td></tr></table></figure>
<p>结果当然是一样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">调整下图片大小,美化一下...</span><br><span class="line">展示png图片：jimo.png</span><br><span class="line">图片资源清理...</span><br><span class="line">调整下图片大小,美化一下...</span><br><span class="line">展示jpg图片：jimo.jpg</span><br><span class="line">图片资源清理...</span><br></pre></td></tr></table></figure>

<h1 id="动静态代理的区别"><a href="#动静态代理的区别" class="headerlink" title="动静态代理的区别"></a>动静态代理的区别</h1><p>静态代理类：由程序员创建或由特定工具自动生成源代码，再对其编译。在程序运行前，代理类的.class文件就已经存在了。<br>动态代理类：在程序运行时，运用反射机制动态创建而成。<br>静态代理通常只代理一个类，动态代理是代理一个接口下的多个实现类。<br>静态代理事先知道要代理的是什么，而动态代理不知道要代理什么东西，只有在运行时才知道。</p>
<p>说明：本文的静态代理并不只针对一个类，而是一个接口，实际上很多场景没有接口，只有一个类，针对每个类都需要写一个代理类。而java里的动态代理使用接口的代理范围更广泛。</p>
<h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><h2 id="1-设计模式里的代理模式"><a href="#1-设计模式里的代理模式" class="headerlink" title="1.设计模式里的代理模式"></a>1.设计模式里的代理模式</h2><p>下面是一个简单的例子：</p>
<h2 id="2-AOP"><a href="#2-AOP" class="headerlink" title="2.AOP"></a>2.AOP</h2><p>比如spring的AOP，或者本文的例子。</p>
<h2 id="3-RPC"><a href="#3-RPC" class="headerlink" title="3.RPC"></a>3.RPC</h2><ol>
<li>关于RPC和RESTful接口的区别需要了解下：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/jager/p/6519321.html">参考</a></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/41609070">知乎</a>上有一段比较简明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http好比普通话，rpc好比团伙内部黑话。</span><br><span class="line"></span><br><span class="line">讲普通话，好处就是谁都听得懂，谁都会讲。</span><br><span class="line"></span><br><span class="line">讲黑话，好处是可以更精简、更加保密、更加可定制，坏处就是要求“说”黑话的那一方（client端）也要懂，</span><br><span class="line">而且一旦大家都说一种黑话了，换黑话就困难了。</span><br></pre></td></tr></table></figure>

<p>在我们使用Java实现RPC时，会遇到客户端和服务端都要调用同一个接口，所以那个接口应该是公用的。当然，学习和做demo的时候都是放在一个项目里，而项目开发可以提取出一个公共模块，专门存放远程接口，参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/gao763024185/article/details/79916406">https://blog.csdn.net/gao763024185/article/details/79916406</a>.</p>
<p>而今天我们关注RPC中的代理模式的使用，大家可以参考以下资料学习完整的RPC：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/apache/incubator-dubbo">dubbo</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011350550/article/details/80582837">RPC原理及JAVA实现</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/codingexperience/p/5930752.html">Java实现简单的RPC框架</a></li>
</ol>
<p>下面我们省略RPC里的服务端和客户端的网络请求以及注册中心，直接关注代理模块：</p>
<p>项目结构：</p>
<img src="/2018/10/17/java/017-java-static-and-dynamic-proxy/000.png" class="">

<p>下面是代理类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientProxy</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ClientInvoker</span> <span class="variable">invoker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientInvoker</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getObject</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span>  Proxy.newProxyInstance(</span><br><span class="line">				clazz.getClassLoader(),</span><br><span class="line">				<span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[]&#123;clazz&#125;,</span><br><span class="line">				<span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">					<span class="meta">@Override</span></span><br><span class="line">					<span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">						<span class="comment">// 模拟参数</span></span><br><span class="line">						<span class="keyword">final</span> <span class="type">Object</span> <span class="variable">params</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">						<span class="keyword">return</span> invoker.invoke(params, <span class="string">&quot;localhost&quot;</span>, <span class="number">8088</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样客户端就可以统一请求，获取自己需要的对象了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">HelloService</span> <span class="variable">helloService</span> <span class="operator">=</span> (HelloService) ClientProxy.getObject(HelloService.class);</span><br><span class="line">helloService.sayHello();</span><br></pre></td></tr></table></figure>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本文以图片为例实现java版本的动静态代理，并分析他们的区别。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/17/java/017-java-static-and-dynamic-proxy/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/17/java/017-java-static-and-dynamic-proxy/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/17/java/017-java-static-and-dynamic-proxy/" data-id="cl1fw7fkx009gvkd30him3h3w" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/016-java-consurrent-pool" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/13/java/016-java-consurrent-pool/" class="article-date">
  <time datetime="2018-10-13T09:57:43.000Z" itemprop="datePublished">2018-10-13</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/13/java/016-java-consurrent-pool/">java并发-线程池</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>这一篇以ThreadPoolExecutor为例学习线程池。</p>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><p>首先要知道线程池是什么，用来干什么。</p>
<h2 id="解决什么问题"><a href="#解决什么问题" class="headerlink" title="解决什么问题"></a>解决什么问题</h2><ol>
<li>提高多个异步任务的性能，减少每个任务的调用开销</li>
<li>管理资源：线程资源，消耗的资源，基础统计数据（如运行完的线程数）</li>
</ol>
<h1 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h1><p>这个类比较复杂，提供了很多可调的参数，可以构造丰富的线程池，适应不同场景。我们大可使用<code>Executors.newXXXThreadPool()</code><br>这个工厂方法来创建线程池实例，那也是非常简单和初级的。现在我们会学习为什么这个类可以实现如此多的线程池类型。</p>
<p>接下来就是了解这些参数。</p>
<h2 id="core-x2F-max-pool-size"><a href="#core-x2F-max-pool-size" class="headerlink" title="core&#x2F;max pool size"></a>core&#x2F;max pool size</h2><p>既然是个池子，肯定有容量把。这里有2个关于容量的参数：corePoolSize ，maximumPoolSize.</p>
<ol>
<li>运行的线程数 <code>&lt; corePoolSize</code>: 直接创建新的线程来处理请求；</li>
<li>运行的线程数介于corePoolSize和maximumPoolSize之间，只有当队列满了才会创建新线程；</li>
</ol>
<p>当corePoolSize&#x3D;&#x3D;maximumPoolSize时，就是FixedThreadPool了。</p>
<p>这两个参数的设置：</p>
<ol>
<li>构造方法</li>
<li><code>setCorePoolSize(int) 和 setMaximumPoolSize(int)</code> 动态修改</li>
</ol>
<h2 id="keep-alive-time"><a href="#keep-alive-time" class="headerlink" title="keep-alive time"></a>keep-alive time</h2><p>当前线程数大于corePoolSize时，为了节省资源，空闲（Idle）的线程会在超过 <code>keepAliveTime</code>参数设定的时间后被终止。</p>
<p>设置这个值也可以动静结合：</p>
<ol>
<li>构造方法</li>
<li><code>setKeepAliveTime(long, TimeUnit)</code></li>
</ol>
<p>如果<code> allowCoreThreadTimeOut(true)</code>方法被调用，则当线程数小于corePoolSize时也可以终止，默认是false的。</p>
<h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p>这个队列是用来存储线程的，会在以下情况用到：</p>
<ol>
<li>线程数 &lt; corePoolSize,直接创建新线程，不使用队列；</li>
<li>线程数介于corePoolSize和maximumPoolSize之间，优先缓存到队列中；</li>
<li>队列满了，则再创建线程，直到线程数达到maxmimumPoolSize, 后面再有线程就会被拒绝。</li>
</ol>
<p>ThreadPoolExecutor使用的是<code>BlockingQueue</code>队列，排队也有排队的策略，排队论就不说了，下面是这里几种策略：</p>
<p>1. </p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>这一篇以ThreadPoolExecutor为例学习线程池。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/13/java/016-java-consurrent-pool/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/13/java/016-java-consurrent-pool/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/13/java/016-java-consurrent-pool/" data-id="cl1fw7fkw009evkd3b9kw3vdp" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-linux/016-linux-centos-cmd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/12/linux/016-linux-centos-cmd/" class="article-date">
  <time datetime="2018-10-12T00:09:10.000Z" itemprop="datePublished">2018-10-12</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/12/linux/016-linux-centos-cmd/">centos那些常用命令</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本文记录那些常用命令。</p>
<h1 id="防火墙相关"><a href="#防火墙相关" class="headerlink" title="防火墙相关"></a>防火墙相关</h1><p><a target="_blank" rel="noopener" href="https://havee.me/linux/2015-01/using-firewalls-on-centos-7.html">https://havee.me/linux/2015-01/using-firewalls-on-centos-7.html</a></p>
<h2 id="防火墙的开闭"><a href="#防火墙的开闭" class="headerlink" title="防火墙的开闭"></a>防火墙的开闭</h2><h2 id="开放某个端口"><a href="#开放某个端口" class="headerlink" title="开放某个端口"></a>开放某个端口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=<span class="keyword">public</span> --add-port=<span class="number">2888</span>/tcp --permanent</span><br><span class="line"># 重启生效</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h2 id="查看开放的所有端口"><a href="#查看开放的所有端口" class="headerlink" title="查看开放的所有端口"></a>查看开放的所有端口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># firewall-cmd --list-all</span><br><span class="line"><span class="title function_">public</span> <span class="params">(active)</span></span><br><span class="line">  target: <span class="keyword">default</span></span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces: eth0</span><br><span class="line">  sources:</span><br><span class="line">  services: dhcpv6-client ssh</span><br><span class="line">  ports: <span class="number">8080</span>/tcp <span class="number">8088</span>/tcp</span><br><span class="line">  protocols:</span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports:</span><br><span class="line">  source-ports:</span><br><span class="line">  icmp-blocks:</span><br><span class="line">  rich rules:</span><br></pre></td></tr></table></figure>
<h1 id="系统相关"><a href="#系统相关" class="headerlink" title="系统相关"></a>系统相关</h1><h2 id="查看运行进程"><a href="#查看运行进程" class="headerlink" title="查看运行进程"></a>查看运行进程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ps -aux</span><br><span class="line"></span><br><span class="line"># ps -aux | grep <span class="string">&quot;java -jar&quot;</span></span><br></pre></td></tr></table></figure>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本文记录那些常用命令。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/12/linux/016-linux-centos-cmd/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/12/linux/016-linux-centos-cmd/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/12/linux/016-linux-centos-cmd/" data-id="cl1fw7fmk00ffvkd39nhr9mt8" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/centos/" rel="tag">centos</a><span class="article-tag-list-count">5</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/linux/" rel="tag">linux</a><span class="article-tag-list-count">57</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/015-java-concurrent-executor-service" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/11/java/015-java-concurrent-executor-service/" class="article-date">
  <time datetime="2018-10-11T00:02:55.000Z" itemprop="datePublished">2018-10-11</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/11/java/015-java-concurrent-executor-service/">java并发-ExecutorService接口 - java</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>ExecutorService依然是一个非常重要的接口，必须熟悉。</p>
<h1 id="ExecutorSerivice概览"><a href="#ExecutorSerivice概览" class="headerlink" title="ExecutorSerivice概览"></a>ExecutorSerivice概览</h1><p>我一直说，学习一个类就像了解一个人，它的前后今生，从哪里来，到哪里去，他来干什么。</p>
<p>对于接口，它只是规范了行为，而不用关注实现，所以更简单，我们就是要了解这些行为能干什么。</p>
<p>于是先看看行为。</p>
<h2 id="接口行为"><a href="#接口行为" class="headerlink" title="接口行为"></a>接口行为</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ExecutorService</span> <span class="keyword">extends</span> <span class="title class_">Executor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Runnable&gt; <span class="title function_">shutdownNow</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isShutdown</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isTerminated</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">awaitTermination</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span></span><br><span class="line">        <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; Future&lt;T&gt; <span class="title function_">submit</span><span class="params">(Callable&lt;T&gt; task)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; Future&lt;T&gt; <span class="title function_">submit</span><span class="params">(Runnable task, T result)</span>;</span><br><span class="line"></span><br><span class="line">    Future&lt;?&gt; submit(Runnable task);</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; <span class="title function_">invokeAll</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span><br><span class="line">        <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; List&lt;Future&lt;T&gt;&gt; <span class="title function_">invokeAll</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span><br><span class="line"><span class="params">                                  <span class="type">long</span> timeout, TimeUnit unit)</span></span><br><span class="line">        <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; T <span class="title function_">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span><br><span class="line">        <span class="keyword">throws</span> InterruptedException, ExecutionException;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; T <span class="title function_">invokeAny</span><span class="params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span><br><span class="line"><span class="params">                    <span class="type">long</span> timeout, TimeUnit unit)</span></span><br><span class="line">        <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到上面的方法还挺多，仔细一看，也就是几个：<code>shutdown(), submit(), invokeXXX()</code>.</p>
<p>所以，看到这个接口能得到以下信息：</p>
<ol>
<li>它继承自Executor接口，增加了一些行为</li>
<li>它可以控制线程的关闭，可以提交任务(集)</li>
<li>如果你知道Future和Callable类，那应该知道这是异步任务，可以跟踪线程进度。</li>
</ol>
<p>所以，ExecutorService的主要目的是管理任务的终止行为，可以单个，可以批量。现在，你肯定想知道那些方法有什么区别，这个看文档就好了。</p>
<h2 id="接口实现"><a href="#接口实现" class="headerlink" title="接口实现"></a>接口实现</h2><p>子接口：<br>ScheduledExecutorService</p>
<p>实现类：<br>AbstractExecutorService, ForkJoinPool, ScheduledThreadPoolExecutor, ThreadPoolExecutor</p>
<p>下面用到了一些实现，会在更后面的文中详细讲解。</p>
<h1 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h1><h2 id="控制关闭示例"><a href="#控制关闭示例" class="headerlink" title="控制关闭示例"></a>控制关闭示例</h2><p>先当然是简单的例子，重在理解和使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExecutorServiceDemo1</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line">		executor.submit(<span class="keyword">new</span> <span class="title class_">Task</span>());</span><br><span class="line">		System.out.println(<span class="string">&quot;关闭executor&quot;</span>);</span><br><span class="line">		executor.shutdown();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 等待5秒再跳到finally</span></span><br><span class="line">			executor.awaitTermination(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;任务被中断&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (!executor.isTerminated()) &#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;取消未完成的任务&quot;</span>);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 立即关闭，不管当前正在执行的任务</span></span><br><span class="line">				executor.shutdownNow();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			System.out.println(<span class="string">&quot;关闭完成&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">final</span> <span class="type">int</span> <span class="variable">duration</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;我是一只在跑的小白兔...&quot;</span>);</span><br><span class="line">				TimeUnit.SECONDS.sleep(duration);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">关闭executor</span><br><span class="line">我是一只在跑的小白兔...</span><br><span class="line">取消未完成的任务</span><br><span class="line">关闭完成</span><br><span class="line">java.lang.InterruptedException: sleep interrupted</span><br><span class="line">	at java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at java.lang.Thread.sleep(Thread.java:<span class="number">340</span>)</span><br><span class="line">	at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:<span class="number">386</span>)</span><br><span class="line">	at com.jimo.executor.ExecutorServiceDemo1$Task.run(ExecutorServiceDemo1.java:<span class="number">44</span>)</span><br><span class="line">	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:<span class="number">511</span>)</span><br><span class="line">	at java.util.concurrent.FutureTask.run(FutureTask.java:<span class="number">266</span>)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1149</span>)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">624</span>)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br></pre></td></tr></table></figure>
<p>我们的任务睡眠了7秒，而executor最多等待5秒，所以会被中断，如果我们把时间改小：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="variable">duration</span> <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>则会正常结束：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">关闭executor</span><br><span class="line">我是一只在跑的小白兔...</span><br><span class="line">关闭完成</span><br></pre></td></tr></table></figure>
<h2 id="控制关闭示例2"><a href="#控制关闭示例2" class="headerlink" title="控制关闭示例2"></a>控制关闭示例2</h2><p>下面的例子更加理论和详细：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExecutorServiceDemo2</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line">		executor.submit(<span class="keyword">new</span> <span class="title class_">Task</span>());</span><br><span class="line">		shutdownAndAwaitTermination(executor);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shutdownAndAwaitTermination</span><span class="params">(ExecutorService pool)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 拒绝接受新的任务提交，但会等待之前的任务完成</span></span><br><span class="line">		pool.shutdown();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">final</span> <span class="type">int</span> <span class="variable">timeout</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">			<span class="comment">// 等待3秒直到executor执行完，如果3秒后没执行完返回false</span></span><br><span class="line">			<span class="keyword">if</span> (!pool.awaitTermination(timeout, TimeUnit.SECONDS)) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 立即关闭，取消当前正在执行的任务</span></span><br><span class="line">				<span class="comment">// 但是并不保证一定会终止线程，所以有下面的等待过程</span></span><br><span class="line">				pool.shutdownNow();</span><br><span class="line">				System.out.println(<span class="string">&quot;第一次中断&quot;</span>);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 等待强制关闭后线程的结束,算是一个回复</span></span><br><span class="line">				<span class="keyword">if</span> (!pool.awaitTermination(timeout, TimeUnit.SECONDS)) &#123;</span><br><span class="line">					System.err.println(<span class="string">&quot;executor没有终止掉&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			System.err.println(<span class="string">&quot;2次都没杀死&quot;</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 如果2次等待都没有终止，那么会抛出中断异常，所以下面再进行关闭</span></span><br><span class="line">			pool.shutdownNow();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 保持中断状态</span></span><br><span class="line">			Thread.currentThread().interrupt();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">final</span> <span class="type">int</span> <span class="variable">duration</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;我是一只在追小白兔的大灰狼...&quot;</span>);</span><br><span class="line">				TimeUnit.SECONDS.sleep(duration);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">我是一只在追小白兔的大灰狼...</span><br><span class="line">第一次中断</span><br><span class="line">java.lang.InterruptedException: sleep interrupted</span><br><span class="line">	at java.lang.Thread.sleep(Native Method)</span><br><span class="line">	at java.lang.Thread.sleep(Thread.java:<span class="number">340</span>)</span><br><span class="line">	at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:<span class="number">386</span>)</span><br><span class="line">	at com.jimo.executor.ExecutorServiceDemo2$Task.run(ExecutorServiceDemo2.java:<span class="number">57</span>)</span><br><span class="line">	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:<span class="number">511</span>)</span><br><span class="line">	at java.util.concurrent.FutureTask.run(FutureTask.java:<span class="number">266</span>)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1149</span>)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">624</span>)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br></pre></td></tr></table></figure>
<p>很显然，这个任务在第一次时就成功中断，能力有限，没有构造出杀不死的线程，所以杀2次杀不死的运行结果无法展示。</p>
<h2 id="现实的网络例子"><a href="#现实的网络例子" class="headerlink" title="现实的网络例子"></a>现实的网络例子</h2><p>下面是官网给出的例子：处理网络请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetworkService</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> ServerSocket serverSocket;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> ExecutorService pool;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">NetworkService</span><span class="params">(<span class="type">int</span> port, <span class="type">int</span> poolSize)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		serverSocket = <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(port);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 一般需要限制处理请求的线程数</span></span><br><span class="line">		pool = Executors.newFixedThreadPool(poolSize);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">				pool.execute(<span class="keyword">new</span> <span class="title class_">Handler</span>(serverSocket.accept()));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			pool.shutdown();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Handler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> Socket socket;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="title function_">Handler</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.socket = socket;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="comment">//TODO 接受网络请求并处理</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="子接口ScheduledThreadPoolExecutor"><a href="#子接口ScheduledThreadPoolExecutor" class="headerlink" title="子接口ScheduledThreadPoolExecutor"></a>子接口ScheduledThreadPoolExecutor</h2><p>从名字可以看出此接口是和定时调度有关，确实，可以延迟和定期执行。<br>下面是接口，很简单：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ScheduledExecutorService</span> <span class="keyword">extends</span> <span class="title class_">ExecutorService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ScheduledFuture&lt;?&gt; schedule(Runnable command,</span><br><span class="line">                                   <span class="type">long</span> delay, TimeUnit unit);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;V&gt; ScheduledFuture&lt;V&gt; <span class="title function_">schedule</span><span class="params">(Callable&lt;V&gt; callable,</span></span><br><span class="line"><span class="params">                                          <span class="type">long</span> delay, TimeUnit unit)</span>;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command,</span><br><span class="line">                                                <span class="type">long</span> initialDelay,</span><br><span class="line">                                                <span class="type">long</span> period,</span><br><span class="line">                                                TimeUnit unit);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command,</span><br><span class="line">                                                     <span class="type">long</span> initialDelay,</span><br><span class="line">                                                     <span class="type">long</span> delay,</span><br><span class="line">                                                     TimeUnit unit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面的例子会说明区别和用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledExecutorDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;now: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">		<span class="keyword">final</span> <span class="type">ScheduledExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 一次性任务，隔3秒执行</span></span><br><span class="line">		pool.schedule(<span class="keyword">new</span> <span class="title class_">DateTask</span>(<span class="string">&quot;task1&quot;</span>), <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 周期性：2+3*n秒执行，不会管任务是否执行完</span></span><br><span class="line">		pool.scheduleAtFixedRate(<span class="keyword">new</span> <span class="title class_">DateTask</span>(<span class="string">&quot;task2&quot;</span>), <span class="number">2</span>, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 周期性: 2+3*n,上一次执行完到下一次开始之间等待3秒</span></span><br><span class="line">		<span class="keyword">final</span> ScheduledFuture&lt;?&gt; task3 =</span><br><span class="line">				pool.scheduleWithFixedDelay(<span class="keyword">new</span> <span class="title class_">DateTask</span>(<span class="string">&quot;task3&quot;</span>), <span class="number">2</span>, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 在10秒后关闭</span></span><br><span class="line">		pool.schedule(() -&gt; &#123;</span><br><span class="line">			task3.cancel(<span class="literal">true</span>);</span><br><span class="line">			pool.shutdown();</span><br><span class="line">		&#125;, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DateTask</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">		DateTask(String name) &#123;</span><br><span class="line">			<span class="built_in">this</span>.name = name;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">			System.out.println(name + <span class="string">&quot;: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果可以看出task3会逐渐比task2慢1，2，3…秒.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">now: Tue Oct <span class="number">16</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">38</span> CST <span class="number">2018</span></span><br><span class="line">task2: Tue Oct <span class="number">16</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">40</span> CST <span class="number">2018</span></span><br><span class="line">task3: Tue Oct <span class="number">16</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">40</span> CST <span class="number">2018</span></span><br><span class="line">task1: Tue Oct <span class="number">16</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">41</span> CST <span class="number">2018</span></span><br><span class="line">task2: Tue Oct <span class="number">16</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">43</span> CST <span class="number">2018</span></span><br><span class="line">task3: Tue Oct <span class="number">16</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">44</span> CST <span class="number">2018</span></span><br><span class="line">task2: Tue Oct <span class="number">16</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">46</span> CST <span class="number">2018</span></span><br><span class="line">task3: Tue Oct <span class="number">16</span> <span class="number">14</span>:<span class="number">31</span>:<span class="number">48</span> CST <span class="number">2018</span></span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>参考：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html">文档</a></p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>ExecutorService依然是一个非常重要的接口，必须熟悉。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/11/java/015-java-concurrent-executor-service/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/11/java/015-java-concurrent-executor-service/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/11/java/015-java-concurrent-executor-service/" data-id="cl1fw7fkv009bvkd36tohcsjs" class="article-share-link">
          Share
        </a>
        
            
      </footer>
      </div>
      
</article>


  
    <article id="post-java/014-java-velocityengine" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/10/java/014-java-velocityengine/" class="article-date">
  <time datetime="2018-10-10T06:46:49.000Z" itemprop="datePublished">2018-10-10</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/10/java/014-java-velocityengine/">java模板类：用代码生成代码</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>尝尝用代码生成代码的元编程方式，写一个AI来编程把。</p>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.velocity&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;velocity&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.7</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h1 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h1><p>新建一个以vm结尾的文件，里面放模板语法。</p>
<img src="/2018/10/10/java/014-java-velocityengine/000.png" class="">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    #foreach ($filed in $fields)</span><br><span class="line">    <span class="keyword">private</span> String $filed;</span><br><span class="line">    #end</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于这个语法，参看：<a target="_blank" rel="noopener" href="https://velocity.apache.org/engine/1.7/user-guide.html">https://velocity.apache.org/engine/1.7/user-guide.html</a>.</p>
<h1 id="编程"><a href="#编程" class="headerlink" title="编程"></a>编程</h1><p>进行动态注入数据，生成代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.velocity.Template;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.VelocityContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.app.VelocityEngine;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.runtime.RuntimeConstants;</span><br><span class="line"><span class="keyword">import</span> org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestTemplate</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">VelocityEngine</span> <span class="variable">velocityEngine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VelocityEngine</span>();</span><br><span class="line">		velocityEngine.setProperty(RuntimeConstants.RESOURCE_LOADER, <span class="string">&quot;classpath&quot;</span>);</span><br><span class="line">		velocityEngine.setProperty(<span class="string">&quot;classpath.resource.loader.class&quot;</span>, ClasspathResourceLoader.class.getName());</span><br><span class="line">		velocityEngine.init();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">final</span> <span class="type">Template</span> <span class="variable">template</span> <span class="operator">=</span> velocityEngine.getTemplate(<span class="string">&quot;template.vm&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 准备点数据,可能从配置文件读取</span></span><br><span class="line">		List&lt;String&gt; fields = Arrays.asList(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;title&quot;</span>, <span class="string">&quot;content&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">final</span> <span class="type">VelocityContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VelocityContext</span>();</span><br><span class="line">		context.put(<span class="string">&quot;fields&quot;</span>, fields);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">final</span> <span class="type">StringWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>();</span><br><span class="line">		template.merge(context, writer);</span><br><span class="line">		System.out.println(writer.toString());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 或者写入文件</span></span><br><span class="line">		<span class="type">Writer</span> <span class="variable">fileWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;Person.java&quot;</span>));</span><br><span class="line">		template.merge(context, fileWriter);</span><br><span class="line">		fileWriter.flush();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> String age;</span><br><span class="line">        <span class="keyword">private</span> String title;</span><br><span class="line">        <span class="keyword">private</span> String content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>尝尝用代码生成代码的元编程方式，写一个AI来编程把。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/10/java/014-java-velocityengine/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/10/java/014-java-velocityengine/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/10/java/014-java-velocityengine/" data-id="cl1fw7fku0096vkd360xl0ewv" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/%E5%85%83%E7%BC%96%E7%A8%8B/" rel="tag">元编程</a><span class="article-tag-list-count">1</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/013-java-concurrent-executor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/10/java/013-java-concurrent-executor/" class="article-date">
  <time datetime="2018-10-10T00:05:39.000Z" itemprop="datePublished">2018-10-10</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/10/java/013-java-concurrent-executor/">java并发-Executor解析</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>推荐用线程池来创建线程，但首先了解所有线程池的接口Executor。</p>
<h1 id="Executor概览"><a href="#Executor概览" class="headerlink" title="Executor概览"></a>Executor概览</h1><h2 id="Executor接口"><a href="#Executor接口" class="headerlink" title="Executor接口"></a>Executor接口</h2><p>先看看Executor的代码，非常简单，只有一个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Executor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Executes the given command at some time in the future.  The command</span></span><br><span class="line"><span class="comment">     * may execute in a new thread, in a pooled thread, or in the calling</span></span><br><span class="line"><span class="comment">     * thread, at the discretion of the &#123;<span class="doctag">@code</span> Executor&#125; implementation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> command the runnable task</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RejectedExecutionException if this task cannot be</span></span><br><span class="line"><span class="comment">     * accepted for execution</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if command is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Executor的继承层次结构"><a href="#Executor的继承层次结构" class="headerlink" title="Executor的继承层次结构"></a>Executor的继承层次结构</h2><p>子接口：<br>ExecutorService, ScheduledExecutorService</p>
<p>实现类：<br>AbstractExecutorService, ForkJoinPool, ScheduledThreadPoolExecutor, ThreadPoolExecutor</p>
<h1 id="Executor是干嘛的"><a href="#Executor是干嘛的" class="headerlink" title="Executor是干嘛的"></a>Executor是干嘛的</h1><p>他是：执行提交的Runnable任务的对象的接口。那使用它有什么好处呢？</p>
<p>此接口提供了一种将任务提交与每个任务的运行机制分离的方法，包括线程使用，调度等的详细信息。通常使用Executor而不是显式创建线程。 例如，不是为一组任务调用<code>new Thread(new(RunnableTask())).start()</code>，而是使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Executor</span> <span class="variable">executor</span> <span class="operator">=</span> anExecutor的实现类;</span><br><span class="line">executor.execute(<span class="keyword">new</span> <span class="title class_">RunnableTask1</span>());</span><br><span class="line">executor.execute(<span class="keyword">new</span> <span class="title class_">RunnableTask2</span>());</span><br></pre></td></tr></table></figure>
<h1 id="我们来实现Executor"><a href="#我们来实现Executor" class="headerlink" title="我们来实现Executor"></a>我们来实现Executor</h1><p>先不管JDK实现了怎样的Executor，因为后面的文章还会提到，我们只需要看看我们怎么实现。</p>
<h2 id="最简单的同步执行"><a href="#最简单的同步执行" class="headerlink" title="最简单的同步执行"></a>最简单的同步执行</h2><p>这个实际上只是进行了封装，没有实际意义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectExecutor</span> <span class="keyword">implements</span> <span class="title class_">Executor</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span> &#123;</span><br><span class="line">		command.run();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="异步执行"><a href="#异步执行" class="headerlink" title="异步执行"></a>异步执行</h2><p>下面的代码创建了一个新的线程来运行任务，和普通的new Thread没什么区别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadPerTaskExecutor</span> <span class="keyword">implements</span> <span class="title class_">Executor</span> &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span> &#123;</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Thread</span>(command).start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="更真实一点"><a href="#更真实一点" class="headerlink" title="更真实一点"></a>更真实一点</h2><p>上面的例子仅仅是说明有这样的可能，作为教学可以，但现实世界不可能这么简单，我们实现这个Executor都是出于某方面目的，比如固定大小线程池，优先级调用等等。</p>
<p>下面是一个复合的Executor，接收一个Executor，然后接收任务拿给第二个Executor执行，顺序执行任务，使用队列实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerialExecutor</span> <span class="keyword">implements</span> <span class="title class_">Executor</span> &#123;</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">private</span> Queue&lt;Runnable&gt; tasks = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">	<span class="keyword">final</span> Executor executor;</span><br><span class="line">	<span class="keyword">private</span> Runnable current;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">SerialExecutor</span><span class="params">(Executor executor)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.executor = executor;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// new 一个Runnable，在里面直接执行新的任务,然后执行下一个</span></span><br><span class="line">		<span class="comment">// 这一个新的Runnable追加到队列里，并没立即执行</span></span><br><span class="line">		tasks.offer(() -&gt; &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				r.run();</span><br><span class="line">			&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">				scheduleNext();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 只有上一个任务执行完了，current才为null</span></span><br><span class="line">		<span class="keyword">if</span> (current == <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 直到这里才出列被executor执行</span></span><br><span class="line">			scheduleNext();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">scheduleNext</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> ((current = tasks.poll()) != <span class="literal">null</span>) &#123;</span><br><span class="line">			executor.execute(current);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>本文参考<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executor.html">官方文档</a>.</p>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>推荐用线程池来创建线程，但首先了解所有线程池的接口Executor。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/10/java/013-java-concurrent-executor/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/10/java/013-java-concurrent-executor/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/10/java/013-java-concurrent-executor/" data-id="cl1fw7fkv0099vkd38tiq72bn" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/012-java-concurrent-atomic" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/06/java/012-java-concurrent-atomic/" class="article-date">
  <time datetime="2018-10-06T01:37:08.000Z" itemprop="datePublished">2018-10-06</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/06/java/012-java-concurrent-atomic/">java并发-Atomic</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p>本节示例java Atomic原子操作类，很简单。</p>
<h1 id="如果不使用原子操作"><a href="#如果不使用原子操作" class="headerlink" title="如果不使用原子操作"></a>如果不使用原子操作</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicTest</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">int</span> c;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incr</span><span class="params">()</span> &#123;</span><br><span class="line">			c++;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> c;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Counter</span>();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; counter.incr());</span><br><span class="line">			t.start();</span><br><span class="line">		&#125;</span><br><span class="line">		Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;结果为：&quot;</span> + counter.getValue());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果是1000，但存在风险。</p>
<h1 id="使用原子类"><a href="#使用原子类" class="headerlink" title="使用原子类"></a>使用原子类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incr</span><span class="params">()</span> &#123;</span><br><span class="line">        c.incrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> c.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="其他原子类"><a href="#其他原子类" class="headerlink" title="其他原子类"></a>其他原子类</h1><ol>
<li>AtomicLong</li>
<li>AtomicBoolean</li>
<li>AtomicReference</li>
<li>AtomicIntegerArray</li>
<li>AtomicLongArray</li>
<li>AtomicReferenceArray</li>
</ol>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p>本节示例java Atomic原子操作类，很简单。</p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/06/java/012-java-concurrent-atomic/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/06/java/012-java-concurrent-atomic/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/06/java/012-java-concurrent-atomic/" data-id="cl1fw7fku0094vkd3bbb4bshk" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li></ul>

      </footer>
      </div>
      
</article>


  
    <article id="post-java/011-java-concurrent-condition" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/history/2018/10/03/java/011-java-concurrent-condition/" class="article-date">
  <time datetime="2018-10-03T02:10:14.000Z" itemprop="datePublished">2018-10-03</time>
</a>
      
  </div>
  <div class="article-inner">
    
      
        <header class="article-header">
          
  
    <h1 itemprop="name">
      <a class="article-title" href="/history/2018/10/03/java/011-java-concurrent-condition/">java并发-Condition</a>
    </h1>
  

        </header>
        
          <!-- <div class="article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Condition.html">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Condition.html</a></p>
<p>讲解Condition接口</p>
<h1 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Condition(条件)，可以使一个线程站厅执行，直到条件满足才继续。</span></span><br><span class="line"><span class="comment"> * 一般通过await()暂停当前线程（让出CPU），signal()通知其他线程</span></span><br><span class="line"><span class="comment"> * 竞争CPU</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 下面是经典的生产消费者模型，我们使用2个条件：空和满来控制存和取</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jimo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/10/3 9:22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConditionDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">MyQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyQueue</span>(<span class="number">8</span>);</span><br><span class="line">		<span class="keyword">final</span> <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(queue);</span><br><span class="line">		<span class="keyword">final</span> <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Consumer</span>(queue);</span><br><span class="line"></span><br><span class="line">		producer.start();</span><br><span class="line">		consumer.start();</span><br><span class="line"></span><br><span class="line">		producer.join();</span><br><span class="line">		consumer.join();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">full</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">empty</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> Object[] items;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">int</span> current;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">int</span> getIndex;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">int</span> putIndex;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="title function_">MyQueue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.items = <span class="keyword">new</span> <span class="title class_">Object</span>[capacity];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">void</span> <span class="title function_">put</span><span class="params">(Object item)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">			lock.lock();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">// 生产满了，不满足空的条件，所以等待被消费</span></span><br><span class="line">				<span class="keyword">while</span> (current &gt;= items.length) &#123;</span><br><span class="line">					empty.await();</span><br><span class="line">				&#125;</span><br><span class="line">				items[putIndex] = item;</span><br><span class="line">				putIndex = (putIndex + <span class="number">1</span>) % items.length;</span><br><span class="line">				current++;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 通知消费者</span></span><br><span class="line">				full.signal();</span><br><span class="line">			&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">				lock.unlock();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Object <span class="title function_">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">			lock.lock();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">// 不满足满的条件，只能暂停下来，等待生产</span></span><br><span class="line">				<span class="keyword">while</span> (current &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">					full.await();</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="type">Object</span> <span class="variable">item</span> <span class="operator">=</span> items[getIndex];</span><br><span class="line">				getIndex = (getIndex + <span class="number">1</span>) % items.length;</span><br><span class="line">				current--;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 满足空的条件，通知生产者可以生产了</span></span><br><span class="line">				empty.signal();</span><br><span class="line">				<span class="keyword">return</span> item;</span><br><span class="line">			&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">				lock.unlock();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> MyQueue queue;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="title function_">Producer</span><span class="params">(MyQueue queue)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.queue = queue;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">			String[] numbers = &#123;<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;8&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;10&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;12&quot;</span>&#125;;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">for</span> (String number : numbers) &#123;</span><br><span class="line">					queue.put(number);</span><br><span class="line">					System.out.println(<span class="string">&quot;Producer: &quot;</span> + number);</span><br><span class="line">				&#125;</span><br><span class="line">				queue.put(<span class="literal">null</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">final</span> MyQueue queue;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(MyQueue queue)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.queue = queue;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="type">Object</span> <span class="variable">number</span> <span class="operator">=</span> queue.get();</span><br><span class="line">				<span class="keyword">while</span> (number != <span class="literal">null</span>) &#123;</span><br><span class="line">					System.out.println(<span class="string">&quot;Consumer: &quot;</span> + number);</span><br><span class="line">					number = queue.get();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Producer: <span class="number">1</span></span><br><span class="line">Consumer: <span class="number">1</span></span><br><span class="line">Producer: <span class="number">2</span></span><br><span class="line">Consumer: <span class="number">2</span></span><br><span class="line">Producer: <span class="number">3</span></span><br><span class="line">Consumer: <span class="number">3</span></span><br><span class="line">Producer: <span class="number">4</span></span><br><span class="line">Consumer: <span class="number">4</span></span><br><span class="line">Producer: <span class="number">5</span></span><br><span class="line">Consumer: <span class="number">5</span></span><br><span class="line">Producer: <span class="number">6</span></span><br><span class="line">Consumer: <span class="number">6</span></span><br><span class="line">Producer: <span class="number">7</span></span><br><span class="line">Consumer: <span class="number">7</span></span><br><span class="line">Producer: <span class="number">8</span></span><br><span class="line">Consumer: <span class="number">8</span></span><br><span class="line">Producer: <span class="number">9</span></span><br><span class="line">Consumer: <span class="number">9</span></span><br><span class="line">Producer: <span class="number">10</span></span><br><span class="line">Consumer: <span class="number">10</span></span><br><span class="line">Producer: <span class="number">11</span></span><br><span class="line">Consumer: <span class="number">11</span></span><br><span class="line">Producer: <span class="number">12</span></span><br><span class="line">Consumer: <span class="number">12</span></span><br></pre></td></tr></table></figure>

      
    </div> -->
          <div class="article-entry" itemprop="articleBody">
            
              
                
                      
                        
                          
                            
                              
                                
                                  
                                    <p>
                                      <p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Condition.html">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Condition.html</a></p>

                                        <p>
                                          
                                            
                                              
                                                      
          </div>
    <p class="article-more-link">
      <a href="/history/2018/10/03/java/011-java-concurrent-condition/#more">
        Read More
      </a>
    </p>
    <!-- <div class="article-more-link">
      <a href="/history/2018/10/03/java/011-java-concurrent-condition/#more">
        read more
      </a>
    </div> -->
    


      <footer class="article-footer">
        <a data-url="http://jimolonely.github.io/history/2018/10/03/java/011-java-concurrent-condition/" data-id="cl1fw7fkt0091vkd3hvb4dugj" class="article-share-link">
          Share
        </a>
        
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/history/tags/java/" rel="tag">java</a><span class="article-tag-list-count">104</span></li></ul>

      </footer>
      </div>
      
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/history/page/10/">&amp;laquo; 上一页</a><a class="page-number" href="/history/">1</a><span class="space">&hellip;</span><a class="page-number" href="/history/page/9/">9</a><a class="page-number" href="/history/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/history/page/12/">12</a><a class="page-number" href="/history/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/history/page/18/">18</a><a class="extend next" rel="next" href="/history/page/12/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/AI/" rel="tag">AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/UI-test/" rel="tag">UI test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/android/" rel="tag">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/annotation/" rel="tag">annotation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/ansible/" rel="tag">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/ant/" rel="tag">ant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/aop/" rel="tag">aop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/archiva/" rel="tag">archiva</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/asciidoc/" rel="tag">asciidoc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/awk/" rel="tag">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/axios/" rel="tag">axios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/basic/" rel="tag">basic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/big-data/" rel="tag">big data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/blockchain/" rel="tag">blockchain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/centos/" rel="tag">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/cglib/" rel="tag">cglib</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/checkstyle/" rel="tag">checkstyle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/chrome/" rel="tag">chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/computer-principle/" rel="tag">computer principle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/cors/" rel="tag">cors</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/data-structure/" rel="tag">data structure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/design-pattern/" rel="tag">design-pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/elasticsearch/" rel="tag">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/es/" rel="tag">es</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/eureka/" rel="tag">eureka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/firefox/" rel="tag">firefox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/flask/" rel="tag">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/geohash/" rel="tag">geohash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/geomesa/" rel="tag">geomesa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/gitlab/" rel="tag">gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/gradle/" rel="tag">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/groovy/" rel="tag">groovy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/hadoop/" rel="tag">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/hbase/" rel="tag">hbase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/html/" rel="tag">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/idea/" rel="tag">idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/ip/" rel="tag">ip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/junit/" rel="tag">junit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/jupyter/" rel="tag">jupyter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/jupyterhub/" rel="tag">jupyterhub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/jvm/" rel="tag">jvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/jwt/" rel="tag">jwt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/kafka/" rel="tag">kafka</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/katalon/" rel="tag">katalon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/keepalived/" rel="tag">keepalived</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/latex/" rel="tag">latex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/life/" rel="tag">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/linux-kernel/" rel="tag">linux kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/load-balance/" rel="tag">load balance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/log/" rel="tag">log</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/log4j/" rel="tag">log4j</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/log4j12/" rel="tag">log4j12</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/logback/" rel="tag">logback</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/lombok/" rel="tag">lombok</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/lru/" rel="tag">lru</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/lucene/" rel="tag">lucene</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/magnet/" rel="tag">magnet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/make/" rel="tag">make</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/makefile/" rel="tag">makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/manjaro/" rel="tag">manjaro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/math/" rel="tag">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/md5/" rel="tag">md5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/mhtml/" rel="tag">mhtml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/microservice/" rel="tag">microservice</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/music/" rel="tag">music</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/notebook/" rel="tag">notebook</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/nvidia/" rel="tag">nvidia</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/oauth/" rel="tag">oauth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/openstack/" rel="tag">openstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/optimization/" rel="tag">optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/pandas/" rel="tag">pandas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/pandoc/" rel="tag">pandoc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/pgsql/" rel="tag">pgsql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/probability/" rel="tag">probability</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/pyspark/" rel="tag">pyspark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/quartz/" rel="tag">quartz</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/resource/" rel="tag">resource</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/review/" rel="tag">review</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/sbt/" rel="tag">sbt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/scala/" rel="tag">scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/slf4j/" rel="tag">slf4j</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/spark/" rel="tag">spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/spring-cloud/" rel="tag">spring cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/spring-boot/" rel="tag">spring-boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/springboot/" rel="tag">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/sql/" rel="tag">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/sqlserver/" rel="tag">sqlserver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/statistics/" rel="tag">statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/syslog/" rel="tag">syslog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/term/" rel="tag">term</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/texlive/" rel="tag">texlive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/thread/" rel="tag">thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/tomcat/" rel="tag">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/tool/" rel="tag">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/ubuntu/" rel="tag">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/urban-computing/" rel="tag">urban computing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/video/" rel="tag">video</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/vpn/" rel="tag">vpn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/web-dav/" rel="tag">web-dav</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/week/" rel="tag">week</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/windows/" rel="tag">windows</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/wordcloud/" rel="tag">wordcloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/work/" rel="tag">work</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/xml/" rel="tag">xml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/zipkin/" rel="tag">zipkin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/zookeeper/" rel="tag">zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="tag">云计算</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/%E5%85%83%E7%BC%96%E7%A8%8B/" rel="tag">元编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/%E5%9F%8E%E5%B8%82%E8%AE%A1%E7%AE%97/" rel="tag">城市计算</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/%E6%A6%82%E5%BF%B5/" rel="tag">概念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/%E6%B5%8B%E8%AF%95/" rel="tag">测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/history/tags/%E8%BF%90%E7%BB%B4/" rel="tag">运维</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/history/tags/AI/" style="font-size: 10.53px;">AI</a> <a href="/history/tags/UI-test/" style="font-size: 10px;">UI test</a> <a href="/history/tags/algorithm/" style="font-size: 10.53px;">algorithm</a> <a href="/history/tags/android/" style="font-size: 10.53px;">android</a> <a href="/history/tags/annotation/" style="font-size: 10px;">annotation</a> <a href="/history/tags/ansible/" style="font-size: 13.16px;">ansible</a> <a href="/history/tags/ant/" style="font-size: 10px;">ant</a> <a href="/history/tags/aop/" style="font-size: 10px;">aop</a> <a href="/history/tags/archiva/" style="font-size: 10px;">archiva</a> <a href="/history/tags/asciidoc/" style="font-size: 10px;">asciidoc</a> <a href="/history/tags/awk/" style="font-size: 10px;">awk</a> <a href="/history/tags/axios/" style="font-size: 10px;">axios</a> <a href="/history/tags/basic/" style="font-size: 13.16px;">basic</a> <a href="/history/tags/big-data/" style="font-size: 10.53px;">big data</a> <a href="/history/tags/blockchain/" style="font-size: 10px;">blockchain</a> <a href="/history/tags/centos/" style="font-size: 12.11px;">centos</a> <a href="/history/tags/cglib/" style="font-size: 10px;">cglib</a> <a href="/history/tags/checkstyle/" style="font-size: 10px;">checkstyle</a> <a href="/history/tags/chrome/" style="font-size: 11.05px;">chrome</a> <a href="/history/tags/computer-principle/" style="font-size: 10px;">computer principle</a> <a href="/history/tags/cors/" style="font-size: 10.53px;">cors</a> <a href="/history/tags/data-structure/" style="font-size: 10px;">data structure</a> <a href="/history/tags/design-pattern/" style="font-size: 10.53px;">design-pattern</a> <a href="/history/tags/docker/" style="font-size: 17.89px;">docker</a> <a href="/history/tags/elasticsearch/" style="font-size: 13.16px;">elasticsearch</a> <a href="/history/tags/es/" style="font-size: 10px;">es</a> <a href="/history/tags/eureka/" style="font-size: 10px;">eureka</a> <a href="/history/tags/firefox/" style="font-size: 10px;">firefox</a> <a href="/history/tags/flask/" style="font-size: 10px;">flask</a> <a href="/history/tags/geohash/" style="font-size: 10px;">geohash</a> <a href="/history/tags/geomesa/" style="font-size: 10px;">geomesa</a> <a href="/history/tags/git/" style="font-size: 13.16px;">git</a> <a href="/history/tags/gitlab/" style="font-size: 11.05px;">gitlab</a> <a href="/history/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/history/tags/groovy/" style="font-size: 10px;">groovy</a> <a href="/history/tags/hadoop/" style="font-size: 10.53px;">hadoop</a> <a href="/history/tags/hbase/" style="font-size: 11.58px;">hbase</a> <a href="/history/tags/hexo/" style="font-size: 10.53px;">hexo</a> <a href="/history/tags/html/" style="font-size: 10.53px;">html</a> <a href="/history/tags/http/" style="font-size: 10px;">http</a> <a href="/history/tags/idea/" style="font-size: 11.05px;">idea</a> <a href="/history/tags/ip/" style="font-size: 10px;">ip</a> <a href="/history/tags/java/" style="font-size: 20px;">java</a> <a href="/history/tags/javascript/" style="font-size: 11.58px;">javascript</a> <a href="/history/tags/js/" style="font-size: 13.16px;">js</a> <a href="/history/tags/junit/" style="font-size: 10px;">junit</a> <a href="/history/tags/jupyter/" style="font-size: 10px;">jupyter</a> <a href="/history/tags/jupyterhub/" style="font-size: 10.53px;">jupyterhub</a> <a href="/history/tags/jvm/" style="font-size: 10px;">jvm</a> <a href="/history/tags/jwt/" style="font-size: 10px;">jwt</a> <a href="/history/tags/k8s/" style="font-size: 11.05px;">k8s</a> <a href="/history/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/history/tags/katalon/" style="font-size: 10px;">katalon</a> <a href="/history/tags/keepalived/" style="font-size: 10.53px;">keepalived</a> <a href="/history/tags/latex/" style="font-size: 11.05px;">latex</a> <a href="/history/tags/life/" style="font-size: 18.95px;">life</a> <a href="/history/tags/linux/" style="font-size: 19.47px;">linux</a> <a href="/history/tags/linux-kernel/" style="font-size: 10px;">linux kernel</a> <a href="/history/tags/load-balance/" style="font-size: 10px;">load balance</a> <a href="/history/tags/log/" style="font-size: 10px;">log</a> <a href="/history/tags/log4j/" style="font-size: 10px;">log4j</a> <a href="/history/tags/log4j12/" style="font-size: 10px;">log4j12</a> <a href="/history/tags/logback/" style="font-size: 10px;">logback</a> <a href="/history/tags/lombok/" style="font-size: 10px;">lombok</a> <a href="/history/tags/lru/" style="font-size: 10px;">lru</a> <a href="/history/tags/lucene/" style="font-size: 10px;">lucene</a> <a href="/history/tags/magnet/" style="font-size: 10px;">magnet</a> <a href="/history/tags/make/" style="font-size: 10px;">make</a> <a href="/history/tags/makefile/" style="font-size: 10px;">makefile</a> <a href="/history/tags/manjaro/" style="font-size: 10px;">manjaro</a> <a href="/history/tags/math/" style="font-size: 11.05px;">math</a> <a href="/history/tags/maven/" style="font-size: 15.26px;">maven</a> <a href="/history/tags/md5/" style="font-size: 10px;">md5</a> <a href="/history/tags/mhtml/" style="font-size: 10px;">mhtml</a> <a href="/history/tags/microservice/" style="font-size: 14.21px;">microservice</a> <a href="/history/tags/music/" style="font-size: 10px;">music</a> <a href="/history/tags/mybatis/" style="font-size: 11.05px;">mybatis</a> <a href="/history/tags/mysql/" style="font-size: 12.11px;">mysql</a> <a href="/history/tags/nginx/" style="font-size: 12.63px;">nginx</a> <a href="/history/tags/notebook/" style="font-size: 10px;">notebook</a> <a href="/history/tags/npm/" style="font-size: 10px;">npm</a> <a href="/history/tags/nvidia/" style="font-size: 10px;">nvidia</a> <a href="/history/tags/oauth/" style="font-size: 10px;">oauth</a> <a href="/history/tags/openstack/" style="font-size: 12.11px;">openstack</a> <a href="/history/tags/optimization/" style="font-size: 10px;">optimization</a> <a href="/history/tags/pandas/" style="font-size: 10px;">pandas</a> <a href="/history/tags/pandoc/" style="font-size: 10px;">pandoc</a> <a href="/history/tags/pgsql/" style="font-size: 11.58px;">pgsql</a> <a href="/history/tags/probability/" style="font-size: 10px;">probability</a> <a href="/history/tags/pyspark/" style="font-size: 10px;">pyspark</a> <a href="/history/tags/python/" style="font-size: 17.37px;">python</a> <a href="/history/tags/quartz/" style="font-size: 10.53px;">quartz</a> <a href="/history/tags/react/" style="font-size: 10px;">react</a> <a href="/history/tags/redis/" style="font-size: 15.79px;">redis</a> <a href="/history/tags/resource/" style="font-size: 10px;">resource</a> <a href="/history/tags/review/" style="font-size: 10px;">review</a> <a href="/history/tags/sbt/" style="font-size: 10px;">sbt</a> <a href="/history/tags/scala/" style="font-size: 14.74px;">scala</a> <a href="/history/tags/shell/" style="font-size: 12.63px;">shell</a> <a href="/history/tags/slf4j/" style="font-size: 10px;">slf4j</a> <a href="/history/tags/spark/" style="font-size: 14.74px;">spark</a> <a href="/history/tags/spring/" style="font-size: 15.79px;">spring</a> <a href="/history/tags/spring-cloud/" style="font-size: 12.11px;">spring cloud</a> <a href="/history/tags/spring-boot/" style="font-size: 13.68px;">spring-boot</a> <a href="/history/tags/springboot/" style="font-size: 11.05px;">springboot</a> <a href="/history/tags/sql/" style="font-size: 11.05px;">sql</a> <a href="/history/tags/sqlserver/" style="font-size: 10.53px;">sqlserver</a> <a href="/history/tags/ssh/" style="font-size: 12.11px;">ssh</a> <a href="/history/tags/statistics/" style="font-size: 10px;">statistics</a> <a href="/history/tags/syslog/" style="font-size: 10px;">syslog</a> <a href="/history/tags/term/" style="font-size: 10px;">term</a> <a href="/history/tags/test/" style="font-size: 10px;">test</a> <a href="/history/tags/texlive/" style="font-size: 10px;">texlive</a> <a href="/history/tags/thread/" style="font-size: 10px;">thread</a> <a href="/history/tags/tomcat/" style="font-size: 13.16px;">tomcat</a> <a href="/history/tags/tool/" style="font-size: 16.84px;">tool</a> <a href="/history/tags/ubuntu/" style="font-size: 16.32px;">ubuntu</a> <a href="/history/tags/urban-computing/" style="font-size: 10px;">urban computing</a> <a href="/history/tags/video/" style="font-size: 10px;">video</a> <a href="/history/tags/vim/" style="font-size: 10.53px;">vim</a> <a href="/history/tags/vpn/" style="font-size: 10px;">vpn</a> <a href="/history/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/history/tags/vue/" style="font-size: 11.05px;">vue</a> <a href="/history/tags/web/" style="font-size: 10px;">web</a> <a href="/history/tags/web-dav/" style="font-size: 10px;">web-dav</a> <a href="/history/tags/webpack/" style="font-size: 10.53px;">webpack</a> <a href="/history/tags/week/" style="font-size: 18.42px;">week</a> <a href="/history/tags/windows/" style="font-size: 10px;">windows</a> <a href="/history/tags/wordcloud/" style="font-size: 10px;">wordcloud</a> <a href="/history/tags/work/" style="font-size: 10px;">work</a> <a href="/history/tags/xml/" style="font-size: 10px;">xml</a> <a href="/history/tags/zipkin/" style="font-size: 10px;">zipkin</a> <a href="/history/tags/zookeeper/" style="font-size: 10px;">zookeeper</a> <a href="/history/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 12.63px;">云计算</a> <a href="/history/tags/%E5%85%83%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">元编程</a> <a href="/history/tags/%E5%9F%8E%E5%B8%82%E8%AE%A1%E7%AE%97/" style="font-size: 10px;">城市计算</a> <a href="/history/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">架构</a> <a href="/history/tags/%E6%A6%82%E5%BF%B5/" style="font-size: 10px;">概念</a> <a href="/history/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">测试</a> <a href="/history/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">爬虫</a> <a href="/history/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">运维</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2022/03/">三月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/history/archives/2017/12/">十二月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/history/2022/03/31/redis/000-redis-interview/">Redis面试总结202203</a>
          </li>
        
          <li>
            <a href="/history/2019/10/27/maven/009-maven-deploy/">使用IDEA部署jar包到maven仓库(maven deploy)</a>
          </li>
        
          <li>
            <a href="/history/2019/10/24/java/075-pluggable-annotation-processing-lombok/">Pluggable Annotation Processing的讲解与实践</a>
          </li>
        
          <li>
            <a href="/history/2019/10/18/life/036-weekly-learn/">2019-42-周报</a>
          </li>
        
          <li>
            <a href="/history/2019/10/15/shell/003-carriage-linechange/">r command not found</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Jackpler<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/history/" class="mobile-nav-link">home</a>
  
    <a href="/history/archives" class="mobile-nav-link">archives</a>
  
    <a href="/history/about" class="mobile-nav-link">about</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/history/fancybox/jquery.fancybox.css">

  
<script src="/history/fancybox/jquery.fancybox.pack.js"></script>




<script src="/history/js/script.js"></script>




  </div>
</body>
</html>